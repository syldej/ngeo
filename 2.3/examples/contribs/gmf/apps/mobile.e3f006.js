(function(e){function t(t){var a=t[0];var o=t[1];var s=t[2];var l,u,f=0,h=[];for(;f<a.length;f++){u=a[f];if(n[u]){h.push(n[u][0])}n[u]=0}for(l in o){if(Object.prototype.hasOwnProperty.call(o,l)){e[l]=o[l]}}if(c)c(t);while(h.length){h.shift()()}i.push.apply(i,s||[]);return r()}function r(){var e;for(var t=0;t<i.length;t++){var r=i[t];var a=true;for(var s=1;s<r.length;s++){var l=r[s];if(n[l]!==0)a=false}if(a){i.splice(t--,1);e=o(o.s=r[0])}}return e}var a={};var n={1:0};var i=[];function o(t){if(a[t]){return a[t].exports}var r=a[t]={i:t,l:false,exports:{}};e[t].call(r.exports,r,r.exports,o);r.l=true;return r.exports}o.m=e;o.c=a;o.d=function(e,t,r){if(!o.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:r})}};o.r=function(e){Object.defineProperty(e,"__esModule",{value:true})};o.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};o.d(t,"a",t);return t};o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[];var l=s.push.bind(s);s.push=t;s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var c=l;i.push([286,0]);return r()})([,function(e,t,r){"use strict";var a={};a.assert=function(e,t,r){return e};a.assertNumber=function(e,t,r){return e};a.assertString=function(e,t,r){return e};a.assertFunction=function(e,t,r){return e};a.assertObject=function(e,t,r){return e};a.assertArray=function(e,t,r){return e};a.assertBoolean=function(e,t,r){return e};a.assertElement=function(e,t,r){return e};a.assertInstanceof=function(e,t,r,a){return e};a.assertObjectPrototypeIsIntact=function(){};t["a"]=a},,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a={BOOLEAN:"boolean",DATE:"date",DATETIME:"datetime",TIME:"time",GEOMETRY:"geometry",NUMBER:"number",SELECT:"select",TEXT:"text"};t["a"]=a},,function(e,t,r){"use strict";var a={ANGLE:"a",COLOR:"c",IS_CIRCLE:"l",IS_RECTANGLE:"r",IS_TEXT:"t",NAME:"n",SHOW_LABEL:"b",OPACITY:"o",AZIMUT:"z",SHOW_MEASURE:"m",SIZE:"s",STROKE:"k"};t["a"]=a},,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(1);var n=r(100);var i=r(2);var o=r(8);var s=r(36);var l=r(73);var u=r(168);var c=function e(t,r,a,n,i,o){l["a"].call(this);this.addBlankBackgroundLayer_=true;if(o.addBlankBackgroundLayer!==undefined){this.addBlankBackgroundLayer_=o.addBlankBackgroundLayer}this.$q_=a;this.$http_=t;this.treeUrl_=undefined;if(r.has("gmfTreeUrl")){this.treeUrl_=r.get("gmfTreeUrl")}this.cacheVersion_="0";if(r.has("cacheVersion")){this.cacheVersion_=r.get("cacheVersion")}this.ngeoLocation_=null;if(r.has("ngeoLocation")){this.ngeoLocation_=r.get("ngeoLocation")}this.layerHelper_=n;this.gettextCatalog=i;this.deferred_=a.defer();this.promise_=this.deferred_.promise;this.loaded=false;this.bgLayerPromise_=null};c.$inject=["$http","$injector","$q","ngeoLayerHelper","gettextCatalog","gmfThemesOptions"];c.$inject=["$http","$injector","$q","ngeoLayerHelper","gettextCatalog","gmfThemesOptions"];i["d"](c,l["a"]);c.findGroupByLayerNodeName=function(e,t){for(var r=0,a=e.length;r<a;r++){var n=e[r];for(var i=0,o=n.children.length;i<o;i++){var s=n.children[i];var l=[];c.getFlatNodes(s,l);if(c.findObjectByName(l,t)){return s}}}return null};c.findGroupByName=function(e,t){for(var r=0,a=e.length;r<a;r++){var n=e[r];for(var i=0,o=n.children.length;i<o;i++){var s=n.children[i];var l=[];c.getFlatInternalNodes(s,l);if(c.findObjectByName(l,t)){return s}}}return null};c.findObjectByName=function(e,t){return o["d"](e,function(e){return e["name"]===t})};c.findThemeByName=function(e,t){return c.findObjectByName(e,t)};c.getFlatInternalNodes=function(e,t){var r=e.children;if(r!==undefined){t.push(e);for(var a=0;a<r.length;a++){c.getFlatInternalNodes(r[a],t)}}};c.getFlatNodes=function(e,t){var r=void 0;var a=e.children;if(a!==undefined){for(r=0;r<a.length;r++){c.getFlatNodes(a[r],t)}}else{t.push(e)}};c.prototype.getBgLayers=function(){var e=this;var t=this.gettextCatalog;if(this.bgLayerPromise_){return this.bgLayerPromise_}var r=this.$q_;var n=this.layerHelper_;var o=function e(t,r){r.push(i["c"](t));var a=t.children||[];a.forEach(function(t){e(t,r)})};var l=function e(t,r){r.set("label",t.name);r.set("metadata",t.metadata);r.set("dimensions",t.dimensions);var a=[];o(t,a);r.set("querySourceIds",a);return r};var c=function e(t,i){if(i.type==="WMTS"){var o=i;a["a"].assert(o.url,"Layer URL is required");return n.createWMTSLayerFromCapabilitites(o.url,o.layer||"",o.matrixSet,i.dimensions,o.metadata.customOpenLayersOptions).then(l.bind(null,i)).then(null,function(e){var t='Unable to build layer "'+o.layer+'" from WMTSCapabilities: '+o.url+"\n";t+='OpenLayers error is "'+e["message"];console.error(t);return r.resolve(undefined)})}else if(i.type==="WMS"){var s=i;a["a"].assert(s.ogcServer,"An OGC server is required");var u=t[s.ogcServer];a["a"].assert(u,"The OGC server was not found");a["a"].assert(u.url,"The server URL is required");a["a"].assert(u.imageType,"The server image type is required");var c={STYLES:s.styles};if(i.dimensions){for(var f=Object.entries(i.dimensions),h=Array.isArray(f),p=0,f=h?f:f[Symbol.iterator]();;){var d;if(h){if(p>=f.length)break;d=f[p++]}else{p=f.next();if(p.done)break;d=p.value}var g=d;var m=g[0];var v=g[1];c[m]=v}}return l(i,n.createBasicWMSLayer(u.url,s.layers||"",u.imageType,u.type,undefined,c,u.credential?"use-credentials":"anonymous",s.metadata.customOpenLayersOptions))}a["a"].fail("Unsupported type: "+i.type)};var f=function e(t,a){var i=a.children.map(function(e){return e}).reverse();var o=i.map(c.bind(null,t));return r.all(o).then(function(e){var t=void 0;if(e){e=e.filter(function(e){return e});t=new s["b"](e)}var r=n.createBasicGroup(t);l(a,r);return r})};var h=function(e){var t=e.background_layers.map(function(t){var r=t.type;if(r==="WMTS"||r==="WMS"){return c(e.ogcServers,t)}else if(t.children){return f(e.ogcServers,t)}else{return undefined}},this);return r.all(t)}.bind(this);this.bgLayerPromise_=this.promise_.then(h).then(function(r){var a=[];if(e.addBlankBackgroundLayer_){t.getString("blank");a.push(new u["a"]({label:"blank",metadata:{thumbnail:""}}))}r.forEach(function(e){if(e){a.push(e)}});return a});return this.bgLayerPromise_};c.prototype.getThemeObject=function(e){return this.promise_.then(function(t){return c.findThemeByName(t.themes,e)})};c.prototype.getThemesObject=function(){return this.promise_.then(function(e){return e.themes})};c.prototype.getBackgroundLayersObject=function(){a["a"].assert(this.promise_!==null);return this.promise_.then(function(e){return e.background_layers})};c.prototype.getOgcServersObject=function(){a["a"].assert(this.promise_!==null);return this.promise_.then(function(e){return e.ogcServers})};c.prototype.hasEditableLayers=function(){a["a"].assert(this.promise_!==null);return this.promise_.then(this.hasEditableLayers_.bind(this))};c.prototype.hasEditableLayers_=function(e){var t=this;return e.themes.some(function(e){var r=e.children.some(t.hasNodeEditableLayers_.bind(t));return r})};c.prototype.hasNodeEditableLayers_=function(e){if(e.editable){return true}var t=false;var r=e.children;if(r&&r.length){t=r.some(this.hasNodeEditableLayers_.bind(this))}return t};c.getSnappingConfig=function(e){var t=e.metadata&&e.metadata.snappingConfig!==undefined?e.metadata.snappingConfig:null;return t};c.getNodeMaxResolution=function(e){var t=e.metadata;var r=e.maxResolutionHint;if(r===undefined&&t!==undefined){r=t.maxResolution}return r};c.getNodeMinResolution=function(e){var t=e.metadata;var r=e.minResolutionHint;if(r===undefined&&t!==undefined){r=t.minResolution}return r};c.prototype.loadThemes=function(e){var t=this;a["a"].assert(this.treeUrl_,"gmfTreeUrl should be defined.");if(this.loaded){this.deferred_=this.$q_.defer();this.promise_=this.deferred_.promise;this.bgLayerPromise_=null;this.loaded=false}this.$http_.get(this.treeUrl_,{params:e!==undefined?{role:e,cache_version:this.cacheVersion_}:{cache_version:this.cacheVersion_},cache:false,withCredentials:true}).then(function(e){if(e.data.errors.length!=0){var r="The themes contain some errors:\n"+e.data.errors.join("\n");console.error(r);if(t.ngeoLocation_!==null&&t.ngeoLocation_.hasParam("debug")){window.alert(r)}}t.deferred_.resolve(e.data);t.dispatchEvent("change");t.loaded=true},function(e){t.deferred_.reject(e)})};c.NodeType={MIXED_GROUP:"MixedGroup",NOT_MIXED_GROUP:"NotMixedGroup",WMTS:"WMTS",WMS:"WMS"};c.module=angular.module("gmfThemes",[n["a"].module.name]);c.module.value("gmfThemesOptions",{});c.module.service("gmfThemes",c);t["a"]=c},function(e,t,r){"use strict";var a=r(1);var n=r(122);var i=r(108);var o=r(24);var s=r(218);var l=r(135);var u=r(172);var c=r(361);var f=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function d(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var g=function(e){d(t,e);function t(r){h(this,t);var n=p(this,e.call(this,r));n.dimensionsConfig_=r.dimensionsConfig||null;n.dimensionsFiltersConfig_=r.dimensionsFiltersConfig||null;n.filterCondition_=r.filterCondition||i["a"].AND;n.filterRules_=r.filterRules||null;n.filtrable_=r.filtrable||null;n.copyable_=r.copyable===true;n.dimensions_=r.dimensions||null;n.geometryName_=r.geometryName||t.DEFAULT_GEOMETRY_NAME_;n.ogcImageType_=r.ogcImageType||"image/png";n.ogcLayers_=r.ogcLayers||null;n.ogcServerType_=r.ogcServerType||t.ServerType.MAPSERVER;n.ogcType_=r.ogcType||t.Type.WMS;n.snappable_=r.snappable===true;n.snappingToEdges_=r.snappingToEdges!==false;n.snappingToVertice_=r.snappingToVertice!==false;n.snappingTolerance_=r.snappingTolerance!==undefined?r.snappingTolerance:10;n.timeAttributeName_=r.timeAttributeName;n.timeLowerValue_=r.timeLowerValue;n.timeProperty_=r.timeProperty!==undefined?r.timeProperty:null;n.timeUpperValue_=r.timeUpperValue;n.wfsFeatureNS_=r.wfsFeatureNS||t.WFSFeatureNS[n.ogcServerType_];n.wfsFeaturePrefix_=r.wfsFeaturePrefix||t.WFSFeaturePrefix.FEATURE;n.wfsOutputFormat_=r.wfsOutputFormat||t.WFSOutputFormat.GML3;n.wfsUrl_=r.wfsUrl;n.wmsInfoFormat_=r.wmsInfoFormat||t.WMSInfoFormat.GML;n.wmsIsSingleTile_=r.wmsIsSingleTile===true;n.wmsUrl_=r.wmsUrl;n.wmtsLayer_=r.wmtsLayer;n.wmtsUrl_=r.wmtsUrl;var o=[];if(n.queryable&&n.ogcLayers){for(var f=n.ogcLayers,d=Array.isArray(f),g=0,f=d?f:f[Symbol.iterator]();;){var m;if(d){if(g>=f.length)break;m=f[g++]}else{g=f.next();if(g.done)break;m=g.value}var v=m;if(v.queryable){o.push(v.name)}}}var y=null;if(n.supportsWFS&&o.length){var _=undefined;if(n.wfsOutputFormat_===t.WFSOutputFormat.GML3){_=new l["a"]}else if(n.wfsOutputFormat_===t.WFSOutputFormat.GML2){_=new s["a"]}a["a"].assert(_);y=new u["a"]({featureNS:n.wfsFeatureNS,featureType:o,gmlFormat:_})}n.wfsFormat_=y;var S=null;if(n.supportsWMS&&o.length){if(n.wmsInfoFormat===t.WMSInfoFormat.GML){S=new c["a"]({layers:o})}}n.wmsFormat_=S;return n}t.prototype.getAttributes=function t(){return e.prototype.attributes};t.prototype.setAttributes=function t(r){e.prototype.setAttributes.call(this,r);this.updateGeometryNameFromAttributes_()};t.prototype.combinableWithDataSourceForWFS=function e(t){return this.combinableForWFS&&t.combinableForWFS&&this.supportsWFS&&t.supportsWFS&&this.queryable&&t.queryable&&this.wfsUrl===t.wfsUrl&&this.haveTheSameActiveDimensions(t)};t.prototype.combinableWithDataSourceForWMS=function e(t){return this.combinableForWMS&&t.combinableForWMS&&this.supportsWMS&&t.supportsWMS&&this.queryable&&t.queryable&&this.wmsUrl===t.wmsUrl&&this.haveTheSameActiveDimensions(t)};t.prototype.isAnyOGCLayerInRange=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return!!this.getInRangeOGCLayerNames(t,r).length};t.prototype.getInRangeOGCLayerNames=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var a=[];if(this.ogcLayers){for(var n=this.ogcLayers,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;var u=l.maxResolution;var c=l.minResolution;var f=c===undefined||t>=c;var h=u===undefined||t<=u;var p=f&&h;if(p&&(!r||l.queryable)){a.push(l.name)}}}return a};t.prototype.getOGCLayerNames=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var r=[];if(this.ogcLayers){for(var a=this.ogcLayers,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(!t||s.queryable){r.push(s.name)}}}return r};t.prototype.getFiltrableOGCLayerName=function e(){a["a"].assert(this.filtrable);var t=this.getOGCLayerNames();a["a"].assert(t.length===1);return t[0]};t.prototype.updateGeometryNameFromAttributes_=function e(){var r=t.DEFAULT_GEOMETRY_NAME_;if(this.attributes){for(var a=this.attributes,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var s;if(n){if(i>=a.length)break;s=a[i++]}else{i=a.next();if(i.done)break;s=i.value}var l=s;if(l.type===o["a"].GEOMETRY){r=l.name;break}}}this.geometryName_=r};t.prototype.haveTheSameActiveDimensions=function e(t){var r=true;var a=this.activeDimensions;var n=t.activeDimensions;for(var i in a){if(a[i]!==n[i]){r=false;break}}if(r){for(var o in n){if(n[o]!==a[o]){r=false;break}}}return r};f(t,[{key:"dimensions",get:function e(){return this.dimensions_}},{key:"dimensionsConfig",get:function e(){return this.dimensionsConfig_},set:function e(t){this.dimensionsConfig_=t}},{key:"dimensionsFiltersConfig",get:function e(){return this.dimensionsFiltersConfig_},set:function e(t){this.dimensionsFiltersConfig_=t}},{key:"filterCondition",get:function e(){return this.filterCondition_},set:function e(t){this.filterCondition_=t}},{key:"filterRules",get:function e(){return this.filterRules_},set:function e(t){this.filterRules_=t}},{key:"timeLowerValue",get:function e(){return this.timeLowerValue_},set:function e(t){this.timeLowerValue_=t}},{key:"timeRangeValue",get:function e(){var t=null;var r=this.timeLowerValue;var a=this.timeUpperValue;if(r!==undefined){t={end:a,start:r}}return t},set:function e(t){if(t){this.timeUpperValue=t.end;this.timeLowerValue=t.start}else{this.timeUpperValue=undefined;this.timeLowerValue=undefined}}},{key:"timeUpperValue",get:function e(){return this.timeUpperValue_},set:function e(t){this.timeUpperValue_=t}},{key:"copyable",get:function e(){return this.copyable_}},{key:"filtrable",get:function e(){return this.filtrable_},set:function e(t){this.filtrable_=t}},{key:"geometryName",get:function e(){return this.geometryName_}},{key:"ogcImageType",get:function e(){return this.ogcImageType_}},{key:"ogcLayers",get:function e(){return this.ogcLayers_}},{key:"ogcServerType",get:function e(){return this.ogcServerType_}},{key:"ogcType",get:function e(){return this.ogcType_}},{key:"snappable",get:function e(){return this.snappable_}},{key:"snappingToEdges",get:function e(){return this.snappingToEdges_}},{key:"snappingToVertice",get:function e(){return this.snappingToVertice_}},{key:"snappingTolerance",get:function e(){return this.snappingTolerance_}},{key:"timeAttributeName",get:function e(){return this.timeAttributeName_}},{key:"timeProperty",get:function e(){return this.timeProperty_}},{key:"wfsFeatureNS",get:function e(){return this.wfsFeatureNS_}},{key:"wfsFeaturePrefix",get:function e(){return this.wfsFeaturePrefix_}},{key:"wfsOutputFormat",get:function e(){return this.wfsOutputFormat_}},{key:"wfsUrl",get:function e(){return this.wfsUrl_}},{key:"wmsInfoFormat",get:function e(){return this.wmsInfoFormat_}},{key:"wmsIsSingleTile",get:function e(){return this.wmsIsSingleTile_}},{key:"wmsUrl",get:function e(){return this.wmsUrl_}},{key:"wmtsLayer",get:function e(){return this.wmtsLayer_}},{key:"wmtsUrl",get:function e(){return this.wmtsUrl_}},{key:"activeDimensions",get:function e(){var t={};var r=this.dimensions_||{};var a=this.dimensionsConfig||{};for(var n in a){if(a[n]===null){if(r[n]!==undefined&&r[n]!==null){t[n]=r[n]}}else{t[n]=a[n]}}return t}},{key:"combinableForWFS",get:function e(){return this.filterRules_===null&&this.timeRangeValue===null}},{key:"combinableForWMS",get:function e(){return this.filterRules_===null&&this.timeRangeValue===null}},{key:"queryable",get:function e(){var t=false;var r=this.supportsWMS||this.supportsWFS;if(r&&this.ogcLayers){for(var a=this.ogcLayers,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.queryable===true){t=true;break}}}return t}},{key:"supportsWFS",get:function e(){return this.wfsUrl!==undefined}},{key:"supportsAttributes",get:function e(){return this.attributes!==null||this.supportsWFS&&this.ogcLayers!==null&&this.ogcLayers.length===1&&this.ogcLayers[0].queryable===true}},{key:"supportsWMS",get:function e(){return this.wmsUrl!==undefined}},{key:"supportsWMTS",get:function e(){return this.wmtsUrl!==undefined}},{key:"wfsFormat",get:function e(){return this.wfsFormat_}},{key:"wmsFormat",get:function e(){return this.wmsFormat_}}]);return t}(n["a"]);g.guessServiceTypeByUrl=function(e){var t=void 0;if(/(wmts)/i.test(e)){t=g.Type.WMTS}else{t=g.Type.WMS}return t};g.DEFAULT_GEOMETRY_NAME_="the_geom";g.ServerType={GEOSERVER:"geoserver",MAPSERVER:"mapserver",QGISSERVER:"qgisserver"};g.Type={WMS:"WMS",WMTS:"WMTS"};g.WFSFeatureNS={geoserver:"http://www.opengis.net/gml/3.2",mapserver:"http://mapserver.gis.umn.edu/mapserver",qgisserver:"http://www.qgis.org/gml"};g.WFSFeaturePrefix={FEATURE:"feature"};g.WFSOutputFormat={GML2:"GML2",GML3:"GML3"};g.WMSInfoFormat={GML:"application/vnd.ogc.gml"};t["a"]=g},function(e,t,r){"use strict";var a={};a.DATALAYERGROUP_NAME="data";a.EXTERNALLAYERGROUP_NAME="external";a.COORDINATES_LAYER_NAME="gmfCoordinatesLayerName";a.PermalinkParam={BG_LAYER:"baselayer_ref",EXTERNAL_DATASOURCES_NAMES:"eds_n",EXTERNAL_DATASOURCES_URLS:"eds_u",FEATURES:"rl_features",MAP_CROSSHAIR:"map_crosshair",MAP_TOOLTIP:"map_tooltip",MAP_X:"map_x",MAP_Y:"map_y",MAP_Z:"map_zoom",TREE_GROUPS:"tree_groups",WFS_LAYER:"wfs_layer",WFS_NGROUPS:"wfs_ngroups",WFS_SHOW_FEATURES:"wfs_showFeatures"};t["a"]=a},,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(2);var n=r(43);var i=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};n["a"].call(this,t);this.detail=r};a["d"](i,n["a"]);t["a"]=i},,,function(e,t,r){"use strict";var a=function e(){};a.prototype.showMessage=function(e){};a.prototype.show=function(e){var t=this.getMessageObjects(e);t.forEach(this.showMessage,this)};a.prototype.error=function(e){this.show(this.getMessageObjects(e,a.Type.ERROR))};a.prototype.info=function(e){this.show(this.getMessageObjects(e,a.Type.INFORMATION))};a.prototype.success=function(e){this.show(this.getMessageObjects(e,a.Type.SUCCESS))};a.prototype.warn=function(e){this.show(this.getMessageObjects(e,a.Type.WARNING))};a.prototype.getMessageObjects=function(e,t){var r=[];var n=null;var i=a.Type.INFORMATION;if(typeof e==="string"){r.push({msg:e,type:t!==undefined?t:i})}else if(Array.isArray(e)){e.forEach(function(a){if(typeof e==="string"){n={msg:a,type:t!==undefined?t:i}}else{n=a;if(t!==undefined){n.type=t}}r.push(n)},this)}else{n=e;if(t!==undefined){n.type=t}if(n.type===undefined){n.type=i}r.push(n)}return r};a.Type={ERROR:"error",INFORMATION:"information",SUCCESS:"success",WARNING:"warning"};t["a"]=a},,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(1);var n=r(95);var i=r(2);var o=r(3);var s=r(92);var l=r(84);var u=function e(t,r,u){var c=this;var f=u["ngeoLayertreeNotroot"]===undefined;this.isRoot=f;var h=u["ngeoLayertree"];this.rootScope_=r;this.properties={};this.state_="off";this.node;if(f){t.$watch(h,function(e,t){c.node=e})}else{this.node=t.$eval(h);a["a"].assert(this.node!==undefined)}var p=u["ngeoLayertreeMap"];var d=t.$eval(p);a["a"].assert(d!==undefined);this.parent=t.$parent["layertreeCtrl"];this.children=[];if(this.parent){this.parent.children.push(this)}t.$on("$destroy",function(){if(c.parent){var e=c.parent.children.indexOf(c);a["a"].assert(e>=0);c.parent.children.splice(e,1)}});this.uid=i["c"](this);this.depth=f?0:this.parent.depth+1;t["uid"]=this.uid;t["depth"]=this.depth;this.map=d;var g=u["ngeoLayertreeNodelayer"];if(g===undefined){var m=u["ngeoLayertreeNodelayerexpr"];var v=t.$eval(m);a["a"].assertString(v);g=v}a["a"].assert(g!==undefined);this.nodelayerExpr=g;this.layer=null;if(!f){var y=t.$eval(g,{treeCtrl:this})||null;if(y){a["a"].assert(y instanceof l["a"]||y instanceof s["a"]);this.layer=y}}this.dataSource_=null;if(this.layer){n["a"].layerLoading(this.layer,t);n["a"].layer(this.layer);o["a"](this.layer,"change:opacity",function(){c.rootScope_.$broadcast("ngeo-layertree-opacity",c)})}var _=u["ngeoLayertreeListeners"];if(_===undefined){var S=u["ngeoLayertreeListenersexpr"];_=t.$eval(S)}if(_!==undefined){a["a"].assertString(_)}this.listenersExpr=_;if(_){t.$eval(_,{treeScope:t,treeCtrl:this})}t["layertreeCtrl"]=this};u.$inject=["$scope","$rootScope","$attrs"];u.$inject=["$scope","$rootScope","$attrs"];u.prototype.getState=function(){return this.state_};u.prototype.setState=function(e,t){var r=this;if(e===this.state_){return}this.setStateInternal_(e);if(this.parent){this.parent.refreshState()}var a=this.isRoot?this.children:[u.getFirstParentTree(this)];if(t===undefined||t){a.forEach(function(e){r.rootScope_.$broadcast("ngeo-layertree-state",r,e)})}};u.prototype.setStateInternal_=function(e){var t=this;this.state_=e==="on"?"on":"off";this.children.forEach(function(e){e.setStateInternal_(t.state_)})};u.prototype.refreshState=function(){var e=this.getCalculateState();if(this.state_===e){return}this.state_=e;if(this.parent){this.parent.refreshState()}};u.prototype.getCalculateState=function(){if(this.node.children===undefined){return this.state_}var e=void 0;var t=void 0;this.children.some(function(r){e=r.getCalculateState();if(t){if(t!==e){return e="indeterminate"}}t=e});return e};u.prototype.getSetActive=function(e){var t=this.layer;var r=this.map;if(!t){return}if(e!==undefined){if(!e){r.removeLayer(t)}else{r.addLayer(t)}}else{return r.getLayers().getArray().indexOf(t)>=0}};u.prototype.getDataSource=function(){return this.dataSource_};u.prototype.setDataSource=function(e){this.dataSource_=e};u.getFirstParentTree=function(e){var t=e;while(!t.parent.isRoot){t=t.parent}return t};u.VisitorDecision={STOP:"STOP",SKIP:"SKIP",DESCEND:"DESCEND"};u.Visitor;u.prototype.traverseDepthFirst=function(e){var t=e(this)||u.VisitorDecision.DESCEND;switch(t){case u.VisitorDecision.STOP:return true;case u.VisitorDecision.SKIP:return false;case u.VisitorDecision.DESCEND:for(var r=0;r<this.children.length;++r){var n=this.children[r];var i=n.traverseDepthFirst(e);if(i){return true}}return false;default:a["a"].fail("Unhandled case")}};u.module=angular.module("ngeoLayertreeController",[]);u.module.controller("ngeoLayertreeController",u);t["a"]=u},,,function(e,t,r){"use strict";var a=r(44);var n=r(53);var i=r(109);var o=r(105);var s=r(116);var l=r(38);var u=r(45);var c={};c.toMulti=function(e){var t=void 0;if(e instanceof l["a"]){t=new i["a"]([]);t.appendPoint(e)}else if(e instanceof n["a"]){t=new o["a"]([]);t.appendLineString(e)}else if(e instanceof u["b"]){t=new s["a"]([]);t.appendPolygon(e)}else{t=e}return t};c.isSafari=function(){return navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1};c.colorZeroPadding=function(e){return e.length==1?"0"+e:e};c.rgbArrayToHex=function(e){var t=e[0];var r=e[1];var a=e[2];if(t!=(t&255)||r!=(r&255)||a!=(a&255)){throw Error('"('+t+","+r+","+a+')" is not a valid RGB color')}var n=c.colorZeroPadding(t.toString(16));var i=c.colorZeroPadding(r.toString(16));var o=c.colorZeroPadding(a.toString(16));return"#"+n+i+o};c.decodeQueryString=function(e){var t={};if(e){var r=e.substring(1).split("&");for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;var l=s.indexOf("=");if(l>=0){var u=s.substring(0,l);var c=s.substring(l+1);t[decodeURIComponent(u)]=decodeURIComponent(c)}else{t[s]=""}}}return t};c.encodeQueryString=function(e){var t=[];for(var r in e){var a=e[r];t.push(encodeURIComponent(r)+"="+encodeURIComponent(a))}return t.join("&")};c.deleteCondition=function(e){return a["f"](e)&&a["i"](e)};t["a"]=c},,,,,,,,,,function(e,t,r){"use strict";var a=r(1);var n=r(145);var i=r(2);var o=r(91);var s=r(11);var l=r(82);var u=r(16);var c=function e(){this.featureUidToGroupIndex_={};this.groups_=[];this.source_=new l["b"]({useSpatialIndex:false});this.layer_=new o["a"]({source:this.source_,style:this.styleFunction_.bind(this),updateWhileAnimating:true,updateWhileInteracting:true})};c.prototype.addFeature=function(e,t){a["a"].assert(t>=0);a["a"].assert(t<this.groups_.length);var r=i["c"](e).toString();this.featureUidToGroupIndex_[r]=t;this.groups_[t].features[r]=e;this.source_.addFeature(e)};c.prototype.removeFeature=function(e,t){a["a"].assert(t>=0);a["a"].assert(t<this.groups_.length);var r=i["c"](e).toString();delete this.featureUidToGroupIndex_[r];delete this.groups_[t].features[r];this.source_.removeFeature(e)};c.prototype.clear=function(e){a["a"].assert(e>=0);a["a"].assert(e<this.groups_.length);var t=this.groups_[e];for(var r in t.features){this.removeFeature(t.features[r],e)}a["a"].assert(s["d"](t.features))};c.prototype.getLayer=function(){return this.layer_};c.prototype.getFeatureOverlay=function(){var e=this.groups_.length;this.groups_.push({styleFunction:u["a"],features:{}});return new n["a"](this,e)};c.prototype.init=function(e){this.layer_.setMap(e)};c.prototype.setStyle=function(e,t){a["a"].assert(t>=0);a["a"].assert(t<this.groups_.length);this.groups_[t].styleFunction=e===null?u["c"].defaultFunction:Object(u["d"])(e)};c.prototype.styleFunction_=function(e,t){var r=i["c"](e).toString();a["a"].assert(r in this.featureUidToGroupIndex_);var n=this.featureUidToGroupIndex_[r];var o=this.groups_[n];return o.styleFunction(e,t)};c.module=angular.module("ngeoFeatureOverlayMgr",[n["a"].module.name]);c.module.service("ngeoFeatureOverlayMgr",c);t["a"]=c},function(e,t,r){"use strict";var a=r(1);var n=r(133);var i=r(2);var o=function e(t,r){this.$filter_=t;this.gettextCatalog_=r;n["a"].call(this)};o.$inject=["$filter","gettextCatalog"];o.$inject=["$filter","gettextCatalog"];i["d"](o,n["a"]);o.prototype.formatTimeValue=function(e,t,r,a){var n=new Date(e);var i=a?"UTC":undefined;var o="yyyy";var s="yyyy-MM";var l="yyyy-MM-dd";if(!r){var u=this.gettextCatalog_;o=u.getString("yyyy");s=u.getString("M/yyyy");l=u.getString("M/d/yyyy")}switch(t){case"year":return this.$filter_("date")(n,o,i);case"month":return this.$filter_("date")(n,s,i);case"day":return this.$filter_("date")(n,l,i);default:return n.toISOString().replace(/\.\d{3}/,"")}};o.prototype.formatWMSTimeParam=function(e,t,r){a["a"].assert(e.resolution!==undefined);if(e.mode==="range"){a["a"].assert(t.end!==undefined);return this.formatTimeValue(t.start,e.resolution,true,r)+"/"+this.formatTimeValue(t.end,e.resolution,true,r)}else{return this.formatTimeValue(t.start,e.resolution,true,r)}};o.module=angular.module("ngeoWMSTime",[n["a"].module.name]);o.module.service("ngeoWMSTime",o);t["a"]=o},,,,,,function(e,t,r){"use strict";var a=r(1);var n=r(35);var i=r(153);var o=r(92);var s=r(84);var l=r(215);var u=r(225);var c={};c.interaction=function(e){a["a"].assertInstanceof(e,n["a"]);Object.defineProperty(e,"active",{get:function t(){return e.getActive()},set:function t(r){e.setActive(r)}})};c.layer=function(e){a["a"].assertInstanceof(e,i["a"]);Object.defineProperty(e,"visible",{configurable:true,get:function t(){return e.getVisible()},set:function t(r){e.setVisible(r)}});Object.defineProperty(e,"opacity",{configurable:true,get:function t(){return e.getOpacity()},set:function t(r){e.setOpacity(r)}})};c.layerLoading=function(e,t){var r=void 0;var n=null;var i=null;var c=h;var f=p;e.set("load_count",0,true);if(e instanceof o["a"]){e.getLayers().on("add",function(t){var r=t.element;r.set("parent_group",e)})}if(e instanceof s["a"]){r=e.getSource();if(r===null){return}else if(r instanceof u["b"]){n=["tileloadstart"];i=["tileloadend","tileloaderror"]}else if(r instanceof l["a"]){n=["imageloadstart"];i=["imageloadend","imageloaderror"]}else{a["a"].fail("unsupported source type")}r.on(n,function(){c(e);t.$applyAsync()});r.on(i,function(){f(e);t.$applyAsync()})}Object.defineProperty(e,"loading",{configurable:true,get:function t(){return e.get("load_count")>0}});function h(e){var t=e.get("load_count");var r=e.get("parent_group");e.set("load_count",++t,true);if(r){h(r)}}function p(e){var t=e.get("load_count");var r=e.get("parent_group");e.set("load_count",--t,true);if(r){p(r)}}};t["a"]=c},,,function(e,t,r){"use strict";(function(e){var a=r(41);var n=r(39);var i=r(1);var o=r(75);var s=r(59);var l=r(130);var u=r(128);var c=r(8);var f=r(3);var h=r(11);var p=function e(t,r,a,n,i,o,s){this.$timeout_=t;this.$injector_=r;this.gettextCatalog_=a;this.layerHelper_=n;this.ngeoNotification_=i;this.gmfThemes_=o;this.root={children:[]};this.rootCtrl=null;this.numberOfGroupsToAddInThisDigestLoop=0;this.groupsToAddInThisDigestLoop_=[];this.promiseForGroupsToAddInThisDigestLoop_=null;this.ngeoStateManager_=s;this.ogcServers_=null;f["a"](this.gmfThemes_,"change",this.handleThemesChange_,this)};p.$inject=["$timeout","$injector","gettextCatalog","ngeoLayerHelper","ngeoNotification","gmfThemes","ngeoStateManager"];p.$inject=["$timeout","$injector","gettextCatalog","ngeoLayerHelper","ngeoNotification","gmfThemes","ngeoStateManager"];p.prototype.handleThemesChange_=function(){var e=this;this.gmfThemes_.getOgcServersObject().then(function(t){e.ogcServers_=t});if(this.rootCtrl&&this.rootCtrl.children){this.gmfThemes_.getThemesObject().then(function(t){e.refreshFirstLevelGroups_(t)})}};p.prototype.setFirstLevelGroups=function(e){this.root.children.length=0;this.ngeoStateManager_.deleteParam(a["a"].PermalinkParam.TREE_GROUPS);return this.addFirstLevelGroups(e)};p.prototype.addFirstLevelGroups=function(e,t,r){var a=this;var n=[];e.slice().reverse().forEach(function(e){if(!a.addFirstLevelGroup_(e)){n.push(e)}});if(n.length>0&&!r){this.notifyCantAddGroups_(n)}return n.length===0};p.prototype.updateTreeGroupsState_=function(e){var t={};t[a["a"].PermalinkParam.TREE_GROUPS]=e.map(function(e){return e.name}).join(",");this.ngeoStateManager_.updateState(t);if(this.$injector_.has("gmfPermalink")){this.$injector_.get("gmfPermalink").cleanParams(e)}};p.prototype.addFirstLevelGroup_=function(e){var t=this;var r=false;var a=e.id;this.root.children.some(function(e){if(a===e.id){return r=true}},this);this.groupsToAddInThisDigestLoop_.some(function(e){if(a===e.id){return r=true}},this);if(r){return false}this.groupsToAddInThisDigestLoop_.push(e);this.numberOfGroupsToAddInThisDigestLoop=0;if(this.promiseForGroupsToAddInThisDigestLoop_!==null){this.$timeout_.cancel(this.promiseForGroupsToAddInThisDigestLoop_)}this.promiseForGroupsToAddInThisDigestLoop_=this.$timeout_(function(){t.numberOfGroupsToAddInThisDigestLoop=t.groupsToAddInThisDigestLoop_.length;t.groupsToAddInThisDigestLoop_.forEach(function(e){t.root.children.unshift(e)});t.updateTreeGroupsState_(t.root.children);t.groupsToAddInThisDigestLoop_.length=0;t.promiseForGroupsToAddInThisDigestLoop_=null});return true};p.prototype.addGroupByName=function(e,t){var r=this;this.gmfThemes_.getThemesObject().then(function(a){var i=n["a"].findGroupByName(a,e);if(i){r.addFirstLevelGroups([i],t,false)}})};p.prototype.addGroupByLayerName=function(e,t,r){var a=this;this.gmfThemes_.getThemesObject().then(function(i){var s=n["a"].findGroupByLayerNodeName(i,e);if(s){var l=a.addFirstLevelGroups([s],t,r);a.$timeout_(function(){var t=a.getTreeCtrlByNodeId(s.id);if(!t){console.warn("Tree controller not found, unable to add the group");return}var r=void 0;t.traverseDepthFirst(function(t){if(t.node.name===e){r=t;return o["a"].VisitorDecision.STOP}});if(l){t.setState("off")}if(r){r.setState("on")}})}})};p.prototype.removeGroup=function(e){var t=this.root.children;var r=0,a=false;t.some(function(t){if(t.name===e.name){return a=true}r++});if(a){t.splice(r,1);this.updateTreeGroupsState_(t)}};p.prototype.removeAll=function(){while(this.root.children.length){this.removeGroup(this.root.children[0])}};p.prototype.cloneGroupNode_=function(e,t){var r=h["a"]({},e);this.toggleNodeCheck_(r,t);return r};p.prototype.toggleNodeCheck_=function(e,t){var r=this;if(!e.children){return}e.children.forEach(function(e){if(e.children){r.toggleNodeCheck_(e,t)}else if(e.metadata){e.metadata.isChecked=c["f"](t,e.name)}})};p.prototype.notifyCantAddGroups_=function(e){var t=[];var r=this.gettextCatalog_;e.forEach(function(e){t.push(r.getString(e.name))});var a=t.length<2?r.getString("group is already loaded."):r.getString("groups are already loaded.");this.ngeoNotification_.notify({msg:t.join(", ")+" "+a,type:s["a"].Type.INFORMATION})};p.prototype.getTreeCtrlByNodeId=function(e){var t=null;if(this.rootCtrl&&this.rootCtrl.traverseDepthFirst){this.rootCtrl.traverseDepthFirst(function(r){if(r.node.id===e){t=r;return o["a"].VisitorDecision.STOP}})}return t};p.prototype.getOgcServer=function(e){if(e.parent.node.mixed){var t=e.node;i["a"].assert(t.ogcServer);return this.ogcServers_[t.ogcServer]}else{var r=e;while(!r.parent.isRoot){r=r.parent}var a=r.node;i["a"].assert(a.ogcServer);return this.ogcServers_[a.ogcServer]}};p.prototype.refreshFirstLevelGroups_=function(e){var t=this;var r={};this.rootCtrl.children.map(function(e){var a=e.node.name;r[a]=t.getFirstLevelGroupFullState_(e)});var a=[];this.root.children.map(function(i){var o=i.name;var s=n["a"].findGroupByName(e,o);if(s){var l=r[o];if(l){t.setNodeMetadataFromFullState_(s,l)}a.push(s)}});this.setFirstLevelGroups(a);this.$timeout_(function(){t.updateTreeGroupsState_(t.root.children)})};p.prototype.getFirstLevelGroupFullState_=function(t){var r=this;var a={};t.children.map(function(e){a[e.node.name]=r.getFirstLevelGroupFullState_(e)});var n=void 0,i=void 0,o=void 0;if(t.children.length>0){var s=e("#gmf-layertree-layer-group-"+t.uid);if(s){i=s.hasClass("in")}}else{n=t.getState();if(n==="on"){n=true}else if(n==="off"){n=false}else{n=undefined}var l=e("#gmf-layertree-node-"+t.uid+"-legend");if(l){o=l.is(":visible")}}return{children:a,isChecked:n,isExpanded:i,isLegendExpanded:o}};p.prototype.setNodeMetadataFromFullState_=function(e,t){var r=this;if(!t){return e}if(e.children){e.children.map(function(e){r.setNodeMetadataFromFullState_(e,t.children[e.name])})}var a=e.metadata;a.isChecked=t.isChecked;a.isExpanded=t.isExpanded;a.isLegendExpanded=t.isLegendExpanded;return e};p.module=angular.module("gmfTreeManager",[n["a"].module.name,o["a"].module.name,l["a"].module.name,u["a"].module.name]);p.module.service("gmfTreeManager",p);t["a"]=p}).call(this,r(33))},,function(e,t,r){"use strict";var a=r(1);var n=r(8);var i=r(272);var o=r(92);var s=r(175);var l=r(168);var u=r(11);var c=r(149);var f=r(222);var h=r(169);var p=r(142);var d=function e(t,r,a){this.$q_=t;this.$http_=r;this.tilesPreloadingLimit_=a};d.$inject=["$q","$http","ngeoTilesPreloadingLimit"];d.$inject=["$q","$http","ngeoTilesPreloadingLimit"];d.GROUP_KEY="groupName";d.REFRESH_PARAM="random";d.prototype.createBasicWMSLayer=function(e,t,r,a,n,i,o,l){var u={FORMAT:r,LAYERS:t};var f=void 0;if(n){u["TIME"]=n}if(a){u["SERVERTYPE"]=a;f=a.replace("qgisserver","qgis")}var h=Object.assign({},l,{url:e,params:u,serverType:f,crossOrigin:o});var p=new c["a"](h);if(i){p.updateParams(i)}return new s["a"]({source:p})};d.prototype.createBasicWMSLayerFromDataSource=function(e,t){var r=e.wmsUrl;a["a"].assert(r);var n=e.getOGCLayerNames().join(",");var i=e.ogcServerType;var o=e.ogcImageType;var s=this.createBasicWMSLayer(r,n,o,i,undefined,undefined,t);s.setVisible(e.visible);s.set("querySourceIds",[e.id]);return s};d.prototype.createWMTSLayerFromCapabilitites=function(e,t,r,a,o){var s=new i["a"];var c=new l["a"]({preload:this.tilesPreloadingLimit_});var f=this.$q_;return this.$http_.get(e,{cache:true}).then(function(i){var l=void 0;if(i.data){l=s.read(i.data)}if(l){var p=Object.assign({},o,Object(h["b"])(l,{matrixSet:r,crossOrigin:"anonymous",layer:t}));var d=new h["a"](p);if(a&&!u["d"](a)){d.updateDimensions(a)}c.setSource(d);var g=l["Contents"]["Layer"];var m=n["d"](g,function(e,r,a){return e["Identifier"]==t});c.set("capabilitiesStyles",m["Style"]);return f.resolve(c)}return f.reject("Failed to get WMTS capabilities from "+e)})};d.prototype.createWMTSLayerFromCapabilititesObj=function(e,t,r){var n=Object(h["b"])(e,{crossOrigin:"anonymous",layer:t["Identifier"]});a["a"].assert(n);var i=new h["a"](n);if(r&&!u["d"](r)){i.updateDimensions(r)}return new l["a"]({capabilitiesStyles:t["Style"],preload:Infinity,source:i})};d.prototype.createBasicGroup=function(e){var t=new o["a"];if(e){t.setLayers(e)}return t};d.prototype.getGroupFromMap=function(e,t){var r=e.getLayerGroup().getLayers();var a=void 0;r.getArray().some(function(e){if(e.get(d.GROUP_KEY)===t){a=e;return true}else{return false}});if(!a){a=this.createBasicGroup();a.set(d.GROUP_KEY,t);e.addLayer(a)}return a};d.prototype.getFlatLayers=function(e){if(e instanceof o["a"]){var t=e.getLayers().getArray();var r=t.some(function(e){return e instanceof o["a"]});if(!r){return t.slice()}}return this.getFlatLayers_(e,[],undefined)};d.prototype.getFlatLayers_=function(e,t,r){var a=this;var n=e.getOpacity();if(r!==undefined){r*=n}else{r=n}if(e instanceof o["a"]){var i=e.getLayers();i.forEach(function(e){a.getFlatLayers_(e,t,r)})}else{if(t.indexOf(e)<0){e.set("inheritedOpacity",r,true);t.push(e)}}return t};d.prototype.getLayerByName=function(e,t){var r=this;var a=null;t.some(function(t){if(t instanceof o["a"]){var n=t.getLayers().getArray();a=r.getLayerByName(e,n)}else if(t.get("layerNodeName")===e){a=t}return!!a});return a};d.prototype.getWMTSLegendURL=function(e){var t=void 0;var r=e.get("capabilitiesStyles");if(r!==undefined){var a=r[0]["legendURL"];if(a!==undefined){t=a[0]["href"]}}return t};d.prototype.getWMSLegendURL=function(e,t,r,a,n,i,o,s,l,u,c){if(!e){return undefined}var f={FORMAT:"image/png",TRANSPARENT:true,SERVICE:"WMS",VERSION:"1.1.1",REQUEST:"GetLegendGraphic",LAYER:t};if(r!==undefined){f["SCALE"]=r}if(a!==undefined){f["RULE"]=a;if(n!==undefined){f["WIDTH"]=n}if(i!==undefined){f["HEIGHT"]=i}}if(o=="qgis"){if(s!=undefined){f["DPI"]=s}if(l!=undefined&&u!=undefined&&r!=undefined&&s!=undefined&&a==undefined){f["BBOX"]=l.join(",");f["SRS"]=u;f["WIDTH"]=Math.round((l[2]-l[0])/r*39.37*s);f["HEIGHT"]=Math.round((l[3]-l[1])/r*39.37*s)}}if(c){Object.assign(f,c)}return p["a"](e,f)};d.prototype.isLayerVisible=function(e,t){if(!e.getVisible()){return false}var r=t.getView().getResolution();return r>e.getMinResolution()&&r<e.getMaxResolution()};d.prototype.refreshWMSLayer=function(e){var t=e.getSource();a["a"].assert(t instanceof c["a"]||t instanceof f["a"]);var r=t;var n=r.getParams();n[d.REFRESH_PARAM]=Math.random();r.updateParams(n)};d.prototype.setZIndexToFirstLevelChildren=function(e,t){if(!(e instanceof o["a"])){return}var r=e.getLayers();r.forEach(function(e){return e.setZIndex(t)})};d.prototype.updateWMSLayerState=function(e,t,r){if(t.length<=0){e.setVisible(false)}else{e.setVisible(true);var a=e.getSource();if(r){a.updateParams({LAYERS:t,TIME:r})}else{a.updateParams({LAYERS:t})}}};d.prototype.getQuerySourceIds=function(e){return e.get("querySourceIds")};d.module=angular.module("ngeoLayerHelper",[]).service("ngeoLayerHelper",d).value("ngeoTilesPreloadingLimit",Infinity);t["a"]=d},,,,,,,,function(e,t,r){"use strict";var a={AND:"&&",NOT:"!",OR:"||"};t["a"]=a},,,,,,function(e,t,r){"use strict";var a=r(1);var n=r(122);var i=r(36);var o=r(3);var s=r(232);var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function e(){u(this,e);this.collection_=new i["b"];this.map_=null;this.listenerKeys_=[];o["a"](this.collection_,"add",this.handleDataSourcesAdd_,this)}e.prototype.bindMap_=function e(t){var r=t.getView();this.listenerKeys_.push(o["a"](r,"change:resolution",this.handleViewResolutionChange_,this));var n=r.getResolution();a["a"].assertNumber(n);this.syncDataSourcesToResolution_(n)};e.prototype.unbindMap_=function e(t){this.listenerKeys_.forEach(o["e"]);this.listenerKeys_=[]};e.prototype.handleViewResolutionChange_=function e(t){var r=t.target;a["a"].assertInstanceof(r,s["a"]);var n=r.getResolution();a["a"].assertNumber(n);this.syncDataSourcesToResolution_(n)};e.prototype.syncDataSourcesToResolution_=function e(t){var r=this;this.collection_.forEach(function(e){r.syncDataSourceToResolution_(e,t)})};e.prototype.syncDataSourceToResolution_=function e(t,r){if(!t.supportsDynamicInRange){return}var a=t.maxResolution;var n=t.minResolution;var i=n===null||n===undefined||r>=n;var o=a===null||a===undefined||r<=a;var s=i&&o;t.inRange=s};e.prototype.handleDataSourcesAdd_=function e(t){var r=a["a"].assertInstanceof(t.element,n["a"]);if(this.map_){var i=this.map_.getView().getResolution();a["a"].assertNumber(i);this.syncDataSourceToResolution_(r,i)}};l(e,[{key:"map",set:function e(t){if(this.map_===t){return}if(this.map_){this.unbindMap_(this.map_)}this.map_=t;if(t){this.bindMap_(t)}}},{key:"collection",get:function e(){return this.collection_}}]);return e}();c.module=angular.module("ngeoDataSources",[]);c.module.service("ngeoDataSources",c);t["a"]=c},,,,,,,function(e,t,r){"use strict";var a=r(98);var n=r(39);var i=r(128);var o=function e(t,r,a,n,i){this.$rootScope_=t;this.gmfThemes_=r;this.modeFlush=a;this.gmfTreeManager_=n;this.ngeoStateManager_=i;this.themeName_=""};o.$inject=["$rootScope","gmfThemes","gmfTreeManagerModeFlush","gmfTreeManager","ngeoStateManager"];o.$inject=["$rootScope","gmfThemes","gmfTreeManagerModeFlush","gmfTreeManager","ngeoStateManager"];o.prototype.addTheme=function(e,t){if(this.modeFlush){this.ngeoStateManager_.updateState({theme:e.name});this.setThemeName(e.name);this.gmfTreeManager_.setFirstLevelGroups(e.children)}else{this.gmfTreeManager_.addFirstLevelGroups(e.children,false,t)}};o.prototype.getThemeName=function(){return this.themeName_};o.prototype.isLoading=function(){return!this.gmfThemes_.loaded};o.prototype.setThemeName=function(e,t){this.themeName_=e;if(!t){this.$rootScope_.$emit(o.EventType.THEME_NAME_SET,e)}};o.prototype.removeAll=function(){this.gmfTreeManager_.removeAll()};o.EventType={THEME_NAME_SET:"gmf-thememanager-theme_name_set"};o.module=angular.module("gmfThemeManager",[a["a"].module.name,n["a"].module.name,i["a"].module.name]);o.module.value("gmfTreeManagerModeFlush",true);o.module.service("gmfThemeManager",o);t["a"]=o},function(e,t,r){"use strict";var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(t){n(this,e);this.inRange_=t.inRange!==false;this.visible_=t.visible===true;this.attributes=t.attributes||null;this.id_=t.id;this.identifierAttribute_=t.identifierAttribute;this.maxResolution_=t.maxResolution;this.minResolution_=t.minResolution;this.name_=t.name}e.prototype.getAttributes=function e(){return this.attributes};e.prototype.setAttributes=function e(t){this.attributes=t};a(e,[{key:"inRange",get:function e(){return this.inRange_},set:function e(t){this.inRange_=t}},{key:"visible",get:function e(){return this.visible_},set:function e(t){this.visible_=t}},{key:"id",get:function e(){return this.id_}},{key:"identifierAttribute",get:function e(){return this.identifierAttribute_}},{key:"maxResolution",get:function e(){return this.maxResolution_}},{key:"minResolution",get:function e(){return this.minResolution_}},{key:"name",get:function e(){return this.name_}},{key:"queryable",get:function e(){return false}},{key:"supportsDynamicInRange",get:function e(){return this.maxResolution!==null||this.minResolution!==null}}]);return e}();t["a"]=i},,,,,,function(e,t,r){"use strict";var a=r(1);var n=r(161);var i=function e(t,r){var n=this;this.initialState={};this.ngeoLocation=t;this.usedKeyRegexp=r;this.useLocalStorage_;this.setUseLocalStorage(false);var i=t.getParamKeys().filter(function(e){return e!="debug"&&e!="no_redirect"});if(i.length===0){if(this.useLocalStorage_){var o=function e(t){a["a"].assert(t);n.usedKeyRegexp.some(function(e){if(t.match(e)){var r=window.localStorage[t];if(r!==undefined||r!==null){n.initialState[t]=r}else{n.initialState[t]=""}return true}})};for(var s in window.localStorage){o(s)}}}else{i.forEach(function(e){n.usedKeyRegexp.some(function(t){if(e.match(t)){var r=n.ngeoLocation.getParam(e);if(r!==undefined){n.initialState[e]=r;return true}}})})}};i.$inject=["ngeoLocation","ngeoUsedKeyRegexp"];i.$inject=["ngeoLocation","ngeoUsedKeyRegexp"];i.prototype.setUseLocalStorage=function(e){this.useLocalStorage_=e;if(this.useLocalStorage_){try{if("localStorage"in window){window.localStorage["test"]="";delete window.localStorage["test"]}else{this.useLocalStorage_=false}}catch(e){console.error(e);this.useLocalStorage_=false}}return this.useLocalStorage_};i.prototype.getInitialValue=function(e){return this.initialState[e]};i.prototype.getInitialStringValue=function(e){var t=this.initialState[e];if(t===undefined){return undefined}return t};i.prototype.getInitialNumberValue=function(e){var t=this.initialState[e];if(t===undefined){return undefined}return parseFloat(t)};i.prototype.getInitialBooleanValue=function(e){var t=this.initialState[e];if(t===undefined){return undefined}return t==="true"};i.prototype.updateState=function(e){this.ngeoLocation.updateParams(e);if(this.useLocalStorage_){for(var t in e){a["a"].assert(t);var r=e[t];a["a"].assert(r!==undefined);window.localStorage[t]=r}}};i.prototype.deleteParam=function(e){this.ngeoLocation.deleteParam(e);if(this.useLocalStorage_){delete window.localStorage[e]}};i.module=angular.module("ngeoStateManager",[n["a"].module.name]);i.module.service("ngeoStateManager",i);i.module.value("ngeoUsedKeyRegexp",[new RegExp(".*")]);t["a"]=i},,function(e,t,r){"use strict";var a=r(249);var n=r.n(a);var i=r(1);var o=r(59);var s=r(2);var l=function e(t){o["a"].call(this);this.timeout_=t;var r=angular.element('<div class="ngeo-notification"></div>');angular.element(document.body).append(r);this.container_=r;this.cache_={}};l.$inject=["$timeout"];l.$inject=["$timeout"];s["d"](l,o["a"]);l.DEFAULT_DELAY_=7e3;l.prototype.notify=function(e){this.show(e)};l.prototype.clear=function(){for(var e in this.cache_){this.clearMessageByCacheItem_(this.cache_[parseInt(e,10)])}};l.prototype.showMessage=function(e){var t=this;var r=e.type;i["a"].assertString(r,"Type should be set.");var a=["alert","fade"];switch(r){case o["a"].Type.ERROR:a.push("alert-danger");break;case o["a"].Type.INFORMATION:a.push("alert-info");break;case o["a"].Type.SUCCESS:a.push("alert-success");break;case o["a"].Type.WARNING:a.push("alert-warning");break;default:break}var n=angular.element('<div class="'+a.join(" ")+'"></div>');var u=void 0;if(e.target){u=angular.element(e.target)}else{u=this.container_}u.append(n);n.html(e.msg).addClass("in");var c=e.delay!==undefined?e.delay:l.DEFAULT_DELAY_;var f={el:n};var h=s["c"](n);f.promise=this.timeout_(function(){n.alert("close");delete t.cache_[h]},c);this.cache_[h]=f};l.prototype.clearMessageByCacheItem_=function(e){var t=e.el;var r=e.promise;var a=s["c"](t);t.alert("close");this.timeout_.cancel(r);delete this.cache_[a]};l.CacheItem;l.module=angular.module("ngeoNotification",[]);l.module.service("ngeoNotification",l);t["a"]=l},,function(e,t,r){"use strict";var a=r(39);var n=r(1);var i=r(75);var o=r(89);var s=r(2);var l=r(175);var u=r(168);var c=function e(t,r,a,n){var i=this;this.layerHelper_=r;this.ngeoWMSTime_=a;this.ogcServersObject_;n.getOgcServersObject().then(function(e){i.ogcServersObject_=e});t.$on("ngeo-layertree-state",function(e,t,r){i.sync_(e,r)})};c.$inject=["$rootScope","ngeoLayerHelper","ngeoWMSTime","gmfThemes"];c.$inject=["$rootScope","ngeoLayerHelper","ngeoWMSTime","gmfThemes"];c.prototype.createLayer=function(e,t,r,a){var n=null;if(e.node.children!==undefined&&e.node.mixed){n=this.createGroup_(e,t,r,a)}else if(e.node.children===undefined&&e.parent.node.mixed){n=this.createLeafInAMixedGroup_(e,t)}else if(e.node.children===undefined){this.initGmfLayerInANotMixedGroup_(e,t)}else if(e.depth===1&&!e.node.mixed){n=this.createGroup_(e,t,r,a)}if(n&&e.node.metadata.opacity){n.setOpacity(e.node.metadata.opacity)}return n};c.prototype.sync_=function(e,t){var r=this;t.traverseDepthFirst(function(e){if(e.layer&&!e.node.mixed){r.updateLayerState_(e.layer,e)}})};c.prototype.updateLayerState_=function(e,t){var r=t.getState()==="on";if(t.node.type==="WMTS"){e.setVisible(r)}else if(!t.node.mixed&&t.depth===1){n["a"].assertInstanceof(e,l["a"]);var a=[];var i=[];t.traverseDepthFirst(function(e){if(e.node.children===undefined&&e.getState()==="on"){a.push(e.node.layers);var t=e.node.style!==undefined?e.node.style:"";i.push(t)}});if(a.length===0){e.setVisible(false)}e.getSource().updateParams({LAYERS:a.reverse().join(","),STYLES:i.reverse().join(",")});if(a.length!==0){e.setVisible(true)}}else{n["a"].assertInstanceof(e,l["a"]);e.setVisible(r)}};c.prototype.createGroup_=function(e,t,r,a){var n=e.node;var i=null;var o=e.parent.isRoot;var s=true;if(n.metadata.printNativeAngle!==undefined){s=n.metadata.printNativeAngle}if(o){i=this.createLayerFromGroup_(e,!!n.mixed);var l=a|0;r.getLayers().insertAt(l,i)}else{var u=!this.isOneParentNotMixed_(e);if(u){i=this.createLayerFromGroup_(e,true);var f=c.getLayer(e.parent);f.getLayers().insertAt(0,i)}}i.set("printNativeAngle",s);return i};c.prototype.createLayerFromGroup_=function(e,t){var r=this;var a=void 0;var i=e.node;if(t){a=this.layerHelper_.createBasicGroup()}else{var o=this.getTimeParam_(e);var s=this.ogcServersObject_[i.ogcServer||""];n["a"].assert(s);n["a"].assert(s.url);n["a"].assert(s.type);n["a"].assert(s.imageType);a=this.layerHelper_.createBasicWMSLayer(s.url,"",s.imageType,s.type,o,undefined,s.credential?"use-credentials":"anonymous");var l=false;e.traverseDepthFirst(function(e){r.updateLayerReferences_(e.node,a);if(e.node.metadata.isChecked){e.setState("on",false);r.updateLayerState_(a,e);l=true}});a.setVisible(l);a.set("layerNodeName",i.name)}return a};c.prototype.createLeafInAMixedGroup_=function(e,t){var r=e.node;var a=void 0;if(r.type==="WMTS"){a=this.createWMTSLayer_(r)}else{var i=r;var o=this.getTimeParam_(e);var s=this.ogcServersObject_[i.ogcServer];n["a"].assert(s);n["a"].assert(s.url);n["a"].assert(s.type);n["a"].assert(i.layers);n["a"].assert(s.imageType);var l={STYLES:i.style};a=this.layerHelper_.createBasicWMSLayer(s.url,i.layers,s.imageType,s.type,o,l,s.credential?"use-credentials":"anonymous")}a.set("layerNodeName",r.name);this.updateLayerReferences_(r,a);var u=r.metadata.isChecked===true;if(u){e.setState("on",false)}a.setVisible(u);var f=c.getLayer(e.parent);f.getLayers().insertAt(0,a);return a};c.prototype.initGmfLayerInANotMixedGroup_=function(e,t){var r=e.node;var a=this.getFirstLevelGroupCtrl_(e);n["a"].assert(a);var i=a.layer;n["a"].assertInstanceof(i,l["a"]);this.updateLayerReferences_(r,i);if(r.metadata.isChecked){e.setState("on",false);this.updateLayerState_(i,a)}else{e.parent.refreshState()}};c.prototype.createWMTSLayer_=function(e){var t=new u["a"];n["a"].assert(e.url);n["a"].assert(e.layer);this.layerHelper_.createWMTSLayerFromCapabilitites(e.url,e.layer,e.matrixSet,e.dimensions).then(function(e){t.setSource(e.getSource());t.set("capabilitiesStyles",e.get("capabilitiesStyles"))});return t};c.prototype.updateLayerReferences_=function(e,t){var r=s["c"](e);var a=t.get("querySourceIds")||[];a.push(r);t.set("querySourceIds",a);var n=e.metadata.disclaimer;if(n){var i=t.get("disclaimers")||[];i.push(e.metadata.disclaimer);t.set("disclaimers",i)}};c.prototype.getTimeParam_=function(e){var t=void 0;var r=void 0;var a=e.node;if(a.time){t=a.time}else if(a.children){e.traverseDepthFirst(function(e){if(e.node.children===undefined&&e.node.time){t=e.node.time;return i["a"].VisitorDecision.STOP}})}if(t){var n=this.ngeoWMSTime_.getOptions(t)["values"];r=this.ngeoWMSTime_.formatWMSTimeParam(t,{start:n[0]||n,end:n[1]})}return r};c.prototype.isOneParentNotMixed_=function(e){var t=e.parent;var r=false;do{r=t.node.mixed===false;t=t.parent}while(t.parent&&!r);return r};c.prototype.getFirstLevelGroupCtrl_=function(e){var t=e;while(!t.parent.isRoot){t=t.parent}return t};c.getLayer=function(e){var t=e;var r=null;while(!t.isRoot&&r===null){if(t.layer){r=t.layer}t=t.parent}return r};c.module=angular.module("gmfSyncLayertreeMap",[a["a"].module.name,i["a"].module.name,o["a"].module.name]);c.module.service("gmfSyncLayertreeMap",c);t["a"]=c},function(e,t,r){"use strict";var a=function e(){};a.prototype.createDate=function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return e!==null?new Date(e):t};a.prototype.getTime=function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return e?e.getTime():t};a.prototype.getOptions=function(e){var t=this.createDate(e.minValue);var r=this.createDate(e.maxValue);var a=this.createDate(e.minDefValue,t);var n=this.createDate(e.maxDefValue,r);var i=e.mode==="range"?[this.getTime(a),this.getTime(n)]:this.getTime(a);return{minDate:this.getTime(t),maxDate:this.getTime(r),values:i}};a.prototype.getUTCDate=function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())};a.module=angular.module("ngeoTime",[]);a.module.service("ngeoTime",a);t["a"]=a},,,,,,,,,,,,function(e,t,r){"use strict";var a=r(3);var n=function e(t,r){this.manager_=t;this.features_=null;this.index_=r};n.prototype.addFeature=function(e){this.manager_.addFeature(e,this.index_)};n.prototype.removeFeature=function(e){this.manager_.removeFeature(e,this.index_)};n.prototype.clear=function(){this.manager_.clear(this.index_)};n.prototype.setFeatures=function(e){var t=this;if(this.features_!==null){this.features_.clear();a["c"](this.features_,"add",this.handleFeatureAdd_,this);a["c"](this.features_,"remove",this.handleFeatureRemove_,this)}if(e!==null){e.forEach(function(e){t.addFeature(e)});a["a"](e,"add",this.handleFeatureAdd_,this);a["a"](e,"remove",this.handleFeatureRemove_,this)}this.features_=e};n.prototype.setStyle=function(e){this.manager_.setStyle(e,this.index_)};n.prototype.handleFeatureAdd_=function(e){var t=e.element;this.addFeature(t)};n.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature(t)};n.module=angular.module("ngeoFeatureOverlay",[]);t["a"]=n},,function(e,t,r){"use strict";var a=r(1);var n=r(36);var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=function(){function e(t){o(this,e);this.dataSourcesCollection_=new n["b"](t.dataSources);this.title_=t.title}e.prototype.destroy=function e(){this.dataSourcesCollection_.clear()};e.prototype.getDataSourceState=function t(r){return r.visible?e.VisibilityState.ON:e.VisibilityState.OFF};e.prototype.addDataSource=function e(t){this.dataSourcesCollection_.push(t)};e.prototype.removeDataSource=function e(t){this.dataSourcesCollection_.remove(t)};e.prototype.toggleVisibilityState=function t(){var r=this.visibilityState!==e.VisibilityState.ON;for(var a=this.dataSources,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.visible!==r){s.visible=r}}};i(e,[{key:"dataSources",get:function e(){return this.dataSourcesCollection_.getArray()}},{key:"dataSourcesCollection",get:function e(){return this.dataSourcesCollection_}},{key:"title",get:function e(){return this.title_}},{key:"visibilityState",get:function t(){var r=void 0;for(var n=this.dataSources,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(r===undefined){r=this.getDataSourceState(l)}else{var u=this.getDataSourceState(l);if(u!==r){r=e.VisibilityState.INDETERMINATE}}if(r===e.VisibilityState.INDETERMINATE){break}}a["a"].assertString(r);return r}}]);return e}();s.VisibilityState={INDETERMINATE:"indeterminate",OFF:"off",ON:"on"};t["a"]=s},,,,,,,,,,,,function(e,t,r){"use strict";var a=angular.module("ngeoDebounce",[]);a.factory_=function(e){return function(t,r,a){var n=null;return function(){for(var i=arguments.length,o=Array(i),s=0;s<i;s++){o[s]=arguments[s]}var l=this;var u=function e(){n=null;t.apply(l,o)};if(n!==null){e.cancel(n)}n=e(u,r,a)}}};a.factory_.$inject=["$timeout"];a.factory("ngeoDebounce",a.factory_);t["a"]=a},function(e,t,r){"use strict";var a=r(3);var n=function e(){this.listenerKeys_={}};n.prototype.addListenerKey=function(e,t){if(!this.listenerKeys_[e]){this.initListenerKey_(e)}this.listenerKeys_[e].push(t)};n.prototype.clearListenerKey=function(e){this.initListenerKey_(e)};n.prototype.initListenerKey_=function(e){if(!this.listenerKeys_[e]){this.listenerKeys_[e]=[]}else{if(this.listenerKeys_[e].length){this.listenerKeys_[e].forEach(a["e"]);this.listenerKeys_[e].length=0}}};n.module=angular.module("ngeoEventHelper",[]);n.module.service("ngeoEventHelper",n);t["a"]=n},function(e,t,r){"use strict";var a=r(1);var n=r(78);var i=function e(t,r){this.history_=r;this.schema_=t.protocol.substring(0,t.protocol.length-1);this.domain_=t.hostname;this.port_=t.port?parseInt(t.port,10):undefined;this.path_=t.pathname;this.queryData_=n["a"].decodeQueryString(t.search);this.fragment_=n["a"].decodeQueryString(t.hash)};i.replaceState=function(e,t){try{e.replaceState(null,"",t)}catch(e){}};i.prototype.getPath=function(){return this.path_};i.prototype.getUriString=function(){var e=[];if(this.schema_){e.push(this.schema_,":")}if(this.domain_||this.schema_==="file"){e.push("//");e.push(this.domain_);if(this.port_!==undefined){e.push(":",String(this.port_))}}if(this.path_){if(this.domain_&&this.path_.charAt(0)!=="/"){e.push("/")}e.push(this.path_)}var t=n["a"].encodeQueryString(this.queryData_);if(t.length>0){e.push("?",t)}var r=n["a"].encodeQueryString(this.fragment_);if(r.length>0){e.push("#",r)}return e.join("")};i.prototype.hasParam=function(e){return e in this.queryData_};i.prototype.hasFragmentParam=function(e){return e in this.fragment_};i.prototype.getParam=function(e){return this.queryData_[e]};i.prototype.getFragmentParam=function(e){return this.fragment_[e]};i.prototype.getParamAsInt=function(e){var t=this.getParam(e);if(t===undefined){return undefined}a["a"].assertString(t);var r=parseInt(t,10);return isNaN(r)?undefined:r};i.prototype.getParamAsFloat=function(e){var t=this.getParam(e);if(t===undefined){return undefined}a["a"].assertString(t);var r=parseFloat(t);return isNaN(r)?undefined:r};i.prototype.getFragmentParamAsInt=function(e){var t=this.getFragmentParam(e);if(t===undefined){return undefined}a["a"].assertString(t);var r=parseInt(t,10);return isNaN(r)?undefined:r};i.prototype.getParamKeys=function(){var e=[];for(var t in this.queryData_){e.push(t)}return e};i.prototype.getFragmentParamKeys=function(){var e=[];for(var t in this.fragment_){e.push(t)}return e};i.prototype.getParamKeysWithPrefix=function(e){var t=[];for(var r in this.queryData_){if(r.indexOf(e)==0){t.push(r)}}return t};i.prototype.getFragmentParamKeysWithPrefix=function(e){var t=[];for(var r in this.fragment_){if(r.indexOf(e)==0){t.push(r)}}return t};i.prototype.updateParams=function(e){for(var t in e){this.queryData_[t]=e[t]}};i.prototype.updateFragmentParams=function(e){for(var t in e){this.fragment_[t]=e[t]}};i.prototype.deleteParam=function(e){delete this.queryData_[e]};i.prototype.deleteFragmentParam=function(e){delete this.fragment_[e]};i.prototype.refresh=function(){i.replaceState(this.history_,this.getUriString())};i.prototype.setPath=function(e){this.path_=e};i.LocationFactory=function(e,t){var r=t.history;var a=new i(t.location,t.history);var n=a.getUriString();e.$watch(function(){var t=a.getUriString();if(n!==t){e.$evalAsync(function(){n=t;if(r!==undefined&&r.replaceState!==undefined){i.replaceState(r,t)}e.$broadcast("ngeoLocationChange")})}});return a};i.LocationFactory.$inject=["$rootScope","$window"];i.MockProvider=function(e){e["$get"]=function(){var e={absUrl:function e(){return""},hash:function e(t){return t!==undefined?this:""},host:function e(){return""},path:function e(t){return t!==undefined?this:""},port:function e(){return 0},protocol:function e(){return""},replace:function e(){},search:function e(t,r){return t!==undefined?this:{}},url:function e(t){return""}};return e}};i.MockProvider.$inject=["$locationProvider"];i.module=angular.module("ngeoLocation",[]);i.module.factory("ngeoLocation",i.LocationFactory);t["a"]=i},,function(e,t,r){"use strict";var a={};a.module=angular.module("gmfDataSourceBeingFiltered",[]);a.module.value("gmfDataSourceBeingFiltered",{dataSource:null});t["a"]=a},function(e,t,r){"use strict";(function(e){var a=r(56);var n=r(73);function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=function(t){r.$inject=["$http","$injector","$rootScope","authenticationBaseUrl","gmfUser"];s(r,t);function r(e,a,n,s,l){i(this,r);var u=o(this,t.call(this));u.$http_=e;u.$rootScope_=n;u.baseUrl_=s.replace(/\/$/,"");u.user_=l;u.noReloadRole_=a.has("gmfAuthenticationNoReloadRole")?a.get("gmfAuthenticationNoReloadRole"):null;u.load_();return u}r.prototype.load_=function e(){var t=this.baseUrl_+"/"+r.RouteSuffix.IS_LOGGED_IN;this.$http_.get(t,{withCredentials:true}).then(this.handleLogin_.bind(this,true))};r.prototype.changePassword=function t(a,n,i){var o=this;var s=this.baseUrl_+"/"+r.RouteSuffix.CHANGE_PASSWORD;return this.$http_.post(s,e.param({oldPassword:a,newPassword:n,confirmNewPassword:i}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:true}).then(function(e){o.user_.is_password_changed=true;o.$rootScope_.$digest()}.bind(this))};r.prototype.login=function t(a,n){var i=this.baseUrl_+"/"+r.RouteSuffix.LOGIN;return this.$http_.post(i,e.param({login:a,password:n}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:true}).then(this.handleLogin_.bind(this,false))};r.prototype.logout=function e(){var t=this;var a=this.user_["role_name"]===this.noReloadRole_;var n=this.baseUrl_+"/"+r.RouteSuffix.LOGOUT;return this.$http_.get(n,{withCredentials:true}).then(function(){t.resetUser_(a)})};r.prototype.resetPassword=function t(a){var n=this.baseUrl_+"/"+r.RouteSuffix.RESET_PASSWORD;var i=function(e){var t=e.data;return t}.bind(this);return this.$http_.post(n,e.param({login:a}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(i)};r.prototype.getFunctionalities=function e(){return this.user_.functionalities};r.prototype.getRoleId=function e(){return this.user_.role_id};r.prototype.handleLogin_=function e(t,r){var n=r.data;this.setUser_(n,!t);if(t){var i=new a["a"]("ready",{user:this.user_});this.dispatchEvent(i)}return r};r.prototype.setUser_=function e(t,r){for(var n in t){this.user_[n]=t[n]}if(r&&t.username!==undefined){var i=new a["a"]("login",{user:this.user_});this.dispatchEvent(i)}};r.prototype.resetUser_=function e(t){t=t||false;for(var r in this.user_){this.user_[r]=null}var n=new a["a"]("logout",{user:this.user_});this.dispatchEvent(n);if(!t){this.load_()}};return r}(n["a"]);l.RouteSuffix={CHANGE_PASSWORD:"loginchange",IS_LOGGED_IN:"loginuser",LOGIN:"login",LOGOUT:"logout",RESET_PASSWORD:"loginresetpassword"};l.module=angular.module("gmfAuthenticationService",[]);l.module.service("gmfAuthenticationService",l);l.module.value("gmfUser",{functionalities:null,is_password_changed:null,role_id:null,role_name:null,username:null});t["a"]=l}).call(this,r(33))},function(e,t,r){"use strict";(function(e){var r=function e(t,r){this.$http_=t;this.gmfShortenerCreateUrl_=r};r.$inject=["$http","gmfShortenerCreateUrl"];r.$inject=["$http","gmfShortenerCreateUrl"];r.prototype.getShortUrl=function(e){var t={url:e};if(!this.gmfShortenerCreateUrl_){return{data:{short_url:e},status:200}}return this.postShortUrl_(t)};r.prototype.sendShortUrl=function(e,t,r){var a={url:e,email:t};if(r){a["message"]=r}return this.postShortUrl_(a)};r.prototype.postShortUrl_=function(t){return this.$http_.post(this.gmfShortenerCreateUrl_,e.param(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})};r.URL_MAX_LEN=2083;r.URL_PATH_MAX_LEN=2048;r.module=angular.module("gmfShareService",[]);r.module.service("gmfShareService",r);t["a"]=r}).call(this,r(33))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(41);var n=r(1);var i=r(100);var o=r(214);var s=r(114);var l=r(122);var u=r(36);var c=r(91);var f=r(82);var h=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function d(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function g(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var m=function(e){g(t,e);function t(r){p(this,t);var a=d(this,e.call(this,r));a.featuresCollection_=r.features||new u["b"];a.source_=new f["b"]({features:a.featuresCollection_,wrapX:false});a.layer_=new c["a"]({source:a.source_});return a}h(t,[{key:"features",get:function e(){return this.featuresCollection_.getArray()}},{key:"featuresCollection",get:function e(){return this.featuresCollection_}},{key:"layer",get:function e(){return this.layer_}},{key:"extent",get:function e(){return this.source_.getExtent()}}]);return t}(l["a"]);var v=m;var y=r(147);function _(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function S(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function b(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var w=function(e){b(t,e);function t(r){_(this,t);var a=S(this,e.call(this,r));var n=r.injector;a.rootScope_=n.get("$rootScope");a.unregister_={};return a}t.prototype.addDataSource=function t(r){e.prototype.addDataSource.call(this,r);n["a"].assertInstanceof(r,v);this.registerDataSource_(r)};t.prototype.registerDataSource_=function e(t){this.unregister_[t.id]=this.rootScope_.$watch(function(){return t.visible},this.handleDataSourceVisibleChange_.bind(this,t))};t.prototype.handleDataSourceVisibleChange_=function e(t,r,a){if(r!==undefined){t.layer.setVisible(r)}};t.prototype.removeDataSource=function t(r){e.prototype.removeDataSource.call(this,r);n["a"].assertInstanceof(r,v);this.unregisterDataSource_(r)};t.prototype.unregisterDataSource_=function e(t){this.unregister_[t.id]();delete this.unregister_[t.id]};return t}(y["a"]);var C=w;var T=r(40);var E=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function M(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function L(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function A(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var F=function(e){A(t,e);function t(r){M(this,t);var a=L(this,e.call(this,r));a.url_=r.url;return a}E(t,[{key:"url",get:function e(){return this.url_}}]);return t}(y["a"]);var P=F;var R=r(8);var k=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function x(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function D(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function O(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var $=function(e){O(t,e);function t(r,a){x(this,t);var n=D(this,e.call(this,r));var i=r.injector;n.layer_;n.ngeoLayerHelper_=a;n.rootScope_=i.get("$rootScope");n.wmsDataSourceUnregister_={};n.init_();return n}t.prototype.init_=function e(){n["a"].assert(this.dataSources.length,"At least one data source is required.");for(var t=this.dataSources,r=Array.isArray(t),a=0,t=r?t:t[Symbol.iterator]();;){var i;if(r){if(a>=t.length)break;i=t[a++]}else{a=t.next();if(a.done)break;i=a.value}var o=i;n["a"].assertInstanceof(o,T["a"]);this.registerDataSource_(o)}};t.prototype.destroy=function t(){for(var r=this.dataSources,a=Array.isArray(r),i=0,r=a?r:r[Symbol.iterator]();;){var o;if(a){if(i>=r.length)break;o=r[i++]}else{i=r.next();if(i.done)break;o=i.value}var s=o;n["a"].assertInstanceof(s,T["a"]);this.unregisterDataSource_(s)}e.prototype.destroy.call(this)};t.prototype.addDataSource=function t(r){e.prototype.addDataSource.call(this,r);n["a"].assertInstanceof(r,T["a"]);this.registerDataSource_(r)};t.prototype.registerDataSource_=function e(t){var r=t.id;this.wmsDataSourceUnregister_[r]=this.rootScope_.$watch(function(){return t.visible},this.handleDataSourceVisibleChange_.bind(this));if(!this.layer_){this.layer_=this.ngeoLayerHelper_.createBasicWMSLayerFromDataSource(t)}else{this.layer_.get("querySourceIds").push(r);this.updateLayer_()}};t.prototype.handleDataSourceVisibleChange_=function e(t,r){if(t!==undefined&&t!==r){this.updateLayer_()}};t.prototype.updateLayer_=function e(){var t=this.layer;var r=[];for(var a=this.dataSources,i=Array.isArray(a),o=0,a=i?a:a[Symbol.iterator]();;){var s;if(i){if(o>=a.length)break;s=a[o++]}else{o=a.next();if(o.done)break;s=o.value}var l=s;n["a"].assertInstanceof(l,T["a"]);if(l.visible){r=r.concat(l.getOGCLayerNames())}}this.ngeoLayerHelper_.updateWMSLayerState(t,r.join(","))};t.prototype.removeDataSource=function t(r){e.prototype.removeDataSource.call(this,r);n["a"].assertInstanceof(r,T["a"]);this.unregisterDataSource_(r)};t.prototype.unregisterDataSource_=function e(t){var r=t.id;var a=this.layer;var n=this.wmsDataSourceUnregister_[r];n();delete this.wmsDataSourceUnregister_[r];R["j"](this.dataSources,t);var i=this.ngeoLayerHelper_.getQuerySourceIds(a);if(i){R["j"](i,r)}if(this.dataSources.length){this.updateLayer_()}};k(t,[{key:"layer",get:function e(){return this.layer_}}]);return t}(P);var I=$;var N=r(2);var G=r(5);var U=r(3);var j=r(277);var V=r(273);var B=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function W(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var H=function(){e.$inject=["gettextCatalog","$injector","$q","$rootScope","ngeoDataSources","ngeoFile","ngeoLayerHelper"];function e(t,r,a,n,i,o,s){W(this,e);this.injector_=r;this.q_=a;this.rootScope_=n;this.dataSources_=i.collection;this.ngeoFile_=o;this.ngeoLayerHelper_=s;this.extDataSources_={};this.files_={};this.map_=null;this.fileGroup_=new C({dataSources:[],injector:this.injector_,title:t.getString("Local files")});this.wmsGroupsCollection_=new u["b"];this.wmtsGroupsCollection_=new u["b"];this.wmtsCache_={};U["a"](this.dataSources_,"remove",this.handleDataSourcesRemove_,this)}e.prototype.addWMSGroup_=function e(t){this.wmsGroupsCollection.push(t)};e.prototype.removeWMSGroup_=function e(t){this.wmsGroupsCollection.remove(t)};e.prototype.getWMSGroup=function e(t){var r=null;for(var a=this.wmsGroups,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.url===t){r=s;break}}return r};e.prototype.addWMTSGroup_=function e(t){this.wmtsGroupsCollection.push(t)};e.prototype.removeWMTSGroup_=function e(t){this.wmtsGroupsCollection.remove(t)};e.prototype.getWMTSGroup=function e(t){var r=null;for(var a=this.wmtsGroups,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.url===t){r=s;break}}return r};e.prototype.isExternalDataSource=function e(t){return!!this.extDataSources_[t.id]};e.prototype.addLayer_=function e(t){this.layerGroup.getLayers().push(t)};e.prototype.removeLayer_=function e(t){this.layerGroup.getLayers().remove(t)};e.prototype.createAndAddDataSourceFromWMSCapability=function t(r,a,n){var i=e.getId(r);var o=a["Service"];var s=void 0;if(this.extDataSources_[i]){s=this.extDataSources_[i]}else{var l=a["Capability"]["Request"];var u=l["GetMap"]["Format"];var c="image/png";var f=u.includes(c)?c:u[0];var h=l["GetFeatureInfo"]["Format"];var p=h.includes(T["a"].WMSInfoFormat.GML)?T["a"].WMSInfoFormat.GML:undefined;var d=r["queryable"]===true&&p!==undefined;s=new T["a"]({id:i,name:r["Title"],ogcImageType:f,ogcLayers:[{name:r["Name"],queryable:d}],ogcType:T["a"].Type.WMS,visible:true,wmsInfoFormat:p,wmsUrl:n});this.extDataSources_[i]=s}var g=this.getWMSGroup(n);if(g){if(!g.dataSources.includes(s)){g.addDataSource(s);this.dataSources_.push(s)}}else{g=new I({dataSources:[s],injector:this.injector_,title:o["Title"],url:n},this.ngeoLayerHelper_);this.addLayer_(g.layer);this.addWMSGroup_(g);this.dataSources_.push(s)}};e.prototype.createAndAddDataSourceFromWMTSCapability=function t(r,a,i){var o=e.getId(r);if(this.wmtsCache_[o]){return}var s=void 0;if(this.extDataSources_[o]){s=this.extDataSources_[o]}else{var l=n["a"].assertString(r["Title"]);var u=n["a"].assertString(r["Identifier"]);s=new T["a"]({id:o,name:l,ogcType:T["a"].Type.WMTS,visible:true,wmtsLayer:u,wmtsUrl:i});this.extDataSources_[o]=s}var c=this.getWMTSGroup(i);if(!c){c=new P({dataSources:[],title:a["ServiceIdentification"]["Title"],url:i});this.addWMTSGroup_(c)}c.addDataSource(s);var f=this.ngeoLayerHelper_.createWMTSLayerFromCapabilititesObj(a,r);this.addLayer_(f);this.dataSources_.push(s);this.wmtsCache_[o]={layerObj:f,unregister:this.rootScope_.$watch(function(){return s.visible},this.handleWMTSDataSourceVisibleChange_.bind(this,f))}};e.prototype.createAndAddDataSourceFromFile=function e(t,r){var a=this;this.getFileDataSource_(t).then(function(e){var t=true;var n=a.fileGroup_;if(Object(G["H"])(e.extent)){t=false}else{if(n.dataSources.includes(e)){return}a.addLayer_(e.layer);n.addDataSource(e);a.map_.getView().fit(e.extent);a.dataSources_.push(e)}if(r){r(t)}},function(e){console.error("Failed to load file: "+t.name);if(r){r(false)}})};e.prototype.getFileDataSource_=function t(r){var a=this;var n=this.q_.defer();if(this.files_[r.name]){n.resolve(this.files_[r.name])}else{var i=this.ngeoFile_;i.read(r).then(function(t){var o=void 0;var s={featureProjection:a.map_.getView().getProjection()};if(i.isKml(t)){o=new V["a"]({extractStyles:false}).readFeatures(t,s)}else if(i.isGpx(t)){o=(new j["a"]).readFeatures(t,s)}if(o){var l=e.getId(r);var c=new v({features:new u["b"](o),id:l,name:r.name,visible:true});a.files_[r.name]=c;a.extDataSources_[l]=c;n.resolve(c)}else{n.reject()}})}return n.promise};e.prototype.handleWMTSDataSourceVisibleChange_=function e(t,r,a){if(r!==undefined&&r!==a){t.setVisible(r)}};e.prototype.handleDataSourcesRemove_=function e(t){var r=t.element;if(this.extDataSources_[r.id]===r){if(r instanceof v){this.removeFileDataSource_(r)}else if(r instanceof T["a"]){this.removeOGCDataSource_(r)}}};e.prototype.removeFileDataSource_=function e(t){this.removeLayer_(t.layer);this.fileGroup_.removeDataSource(t)};e.prototype.removeOGCDataSource_=function e(t){if(t.ogcType===T["a"].Type.WMS){var r=t.wmsUrl;n["a"].assert(r);var a=this.getWMSGroup(r);if(a&&a.dataSources.includes(t)){a.removeDataSource(t);if(!a.dataSources.length){this.removeLayer_(a.layer);a.destroy();this.removeWMSGroup_(a)}}}else if(t.ogcType===T["a"].Type.WMTS){var i=t.wmtsUrl;n["a"].assert(i);var o=this.getWMTSGroup(i);if(o&&o.dataSources.includes(t)){o.removeDataSource(t);var s=t.id;this.removeLayer_(this.wmtsCache_[s].layerObj);this.wmtsCache_[s].unregister();delete this.wmtsCache_[s];if(!o.dataSources.length){o.destroy();this.removeWMTSGroup_(o)}}}};B(e,[{key:"fileGroup",get:function e(){return this.fileGroup_}},{key:"wmsGroups",get:function e(){return this.wmsGroupsCollection_.getArray()}},{key:"wmsGroupsCollection",get:function e(){return this.wmsGroupsCollection_}},{key:"wmtsGroups",get:function e(){return this.wmtsGroupsCollection_.getArray()}},{key:"wmtsGroupsCollection",get:function e(){return this.wmtsGroupsCollection_}},{key:"layerGroup",get:function e(){var t=this.map_;n["a"].assert(t);return this.ngeoLayerHelper_.getGroupFromMap(t,a["a"].EXTERNALLAYERGROUP_NAME)}},{key:"map",set:function e(t){this.map_=t}}]);return e}();H.getId=function(e){return N["c"](e)+1e6};H.module=angular.module("gmfExternalDataSourcesManager",[i["a"].module.name,o["a"].module.name,s["a"].module.name]);H.module.service("gmfExternalDataSourcesManager",H);var q=t["a"]=H},,,function(e,t,r){"use strict";var a=r(131);var n=r(199);a["a"].Proj.projections.add(n["a"]);var i="somerc";t["a"]=i},function(e,t,r){"use strict";var a=r(10);var n=r(275);var i=r(201);var o=r(131);var s=["+proj="+i["a"],"+lat_0=46.95240555555556","+lon_0=7.439583333333333","+k_0=1","+x_0=600000","+y_0=200000","+ellps=bessel","+towgs84=674.374,15.056,405.346,0,0,0,0","+units=m","+no_defs"].join(" ");var l=[42e4,3e4,9e5,35e4];o["a"].defs("EPSG:21781",s);n["a"](o["a"]);a["f"]("EPSG:21781").setExtent(l);var u="EPSG:21781";t["a"]=u},function(e,t,r){"use strict";var a=r(10);var n=r(5);var i=function e(){};i.prototype.stringToCoordinates=function(e){var t=e.match(/([\d\.']+)[\s,]+([\d\.']+)/);if(t){var r=parseFloat(t[1].replace("'",""));var a=parseFloat(t[2].replace("'",""));if(!isNaN(r)&&!isNaN(a)){return[r,a]}}return null};i.prototype.getProjectionList=function(e){var t=void 0,r=void 0;var n=[];e.forEach(function(e){t=e.toUpperCase();if(t.substr(0,5)!="EPSG:"){t="EPSG:"+t}r=a["f"](t);if(r!==null){n.push(r)}else{console.error("The projection "+t+" is not defined in ol.proj.")}});return n};i.prototype.tryProjections=function(e,t,r,i){var o=void 0;if(i===undefined){i=[r]}i.some(function(i){try{o=a["k"](e,i,r);if(n["f"](t,o)){return true}}catch(e){}o=null});return o};i.prototype.tryProjectionsWithInversion=function(e,t,r,a){var n=this.tryProjections(e,t,r,a);if(n===null){n=this.tryProjections(e.reverse(),t,r,a)}return n};i.module=angular.module("ngeoAutoProjection",[]);i.module.service("ngeoAutoProjection",i);t["a"]=i},function(e,t,r){"use strict";var a=r(78);var n=function e(t,r){this.$http_=r;this.url_=t.get("fulltextsearchUrl");var n=this.url_.split("?");this.baseUrl_=n[0];var i=n.length==2?"?"+n[1]:"";this.defaultParams_=a["a"].decodeQueryString(i)};n.$inject=["$injector","$http"];n.$inject=["$injector","$http"];n.prototype.search=function(e,t){var r=this;var n=Object.assign({},this.defaultParams_,t);n["query"]=e;var i=this.baseUrl_+"?"+a["a"].encodeQueryString(n);return new Promise(function(e,t){r.$http_.get(i).then(function(t){return e(t["data"])}).catch(t)})};n.module=angular.module("gmfSearchFulltextSearch",[]);n.module.service("gmfSearchFulltextSearch",n);t["a"]=n},function(e,t,r){"use strict";var a=r(114);var n=r(2);function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=angular.module("gmfLayertreeDatasourceGroupTreeComponent",[a["a"].module.name]);o.run(["$templateCache",function(e){e.put("gmf/layertree/datasourceGroupTreeComponent",r(332))}]);o.value("gmfLayertreeDatasourceGroupTreeTemplateUrl",function(e){var t=e["gmfLayertreeDatasourceGroupTreeTemplateUrl"];return t!==undefined?t:"gmf/layertree/datasourceGroupTreeComponent"});s.$inject=["$attrs","gmfLayertreeDatasourceGroupTreeTemplateUrl"];function s(e,t){return t(e)}o.Controller_=function(){e.$inject=["$scope","ngeoDataSources"];function e(t,r){i(this,e);this.group;this.scope_=t;this.dataSources_=r.collection}e.prototype.getGroupUid=function e(){return"datasourcegrouptree-"+n["c"](this.group)};e.prototype.toggle=function e(){this.group.toggleVisibilityState()};e.prototype.toggleDataSource=function e(t){t.visible=!t.visible};e.prototype.remove=function e(){for(var t=this.group.dataSources.length-1,r=0;t>=r;t--){this.dataSources_.remove(this.group.dataSources[t])}};e.prototype.removeDataSource=function e(t){this.dataSources_.remove(t)};return e}();o.component("gmfDatasourcegrouptree",{bindings:{group:"<"},controller:o.Controller_,templateUrl:s});t["a"]=o},function(e,t,r){"use strict";var a=r(161);var n=r(128);var i=angular.module("ngeoStatemanagerModule",[a["a"].module.name,n["a"].module.name]);t["a"]=i},function(e,t,r){"use strict";(function(e){var a=r(41);var n=r(121);var i=r(39);var o=r(266);var s=r(209);var l=r(147);var u=r(40);var c=r(265);var f=r(251);var h=r(26);var p=r(159);var d=r(160);var g=r(206);var m=r(128);var v=r(75);var y=r(1);var _=r(2);var S=r(8);var b=r(3);var w=r(30);var C=r(109);var T=r(38);var E=r(46);var M=r(136);var L=r(16);var A=r(92);var F=function e(t,r,a,i,o,s,l,u,c,p){var d=this;this.q_=t;this.rootScope_=a;this.$timeout_=r;this.mapViewPropertyChangeEventKey_=null;this.ngeoDebounce_=o;this.ngeoEventHelper_=l;this.ngeoStateManager_=u;this.ngeoFeatures_=i.has("ngeoFeatures")?i.get("ngeoFeatures"):null;this.ngeoBackgroundLayerMgr_=i.has("ngeoBackgroundLayerMgr")?i.get("ngeoBackgroundLayerMgr"):null;var g=i.has("ngeoFeatureOverlayMgr")?i.get("ngeoFeatureOverlayMgr"):null;this.featureOverlay_=g?g.getFeatureOverlay():null;this.featureHelper_=i.has("ngeoFeatureHelper")?i.get("ngeoFeatureHelper"):null;this.ngeoQuerent_=i.has("ngeoQuerent")?i.get("ngeoQuerent"):null;var m=i.has("gmfPermalinkOptions")?i.get("gmfPermalinkOptions"):{};if(m.useLocalStorage===true){this.ngeoStateManager_.setUseLocalStorage(true)}this.crosshairEnabledByDefault_=!!m.crosshairEnabledByDefault;this.pointRecenterZoom_=m.pointRecenterZoom;this.gmfExternalDataSourcesManager_=i.has("gmfExternalDataSourcesManager")?i.get("gmfExternalDataSourcesManager"):null;this.gmfThemes_=i.has("gmfThemes")?i.get("gmfThemes"):null;this.gmfObjectEditingManager_=i.has("gmfObjectEditingManager")?i.get("gmfObjectEditingManager"):null;this.gmfThemeManager_=i.has("gmfThemeManager")?i.get("gmfThemeManager"):null;this.defaultTheme_=i.has("defaultTheme")?i.get("defaultTheme"):undefined;this.gmfTreeManager_=i.has("gmfTreeManager")?i.get("gmfTreeManager"):null;this.user_=p;this.ngeoLocation_=c;this.ngeoWfsPermalink_=i.has("ngeoWfsPermalink")?i.get("ngeoWfsPermalink"):null;this.gmfUser_=i.has("gmfUser")?i.get("gmfUser"):null;this.map_=null;this.ngeoAutoProjection_=i.has("ngeoAutoProjection")?i.get("ngeoAutoProjection"):null;this.sourceProjections_=null;if(m.projectionCodes!==undefined&&this.ngeoAutoProjection_){var v=this.ngeoAutoProjection_.getProjectionList(m.projectionCodes);if(v.length>0){this.sourceProjections_=v}}this.crosshairFeature_=null;this.crosshairStyle_;if(m.crosshairStyle!==undefined){this.crosshairStyle_=m.crosshairStyle}else{this.crosshairStyle_=[new L["c"]({image:new M["a"]({stroke:new E["a"]({color:"rgba(255, 255, 255, 0.8)",width:5}),points:4,radius:8,radius2:0,angle:0})}),new L["c"]({image:new M["a"]({stroke:new E["a"]({color:"rgba(255, 0, 0, 1)",width:2}),points:4,radius:8,radius2:0,angle:0})})]}this.mapTooltip_=null;this.featureHashFormat_=new f["a"]({setStyle:false,encodeStyles:false,propertiesType:{fillColor:h["a"].COLOR,fillOpacity:h["a"].OPACITY,fontColor:h["a"].COLOR,fontSize:h["a"].SIZE,isBox:h["a"].IS_RECTANGLE,isCircle:h["a"].IS_CIRCLE,isLabel:h["a"].IS_TEXT,name:h["a"].NAME,pointRadius:h["a"].SIZE,showLabel:h["a"].SHOW_LABEL,showMeasure:h["a"].SHOW_MEASURE,strokeColor:h["a"].COLOR,strokeWidth:h["a"].STROKE},defaultValues:{name:function e(t){return s.getString(t.getGeometry().getType())},fillOpacity:function e(){return.5},showLabel:function e(){return false},showMeasure:function e(){return false}}});if(this.ngeoBackgroundLayerMgr_){b["a"](this.ngeoBackgroundLayerMgr_,"change",this.handleBackgroundLayerManagerChange_,this)}this.rootScope_.$on("ngeo-layertree-state",function(t,r,a){var n={};if(a.node.mixed){var i=r.getState();y["a"].assert(i==="on"||i==="off");var o=i==="on";r.traverseDepthFirst(function(t){if(t.node.children===undefined){var r=e.ParamPrefix.TREE_ENABLE+t.node.name;n[r]=o}})}else{var s=[];a.traverseDepthFirst(function(e){if(e.node.children===undefined&&e.getState()==="on"){s.push(e.node.name)}});n[e.ParamPrefix.TREE_GROUP_LAYERS+a.node.name]=s.join(",")}d.ngeoStateManager_.updateState(n)});this.rootScope_.$on("ngeo-layertree-opacity",function(t,r){var a={};var n=r.layer.getOpacity();var i=(r.parent.node.mixed?e.ParamPrefix.TREE_OPACITY:e.ParamPrefix.TREE_GROUP_OPACITY)+r.node.name;a[i]=n;d.ngeoStateManager_.updateState(a)});var _=this.getFeatures();if(this.ngeoFeatures_){_.forEach(function(e){if(d.featureHelper_){d.featureHelper_.setStyle(e)}d.addNgeoFeature_(e)});this.ngeoFeatures_.extend(_);b["a"](this.ngeoFeatures_,"add",this.handleNgeoFeaturesAdd_,this);b["a"](this.ngeoFeatures_,"remove",this.handleNgeoFeaturesRemove_,this)}if(this.featureHelper_){this.rootScope_.$on("$localeChangeSuccess",function(){_.forEach(function(e){d.featureHelper_.setStyle(e)})})}if(this.gmfThemeManager_){this.rootScope_.$on(n["a"].EventType.THEME_NAME_SET,function(e,t){d.setThemeInUrl_(t)})}this.setExternalDataSourcesStatePromise_=null;if(this.ngeoQuerent_&&this.gmfExternalDataSourcesManager_){this.initExternalDataSources_().then(function(){b["a"](d.gmfExternalDataSourcesManager_.wmsGroupsCollection,"add",d.handleExternalDSGroupCollectionAdd_,d);b["a"](d.gmfExternalDataSourcesManager_.wmsGroupsCollection,"remove",d.handleExternalDSGroupCollectionRemove_,d);b["a"](d.gmfExternalDataSourcesManager_.wmtsGroupsCollection,"add",d.handleExternalDSGroupCollectionAdd_,d);b["a"](d.gmfExternalDataSourcesManager_.wmtsGroupsCollection,"remove",d.handleExternalDSGroupCollectionRemove_,d);for(var e=d.gmfExternalDataSourcesManager_.wmsGroups,t=Array.isArray(e),r=0,e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{r=e.next();if(r.done)break;a=r.value}var n=a;d.registerExternalDSGroup_(n)}for(var i=d.gmfExternalDataSourcesManager_.wmtsGroups,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;d.registerExternalDSGroup_(u)}})}this.initLayers_()};F.$inject=["$q","$timeout","$rootScope","$injector","ngeoDebounce","gettextCatalog","ngeoEventHelper","ngeoStateManager","ngeoLocation","gmfUser"];F.$inject=["$q","$timeout","$rootScope","$injector","ngeoDebounce","gettextCatalog","ngeoEventHelper","ngeoStateManager","ngeoLocation","gmfUser"];F.prototype.getMapCenter=function(){var e=this.ngeoStateManager_.getInitialNumberValue(a["a"].PermalinkParam.MAP_X);var t=this.ngeoStateManager_.getInitialNumberValue(a["a"].PermalinkParam.MAP_Y);if(!isNaN(e)&&!isNaN(t)){var r=[e,t];if(this.sourceProjections_!==null&&this.ngeoAutoProjection_){var n=this.map_.getView().getProjection();var i=this.ngeoAutoProjection_.tryProjectionsWithInversion(r,n.getExtent(),n,this.sourceProjections_);if(i){return i}}return r}return null};F.prototype.getMapZoom=function(){var e=this.ngeoStateManager_.getInitialNumberValue(a["a"].PermalinkParam.MAP_Z);return isNaN(e)?undefined:e};F.prototype.getMapCrosshair=function(){var e=this.ngeoStateManager_.getInitialBooleanValue(a["a"].PermalinkParam.MAP_CROSSHAIR);return e===undefined?this.crosshairEnabledByDefault_:e};F.prototype.setMapCrosshair=function(e){var t=void 0;if(e){t=e}else{t=this.map_.getView().getCenter()}y["a"].assertArray(t);if(this.crosshairFeature_){this.featureOverlay_.removeFeature(this.crosshairFeature_)}this.crosshairFeature_=new w["a"](new T["a"](t));this.crosshairFeature_.setStyle(this.crosshairStyle_);this.featureOverlay_.addFeature(this.crosshairFeature_)};F.prototype.getMapTooltip=function(){return this.ngeoStateManager_.getInitialStringValue(a["a"].PermalinkParam.MAP_TOOLTIP)};F.prototype.setMapTooltip=function(t,r){var a=void 0;if(r){a=r}else{a=this.map_.getView().getCenter()}y["a"].assertArray(a);var n=e("<div/>",{class:"gmf-permalink-tooltip",text:t})[0];if(this.mapTooltip_!==null){this.map_.removeOverlay(this.mapTooltip_)}this.mapTooltip_=new o["a"]({element:n,position:a});this.map_.addOverlay(this.mapTooltip_)};F.prototype.getFeatures=function(){var e=this.ngeoStateManager_.getInitialStringValue(a["a"].PermalinkParam.FEATURES);if(e!==undefined&&e!==""){return y["a"].assert(this.featureHashFormat_.readFeatures(e))}return[]};F.prototype.setDimensions=function(e){var t=this;var r=this.ngeoLocation_.getParamKeysWithPrefix(F.ParamPrefix.DIMENSIONS);for(var a=0;a<r.length;a++){var n=r[a];var i=this.ngeoLocation_.getParam(n);y["a"].assert(i);e[n.slice(F.ParamPrefix.DIMENSIONS.length)]=i}this.rootScope_.$watchCollection(function(){return e},function(e){var r={};for(var a in e){r[F.ParamPrefix.DIMENSIONS+a]=e[a]}t.ngeoLocation_.updateParams(r)})};F.prototype.setMap=function(e){var t=this;if(e===this.map_){return}if(this.map_){this.unregisterMap_();this.map_=null}if(e){this.map_=e;if(this.gmfObjectEditingManager_){this.gmfObjectEditingManager_.getFeature().then(function(r){t.registerMap_(e,r)})}else{this.registerMap_(e,null)}}};F.prototype.registerMap_=function(e,t){var r=this;var n=e.getView();var i=void 0;var o=typeof t!=="undefined"&&t!==null?t.getGeometry():undefined;if(o){var s=e.getSize();y["a"].assert(s);var l=void 0;if(o instanceof T["a"]||o instanceof C["a"]){l=this.pointRecenterZoom_}n.fit(o.getExtent(),{size:s,maxZoom:l})}else{var u=this.ngeoStateManager_.getInitialBooleanValue(c["a"].Permalink3dParam.ENABLED);if(!u){i=this.getMapCenter();if(i){n.setCenter(i)}var f=this.getMapZoom();if(f!==undefined){n.setZoom(f)}}}this.mapViewPropertyChangeEventKey_=b["a"](n,"propertychange",this.ngeoDebounce_(function(){var e=n.getCenter();var t=n.getZoom();var i={};i[a["a"].PermalinkParam.MAP_X]=Math.round(e[0]);i[a["a"].PermalinkParam.MAP_Y]=Math.round(e[1]);i[a["a"].PermalinkParam.MAP_Z]=t;r.ngeoStateManager_.updateState(i)},300,true),this);if(this.getMapCrosshair()&&this.featureOverlay_){this.setMapCrosshair(i)}var h=this.getMapTooltip();if(h){this.setMapTooltip(h,i)}var p=this.getWfsPermalinkData_();if(p!==null&&this.ngeoWfsPermalink_){this.ngeoWfsPermalink_.issue(p,e)}};F.prototype.unregisterMap_=function(){y["a"].assert(this.mapViewPropertyChangeEventKey_,"Key should be thruthy");b["e"](this.mapViewPropertyChangeEventKey_);this.mapViewPropertyChangeEventKey_=null};F.prototype.getBackgroundLayer=function(e){var t=this.ngeoStateManager_.getInitialStringValue(a["a"].PermalinkParam.BG_LAYER);if(t!==undefined){for(var r=e,n=Array.isArray(r),i=0,r=n?r:r[Symbol.iterator]();;){var o;if(n){if(i>=r.length)break;o=r[i++]}else{i=r.next();if(i.done)break;o=i.value}var s=o;if(s.get("label")===t){return s}}}return null};F.prototype.handleBackgroundLayerManagerChange_=function(){if(!this.map_||!this.ngeoBackgroundLayerMgr_){return}var e=this.ngeoBackgroundLayerMgr_.get(this.map_);var t=e.get("label");y["a"].assertString(t);var r={};r[a["a"].PermalinkParam.BG_LAYER]=t;this.ngeoStateManager_.updateState(r)};F.prototype.refreshFirstLevelGroups=function(){if(!this.gmfTreeManager_){return}var e=this.gmfTreeManager_.rootCtrl.node.children;var t=e.map(function(e){return e.name});var r={};r[a["a"].PermalinkParam.TREE_GROUPS]=t.join(",");this.ngeoStateManager_.updateState(r)};F.prototype.themeInUrl_=function(e){var t=e.indexOf("theme");return t!=-1&&t==e.length-2};F.prototype.setThemeInUrl_=function(e){if(e){var t=this.ngeoLocation_.getPath().split("/");y["a"].assert(t.length>1);if(t[t.length-1]===""){t.splice(t.length-1)}if(this.themeInUrl_(t)){t[t.length-1]=e}else{t.push("theme",e)}this.ngeoLocation_.setPath(t.join("/"))}};F.prototype.defaultThemeName=function(){var e=this.ngeoLocation_.getPath().split("/");if(this.themeInUrl_(e)){return decodeURI(e[e.length-1])}var t=this.ngeoStateManager_.getInitialStringValue("theme");if(t){return t}var r=this.defaultThemeNameFromFunctionalities();if(r!==null){return r}if(this.defaultTheme_){return this.defaultTheme_}return null};F.prototype.defaultThemeNameFromFunctionalities=function(){if(!this.gmfUser_){return null}var e=this.gmfUser_.functionalities;if(e&&"default_theme"in e){var t=e.default_theme;if(t.length>0){return t[0]}}return null};F.prototype.initLayers_=function(){var e=this;var t=window.location.href;var r=false;if(!this.gmfThemes_){return}this.gmfThemes_.getThemesObject().then(function(n){var o=e.defaultThemeName();y["a"].assert(o!==null);if(e.gmfThemeManager_){e.gmfThemeManager_.setThemeName(e.gmfThemeManager_.modeFlush?o:"")}var s=[];var l=void 0;var u=e.ngeoLocation_.getParam(a["a"].PermalinkParam.TREE_GROUPS);if(u===undefined){y["a"].assertString(o);l=i["a"].findThemeByName(n,o);if(l){s=l.children}}else{u.split(",").forEach(function(e){var t=i["a"].findGroupByName(n,e);if(t){s.push(t)}else{r=true}})}if(e.gmfTreeManager_){e.gmfTreeManager_.setFirstLevelGroups(s)}e.$timeout_(function(){if(!e.gmfTreeManager_||!e.gmfTreeManager_.rootCtrl){return}e.gmfTreeManager_.rootCtrl.traverseDepthFirst(function(t){if(t.isRoot){return}var a=e.ngeoStateManager_.getInitialNumberValue((t.parent.node.mixed?F.ParamPrefix.TREE_OPACITY:F.ParamPrefix.TREE_GROUP_OPACITY)+t.node.name);if(a!==undefined&&t.layer){t.layer.setOpacity(a)}if(t.parent.node&&t.parent.node.mixed&&t.node.children==undefined){var n=e.ngeoStateManager_.getInitialBooleanValue(F.ParamPrefix.TREE_ENABLE+t.node.name);if(n!==undefined){t.setState(n?"on":"off",false)}}else if(!t.node.mixed&&t.depth==1){var i=e.ngeoStateManager_.getInitialStringValue(F.ParamPrefix.TREE_GROUP_LAYERS+t.node.name);if(i!==undefined){var o=i.split(",");t.traverseDepthFirst(function(e){if(e.node.children===undefined){var t=S["f"](o,e.node.name);if(t){o.splice(o.indexOf(e.node.name),1)}e.setState(t?"on":"off",false)}});if(o.length>0){r=true}}}});var a=e.gmfTreeManager_.rootCtrl.children;a.forEach(function(t){t.traverseDepthFirst(function(r){if(r.getState()!=="indeterminate"){e.rootScope_.$broadcast("ngeo-layertree-state",r,t);return v["a"].VisitorDecision.STOP}})});if(r&&e.user_.role_id===null){e.rootScope_.$broadcast("authenticationrequired",{url:t})}})})};F.prototype.handleNgeoFeaturesAdd_=function(e){var t=e.element;y["a"].assertInstanceof(t,w["a"]);this.addNgeoFeature_(t)};F.prototype.handleNgeoFeaturesRemove_=function(e){var t=e.element;y["a"].assertInstanceof(t,w["a"]);this.removeNgeoFeature_(t)};F.prototype.addNgeoFeature_=function(e){var t=_["c"](e);this.ngeoEventHelper_.addListenerKey(t,b["a"](e,"change",this.ngeoDebounce_(this.handleNgeoFeaturesChange_,250,true),this))};F.prototype.removeNgeoFeature_=function(e){var t=_["c"](e);this.ngeoEventHelper_.clearListenerKey(t);this.handleNgeoFeaturesChange_()};F.prototype.handleNgeoFeaturesChange_=function(){if(!this.ngeoFeatures_){return}var e=this.ngeoFeatures_.getArray();var t=this.featureHashFormat_.writeFeatures(e);var r={};r[a["a"].PermalinkParam.FEATURES]=t;this.ngeoStateManager_.updateState(r)};F.prototype.getWfsPermalinkData_=function(){var e=this.ngeoLocation_.getParam(a["a"].PermalinkParam.WFS_LAYER);if(!e){return null}var t=this.ngeoLocation_.getParamAsInt(a["a"].PermalinkParam.WFS_NGROUPS);var r=this.ngeoLocation_.getParamKeysWithPrefix(F.ParamPrefix.WFS);var n=[];var i=void 0;if(t===undefined){i=this.createFilterGroup_(F.ParamPrefix.WFS,r);if(i!==null){n.push(i)}}else{for(var o=0;o<t;o++){i=this.createFilterGroup_(F.ParamPrefix.WFS+o+"_",r);if(i!==null){n.push(i)}}}if(n.length==0){return null}var s=this.ngeoLocation_.getParam(a["a"].PermalinkParam.WFS_SHOW_FEATURES);var l=!(s==="0"||s==="false");return{wfsType:e,showFeatures:l,filterGroups:n}};F.prototype.createFilterGroup_=function(e,t){var r=this;var n=[];t.forEach(function(t){if(t==a["a"].PermalinkParam.WFS_LAYER||t==a["a"].PermalinkParam.WFS_SHOW_FEATURES||t==a["a"].PermalinkParam.WFS_NGROUPS||t.indexOf(e)!=0){return}var i=r.ngeoLocation_.getParam(t);if(!i){return}var o=i;if(i.indexOf(",")>-1){o=i.split(",")}var s={property:t.replace(e,""),condition:o};n.push(s)});return n.length>0?{filters:n}:null};F.prototype.initExternalDataSources_=function(){var e=this;var t=y["a"].assert(this.ngeoQuerent_);var r=y["a"].assert(this.gmfExternalDataSourcesManager_);var n=[];var i=this.ngeoStateManager_.getInitialValue(a["a"].PermalinkParam.EXTERNAL_DATASOURCES_NAMES);var o=this.ngeoStateManager_.getInitialValue(a["a"].PermalinkParam.EXTERNAL_DATASOURCES_URLS);if(i&&o){var s=i.split(F.ExtDSSeparator.LIST);var l=o.split(F.ExtDSSeparator.LIST);var c=function r(a,i){var o=s[a];if(!o){return"break"}var c=o.split(F.ExtDSSeparator.NAMES);var f=l[a];var h=u["a"].guessServiceTypeByUrl(f);var p=e.q_.defer();n.push(p.promise);if(h===u["a"].Type.WMS){t.wmsGetCapabilities(f).then(function(e){p.resolve({capabilities:e,groupLayerNames:c,serviceType:h,url:f})},function(){p.reject({groupLayerNames:c,serviceType:h,url:f})})}else if(h===u["a"].Type.WMTS){t.wmtsGetCapabilities(f).then(function(e){p.resolve({capabilities:e,groupLayerNames:c,serviceType:h,url:f})},function(){p.reject({groupLayerNames:c,serviceType:h,url:f})})}else{p.reject({groupLayerNames:c,serviceType:h,url:f})}};for(var f=0,h=l.length;f<h;f++){var p=c(f,h);if(p==="break")break}}return this.q_.all(n).then(function(e){for(var a=e,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.serviceType===u["a"].Type.WMS){for(var l=s.groupLayerNames,c=Array.isArray(l),f=0,l=c?l:l[Symbol.iterator]();;){var h;if(c){if(f>=l.length)break;h=l[f++]}else{f=l.next();if(f.done)break;h=f.value}var p=h;var d=t.wmsFindLayerCapability(s.capabilities["Capability"]["Layer"]["Layer"],p);if(d){r.createAndAddDataSourceFromWMSCapability(d,s.capabilities,s.url)}else{}}}else if(s.serviceType===u["a"].Type.WMTS){for(var g=s.groupLayerNames,m=Array.isArray(g),v=0,g=m?g:g[Symbol.iterator]();;){var y;if(m){if(v>=g.length)break;y=g[v++]}else{v=g.next();if(v.done)break;y=v.value}var _=y;var S=t.wmtsFindLayerCapability(s.capabilities["Contents"]["Layer"],_);if(S){r.createAndAddDataSourceFromWMTSCapability(S,s.capabilities,s.url)}else{}}}}},function(e){})};F.prototype.handleExternalDSGroupCollectionAdd_=function(e){var t=e.element;y["a"].assertInstanceof(t,l["a"]);this.registerExternalDSGroup_(t);this.setExternalDataSourcesState_()};F.prototype.registerExternalDSGroup_=function(e){b["a"](e.dataSourcesCollection,"add",this.setExternalDataSourcesState_,this);b["a"](e.dataSourcesCollection,"remove",this.setExternalDataSourcesState_,this)};F.prototype.containsLayerName=function(e,t){if(e instanceof A["a"]){for(var r=e.getLayers().getArray(),a=Array.isArray(r),n=0,r=a?r:r[Symbol.iterator]();;){var i;if(a){if(n>=r.length)break;i=r[n++]}else{n=r.next();if(n.done)break;i=n.value}var o=i;y["a"].assert(o);if(this.containsLayerName(o,t)){return true}}return false}else{return e.get("layerNodeName")==t}};F.prototype.handleExternalDSGroupCollectionRemove_=function(e){var t=e.element;y["a"].assertInstanceof(t,l["a"]);this.unregisterExternalDSGroup_(t);this.setExternalDataSourcesState_()};F.prototype.unregisterExternalDSGroup_=function(e){b["c"](e.dataSourcesCollection,"add",this.setExternalDataSourcesState_,this);b["c"](e.dataSourcesCollection,"remove",this.setExternalDataSourcesState_,this)};F.prototype.setExternalDataSourcesState_=function(){var e=this;if(this.setExternalDataSourcesStatePromise_){this.$timeout_.cancel(this.setExternalDataSourcesStatePromise_)}this.setExternalDataSourcesStatePromise_=this.$timeout_(function(){var t;var r=[];var n=[];for(var i=e.gmfExternalDataSourcesManager_.wmsGroups,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var c=l;n.push(c.url);var f=[];for(var h=c.dataSources,p=Array.isArray(h),d=0,h=p?h:h[Symbol.iterator]();;){var g;if(p){if(d>=h.length)break;g=h[d++]}else{d=h.next();if(d.done)break;g=d.value}var m=g;y["a"].assertInstanceof(m,u["a"]);var v=m.getOGCLayerNames()[0];f.push(v)}r.push(f.join(F.ExtDSSeparator.NAMES))}for(var _=e.gmfExternalDataSourcesManager_.wmtsGroups,S=Array.isArray(_),b=0,_=S?_:_[Symbol.iterator]();;){var w;if(S){if(b>=_.length)break;w=_[b++]}else{b=_.next();if(b.done)break;w=b.value}var C=w;n.push(C.url);var T=[];for(var E=C.dataSources,M=Array.isArray(E),L=0,E=M?E:E[Symbol.iterator]();;){var A;if(M){if(L>=E.length)break;A=E[L++]}else{L=E.next();if(L.done)break;A=L.value}var P=A;y["a"].assert(P.wmtsLayer);T.push(P.wmtsLayer)}r.push(T.join(F.ExtDSSeparator.NAMES))}e.ngeoStateManager_.updateState((t={},t[a["a"].PermalinkParam.EXTERNAL_DATASOURCES_NAMES]=r.join(F.ExtDSSeparator.LIST),t[a["a"].PermalinkParam.EXTERNAL_DATASOURCES_URLS]=n.join(F.ExtDSSeparator.LIST),t));e.setExternalDataSourcesStatePromise_=null})};F.prototype.cleanParams=function(e){var t=this;var r=y["a"].assert(this.ngeoLocation_.getParamKeys());for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.startsWith(F.ParamPrefix.TREE_GROUP_LAYERS)){var l=s.substring(F.ParamPrefix.TREE_GROUP_LAYERS.length);for(var u=e,c=Array.isArray(u),f=0,u=c?u:u[Symbol.iterator]();;){var h;if(c){if(f>=u.length)break;h=u[f++]}else{f=u.next();if(f.done)break;h=f.value}var p=h;if(p.name==l){this.ngeoStateManager_.deleteParam(s);break}}}if(s.startsWith(F.ParamPrefix.TREE_GROUP_OPACITY)){var d=s.substring(F.ParamPrefix.TREE_GROUP_OPACITY.length);for(var g=e,m=Array.isArray(g),v=0,g=m?g:g[Symbol.iterator]();;){var _;if(m){if(v>=g.length)break;_=g[v++]}else{v=g.next();if(v.done)break;_=v.value}var S=_;if(S.name==d){this.ngeoStateManager_.deleteParam(s);break}}}}this.$timeout_(function(){if(!t.map_){return}var e=t.map_.getLayerGroup();y["a"].assert(e);for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.startsWith(F.ParamPrefix.TREE_ENABLE)){var l=s.substring(F.ParamPrefix.TREE_ENABLE.length);if(!t.containsLayerName(e,l)){t.ngeoStateManager_.deleteParam(s)}}if(s.startsWith(F.ParamPrefix.TREE_OPACITY)){var u=s.substring(F.ParamPrefix.TREE_OPACITY.length);if(!t.containsLayerName(e,u)){t.ngeoStateManager_.deleteParam(s)}}}})};F.module=angular.module("gmfPermalink",[n["a"].module.name,i["a"].module.name,s["a"].name,v["a"].module.name,p["a"].name,d["a"].module.name,g["a"].name]);F.module.service("gmfPermalink",F);F.OpenLayersLayerProperties={OPACITY:"opacity"};F.ParamPrefix={DIMENSIONS:"dim_",TREE_ENABLE:"tree_enable_",TREE_GROUP_LAYERS:"tree_group_layers_",TREE_GROUP_OPACITY:"tree_group_opacity_",TREE_OPACITY:"tree_opacity_",WFS:"wfs_"};F.ExtDSSeparator={LIST:",",NAMES:";"};F.module.value("gmfPermalinkOptions",{});(function(){var e=[];for(var t in F.ParamPrefix){e.push(new RegExp(F.ParamPrefix[t]+".*"))}for(var r in a["a"].PermalinkParam){e.push(new RegExp(F.ParamPrefix[r]))}m["a"].module.value("ngeoUsedKeyRegexp",e)})();t["a"]=F}).call(this,r(33))},function(e,t,r){"use strict";(function(e){var a=r(1);var n=r(133);var i=r(341);var o=r.n(i);var s=r(405);var l=r.n(s);var u=r(340);var c=r.n(u);var f=r(339);var h=r.n(f);var p=r(338);var d=r.n(p);var g=r(337);var m=r.n(g);var v=angular.module("ngeoDatePicker",[n["a"].module.name,"ui.date"]);v.value("ngeoDatePickerTemplateUrl",function(e,t){var r=t["ngeoDatePickerTemplateUrl"];return r!==undefined?r:"ngeo/misc/datepickerComponent"});v.run(["$templateCache",function(e){e.put("ngeo/misc/datepickerComponent",r(336))}]);v.component_=function(t,r){return{scope:{onDateSelected:"&",time:"="},bindToController:true,controller:"ngeoDatePickerController as datepickerCtrl",restrict:"AE",templateUrl:t,link:function t(a,n,i,o){o.init();var s=o.gettextCatalog_.getCurrentLanguage();e["datepicker"]["setDefaults"](e["datepicker"]["regional"][s]);o.sdateOptions=angular.extend({},o.sdateOptions,{minDate:o.initialMinDate,maxDate:o.initialMaxDate,onClose:function t(r){if(r){e(n[0]).find('input[name="edate"]').datepicker("option","minDate",r)}}});o.edateOptions=angular.extend({},o.edateOptions,{minDate:o.initialMinDate,maxDate:o.initialMaxDate,onClose:function t(r){if(r){e(n[0]).find('input[name="sdate"]').datepicker("option","maxDate",r)}}});angular.element("body").on("hidden.bs.popover",function(){var t=angular.element("#ui-datepicker-div");if(t&&t.css("display")==="block"){e(n[0]).find('input[name$="date"]').datepicker("hide")}});r(function(){angular.element("#ui-datepicker-div").on("mousedown",function(e){e.stopPropagation()})})}}};v.component_.$inject=["ngeoDatePickerTemplateUrl","$timeout"];v.directive("ngeoDatePicker",v.component_);v.Controller_=function(e,t,r,a){var n=this;this.ngeoTime_=r;this.time;this.gettextCatalog_=a;this.isModeRange;this.onDateSelected;this.initialMinDate;this.initialMaxDate;this.edateOptions={changeMonth:true,changeYear:true};this.sdateOptions={changeMonth:true,changeYear:true};this.sdate;this.edate;e.$watchGroup(["datepickerCtrl.sdate","datepickerCtrl.edate"],function(e,t){var r=e[0];var a=e[1];if(angular.isDate(r)&&(!n.isModeRange||angular.isDate(a))){n.onDateSelected({time:{start:n.ngeoTime_.getTime(r),end:n.ngeoTime_.getTime(a)}})}})};v.Controller_.$inject=["$scope","$injector","ngeoTime","gettextCatalog"];v.Controller_.prototype.init=function(){var e=this.ngeoTime_.getOptions(this.time);this.initialMinDate=this.ngeoTime_.createDate(e.minDate);this.initialMaxDate=this.ngeoTime_.createDate(e.maxDate);this.isModeRange=this.time.mode==="range";if(this.isModeRange){a["a"].assertArray(e.values);this.sdate=this.ngeoTime_.createDate(e.values[0]);this.edate=this.ngeoTime_.createDate(e.values[1])}else{a["a"].assertNumber(e.values);this.sdate=this.ngeoTime_.createDate(e.values)}};v.controller("ngeoDatePickerController",v.Controller_);t["a"]=v}).call(this,r(33))},function(e,t,r){"use strict";var a=r(36);var n=angular.module("ngeoFeatures",[]);n.value("ngeoFeatures",new a["b"]);t["a"]=n},,,,,function(e,t,r){"use strict";var a=function e(t,r,a){var n=void 0,i=void 0;this.isValidFileSize=function(e){return!(e>2e7)};this.isWmsGetCap=function(e){return/<(WMT_MS_Capabilities|WMS_Capabilities)/.test(e)};this.isWmtsGetCap=function(e){return/<Capabilities/.test(e)};this.isKml=function(e){return/<kml/.test(e)&&/<\/kml>/.test(e)};this.isGpx=function(e){return/<gpx/.test(e)&&/<\/gpx>/.test(e)};this.read=function(e){var r=t.defer();if(n&&n.readyState===FileReader.LOADING){n.abort()}n=new FileReader;n.onload=function(e){r.resolve(e.target.result)};n.onerror=function(e){var t=e.target.error;console.error("Reading file failed: ",t);r.reject({message:t.code==20?a("Operation canceled"):a("Read failed"),reason:t.message})};n.onprogress=function(e){r.notify(e)};n.readAsText(e);return r.promise};this.load=function(e,n){if(i){i.resolve()}i=n||t.defer();var o=t.defer();r.get(e,{timeout:i.promise}).then(function(e){o.resolve(e.data)},function(e){console.error("Uploading file failed: ",e);o.reject({message:a("Upload failed"),reason:e})});return o.promise}};a.$inject=["$q","$http","gettext"];a.$inject=["$q","$http","gettext"];a.module=angular.module("ngeoFile",[]);a.module.service("ngeoFile",a);t["a"]=a},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(1);var n=r(26);var i={LINE_STRING:"LineString",POINT:"Point",POLYGON:"Polygon"};var o=i;var s=r(78);var l=r(2);var u=r(30);var c=r(107);var f=r(8);var h=r(68);var p=r(276);var d=r(17);var g=r(53);var m=r(105);var v=r(109);var y=r(116);var _=r(38);var S=r(45);var b=r(106);var w=r(55);var C=r(46);var T=r(16);var E=r(171);var M=function e(t){p["a"].call(this);var r=t!==undefined?t:{};this.accuracy_=r.accuracy!==undefined?r.accuracy:e.ACCURACY_;this.encodeStyles_=r.encodeStyles!==undefined?r.encodeStyles:true;this.propertiesFunction_=r.properties!==undefined?r.properties:e.defaultPropertiesFunction_;this.setStyle_=r.setStyle!==undefined?r.setStyle:true;this.prevX_=0;this.prevY_=0;e.LegacyProperties_=r.propertiesType!==undefined&&r.propertiesType;this.defaultValues_=r.defaultValues!==undefined?r.defaultValues:{}};l["d"](M,p["a"]);M.StyleTypes_={LineString:o.LINE_STRING,Point:o.POINT,Polygon:o.POLYGON,MultiLineString:o.LINE_STRING,MultiPoint:o.POINT,MultiPolygon:o.POLYGON};M.LegacyProperties_={};M.prototype.readFeature;M.prototype.readFeatures;M.prototype.readGeometry;M.prototype.writeFeature;M.prototype.writeFeatures;M.prototype.writeGeometry;M.CHAR64_=".-_!*ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghjkmnpqrstuvwxyz";M.ACCURACY_=.1;M.defaultPropertiesFunction_=function(e){return e.getProperties()};M.encodeSignedNumber_=function(e){var t=e<<1;if(e<0){t=~t}return M.encodeNumber_(t)};M.encodeNumber_=function(e){var t="";while(e>=32){t+=M.CHAR64_.charAt(32|e&31);e>>=5}t+=M.CHAR64_.charAt(e);return t};M.encodeStyles_=function(e,t,r){var n=M.StyleTypes_[t];a["a"].assert(n!==undefined);for(var i=0;i<e.length;++i){var s=e[i];var l=s.getFill();var u=s.getImage();var c=s.getStroke();var f=s.getText();if(n==o.POLYGON){if(l!==null){M.encodeStylePolygon_(l,c,r)}}else if(n==o.LINE_STRING){if(c!==null){M.encodeStyleLine_(c,r)}}else if(n==o.POINT){if(u!==null){M.encodeStylePoint_(u,r)}}if(f!==null){M.encodeStyleText_(f,r)}}};M.encodeStyleLine_=function(e,t){M.encodeStyleStroke_(e,t)};M.encodeStylePoint_=function(e,t){if(e instanceof b["a"]){var r=e.getRadius();if(t.length>0){t.push("'")}t.push(encodeURIComponent("pointRadius*"+r));var a=e.getFill();if(a!==null){M.encodeStyleFill_(a,t)}var n=e.getStroke();if(n!==null){M.encodeStyleStroke_(n,t)}}};M.encodeStylePolygon_=function(e,t,r){M.encodeStyleFill_(e,r);if(t!==null){M.encodeStyleStroke_(t,r)}};M.encodeStyleFill_=function(e,t,r){var n=r!==undefined?r:"fillColor";var i=e.getColor();if(i!==null){a["a"].assert(Array.isArray(i),"only supporting fill colors");var o=c["a"](i);a["a"].assert(Array.isArray(o),"fill color must be an array");var l=s["a"].rgbArrayToHex(o);if(t.length>0){t.push("'")}t.push(encodeURIComponent(n+"*"+l))}};M.encodeStyleStroke_=function(e,t){var r=e.getColor();if(r!==null){a["a"].assert(Array.isArray(r));var n=c["a"](r);a["a"].assert(Array.isArray(n),"only supporting stroke colors");var i=s["a"].rgbArrayToHex(n);if(t.length>0){t.push("'")}t.push(encodeURIComponent("strokeColor*"+i))}var o=e.getWidth();if(o!==undefined){if(t.length>0){t.push("'")}t.push(encodeURIComponent("strokeWidth*"+o))}};M.encodeStyleText_=function(e,t){var r=e.getFont();if(r!==undefined){var a=r.split(" ");if(a.length>=3){if(t.length>0){t.push("'")}t.push(encodeURIComponent("fontSize*"+a[1]))}}var n=e.getFill();if(n!==null){M.encodeStyleFill_(n,t,"fontColor")}};M.readLineStringGeometry_=function(e){a["a"].assert(e.substring(0,2)==="l(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e);var r=new g["a"](null);r.setFlatCoordinates(d["a"].XY,t);return r};M.readMultiLineStringGeometry_=function(e){a["a"].assert(e.substring(0,2)==="L(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=[];var r=[];var n=e.split("'");for(var i=0,o=n.length;i<o;++i){t=this.decodeCoordinates_(n[i],t);r[i]=t.length}var s=new m["a"](null);s.setFlatCoordinates(d["a"].XY,t,r);return s};M.readPointGeometry_=function(e){a["a"].assert(e.substring(0,2)==="p(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e);a["a"].assert(t.length===2);var r=new _["a"](null);r.setFlatCoordinates(d["a"].XY,t);return r};M.readMultiPointGeometry_=function(e){a["a"].assert(e.substring(0,2)==="P(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e);var r=new v["a"](null);r.setFlatCoordinates(d["a"].XY,t);return r};M.readPolygonGeometry_=function(e){a["a"].assert(e.substring(0,2)==="a(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=[];var r=[];var n=e.split("'");for(var i=0,o=n.length;i<o;++i){t=this.decodeCoordinates_(n[i],t);var s=t.length;if(i===0){t[s++]=t[0];t[s++]=t[1]}else{t[s++]=t[r[i-1]];t[s++]=t[r[i-1]+1]}r[i]=s}var l=new S["b"](null);l.setFlatCoordinates(d["a"].XY,t,r);return l};M.readMultiPolygonGeometry_=function(e){a["a"].assert(e.substring(0,2)==="A(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=[];var r=[];var n=e.split(")(");for(var i=0,o=n.length;i<o;++i){var s=n[i].split("'");var l=r[i]=[];for(var u=0,c=s.length;u<c;++u){t=this.decodeCoordinates_(s[u],t);var f=t.length;if(u===0){t[f++]=t[0];t[f++]=t[1]}else{t[f++]=t[l[u-1]];t[f++]=t[l[u-1]+1]}l[u]=f}}var h=new y["a"](null);h.setFlatCoordinates(d["a"].XY,t,r);return h};M.setStyleInFeature_=function(e,t){if(e==""){return}var r=M.getStyleProperties_(e,t);var a=r["fillColor"];var n=r["fontSize"];var i=r["fontColor"];var o=r["pointRadius"];var s=r["strokeColor"];var l=r["strokeWidth"];var u=null;if(a!==undefined){u=new w["a"]({color:a})}var c=null;if(s!==undefined&&l!==undefined){c=new C["a"]({color:s,width:l})}var f=null;if(o!==undefined){f=new b["a"]({radius:o,fill:u,stroke:c});u=c=null}var h=null;if(n!==undefined&&i!==undefined){h=new E["a"]({font:n+" sans-serif",fill:new w["a"]({color:i})})}var p=new T["c"]({fill:u,image:f,stroke:c,text:h});t.setStyle(p)};M.setStyleProperties_=function(e,t){var r=M.getStyleProperties_(e,t);var a=t.getGeometry();if(a instanceof _["a"]){if(r["isLabel"]||r[n["a"].IS_TEXT]){delete r["strokeColor"];delete r["fillColor"]}else{delete r["fontColor"];delete r["fontSize"]}}else{delete r["fontColor"];if(a instanceof g["a"]){delete r["fillColor"];delete r["fillOpacity"]}}if(r["fontSize"]){var i=parseFloat(r["fontSize"]);if(r["fontSize"].indexOf("px")!==-1){i=Math.round(i/1.333333)}r["fontSize"]=i}var o={};for(var s in r){var l=r[s];if(M.LegacyProperties_[s]){o[M.LegacyProperties_[s]]=l}else{o[s]=l}}t.setProperties(o)};M.castValue_=function(e,t){var r=[n["a"].ANGLE,n["a"].OPACITY,n["a"].SIZE,n["a"].STROKE,"pointRadius","strokeWidth"];var a=[n["a"].IS_CIRCLE,n["a"].IS_RECTANGLE,n["a"].IS_TEXT,n["a"].SHOW_MEASURE,n["a"].SHOW_LABEL,"isCircle","isRectangle","isLabel","showMeasure","showLabel"];if(f["f"](r,e)){return+t}else if(f["f"](a,e)){return t==="true"?true:false}else{return t}};M.getStyleProperties_=function(e,t){var r=e.split("'");var n={};for(var i=0;i<r.length;++i){var o=decodeURIComponent(r[i]);var s=o.split("*");a["a"].assert(s.length===2);var l=s[0];var u=s[1];n[l]=M.castValue_(l,u)}return n};M.writeLineStringGeometry_=function(e){a["a"].assertInstanceof(e,g["a"]);var t=e.getFlatCoordinates();var r=e.getStride();var n=t.length;return"l("+this.encodeCoordinates_(t,r,0,n)+")"};M.writeMultiLineStringGeometry_=function(e){a["a"].assertInstanceof(e,m["a"]);var t=e.getEnds();var r=t.length;var n=e.getFlatCoordinates();var i=e.getStride();var o=0;var s=["L("];for(var l=0;l<r;++l){var u=t[l];var c=this.encodeCoordinates_(n,i,o,u);if(l!==0){s.push("'")}s.push(c);o=u}s.push(")");return s.join("")};M.writePointGeometry_=function(e){a["a"].assertInstanceof(e,_["a"]);var t=e.getFlatCoordinates();var r=e.getStride();var n=t.length;return"p("+this.encodeCoordinates_(t,r,0,n)+")"};M.writeMultiPointGeometry_=function(e){a["a"].assertInstanceof(e,v["a"]);var t=e.getFlatCoordinates();var r=e.getStride();var n=t.length;return"P("+this.encodeCoordinates_(t,r,0,n)+")"};M.encodeRings_=function(e,t,r,a,n){var i=a.length;for(var o=0;o<i;++o){var s=a[o]-t;var l=this.encodeCoordinates_(e,t,r,s);if(o!==0){n.push("'")}n.push(l);r=a[o]}return r};M.writePolygonGeometry_=function(e){a["a"].assertInstanceof(e,S["b"]);var t=e.getFlatCoordinates();var r=e.getStride();var n=e.getEnds();var i=0;var o=["a("];M.encodeRings_.call(this,t,r,i,n,o);o.push(")");return o.join("")};M.writeMultiPolygonGeometry_=function(e){a["a"].assertInstanceof(e,y["a"]);var t=e.getFlatCoordinates();var r=e.getStride();var n=e.getEndss();var i=n.length;var o=0;var s=["A"];for(var l=0;l<i;++l){var u=n[l];s.push("(");o=M.encodeRings_.call(this,t,r,o,u,s);s.push(")")}return s.join("")};M.GEOMETRY_READERS_={P:M.readMultiPointGeometry_,L:M.readMultiLineStringGeometry_,A:M.readMultiPolygonGeometry_,l:M.readLineStringGeometry_,p:M.readPointGeometry_,a:M.readPolygonGeometry_};M.GEOMETRY_WRITERS_={MultiLineString:M.writeMultiLineStringGeometry_,MultiPoint:M.writeMultiPointGeometry_,MultiPolygon:M.writeMultiPolygonGeometry_,LineString:M.writeLineStringGeometry_,Point:M.writePointGeometry_,Polygon:M.writePolygonGeometry_};M.prototype.decodeCoordinates_=function(e,t){var r=e.length;var a=0;var n=t!==undefined?t:[];var i=n.length;while(a<r){var o=void 0;var s=0;var l=0;do{o=M.CHAR64_.indexOf(e.charAt(a++));l|=(o&31)<<s;s+=5}while(o>=32);var u=l&1?~(l>>1):l>>1;this.prevX_+=u;s=0;l=0;do{o=M.CHAR64_.indexOf(e.charAt(a++));l|=(o&31)<<s;s+=5}while(o>=32);var c=l&1?~(l>>1):l>>1;this.prevY_+=c;n[i++]=this.prevX_*this.accuracy_;n[i++]=this.prevY_*this.accuracy_}return n};M.prototype.encodeCoordinates_=function(e,t,r,a){var n="";for(var i=r;i<a;i+=t){var o=e[i];var s=e[i+1];o=Math.floor(o/this.accuracy_);s=Math.floor(s/this.accuracy_);var l=o-this.prevX_;var u=s-this.prevY_;this.prevX_=o;this.prevY_=s;n+=M.encodeSignedNumber_(l)+M.encodeSignedNumber_(u)}return n};M.prototype.readFeatureFromText=function(e,t){a["a"].assert(e.length>2);a["a"].assert(e[1]==="(");a["a"].assert(e[e.length-1]===")");var r=e.indexOf("~");var n=r>=0?e.substring(0,r)+")":e;var i=this.readGeometryFromText(n,t);var o=new u["a"](i);if(r>=0){var s=e.substring(r+1,e.length-1);r=s.indexOf("~");var l=r>=0?s.substring(0,r):s;if(l!=""){var c=l.split("'");for(var f=0;f<c.length;++f){var h=decodeURIComponent(c[f]);var p=h.split("*");a["a"].assert(p.length===2);var d=p[0];var g=p[1];if(!this.setStyle_&&M.LegacyProperties_[d]){d=M.LegacyProperties_[d]}o.set(d,M.castValue_(d,g))}}if(r>=0){var m=s.substring(r+1);if(this.setStyle_){M.setStyleInFeature_(m,o)}else{M.setStyleProperties_(m,o)}}}return o};M.prototype.readFeaturesFromText=function(e,t){var r=this;a["a"].assert(e[0]==="F");this.prevX_=0;this.prevY_=0;var n=[];e=e.substring(1);while(e.length>0){var i=e.indexOf(")");a["a"].assert(i>=0);var o=this.readFeatureFromText(e.substring(0,i+1),t);n.push(o);e=e.substring(i+1)}n.forEach(function(e){for(var t in r.defaultValues_){var a=M.LegacyProperties_[t];if(e.get(a)===undefined){e.set(a,r.defaultValues_[t].call(null,e))}}});return n};M.prototype.readGeometryFromText=function(e,t){var r=M.GEOMETRY_READERS_[e[0]];a["a"].assert(r!==undefined);return r.call(this,e)};M.prototype.writeFeatureText=function(e,t){var r=[];var n="";var i=e.getGeometry();if(i){n=this.writeGeometryText(i,t)}if(n.length>0){a["a"].assert(n[n.length-1]===")");n=n.substring(0,n.length-1);r.push(n)}var o=[];var s=this.propertiesFunction_(e);for(var l in s){var u=s[l];if(u!==undefined&&u!==null&&l!==e.getGeometryName()){if(o.length!==0){o.push("'")}var c=encodeURIComponent(l.replace(/[()'*]/g,"_")+"*"+u.toString().replace(/[()'*]/g,"_"));o.push(c)}}if(o.length>0){r.push("~");Array.prototype.push.apply(r,o)}if(this.encodeStyles_){var f=e.getStyleFunction();if(f!==undefined){var h=f.call(e,0);if(h!==null){var p=[];h=Array.isArray(h)?h:[h];M.encodeStyles_(h,i.getType(),p);if(p.length>0){r.push("~");Array.prototype.push.apply(r,p)}}}}r.push(")");return r.join("")};M.prototype.writeFeaturesText=function(e,t){this.prevX_=0;this.prevY_=0;var r=[];if(e.length>0){r.push("F");for(var a=0,n=e.length;a<n;++a){r.push(this.writeFeatureText(e[a],t))}}return r.join("")};M.prototype.writeGeometryText=function(e,t){var r=M.GEOMETRY_WRITERS_[e.getType()];a["a"].assert(r!==undefined);var n=h["b"](e,true,t);return r.call(this,n)};var L=t["a"]=M},function(e,t,r){"use strict";var a=function e(){return{restrict:"A",link:function t(r,a,n){var i=n["ngeoSearch"];var o=r.$eval(i);var s=n["ngeoSearchDatasets"];var l=r.$eval(s);var u=l.slice();u.unshift(o);a.typeahead.apply(a,u);var c=n["ngeoSearchListeners"];var f=r.$eval(c);var h=e.adaptListeners_(f);a.on("typeahead:open",function(){r.$apply(function(){h.open()})});a.on("typeahead:close",function(){r.$apply(function(){h.close()})});a.on("typeahead:cursorchange",function(e,t,a){r.$apply(function(){h.cursorchange(e,t,a)})});a.on("typeahead:select",function(e,t,a){r.$apply(function(){h.select(e,t,a)})});a.on("typeahead:autocomplete",function(e,t,a){r.$apply(function(){h.autocomplete(e,t,a)})});a.on("typeahead:asyncreceive",function(e,t,n){r.$apply(function(){var t=a.data("tt-typeahead")["menu"]["_allDatasetsEmpty"]();h.datasetsempty(e,n,t)})})}}};a.adaptListeners_=function(e){var t=void 0;if(e===undefined){t={open:function e(){},close:function e(){},cursorchange:function e(){},datasetsempty:function e(){},select:function e(){},autocomplete:function e(){}}}else{t={open:e.open!==undefined?e.open:function(){},close:e.close!==undefined?e.close:function(){},cursorchange:e.cursorchange!==undefined?e.cursorchange:function(){},datasetsempty:e.datasetsempty!==undefined?e.datasetsempty:function(){},select:e.select!==undefined?e.select:function(){},autocomplete:e.autocomplete!==undefined?e.autocomplete:function(){}}}return t};a.module=angular.module("ngeoSearchDirective",[]);a.module.directive("ngeoSearch",a);var n=a;var i=r(231);var o=r(11);var s=r(241);var l=function e(t,r,a,n,s,l){var u=new i["a"];var c={remote:{url:t,prepare:function e(t,r){r.url=r.url.replace("%QUERY",t);return r},transform:function e(t){var i=t;if(r!==undefined){i={type:"FeatureCollection",features:i.features.filter(r)}}return u.readFeatures(i,{featureProjection:a,dataProjection:n})}},datumTokenizer:function e(){},queryTokenizer:Bloodhound.tokenizers.whitespace};var f=o["a"]({},s||{});var h=o["a"]({},l||{});if(f.remote){o["a"](h,f.remote);delete f.remote}o["a"](c,f);o["a"](c.remote,h);return new Bloodhound(c)};l.module=angular.module("ngeoSearchCreategeojsonbloodhound",[]);l.module.value("ngeoSearchCreateGeoJSONBloodhound",l);l.Function;var u=l;var c=r(10);var f=r(202);var h=r(38);var p=r(30);var d=function e(t){var r=t||{};var a=c["f"](f["a"]);var n=r.targetProjection;var i=function e(t){var r=/BOX\((.*?) (.*?),(.*?) (.*?)\)/g;var a=r.exec(t);if(a!==null){return[parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4])]}else{return null}};var s=function e(t){return t.replace(/<\/?[ib]>/g,"")};var l=function e(t){var r=/<b>(.*?)<\/b>/g;var a=r.exec(t);if(a!==null){return a[1]}else{return t}};var u={remote:{url:"https://api3.geo.admin.ch/rest/services/api/SearchServer?type=locations&searchText=%QUERY",prepare:function e(t,a){a.url=a.url.replace("%QUERY",t);if(r.limit!==undefined){a.url+="&limit="+r.limit}if(r.origins!==undefined){a.url+="&origins="+r.origins}return r.prepare!==undefined?r.prepare(t,a):a},transform:function e(t){var r=t.results.map(function(e){var t=e.attrs;var r=new h["a"]([t.y,t.x]);var o=i(t.geom_st_box2d);if(n!==undefined){r.transform(a,n);if(o!==null){o=c["l"](o,a,n)}}t["geometry"]=r;t["bbox"]=o;var u=t.label;t["label_no_html"]=s(u);t["label_simple"]=l(u);var f=new p["a"](t);f.setId(t.featureId);return f});return r}},datumTokenizer:function e(){},queryTokenizer:Bloodhound.tokenizers.whitespace};var d=o["a"]({},r.options||{});var g=o["a"]({},r.remoteOptions||{});if(d.remote){o["a"](g,d.remote);delete d.remote}o["a"](u,d);o["a"](u.remote,g);return new Bloodhound(u)};d.module=angular.module("ngeoCreateLocationSearchBloodhound",[]);d.module.value("ngeoCreateLocationSearchBloodhound",d);d.Function;var g=d;var m=angular.module("ngeoSearchModule",[n.module.name,u.module.name,g.module.name]);var v=t["a"]=m},,,function(e,t,r){"use strict";(function(e){var a=r(1);var n=angular.module("gmfMobileNav",[]);n.component_=function(){return{restrict:"A",controller:"gmfMobileNavController as navCtrl",bindToController:true,scope:true,link:function e(t,r,a,n){n.init(r)}}};n.directive("gmfMobileNav",n.component_);n.Controller_=function(){this.slid_=[];this.active_=null;this.header_=null;this.backButton_=null;this.back=this.back_.bind(this)};n.controller("gmfMobileNavController",n.Controller_);n.Controller_.prototype.init=function(t){var r=this;var i=n.Controller_.ClassName_;this.active_=e(t.find("."+i.ACTIVE+"."+i.SLIDE));this.header_=e(t.find("> header"));this.backButton_=e(t.find("header > ."+i.GO_BACK));t.find("[data-toggle=slide-in]").on("click",function(t){var i=n.Controller_.ClassName_;var o=e(t.currentTarget).parents("."+i.SLIDE);a["a"].assert(o.length===1);r.slid_.push(o);o.addClass(i.SLIDE_OUT).removeClass(i.ACTIVE);var s=e(e(t.currentTarget).attr("data-target"));a["a"].assert(s.length===1);s.addClass(i.ACTIVE);r.updateNavigationHeader_(s,false);r.active_=s});this.backButton_.click(this.back.bind(this))};n.Controller_.prototype.updateNavigationHeader_=function(t,r){var a=n.Controller_.ClassName_;this.header_.toggleClass(a.BACK,r);this.header_.find("nav:not(."+a.ACTIVE+" +)").remove();this.header_.find("nav."+a.ACTIVE).removeClass(a.ACTIVE).addClass(a.SLIDE_OUT);this.backButton_.toggleClass(a.ACTIVE,this.slid_.length>0);var i=e("<nav>");i.append(e("<span>",{text:t.attr("data-header-title")}));this.header_.append(i);window.setTimeout(function(){i.css("display","none");i.offset();i.css("display","");window.setTimeout(function(){i.position();i.addClass(n.Controller_.ClassName_.ACTIVE)},0)},0)};n.Controller_.prototype.back_=function(){if(this.slid_.length<=0){return}var e=n.Controller_.ClassName_;this.active_.removeClass(e.ACTIVE);var t=this.slid_.pop();t.addClass(e.ACTIVE).removeClass(e.SLIDE_OUT);this.updateNavigationHeader_(t,true);this.active_=t};n.Controller_.prototype.backIfActive=function(e){if(this.active_!==null&&this.active_.is(e)){this.back_()}};n.Controller_.ClassName_={ACTIVE:"gmf-mobile-nav-active",BACK:"gmf-mobile-nav-back",GO_BACK:"gmf-mobile-nav-go-back",SLIDE:"gmf-mobile-nav-slide",SLIDE_OUT:"gmf-mobile-nav-slide-out"};n.backDirective=function(){return{require:"^^gmfMobileNav",restrict:"A",scope:false,link:function e(t,r,a,n){t.$watch(a["gmfMobileNavBack"],function(e,t){if(e===true){n.backIfActive(r[0])}})}}};n.directive("gmfMobileNavBack",n.backDirective);n.backOnClickDirective=function(){return{require:"^^gmfMobileNav",restrict:"A",scope:false,link:function e(t,r,a,n){r.on("click",function(){n.backIfActive(r[0])})}}};n.directive("gmfMobileNavBackOnClick",n.backOnClickDirective);t["a"]=n}).call(this,r(33))},function(e,t,r){"use strict";(function(e){var a=r(293);var n=r.n(a);var i=r(1);var o=angular.module("ngeoSortable",[]);o.component_=function(t){return{restrict:"A",link:function r(a,n,o){var s=a.$eval(o["ngeoSortable"])||[];i["a"].assert(Array.isArray(s));a.$watchCollection(function(){return s},function(){s.length&&t(h,0)});var l=a.$eval(o["ngeoSortableOptions"]);var u=p(l);var c=a.$eval(o["ngeoSortableCallback"]);var f=a.$eval(o["ngeoSortableCallbackCtx"]);function h(){var t=n.children();for(var r=0;r<t.length;++r){angular.element(t[r]).data("idx",r)}var i=e(n);if(i.data("ui-sortable")){i.off("sortupdate");i.sortable("destroy")}var o={axis:"y",classes:{"ui-sortable-helper":u["draggerClassName"]}};if(u["handleClassName"]){o["handle"]="."+u["handleClassName"]}if(u["placeholderClassName"]){o["placeholder"]=u["placeholderClassName"];o["forcePlaceholderSize"]=true}i.sortable(o);i.on("sortupdate",function(t,r){var i=e(r.item[0]).data("idx");var o=r.item.index();e(r.item[0]).data("idx",o);a.$apply(function(){s.splice(o,0,s.splice(i,1)[0])});if(c instanceof Function){c.apply(f,[n,s])}})}function p(e){var t=void 0;var r="ngeo-sortable-handle";if(e===undefined){t={handleClassName:r}}else{if(e["handleClassName"]===undefined){e["handleClassName"]=r}t=e}return t}}}};o.component_.$inject=["$timeout"];o.directive("ngeoSortable",o.component_);t["a"]=o}).call(this,r(33))},function(e,t,r){"use strict";(function(e){var a=r(302);var n=r.n(a);var i=r(301);var o=r.n(i);var s=angular.module("ngeoPopover",[]);s.component_=function(){return{restrict:"A",scope:true,controller:"NgeoPopoverController as popoverCtrl",link:function t(r,a,n,i){i.anchorElm.on("hidden.bs.popover",function(){var e=i.anchorElm.data("bs.popover");e["inState"].click=false});i.anchorElm.on("inserted.bs.popover",function(){i.bodyElm.show();i.shown=true});i.anchorElm.popover({container:"body",html:true,content:i.bodyElm,placement:n["ngeoPopoverPlacement"]||"right"});if(n["ngeoPopoverDismiss"]){e(n["ngeoPopoverDismiss"]).on("scroll",function(){i.dismissPopover()})}r.$on("$destroy",function(){i.anchorElm.popover("destroy");i.anchorElm.unbind("inserted.bs.popover");i.anchorElm.unbind("hidden.bs.popover")})}}};s.anchorComponent=function(){return{restrict:"A",require:"^^ngeoPopover",link:function e(t,r,a,n){n.anchorElm=r}}};s.contentComponent=function(){return{restrict:"A",require:"^^ngeoPopover",link:function e(t,r,a,n){n.bodyElm=r;r.hide()}}};s.PopoverController_=function(e){this.shown=false;this.anchorElm=undefined;this.bodyElm=undefined;function t(e){if(this.anchorElm[0]!==e.target&&this.bodyElm.parent()[0]!==e.target&this.bodyElm.parent().find(e.target).length===0&&this.shown){this.dismissPopover()}}angular.element("body").on("mousedown",t.bind(this));e.$on("$destroy",function(){angular.element("body").off("mousedown",t)})};s.PopoverController_.$inject=["$scope"];s.PopoverController_.prototype.dismissPopover=function(){this.shown=false;this.anchorElm.popover("hide")};s.controller("NgeoPopoverController",s.PopoverController_);s.directive("ngeoPopover",s.component_);s.directive("ngeoPopoverAnchor",s.anchorComponent);s.directive("ngeoPopoverContent",s.contentComponent);t["a"]=s}).call(this,r(33))},function(e,t,r){"use strict";var a=angular.module("ngeoColorpicker",[]);a.value("ngeoColorpickerTemplateUrl",function(e,t){var r=t["ngeoColorpickerTemplateurl"];return r!==undefined?r:"ngeo/misc/colorpickerComponent"});a.run(["$templateCache",function(e){e.put("ngeo/misc/colorpickerComponent",r(303))}]);a.component_=function(e){return{restrict:"A",scope:{colors:"<?ngeoColorpicker",color:"=?ngeoColorpickerColor"},controller:"NgeoColorpickerController as ctrl",bindToController:true,templateUrl:e}};a.component_.$inject=["ngeoColorpickerTemplateUrl"];a.directive("ngeoColorpicker",a.component_);a.DEFAULT_COLORS=[["#F4EB37","#CDDC39","#62AF44","#009D57","#0BA9CC","#4186F0","#3F5BA9","#7C3592","#A61B4A","#DB4436","#F8971B","#F4B400","#795046"],["#F9F7A6","#E6EEA3","#B7DBAB","#7CCFA9","#93D7E8","#9FC3FF","#A7B5D7","#C6A4CF","#D698AD","#EE9C96","#FAD199","#FFDD5E","#B29189"],["#ffffff","#CCCCCC","#777","#000000"]];a.Controller_=function(e,t,r){this.colors=this.colors||a.DEFAULT_COLORS;this.color};a.Controller_.$inject=["$scope","$element","$attrs"];a.Controller_.prototype.setColor=function(e){this.color=e};a.controller("NgeoColorpickerController",a.Controller_);t["a"]=a},function(e,t,r){"use strict";(function(e){var a=r(41);var n=r(98);var i=r(204);var o=r(39);var s=r(1);var l=r(88);var u=r(203);var c=r(258);var f=r(257);var h=r(252);var p=r(30);var d=r(107);var g=r(38);var m=r(11);var v=r(231);var y=r(10);var _=r(106);var S=r(55);var b=r(136);var w=r(46);var C=r(16);var T=r(142);function E(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var M=angular.module("gmfSearch",[n["a"].module.name,i["a"].module.name,o["a"].module.name,u["a"].module.name,c["a"].name,h["a"].name,l["a"].module.name,f["a"].name]);M.gmfSearchTemplateUrl_=function(e,t){var r=t["gmfSearchTemplateurl"];return r!==undefined?r:"gmf/search"};M.run(["$templateCache",function(e){e.put("gmf/search",r(296))}]);L.$inject=["$element","$attrs","gmfSearchTemplateUrl"];function L(e,t,r){return r(e,t)}M.component_={bindings:{inputValue:"=?gmfSearchInputValue",placeholder:"@?gmfSearchPlaceholder",map:"<gmfSearchMap",datasources:"<gmfSearchDatasources",typeaheadOptions:"<?gmfSearchOptions",featuresStyles:"<?gmfSearchStyles",clearButton:"=?gmfSearchClearbutton",colorChooser:"<?gmfSearchColorchooser",coordinatesProjections:"<?gmfSearchCoordinatesprojections",additionalListeners:"<gmfSearchListeners",maxZoom:"<?gmfSearchMaxzoom",delay:"<?gmfSearchDelay",onInitCallback:"<?gmfSearchOnInit"},controller:"gmfSearchController",templateUrl:L};M.value("gmfSearchTemplateUrl",M.gmfSearchTemplateUrl_);M.component("gmfSearch",M.component_);M.SearchController_=function(){t.$inject=["$element","$scope","$compile","$timeout","$injector","gettextCatalog","ngeoAutoProjection","ngeoSearchCreateGeoJSONBloodhound","ngeoFeatureOverlayMgr","gmfThemes","gmfTreeManager","gmfSearchFulltextSearch"];function t(e,r,a,n,i,o,s,l,u,c,f,h){E(this,t);this.element_=e;this.scope_=r;this.compile_=a;this.timeout_=n;this.gettextCatalog_=o;this.gmfThemes_=c;this.gmfTreeManager_=f;this.fullTextSearch_=h;this.ngeoSearchCreateGeoJSONBloodhound_=l;this.ngeoFeatureOverlayMgr=u;this.ngeoLocation_;if(i.has("ngeoLocation")){this.ngeoLocation_=i.get("ngeoLocation")}this.ngeoAutoProjection_=s;this.map;this.styles_={};this.onInitCallback;this.clearButton;this.colorChooser;this.placeholder;this.delay;this.maxZoom=16;this.coordinatesProjections;this.featureOverlay_=u.getFeatureOverlay();this.datasources=[];this.typeaheadOptions;this.options={highlight:true};this.featuresStyles;this.datasets=[];this.inputValue="";this.color;this.displayColorPicker=false;this.listeners;this.additionalListeners}t.prototype.$onInit=function e(){var t=this;var r=this.gettextCatalog_;this.clearButton=this.clearButton!==false;this.colorChooser=this.colorChooser===true;if(this.delay===undefined){this.delay=50}this.placeholder=this.placeholder!==undefined?this.placeholder:r.getString("Search…");var a=this.coordinatesProjections;if(a===undefined){a=[this.map.getView().getProjection()]}else{a=this.ngeoAutoProjection_.getProjectionList(a)}this.coordinatesProjections=a;if(!this.clearButton){this.element_.find("input").on("focus blur",function(){t.clear()})}if(this.onInitCallback){this.onInitCallback()}this.initStyles_();this.featureOverlay_.setStyle(this.getSearchStyle_.bind(this));if(this.typeaheadOptions){m["a"](this.options,this.typeaheadOptions)}this.initDatasets_();this.scope_.$watch(function(){return t.color},this.setStyleColor.bind(this));this.listeners=this.mergeListeners_(this.additionalListeners,{select:this.select_.bind(this),close:this.close_.bind(this),datasetsempty:this.datasetsempty_.bind(this)});if(this.ngeoLocation_){var n=this.ngeoLocation_.getParam("search");if(n){var i=1;if(this.ngeoLocation_.getParam("search-select-index")){i=parseInt(this.ngeoLocation_.getParam("search-select-index"),10)}var o=void 0;if(this.ngeoLocation_.getParam("search-maxzoom")){o=parseInt(this.ngeoLocation_.getParam("search-maxzoom"),10)}else if(this.ngeoLocation_.getParam("map_zoom")){o=parseInt(this.ngeoLocation_.getParam("map_zoom"),10)}this.fulltextsearch_(n,i,o)}}};t.prototype.mergeListeners_=function e(t,r){if(t===undefined){return r}return{open:t.open,close:t.close===undefined?r.close:function(){r.close();t.close()},cursorchange:t.cursorchange,datasetsempty:t.datasetsempty,select:t.select===undefined?r.select:function(e,a,n){r.select(e,a,n);t.select(e,a,n)},autocomplete:t.autocomplete}};t.prototype.initDatasets_=function e(){var t=this;var r=this.gettextCatalog_;var a=function e(a){var n=t.datasources[a];var i=n.groupValues!==undefined?n.groupValues:[];var o=n.groupActions?n.groupActions:[];var s=[];if(i.length===0){s.push({title:"",filter:t.filterLayername_()})}else{i.forEach(function(e){s.push({title:e,filter:this.filterLayername_(e)})},t)}o.forEach(function(e){s.push({title:r.getString(e["title"]),filter:this.filterAction_(e["action"])})},t);s.forEach(function(e){this.datasets.push(this.createDataset_({bloodhoundOptions:n.bloodhoundOptions,datasetTitle:e["title"],groupsKey:"layer_name",labelKey:n.labelKey,projection:n.projection,typeaheadDatasetOptions:n.typeaheadDatasetOptions,url:n.url},e["filter"]))},t)};for(var n=0;n<this.datasources.length;n++){a(n)}this.datasets.push({source:this.createSearchCoordinates_(this.map.getView()),name:"coordinates",display:"label",templates:{header:function e(){var e=r.getString("Recenter to");return'<div class="gmf-search-header" translate>'+e+"</div>"},suggestion:function e(t){var r=t["label"];var a='<p class="gmf-search-label">'+r+"</p>";a='<div class="gmf-search-datum">'+a+"</div>";return a}}})};t.prototype.createDataset_=function e(t,r){var a=this.gettextCatalog_;var n=this.scope_;var i=this.compile_;var o=this.createAndInitBloodhound_(t,r);var s={limit:Infinity,source:o.ttAdapter(),display:function e(r){var a=r;return a.get(t.labelKey)},templates:{header:function e(){if(t.datasetTitle===undefined){return""}else{var e=a.getString(t.datasetTitle);return'<div class="gmf-search-header">'+e+"</div>"}},suggestion:function e(r){var a=r;var o=n.$new(true);o["feature"]=a;var s='<p class="gmf-search-label" translate>'+a.get(t.labelKey)+"</p>";s+='<p class="gmf-search-group" translate>'+(a.get("layer_name")||t.datasetTitle)+"</p>";s='<div class="gmf-search-datum">'+s+"</div>";return i(s)(o)}}};if(t.typeaheadDatasetOptions){m["a"](s,t.typeaheadDatasetOptions)}return s};t.prototype.filterAction_=function e(t){return function(e){var r=e["properties"];if(r["actions"]){return!r["layer_name"]&&r["actions"].some(function(e){return e.action===t})}else{return false}}};t.prototype.filterLayername_=function e(t){return function(e){var r=e["properties"]["layer_name"];if(r===undefined){return false}if(t===undefined){return true}return r===t}};t.prototype.createAndInitBloodhound_=function e(t,r){var a=this.map.getView().getProjection().getCode();var n=this.getBloodhoudRemoteOptions_();var i=this.ngeoSearchCreateGeoJSONBloodhound_(t.url,r,y["f"](a),y["f"](t.projection),t.bloodhoundOptions,n);i.initialize();return i};t.prototype.getBloodhoudRemoteOptions_=function e(){var t=this.gettextCatalog_;return{rateLimitWait:this.delay,prepare:function e(r,a){var n=a.url;var i=t.currentLanguage;a.xhrFields={withCredentials:true};a.url=T["a"](n,{query:r,lang:i});return a}}};t.prototype.createSearchCoordinates_=function e(t){var r=t.getProjection();var a=r.getExtent();return function(e,t){var n=[];var i=this.ngeoAutoProjection_.stringToCoordinates(e);if(i===null){return}var o=this.ngeoAutoProjection_.tryProjectionsWithInversion(i,a,r,this.coordinatesProjections);if(o===null){return}n.push({label:i.join(" "),position:o,tt_source:"coordinates"});t(n)}.bind(this)};t.prototype.initStyles_=function e(){this.styles_[a["a"].COORDINATES_LAYER_NAME]=new C["c"]({image:new b["a"]({stroke:new w["a"]({color:[0,0,0,.7],width:2}),points:4,radius:8,radius2:0,angle:0})});var t=new S["a"]({color:[65,134,240,.5]});var r=new w["a"]({color:[65,134,240,1],width:2});this.styles_["default"]=new C["c"]({fill:t,image:new _["a"]({fill:t,radius:5,stroke:r}),stroke:r});var n=this.featuresStyles||{};m["a"](this.styles_,n)};t.prototype.getSearchStyle_=function e(t,r){s["a"].assert(t);var a=this.styles_[t.get("layer_name")]||this.styles_["default"];if(this.color){var n=d["a"](this.color);var i=n.slice();i[3]=1;var o=n.slice();o[3]=.5;var l=a.getStroke();if(l){l.setColor(i)}var u=a.getFill();if(u){u.setColor(o)}var c=a.getImage();if(c){c=c.clone();var f=c.getStroke();if(f){f.setColor(i)}var h=c.getFill();if(h){h.setColor(o)}a.setImage(c)}}return a};t.prototype.setStyleColor=function e(t){if(t){this.color=t;this.ngeoFeatureOverlayMgr.getLayer().changed()}};t.prototype.setTTDropdownVisibility_=function e(){if(this.clearButton){var t=this.element_.find(".twitter-typeahead .tt-menu");this.inputValue?t.show():t.hide()}};t.prototype.onClearButton=function e(){this.featureOverlay_.clear();this.clear()};t.prototype.clear=function t(){var r=this.element_.find(".twitter-typeahead");var a=r.children(".tt-menu");var n=r.children("input");this.inputValue="";e(n[1]).typeahead("val","");a.children(".tt-dataset").empty();this.setTTDropdownVisibility_();this.displayColorPicker=false};t.prototype.blur=function t(){var r=this.element_.find(".twitter-typeahead");var a=r.children("input");this.timeout_(function(){e(a[1]).blur()})};t.prototype.select_=function e(t,r,n){if(r["tt_source"]==="coordinates"){var i=new g["a"](r["position"]);this.featureOverlay_.clear();this.featureOverlay_.addFeature(new p["a"]({geometry:i,layer_name:a["a"].COORDINATES_LAYER_NAME}));this.map.getView().setCenter(r["position"]);this.leaveSearch_()}else{s["a"].assertInstanceof(r,p["a"]);this.selectFromGMF_(t,r,n)}};t.prototype.selectFromGMF_=function e(t,r,a){var n=this;var i=r.get("actions");var s=r.getGeometry();if(i){var l=function e(t,r){var a=i[t];var l=a["action"];var u=a["data"];if(l=="add_theme"){n.gmfThemes_.getThemesObject().then(function(e){var t=o["a"].findThemeByName(e,u);if(t){n.gmfTreeManager_.addFirstLevelGroups(t.children)}})}else if(l=="add_group"){n.gmfTreeManager_.addGroupByName(u,true)}else if(l=="add_layer"){var c=n.datasources[0].groupActions;var f=void 0;c.forEach(function(e){if(e["action"]==="add_layer"){return f=true}});if(f){var h=!!s;n.gmfTreeManager_.addGroupByLayerName(u,true,h)}}};for(var u=0,c=i.length;u<c;u++){l(u,c)}}var f=this.map.getSize();if(s&&f){var h=this.map.getView();this.featureOverlay_.clear();this.featureOverlay_.addFeature(r);this.displayColorPicker=true;var p=s.getType()==="GeometryCollection"?s.getExtent():s;h.fit(p,{size:f,maxZoom:this.maxZoom})}this.leaveSearch_()};t.prototype.leaveSearch_=function e(){if(!this.clearButton){this.clear()}this.blur()};t.prototype.close_=function e(t){if(!this.clearButton){this.setTTDropdownVisibility_()}};t.prototype.datasetsempty_=function t(r,a,n){var i=this.element_.find(".twitter-typeahead .tt-menu");var o=i.children(".gmf-search-no-results");if(o.length==0){var s=e('<div class="gmf-search-no-results" translate>No result found</div>');i.append(s)}if(n){o.show();i.addClass("gmf-search-no-results")}else{i.removeClass("gmf-search-no-results");o.hide()}};t.prototype.fulltextsearch_=function e(t,r,a){var n=this;if(r<1){r=1}this.fullTextSearch_.search(t,{limit:r}).then(function(e){if(e&&e.features[r-1]){var t=new v["a"];var i=t.readFeature(e.features[r-1]);n.featureOverlay_.addFeature(i);var o={};if(a!==undefined){o.maxZoom=a;o.size=n.map.getSize()}n.map.getView().fit(i.getGeometry().getExtent(),o);n.inputValue=i.get("label")}})};return t}();M.controller("gmfSearchController",M.SearchController_);t["a"]=M}).call(this,r(33))},function(e,t,r){"use strict";(function(e){var r=angular.module("ngeoRecenter",[]);r.directive_=function(){return{restrict:"A",link:function t(r,a,n){var i=n["ngeoRecenterMap"];var o=r.$eval(i);function s(e){var t=e.attr("ngeo-extent");if(t!==undefined){var a=o.getSize();o.getView().fit(r.$eval(t),{size:a})}var n=e.attr("ngeo-zoom");if(n!==undefined){o.getView().setZoom(r.$eval(n))}}a.on("click","*",function(t){s(angular.element(e(this)))});a.on("change",function(e){var t=e.target.options[e.target.selectedIndex];s(angular.element(t))})}}};r.directive("ngeoRecenter",r.directive_);t["a"]=r}).call(this,r(33))},,,function(e,t,r){"use strict";var a=r(1);var n=function e(t,r,n,i,o){var s=i.$watchCollection(function(){return t},function(){var e=void 0,a=void 0,i=void 0;if(n){for(e=t.length-1,i=0;e>=0;--e){if(o(t[e])){r[i++]=t[e]}}}else{for(e=0,a=t.length,i=0;e<a;++e){if(o(t[e])){r[i++]=t[e]}}}r.length=i});var l=i.$watchCollection(function(){return r},function(){var e=void 0,i=void 0,s=void 0;if(n){for(e=0,i=t.length,s=r.length-1;e<i;++e){if(o(t[e])){t[e]=r[s--]}}a["a"].assert(s==-1)}else{for(e=0,i=t.length,s=0;e<i;++e){if(o(t[e])){t[e]=r[s++]}}a["a"].assert(s==r.length)}});return function(){s();l()}};t["a"]=n},function(e,t,r){"use strict";var a=r(75);var n=r(226);var i=r.n(n);var o=angular.module("ngeoLayertree",[a["a"].module.name]);o.value("ngeoLayertreeTemplateUrl",function(e,t){var r=t["ngeoLayertreeTemplateurl"];return r!==undefined?r:"ngeo/layertree"});o.run(["$templateCache",function(e){e.put("ngeo/layertree",r(331))}]);o.directive_=function(e){return{restrict:"A",scope:true,templateUrl:e,controller:a["a"]}};o.directive_.$inject=["ngeoLayertreeTemplateUrl"];o.directive("ngeoLayertree",o.directive_);t["a"]=o},function(e,t,r){"use strict";var a={};a.Permalink3dParam={ENABLED:"3d_enabled",LON:"3d_lon",LAT:"3d_lat",ELEVATION:"3d_elevation",HEADING:"3d_heading",PITCH:"3d_pitch",PREFIX:"3d_"};t["a"]=a},function(e,t,r){"use strict";(function(e){var a=r(2);var n=r(124);var i=function t(r){var a=r!==undefined?r:{};var i=void 0;if(a.element){i=a.element;delete a.element}else{i=e("<div />")[0]}this.closeEl_=e("<button>",{class:"close",html:"&times;"});this.contentEl_=e("<div/>").append(this.closeEl_).append(i);a.element=e("<div />")[0];n["a"].call(this,a)};a["d"](i,n["a"]);i.prototype.setMap=function(t){var r=this;var a=this.getElement();var i=this.getMap();if(i){e(a).popover("destroy")}n["a"].prototype.setMap.call(this,t);if(t){var o=this.contentEl_;window.setTimeout(function(){e(a).popover({content:o,html:true,placement:"top",template:['<div class="popover ngeo-popover" role="tooltip">','  <div class="arrow"></div>','  <h3 class="popover-title"></h3>','  <div class="popover-content"></div>',"</div>"].join("")}).popover("show")},0);this.closeEl_.one("click",function(){var e=r.getMap();if(e){e.removeOverlay(r)}})}};t["a"]=i}).call(this,r(33))},function(e,t,r){"use strict";(function(e){var a=r(41);var n=r(163);var i=r(198);var o=r(207);var s=r(205);var l=r(132);var u=r(98);var c=r(39);var f=r(1);var h=r(40);var p=r(264);var d=r(75);var g=r(100);var m=r(263);var v=r(89);var y=r(168);var _=r(84);var S=r(11);var b=r(149);var w=r(222);var C=r(169);var T=r(226);var E=r.n(T);var M=angular.module("gmfLayertreeComponent",[n["a"].module.name,i["a"].module.name,o["a"].module.name,s["a"].name,l["a"].module.name,u["a"].module.name,c["a"].module.name,p["a"].name,d["a"].module.name,g["a"].module.name,v["a"].module.name]);M.value("ngeoLayertreeTemplateUrl",function(e,t){return"gmf/layertree"});M.run(["$templateCache",function(e){e.put("gmf/layertree",r(330))}]);M.value("gmfLayertreeTemplate",function(e,t){var r="gmf/layertree";return'<div ngeo-layertree="gmfLayertreeCtrl.root" '+'ngeo-layertree-map="gmfLayertreeCtrl.map" '+'ngeo-layertree-nodelayer="gmfLayertreeCtrl.getLayer(treeCtrl)" '+'ngeo-layertree-listeners="gmfLayertreeCtrl.listeners(treeScope, treeCtrl)" '+('ngeo-layertree-templateurl="'+r+'">')+"</div>"});L.$inject=["$element","$attrs","gmfLayertreeTemplate"];function L(e,t,r){return r(e,t)}M.component_={controller:"GmfLayertreeController as gmfLayertreeCtrl",bindings:{map:"=gmfLayertreeMap",dimensions:"=?gmfLayertreeDimensions",openLinksInNewWindow:"<?gmfLayertreeOpenlinksinnewwindow"},template:L};M.component("gmfLayertree",M.component_);M.Controller_=function(e,t,r,a,n,i,o,s,l,u){var c=this;this.map;this.dimensions;this.scope_=t;this.layerHelper_=r;this.gmfDataSourceBeingFiltered=a;this.gmfExternalDataSourcesManager=n;this.gmfPermalink_=i;this.gmfTreeManager_=o;var h=o.root;f["a"].assert(h);this.root=h;this.gmfSyncLayertreeMap_=s;this.ngeoWMSTime_=l;this.groupNodeStates_={};this.openLinksInNewWindow;this.dataLayerGroup_=null;this.layers=[];this.gmfThemes_=u;e.on("shown.bs.collapse",function(){c.scope_.$apply()})};M.Controller_.$inject=["$element","$scope","ngeoLayerHelper","gmfDataSourceBeingFiltered","gmfExternalDataSourcesManager","gmfPermalink","gmfTreeManager","gmfSyncLayertreeMap","ngeoWMSTime","gmfThemes"];M.Controller_.prototype.$onInit=function(){var e=this;this.openLinksInNewWindow=this.openLinksInNewWindow===true;this.dataLayerGroup_=this.layerHelper_.getGroupFromMap(this.map,a["a"].DATALAYERGROUP_NAME);Object(m["a"])(this.dataLayerGroup_.getLayers().getArray(),this.layers,true,this.scope_,function(){return true});this.scope_.$watchCollection(function(){return e.layers},function(){e.map.render()});this.scope_.$watchCollection(function(){if(e.gmfTreeManager_.rootCtrl){return e.dimensions}},function(t){if(t){e.updateDimensions_(e.gmfTreeManager_.rootCtrl)}})};M.Controller_.prototype.updateDimensions_=function(e){var t=this;e.traverseDepthFirst(function(e){if(e.node.dimensions){var r=e.layer;f["a"].assertInstanceof(r,_["a"]);t.updateLayerDimensions_(r,e.node)}})};M.Controller_.prototype.updateLayerDimensions_=function(e,t){var r=this;if(this.dimensions&&t.dimensions){var a={};for(var n in t.dimensions){if(t.dimensions[n]===null){var i=this.dimensions[n];if(i!==undefined){a[n]=i}}else{a[n]=t.dimensions[n]}}if(!S["d"](a)){var o=e.getSource();if(o instanceof C["a"]){o.updateDimensions(a)}else if(o instanceof w["a"]||o instanceof b["a"]){o.updateParams(a)}else{e.once("change:source",function(){f["a"].assertInstanceof(e,_["a"]);r.updateLayerDimensions_(e,t)})}}}};M.Controller_.prototype.getLayer=function(e){var t=void 0;if(e.parent.isRoot){this.gmfTreeManager_.rootCtrl=e.parent;t=this.gmfTreeManager_.root.children.length-this.gmfTreeManager_.numberOfGroupsToAddInThisDigestLoop||0}var r=this.gmfSyncLayertreeMap_.createLayer(e,this.map,this.dataLayerGroup_,t);if(r instanceof _["a"]){var a=e.node;this.updateLayerDimensions_(r,a)}return r};M.Controller_.prototype.listeners=function(e,t){var r=this.dataLayerGroup_;e.$on("$destroy",function(){r.getLayers().remove(t.layer)})};M.Controller_.prototype.toggleActive=function(e){e.setState(e.getState()==="on"?"off":"on")};M.Controller_.prototype.getNodeState=function(e){return e.getState()};M.Controller_.prototype.updateWMSTimeLayerState=function(e,t){if(!t){return}var r=e.getDataSource();if(r){f["a"].assertInstanceof(r,h["a"]);r.timeRangeValue=t}else if(e.children){for(var a=0,n=e.children.length;a<n;a++){this.updateWMSTimeLayerState(e.children[a],t)}}};M.Controller_.prototype.getLegendIconURL=function(e){var t=e.node.metadata.iconUrl;if(t!==undefined){return t}if(e.node.children!==undefined){return undefined}var r=e.node;if(r.type!=="WMS"){return undefined}var a=r;var n=a.metadata.legendRule;if(n===undefined){return undefined}var i=a.layers.split(",")[0];var o=this.gmfTreeManager_.getOgcServer(e);return this.layerHelper_.getWMSLegendURL(o.url,i,undefined,n,20,20)};M.Controller_.prototype.getLegendsObject=function(e){var t=this;var r={};if(e.node.children!==undefined){return null}var a=e.node;var n=a.name;if(a.metadata.legendImage){r[n]=a.metadata.legendImage;return r}var i=e.layer;if(a.type==="WMTS"){f["a"].assertInstanceof(i,y["a"]);var o=this.layerHelper_.getWMTSLegendURL(i);r[n]=o;return o?r:null}else{var s=a;var l=s.layers;var u=this.gmfTreeManager_.getOgcServer(e);var c=this.getScale_();if(u.type===h["a"].ServerType.QGISSERVER){l=[l]}else{l=l.split(",")}l.forEach(function(e){r[e]=t.layerHelper_.getWMSLegendURL(u.url,e,c)});return r}};M.Controller_.prototype.getNumberOfLegendsObject=function(e){var t=this.getLegendsObject(e);return t?Object.keys(t).length:0};M.Controller_.prototype.getScale_=function(){var e=this.map.getView();var t=e.getResolution();var r=e.getProjection().getMetersPerUnit();var a=25.4/.28;return t*r*39.37*a};M.Controller_.prototype.displayMetadata=function(e){var t=e.node;var r=t.metadata["metadataUrl"];if(r!==undefined){var a=window.gmfx;if(a.openIframePopup){a.openIframePopup(r,t.name,undefined,undefined,false)}}};M.Controller_.prototype.afterReorder=function(){var e=this;var t=this.gmfTreeManager_.rootCtrl.node.children;var r=this.gmfTreeManager_.rootCtrl.children;var a=[];t.forEach(function(e){r.some(function(t){if(t.node===e){a.push(t);return}})});this.gmfTreeManager_.rootCtrl.children=a;this.layers.length=0;this.gmfTreeManager_.rootCtrl.children.forEach(function(t){e.layers.push(t.layer)});this.gmfPermalink_.refreshFirstLevelGroups()};M.Controller_.prototype.removeNode=function(e){this.gmfTreeManager_.removeGroup(e)};M.Controller_.prototype.removeAllNodes=function(){this.gmfTreeManager_.removeAll()};M.Controller_.prototype.nodesCount=function(){return this.gmfTreeManager_.root.children.length};M.Controller_.prototype.getResolutionStyle=function(e){var t=this.map.getView().getResolution();var r=c["a"].getNodeMinResolution(e);if(r!==undefined&&t<r){return"out-of-resolution"}var a=c["a"].getNodeMaxResolution(e);if(a!==undefined&&t>a){return"out-of-resolution"}return undefined};M.Controller_.prototype.zoomToResolution=function(e){var t=e.node;var r=this.map.getView();var a=r.getResolution();var n=c["a"].getNodeMinResolution(t);if(n!==undefined&&a<n){r.setResolution(r.constrainResolution(n,0,1))}else{var i=c["a"].getNodeMaxResolution(t);if(i!==undefined&&a>i){r.setResolution(r.constrainResolution(i,0,-1))}}};M.Controller_.prototype.toggleNodeLegend=function(t){e(t).toggle({toggle:true})};M.Controller_.prototype.toggleFiltrableDataSource=function(e){this.gmfDataSourceBeingFiltered.dataSource=e};M.Controller_.prototype.isNodeLegendVisible=function(t){return e(t).is(":visible")};M.Controller_.prototype.supportsCustomization=function(e){return!e.isRoot&&(this.supportsLegend(e)||this.supportsOpacityChange(e))};M.Controller_.prototype.supportsLegend=function(e){var t=e.node;return!!t.metadata&&!!t.metadata.legend&&!!this.getLegendsObject(e)};M.Controller_.prototype.supportsOpacityChange=function(e){var t=e.node;var r=e.parent.node;return!!e.layer&&(e.depth===1&&!t.mixed||e.depth>1&&r.mixed)};M.controller("GmfLayertreeController",M.Controller_);t["a"]=M}).call(this,r(33))},,function(e,t,r){"use strict";(function(e){var a=r(1);var n=r(56);var i=r(2);var o=r(3);var s=r(124);var l=r(86);var u=function t(r,a){var n=this;var i=a!==undefined?a:{};i.positioning=l["a"].TOP_LEFT;this.listenerKeys_=[];this.clickOutListenerKey_=null;var o=e("<div/>",{class:"panel panel-default"});this.autoClose_=r.autoClose!==undefined?r.autoClose:true;if(r.title){var u=e("<div>",{class:"panel-heading"}).appendTo(o);e("<span>",{text:r.title}).appendTo(u)}var c=e("<div>",{class:"list-group"}).appendTo(o);this.actions_=[];r.actions.forEach(function(t){n.actions_.push(e("<button>",{class:"list-group-item","data-name":t.name,text:[" ",t.label!==undefined?t.label:t.name].join("")}).appendTo(c).prepend(e("<span>",{class:t.cls!==undefined?t.cls:""})))});i.element=o[0];s["a"].call(this,i)};i["d"](u,s["a"]);u.prototype.setMap=function(e){var t=this;var r=this.getMap();if(r){this.listenerKeys_.forEach(o["e"]);this.listenerKeys_.length=0}s["a"].prototype.setMap.call(this,e);if(e){this.actions_.forEach(function(e){var r=e.data();t.listenerKeys_.push(o["a"](e[0],"click",t.handleActionClick_.bind(t,r.name)))});this.listenerKeys_.push(o["a"](e,"pointermove",this.handleMapPointerMove_,this))}};u.prototype.open=function(e){this.setPosition(e);if(this.autoClose_){this.clickOutListenerKey_=o["a"](document.documentElement,"mousedown",this.handleClickOut_,this)}};u.prototype.close=function(){this.setPosition(undefined);if(this.clickOutListenerKey_!==null){o["e"](this.clickOutListenerKey_)}};u.prototype.handleActionClick_=function(e,t){this.dispatchEvent(new n["a"]("actionclick",{action:e}));if(this.autoClose_){this.close()}t.stopPropagation()};u.prototype.handleClickOut_=function(t){var r=this.getElement();if(r&&e(t.target).closest(r).length===0){this.close()}};u.prototype.handleMapPointerMove_=function(e){var t=e.originalEvent.target;a["a"].assertInstanceof(t,Element);var r=this.getElement();a["a"].assertInstanceof(r,Element);if(r.contains(t)){e.coordinate=[Infinity,Infinity];e.pixel=[Infinity,Infinity]}};t["a"]=u}).call(this,r(33))},,,,,,,,,,,,,,,,,function(e,t,r){"use strict";r.r(t);var a=r(33);var n=r(250);var i=r(355);var o=r(353);var s=r(164);var l=r(59);var u=r(130);var c=r(248);var f=r(350);var h=r(1);function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var d=angular.module("ngeoModal",[]);d.component_={template:'<div class="modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog">\n      <div class="modal-content">\n        <ng-transclude></ng-transclude>\n      </div>\n    </div>\n  </div>',require:{ngModel:"ngModel"},transclude:true,controller:"ngeoModalController",bindings:{resizable:"<ngeoModalResizable",closable:"<ngeoModalClosable"}};d.component("ngeoModal",d.component_);d.Controller_=function(){e.$inject=["$scope","$element"];function e(t,r){p(this,e);this.$element_=r;this.$scope_=t;this.modal_;this.closable;this.resizable;this.ngModel}e.prototype.$onInit=function e(){var t=this;this.closable=this.closable!==false;this.modal_=this.$element_.children();if(!this.closable){this.modal_.attr("data-keyboard",false);this.modal_.attr("data-backdrop","static")}this.resizable=!!this.resizable;var r=this.modal_.find(".modal-dialog");r.draggable();if(this.resizable){r.resizable()}this.ngModel.$render=function(){t.modal_.modal(t.ngModel.$viewValue?"show":"hide")};this.modal_.on("shown.bs.modal hidden.bs.modal",function(e){var r=e.type;h["a"].assert(r=="shown"||r=="hidden");t.ngModel.$setViewValue(r=="shown")})};e.prototype.$onDestroy=function e(){this.modal_.modal("hide");this.modal_.modal("removeBackdrop");var t=this.modal_.find(".modal-dialog");t.draggable("destroy");if(this.resizable){t.resizable("destroy")}};return e}();d.controller("ngeoModalController",d.Controller_);var g=d;function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var v=angular.module("gmfAuthentication",[s["a"].module.name,u["a"].module.name,g.name]);v.gmfAuthenticationTemplateUrl_=function(e,t){var r=t["gmfAuthenticationTemplateurl"];return r!==undefined?r:"gmf/authentication"};v.run(["$templateCache",function(e){e.put("gmf/authentication",r(349))}]);y.$inject=["$element","$attrs","gmfAuthenticationTemplateUrl"];function y(e,t,r){return r(e,t)}v.component_={bindings:{allowPasswordReset:"<?gmfAuthenticationAllowPasswordReset",allowPasswordChange:"<?gmfAuthenticationAllowPasswordChange",passwordValidator:"<?gmfAuthenticationPasswordValidator",forcePasswordChange:"<?gmfAuthenticationForcePasswordChange",infoMessage:"=?gmfAuthenticationInfoMessage"},controller:"GmfAuthenticationController",templateUrl:y};v.value("gmfAuthenticationTemplateUrl",v.gmfAuthenticationTemplateUrl_);v.component("gmfAuthentication",v.component_);v.AuthenticationController_=function(){e.$inject=["$element","gettextCatalog","gmfAuthenticationService","gmfUser","ngeoNotification"];function e(t,r,a,n,i){m(this,e);this.$element_=t;this.gmfUser=n;this.gettextCatalog=r;this.gmfAuthenticationService_=a;this.notification_=i;this.allowPasswordReset;this.allowPasswordChange;this.passwordValidator=null;this.forcePasswordChange;this.infoMessage=null;this.changingPassword=false;this.changePasswordModalShown=false;this.resetPasswordModalShown=false;this.error=false;this.loginVal="";this.pwdVal="";this.oldPwdVal="";this.newPwdVal="";this.newPwdConfVal=""}e.prototype.$onInit=function e(){this.allowPasswordReset=this.allowPasswordReset!==false;this.allowPasswordChange=this.allowPasswordChange!==false;this.forcePasswordChange=this.forcePasswordChange===true;if(this.forcePasswordChange){this.changingPassword=true}};e.prototype.changePassword=function e(){var t=this;var r=this.gettextCatalog;var a=this.oldPwdVal;var n=this.newPwdVal;var i=this.newPwdConfVal;var o=[];if(a===""){o.push(r.getString("The old password is required."))}if(n===""){o.push(r.getString("The new password is required."))}if(i===""){o.push(r.getString("The password confirmation is required."))}if(o.length){this.setError_(o)}else{if(a===n){o.push(r.getString("The old and new passwords are the same."))}if(n!==i){o.push(r.getString("The passwords don't match."))}if(this.passwordValidator){if(!this.passwordValidator.isPasswordValid(a)){o.push(r.getString(this.passwordValidator.notValidMessage))}}if(o.length){this.setError_(o)}else{var s=r.getString("Incorrect old password.");this.gmfAuthenticationService_.changePassword(a,n,i).then(function(){t.changePasswordModalShown=true;t.changePasswordReset()},this.setError_.bind(this,s))}}};e.prototype.login=function e(){var t=this.gettextCatalog;var r=[];if(this.loginVal===""){r.push(t.getString("The username is required."))}if(this.pwdVal===""){r.push(t.getString("The password is required."))}if(r.length){this.setError_(r)}else{var a=t.getString("Incorrect credentials or disabled account.");this.gmfAuthenticationService_.login(this.loginVal,this.pwdVal).then(this.resetError_.bind(this),this.setError_.bind(this,a))}};e.prototype.logout=function e(){var t=this.gettextCatalog;var r=t.getString("Could not log out.");this.gmfAuthenticationService_.logout().then(this.resetError_.bind(this),this.setError_.bind(this,r))};e.prototype.resetPassword=function e(){var t=this.gettextCatalog;if(!this.loginVal){this.setError_(t.getString("Please, input a login..."));return}var r=t.getString("An error occurred while resetting the password.");var a=function(e){this.resetPasswordModalShown=true;this.resetError_()}.bind(this);this.gmfAuthenticationService_.resetPassword(this.loginVal).then(a,this.setError_.bind(this,r))};e.prototype.changePasswordReset=function e(){this.resetError_();this.changingPassword=false;this.oldPwdVal="";this.newPwdVal="";this.newPwdConfVal=""};e.prototype.userMustChangeItsPassword=function e(){return this.gmfUser.is_password_changed===false&&this.forcePasswordChange};e.prototype.setError_=function e(t){if(this.error){this.resetError_()}this.error=true;var r=this.$element_.find(".gmf-authentication-error");if(!Array.isArray(t)){t=[t]}t.forEach(function(e){this.notification_.notify({msg:e,target:r,type:l["a"].Type.ERROR})},this)};e.prototype.resetError_=function e(){this.notification_.clear();this.error=false};return e}();v.controller("GmfAuthenticationController",v.AuthenticationController_);var _=v;var S=angular.module("gmfAuthenticationModule",[_.name,s["a"].module.name]);var b=S;var w=r(39);var C=r(56);var T=r(2);var E=r(179);var M=r(92);var L=r(84);var A=r(149);var F=r(222);var P=r(169);var R=r(100);var k=function e(t){E["a"].call(this);this.mapUids_={};this.ngeoLayerHelper_=t};k.$inject=["ngeoLayerHelper"];k.$inject=["ngeoLayerHelper"];T["d"](k,E["a"]);k.prototype.get=function(e){var t=T["c"](e).toString();return t in this.mapUids_?this.ngeoLayerHelper_.getGroupFromMap(e,k.BACKGROUNDLAYERGROUP_NAME).getLayers().item(0):null};k.prototype.set=function(e,t){var r=-200;var a=T["c"](e).toString();var n=this.get(e);if(t!==null){t.setZIndex(r);this.ngeoLayerHelper_.setZIndexToFirstLevelChildren(t,r)}var i=this.ngeoLayerHelper_.getGroupFromMap(e,k.BACKGROUNDLAYERGROUP_NAME);if(n!==null){h["a"].assert(a in this.mapUids_);if(t!==null){i.getLayers().setAt(0,t)}else{i.getLayers().removeAt(0);delete this.mapUids_[a]}}else if(t!==null){i.getLayers().insertAt(0,t);this.mapUids_[a]=true}var o=new C["a"]("change",{current:t,previous:n});this.dispatchEvent(o);return n};k.prototype.getOpacityBgLayer=function(e){var t=T["c"](e).toString();return t in this.mapUids_?this.ngeoLayerHelper_.getGroupFromMap(e,k.BACKGROUNDLAYERGROUP_NAME).getLayers().item(1):null};k.prototype.setOpacityBgLayer=function(e,t){var r=-100;t.setOpacity(0);t.setVisible(true);t.setZIndex(r);this.ngeoLayerHelper_.setZIndexToFirstLevelChildren(t,r);var a=this.ngeoLayerHelper_.getGroupFromMap(e,k.BACKGROUNDLAYERGROUP_NAME);var n=a.getLayers().getArray().indexOf(t);if(n===-1){a.getLayers().push(t)}};k.prototype.updateDimensions=function(e,t){var r=this.get(e);if(r){var a=[r];if(r instanceof M["a"]){a=r.getLayers().getArray()}a.forEach(function(e){h["a"].assertInstanceof(e,L["a"]);if(e){var r=false;var a={};for(var n in e.get("dimensions")){var i=t[n];if(i!==undefined){a[n]=i;r=true}}if(r){var o=e.getSource();if(o instanceof P["a"]){o.updateDimensions(a);o.refresh()}else if(o instanceof F["a"]||o instanceof A["a"]){o.updateParams(a);o.refresh()}}}})}};k.module=angular.module("ngeoBackgroundLayerMgr",[R["a"].module.name]);k.module.service("ngeoBackgroundLayerMgr",k);k.BACKGROUNDLAYERGROUP_NAME="background";var x=k;var D=r(3);var O=angular.module("gmfBackgroundlayerselector",[w["a"].module.name,x.module.name]);O.value("gmfBackgroundlayerselectorTemplateUrl",function(e,t){var r=t["gmfBackgroundlayerselectorTemplateurl"];return r!==undefined?r:"gmf/backgroundlayerselector"});O.run(["$templateCache",function(e){e.put("gmf/backgroundlayerselector",r(348))}]);$.$inject=["$element","$attrs","gmfBackgroundlayerselectorTemplateUrl"];function $(e,t,r){return r(e,t)}O.component_={controller:"GmfBackgroundlayerselectorController as ctrl",bindings:{map:"=gmfBackgroundlayerselectorMap",opacityOptions:"=gmfBackgroundlayerOpacityOptions",select:"&?gmfBackgroundlayerselectorSelect"},templateUrl:$};O.component("gmfBackgroundlayerselector",O.component_);O.Controller_=function(e,t,r){var a=this;this.map;this.opacityOptions;this.select;this.bgLayer;this.bgLayers;this.opacityLayer;this.gmfThemes_=r;this.listenerKeys_=[];this.listenerKeys_.push(D["a"](r,"change",this.handleThemesChange_,this));this.backgroundLayerMgr_=t;this.listenerKeys_.push(D["a"](this.backgroundLayerMgr_,"change",function(e){a.bgLayer=e.detail.current}));e.$on("$destroy",this.handleDestroy_.bind(this))};O.Controller_.$inject=["$scope","ngeoBackgroundLayerMgr","gmfThemes"];O.Controller_.prototype.$onInit=function(){this.handleThemesChange_()};O.Controller_.prototype.handleThemesChange_=function(){var e=this;this.gmfThemes_.getBgLayers().then(function(t){e.bgLayers=t;if(e.opacityOptions!==undefined){var r=t.find(function(t){return t.get("label")===e.opacityOptions});if(r!==undefined){e.setOpacityBgLayer(r);e.opacityLayer=r;e.bgLayers=e.bgLayers.slice();var a=e.bgLayers.findIndex(function(t){return t===e.opacityLayer});e.bgLayers.splice(a,1);e.bgLayers.push(r)}}})};O.Controller_.prototype.getSetBgLayerOpacity=function(e){if(e){this.opacityLayer.setOpacity(e)}return this.opacityLayer.getOpacity()};O.Controller_.prototype.setLayer=function(e,t){this.bgLayer=e;this.backgroundLayerMgr_.set(this.map,e);if(!t&&this.select){this.select()}};O.Controller_.prototype.setOpacityBgLayer=function(e){this.backgroundLayerMgr_.setOpacityBgLayer(this.map,e)};O.Controller_.prototype.handleDestroy_=function(){this.listenerKeys_.forEach(D["e"]);this.listenerKeys_.length=0};O.controller("GmfBackgroundlayerselectorController",O.Controller_);var I=O;var N=r(163);var G=r(198);function U(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var j=function(){e.$inject=["$http","gmfLayersUrl"];function e(t,r){U(this,e);this.http_=t;this.baseUrl_=r;this.promises_={}}e.prototype.getAttributeValues=function e(t,r){var a=t.id+"_"+r;var n=t.name;if(!this.promises_[a]){var i=this.baseUrl_+"/"+n+"/values/"+r;this.promises_[a]=this.http_.get(i).then(this.handleGetAttributeValues_.bind(this))}return this.promises_[a]};e.prototype.handleGetAttributeValues_=function e(t){var r=t.data;return r.items};return e}();j.module=angular.module("gmfEnumerateAttribute",[]);j.module.service("gmfEnumerateAttribute",j);var V=j;var B=r(122);var W=r(114);var H=r(24);var q={};q.setGeometryType=function(e,t){var r=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/;if(r.exec(t)){e.type=H["a"].GEOMETRY;if(/^gml:Point/.exec(t)){e.geomType="Point"}else if(/^gml:LineString|^gml:Curve/.exec(t)){e.geomType="LineString"}else if(/^gml:Polygon|^gml:Surface/.exec(t)){e.geomType="Polygon"}else if(/^gml:MultiPoint/.exec(t)){e.geomType="MultiPoint"}else if(/^gml:MultiLineString|^gml:MultiCurve/.exec(t)){e.geomType="MultiLineString"}else if(/^gml:MultiPolygon|^gml:MultiSurface/.exec(t)){e.geomType="MultiPolygon"}}return!!e.type&&!!e.geomType};var K=q;var Y=r(112);var z=function e(){Y["a"].call(this)};T["d"](z,Y["a"]);z.prototype.read=function(e){return Y["a"].prototype.read.call(this,e)};z.prototype.readFromDocument=function(e){h["a"].assert(e.nodeType==Node.DOCUMENT_NODE,"doc.nodeType should be DOCUMENT");for(var t=e.firstChild;t;t=t.nextSibling){if(t.nodeType==Node.ELEMENT_NODE){return this.readFromNode(t)}}return null};z.prototype.readFromNode=function(e){h["a"].assert(e.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");h["a"].assert(e.localName=="schema","localName should be schema");var t=e.getElementsByTagName("element");if(!t.length){t=e.getElementsByTagName("xsd:element")}var r=[];var a=void 0;for(var n=0,i=t.length;n<i;n++){a=this.readFromElementNode_(t[n]);if(a){r.push(a)}}return r};z.prototype.readFromElementNode_=function(e){var t=e.getAttribute("name");h["a"].assertString(t,"name should be defined in element node.");var r=e.getAttribute("alias");var a=e.getAttribute("nillable");var n=!(a===true||a==="true");var i={name:t,alias:r,required:n};var o=e.getAttribute("type");if(o){if(!K.setGeometryType(i,o)){this.setAttributeByXsdType_(i,o)}}else{var s=e.getElementsByTagName("enumeration");if(!s.length){s=e.getElementsByTagName("xsd:enumeration")}if(s.length){i.type=H["a"].SELECT;var l=[];for(var u=0,c=s.length;u<c;u++){l.push(s[u].getAttribute("value"))}i.choices=l}else{var f=e.getElementsByTagName("restriction");if(!f.length){f=e.getElementsByTagName("xsd:restriction")}if(f.length&&f[0]){var p=f[0];this.setAttributeByXsdType_(i,p.getAttribute("base"));var d=e.getElementsByTagName("maxLength");if(!d.length){d=e.getElementsByTagName("xsd:maxLength")}if(d.length&&d[0]){i.maxLength=Number(d[0].getAttribute("value"))}}}}if(!i.type){return null}h["a"].assert(i.type);return i};z.prototype.setAttributeByXsdType_=function(e,t){if(t==="xsd:boolean"){e.type=H["a"].BOOLEAN}else if(t==="xsd:date"){e.type=H["a"].DATE}else if(t==="xsd:dateTime"){e.type=H["a"].DATETIME}else if(t==="xsd:time"){e.type=H["a"].TIME}else if(t==="xsd:decimal"||t==="xsd:double"){e.type=H["a"].NUMBER;e.numType=z.NumberType.FLOAT}else if(t==="xsd:integer"){e.type=H["a"].NUMBER;e.numType=z.NumberType.INTEGER}else if(t==="xsd:string"){e.type=H["a"].TEXT}};z.getGeometryAttribute=function(e){var t=null;for(var r=0,a=e.length;r<a;r++){if(e[r].type===H["a"].GEOMETRY){t=e[r];break}}return t};z.NumberType={FLOAT:"float",INTEGER:"integer"};var Q=z;function X(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Z=function(){function e(){X(this,e)}e.prototype.read=function e(t){return t.map(this.readFromComplexTypeElement_)};e.prototype.readFromComplexTypeElement_=function e(t){var r=h["a"].assertString(t["name"]);var a="alias"in t?h["a"].assertString(t["alias"]):null;var n=t["minOccurs"]!="0";var i={name:r,alias:a,required:n};var o=h["a"].assertString(t["type"]);if(!K.setGeometryType(i,o)){if(o==="gml:TimeInstantType"||o==="dateTime"){i.type=H["a"].DATETIME}else if(o==="date"){i.type=H["a"].DATE}else if(o==="time"){i.type=H["a"].TIME}else if(o==="decimal"||o==="double"){i.type=H["a"].NUMBER;i.numType=Q.NumberType.FLOAT}else if(o==="integer"||o==="long"){i.type=H["a"].NUMBER;i.numType=Q.NumberType.INTEGER}else if(o==="boolean"){i.type=H["a"].BOOLEAN}else{i.type=H["a"].TEXT}}return i};return e}();var J=Z;var ee=r(40);var te=r(108);var re=r(20);var ae=r(113);var ne=angular.module("ngeoAngularFilters",[]);ne.Scalify=function(e){var t=e("number");var r=function e(r){var a=t(r,0);return a?"1 : "+a:""};r["$stateful"]=true;return r};ne.Scalify.$inject=["$filter"];ne.filter("ngeoScalify",ne.Scalify);ne.Number=function(e){var t=e.NUMBER_FORMATS;var r=function e(r,a){var n=t.GROUP_SEP;var i=t.DECIMAL_SEP;if(a===undefined){a=3}if(r===Infinity){return"∞"}else if(r===-Infinity){return"-∞"}else if(r===0){return"0"}var o=r<0;r=Math.abs(r);var s=a-Math.floor(Math.log(r)/Math.log(10))-1;var l=Math.pow(10,s);r=Math.round(r*l);var u="";var c=Math.floor(r/l);if(s>0){var f=""+r;while(f.length<s){f="0"+f}u=f.substring(f.length-s);while(u[u.length-1]==="0"){u=u.substring(0,u.length-1)}}var h=[];var p=""+c;while(p.length>3){var d=p.length-3;h.unshift(p.substring(d));p=p.substring(0,d)}h.unshift(p);return(o?"-":"")+h.join(n)+(u.length===0?"":i+u)};return r};ne.Number.$inject=["$locale"];ne.filter("ngeoNumber",ne.Number);ne.UnitPrefix=function(e){var t=e("ngeoNumber");var r=["","k","M","G","T","P"];var a=["","Ki","Mi","Gi","Ti","Pi"];var n=function e(n,i,o,s){if(i===undefined){i=""}var l=1e3;var u=r;if(o==="square"){l=1e6}else if(o==="binary"){l=1024;u=a}var c=0;var f=u.length-1;while(n>=l&&c<f){n=n/l;c++}var h=u[c]+i;var p=h.length==0?"":" ";return t(n,s)+p+h};return n};ne.UnitPrefix.$inject=["$filter"];ne.filter("ngeoUnitPrefix",ne.UnitPrefix);ne.NumberCoordinates=function(e){var t=function t(r,a,n){var i=n?n:"{x} {y}";var o=r[0];var s=r[1];var l=parseInt(a,10)|0;o=e("number")(o,l);s=e("number")(s,l);return i.replace("{x}",o).replace("{y}",s)};return t};ne.NumberCoordinates.$inject=["$filter"];ne.filter("ngeoNumberCoordinates",ne.NumberCoordinates);ne.DMSCoordinates=function(){var e=function e(t,r,a){var n=re["d"](t+180,360)-180;var i=Math.abs(3600*n);var o=Math.floor(i/3600);var s=Math.floor(i/60%60);var l=i%60;return o+"° "+ae["b"](s,2)+"′ "+ae["b"](l,2,a)+"″ "+r.charAt(n<0?1:0)};var t=function t(r,a,n){var i=parseInt(a,10)|0;var o=n?n:"{x} {y}";var s=e(r[0],"EW",i);var l=e(r[1],"NS",i);return o.replace("{x}",s).replace("{y}",l)};return t};ne.filter("ngeoDMSCoordinates",ne.DMSCoordinates);ne.trustHtmlFilter=function(e){return function(t){if(t!==undefined&&t!==null){return e.trustAsHtml(""+t)}else{return e.trustAsHtml("&nbsp;")}}};ne.trustHtmlFilter.$inject=["$sce"];ne.filter("ngeoTrustHtml",ne.trustHtmlFilter);ne.Duration=function(e){var t=Object.freeze({SECONDS:Symbol("seconds"),MINUTES:Symbol("minutes"),HOURS:Symbol("hours"),DAYS:Symbol("days")});var r=function r(a,n){var i="";switch(n){case t.SECONDS:i=e.getPlural(a,"second","seconds");break;case t.MINUTES:i=e.getPlural(a,"minute","minutes");break;case t.HOURS:i=e.getPlural(a,"hour","hours");break;case t.DAYS:i=e.getPlural(a,"day","days");break;default:break}return a+" "+i};var a=function e(a){a=Math.round(a);var n=void 0;if(a<60){return r(a,t.SECONDS)}var i=a%60;a=Math.floor(a/60);if(a<60){n=r(a,t.MINUTES);if(i>0){n+=" "+r(i,t.SECONDS)}return n}i=a%60;a=Math.floor(a/60);if(a<24){n=r(a,t.HOURS);if(i>0){n+=" "+r(i,t.MINUTES)}return n}i=a%24;a=Math.floor(a/24);n=r(a,t.DAYS);if(i>0){n+=" "+r(i,t.HOURS)}return n};return a};ne.Duration.$inject=["gettextCatalog"];ne.filter("ngeoDuration",ne.Duration);var ie=ne;var oe=r(78);var se=r(271);var le=angular.module("ngeoDownload",[]);le.factory_=function(){function e(e,t,r){var a=r!==undefined&&!oe["a"].isSafari()?r:"text/plain;charset=utf-8";var n=new Blob([e],{type:a});Object(se["saveAs"])(n,t)}return e};le.factory("ngeoDownload",le.factory_);var ue=le;var ce=r(26);var fe={CIRCLE:"Circle",LINE_STRING:"LineString",MULTI_LINE_STRING:"MultiLineString",MULTI_POINT:"MultiPoint",MULTI_POLYGON:"MultiPolygon",POINT:"Point",POLYGON:"Polygon",RECTANGLE:"Rectangle",TEXT:"Text"};var he=fe;var pe=r(51);var de=r(10);var ge=r(124);var me=r(194);var ve=r(35);var ye=r(91);var _e=r(82);var Se=r(55);var be=r(46);var we=r(16);var Ce=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};ve["a"].call(this,{handleEvent:e.handleEvent_});this.helpTooltipElement_=null;this.helpTooltipOverlay_=null;this.measureTooltipElement_=null;this.measureTooltipOverlay_=null;this.measureTooltipOverlayCoord_=null;this.sketchFeature=null;this.continueMsg=null;this.decimals=t.decimals;this.precision=t.precision;this.displayHelpTooltip_=t.displayHelpTooltip!==undefined?t.displayHelpTooltip:true;this.startMsg;if(t.startMsg!==undefined){this.startMsg=t.startMsg}else{this.startMsg=document.createElement("span");this.startMsg.textContent="Click to start drawing."}this.changeEventKey_=null;this.postcomposeEventKey_=null;var r=t.style!==undefined?t.style:[new we["c"]({fill:new Se["a"]({color:"rgba(255, 255, 255, 0.2)"})}),new we["c"]({stroke:new be["a"]({color:"white",width:5})}),new we["c"]({stroke:new be["a"]({color:"#ffcc33",width:3})})];this.vectorLayer_=new ye["a"]({source:new _e["b"],style:r});this.drawInteraction_=this.createDrawInteraction(t.sketchStyle,this.vectorLayer_.getSource());this.shouldHandleDrawInteractionActiveChange_=true;D["a"](this.drawInteraction_,"change:active",this.handleDrawInteractionActiveChange_,this);D["a"](this.drawInteraction_,"drawstart",this.onDrawStart_,this);D["a"](this.drawInteraction_,"drawend",this.onDrawEnd_,this);D["a"](this,"change:active",this.updateState_,this)};T["d"](Ce,ve["a"]);Ce.getFormattedArea=function(e,t,r,a){var n=e.clone().transform(t,"EPSG:4326");var i=Math.abs(me["a"](n,{projection:"EPSG:4326"}));return a(i,"m²","square",r)};Ce.getFormattedCircleArea=function(e,t,r){var a=Math.PI*Math.pow(e.getRadius(),2);return r(a,"m²","square",t)};Ce.getFormattedLength=function(e,t,r,a){var n=0;var i=e.getCoordinates();for(var o=0,s=i.length-1;o<s;++o){var l=de["k"](i[o],t,"EPSG:4326");var u=de["k"](i[o+1],t,"EPSG:4326");n+=me["b"](l,u)}return a(n,"m","unit",r)};Ce.getFormattedPoint=function(e,t,r,a){return r(e.getCoordinates(),t,a)};Ce.handleEvent_=function(e){if(e.type!="pointermove"||e.dragging){return true}var t=this.sketchFeature===null?this.startMsg:this.continueMsg;if(this.displayHelpTooltip_){pe["d"](this.helpTooltipElement_);this.helpTooltipElement_.appendChild(t);this.helpTooltipOverlay_.setPosition(e.coordinate)}return true};Ce.prototype.getDrawInteraction=function(){return this.drawInteraction_};Ce.prototype.createDrawInteraction=function(e,t){};Ce.prototype.setMap=function(e){ve["a"].prototype.setMap.call(this,e);this.vectorLayer_.setMap(e);var t=this.drawInteraction_.getMap();if(t!==null){t.removeInteraction(this.drawInteraction_)}if(e!==null){e.addInteraction(this.drawInteraction_)}};Ce.prototype.onDrawStart_=function(e){var t=this;this.sketchFeature=e.feature||e.detail.feature;this.vectorLayer_.getSource().clear(true);this.createMeasureTooltip_();var r=this.sketchFeature.getGeometry();h["a"].assert(r!==undefined);this.changeEventKey_=D["a"](r,"change",function(){t.handleMeasure(function(e,r){if(r!==null){t.measureTooltipElement_.innerHTML=e;t.measureTooltipOverlayCoord_=r}})});this.postcomposeEventKey_=D["a"](this.getMap(),"postcompose",function(){t.measureTooltipOverlay_.setPosition(t.measureTooltipOverlayCoord_)})};Ce.prototype.onDrawEnd_=function(e){this.measureTooltipElement_.classList.add("ngeo-tooltip-static");this.measureTooltipOverlay_.setOffset([0,-7]);var t=new C["a"]("measureend",{feature:this.sketchFeature});this.dispatchEvent(t);this.sketchFeature=null;this.unlistenerEvent_()};Ce.prototype.unlistenerEvent_=function(){if(this.changeEventKey_!==null&&this.postcomposeEventKey_!==null){D["e"](this.changeEventKey_);D["e"](this.postcomposeEventKey_);this.changeEventKey_=null;this.postcomposeEventKey_=null}};Ce.prototype.createHelpTooltip_=function(){this.removeHelpTooltip_();if(this.displayHelpTooltip_){this.helpTooltipElement_=document.createElement("div");this.helpTooltipElement_.classList.add("tooltip");this.helpTooltipOverlay_=new ge["a"]({element:this.helpTooltipElement_,offset:[15,0],positioning:"center-left"});this.getMap().addOverlay(this.helpTooltipOverlay_)}};Ce.prototype.removeHelpTooltip_=function(){if(this.displayHelpTooltip_){this.getMap().removeOverlay(this.helpTooltipOverlay_);if(this.helpTooltipElement_!==null){this.helpTooltipElement_.parentNode.removeChild(this.helpTooltipElement_)}this.helpTooltipElement_=null;this.helpTooltipOverlay_=null}};Ce.prototype.createMeasureTooltip_=function(){this.removeMeasureTooltip_();this.measureTooltipElement_=document.createElement("div");this.measureTooltipElement_.classList.add("tooltip");this.measureTooltipElement_.classList.add("ngeo-tooltip-measure");this.measureTooltipOverlay_=new ge["a"]({element:this.measureTooltipElement_,offset:[0,-15],positioning:"bottom-center",stopEvent:false});this.getMap().addOverlay(this.measureTooltipOverlay_)};Ce.prototype.removeMeasureTooltip_=function(){if(this.measureTooltipElement_!==null){this.measureTooltipElement_.parentNode.removeChild(this.measureTooltipElement_);this.measureTooltipElement_=null;this.measureTooltipOverlay_=null;this.measureTooltipOverlayCoord_=null}};Ce.prototype.updateState_=function(){var e=this.getActive();this.shouldHandleDrawInteractionActiveChange_=false;this.drawInteraction_.setActive(e);this.shouldHandleDrawInteractionActiveChange_=true;if(!this.getMap()){return}if(e){if(!this.measureTooltipOverlay_){this.createMeasureTooltip_();this.createHelpTooltip_()}}else{this.vectorLayer_.getSource().clear(true);this.getMap().removeOverlay(this.measureTooltipOverlay_);this.removeMeasureTooltip_();this.removeHelpTooltip_();this.unlistenerEvent_()}};Ce.prototype.handleMeasure=function(e){};Ce.prototype.getTooltipElement=function(){return this.measureTooltipElement_};Ce.prototype.handleDrawInteractionActiveChange_=function(){if(this.shouldHandleDrawInteractionActiveChange_){this.setActive(this.drawInteraction_.getActive())}};var Te=Ce;var Ee={};Ee.getDefaultDrawStyleFunction=function(){var e=Object(we["b"])();return function(t,r){return e[t.getGeometry().getType()]}};Ee.getDefaultModifyStyleFunction=function(){var e=Object(we["b"])();return function(t,r){return e["Point"]}};var Me=Ee;var Le=r(30);var Ae=r(32);var Fe=r(190);var Pe=r(151);var Re=r(53);var ke=r(38);var xe=r(22);var De=function e(t){xe["b"].call(this,{handleDownEvent:e.handleDownEvent_,handleEvent:e.handleEvent_,handleUpEvent:e.handleUpEvent_});this.downPx_=null;this.source_=t.source!==undefined?t.source:null;this.started_=false;this.sketchFeature_=null;this.sketchPoint_=null;this.squaredClickTolerance_=4;this.sketchLayer_=new ye["a"]({source:new _e["b"]({useSpatialIndex:false,wrapX:false}),style:t.style||Me.getDefaultDrawStyleFunction()});D["a"](this,"change:active",this.updateState_,this)};T["d"](De,xe["b"]);De.handleDownEvent_=function(e){this.downPx_=e.pixel;return true};De.handleUpEvent_=function(e){var t=this.downPx_;var r=e.pixel;var a=t[0]-r[0];var n=t[1]-r[1];var i=a*a+n*n;var o=true;if(i<=this.squaredClickTolerance_){this.handlePointerMove_(e);if(!this.started_){this.startDrawing_(e)}else{this.finishDrawing_()}o=false}return o};De.handleEvent_=function(e){var t=true;if(e.type==="pointermove"){t=this.handlePointerMove_(e)}else if(e.type==="dblclick"){t=false}return xe["c"].call(this,e)&&t};De.prototype.handlePointerMove_=function(e){if(this.started_){this.modifyDrawing_(e)}else{this.createOrUpdateSketchPoint_(e)}return true};De.prototype.createOrUpdateSketchPoint_=function(e){var t=e.coordinate.slice();if(this.sketchPoint_===null){this.sketchPoint_=new Le["a"](new ke["a"](t));this.updateSketchFeatures_()}else{var r=this.sketchPoint_.getGeometry();h["a"].assertInstanceof(r,ke["a"]);r.setCoordinates(t)}};De.prototype.updateSketchFeatures_=function(){var e=[];if(this.sketchFeature_!==null){e.push(this.sketchFeature_)}if(this.sketchPoint_!==null){e.push(this.sketchPoint_)}var t=this.sketchLayer_.getSource();t.clear(true);t.addFeatures(e)};De.prototype.startDrawing_=function(e){var t=e.coordinate;this.started_=true;var r=new Re["a"]([t.slice(),t.slice()]);var a=new Fe["a"](t,0);var n=new Pe["a"]([r,a]);h["a"].assert(n!==undefined);this.sketchFeature_=new Le["a"];this.sketchFeature_.setGeometry(n);this.updateSketchFeatures_();var i=new C["a"]("drawstart",{feature:this.sketchFeature_});this.dispatchEvent(i)};De.prototype.modifyDrawing_=function(e){var t=e.coordinate;var r=h["a"].assertInstanceof(this.sketchFeature_.getGeometry(),Pe["a"]);var a=r.getGeometriesArray();var n=a[0];h["a"].assertInstanceof(n,Re["a"]);var i=n.getCoordinates();var o=this.sketchPoint_.getGeometry();h["a"].assertInstanceof(o,ke["a"]);o.setCoordinates(t);var s=i[i.length-1];s[0]=t[0];s[1]=t[1];h["a"].assertInstanceof(n,Re["a"]);n.setCoordinates(i);var l=h["a"].assertInstanceof(a[1],Fe["a"]);l.setRadius(n.getLength());this.updateSketchFeatures_()};De.prototype.abortDrawing_=function(){this.started_=false;var e=this.sketchFeature_;if(e!==null){this.sketchFeature_=null;this.sketchPoint_=null;this.sketchLayer_.getSource().clear(true)}return e};De.prototype.shouldStopEvent=Ae["a"];De.prototype.updateState_=function(){var e=this.getMap();var t=this.getActive();if(e===null||!t){this.abortDrawing_()}this.sketchLayer_.setMap(t?e:null)};De.prototype.finishDrawing_=function(){var e=this.abortDrawing_();h["a"].assert(e!==null);if(this.source_!==null){this.source_.addFeature(e)}var t=new C["a"]("drawend",{feature:this.sketchFeature_});this.dispatchEvent(t)};De.prototype.setMap=function(e){xe["b"].prototype.setMap.call(this,e);this.updateState_()};var Oe=De;var $e=r(155);var Ie=function e(t,r){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};Te.call(this,a);this.continueMsg;if(a.continueMsg!==undefined){this.continueMsg=a.continueMsg}else{this.continueMsg=document.createElement("span");this.continueMsg.textContent="Click to finish."}this.numberFormat=h["a"].assert(r);this.unitPrefixFormat=h["a"].assert(t)};T["d"](Ie,Te);Ie.prototype.createDrawInteraction=function(e,t){return new Oe({source:t,style:e})};Ie.prototype.handleMeasure=function(e){var t=h["a"].assertInstanceof(this.sketchFeature.getGeometry(),Pe["a"]);var r=h["a"].assertInstanceof(t.getGeometries()[0],Re["a"]);var a=Ie.getFormattedAzimutRadius(r,h["a"].assertInstanceof(this.getMap().getView().getProjection(),$e["a"]),this.decimals,this.precision,this.unitPrefixFormat,this.numberFormat);e(a,r.getLastCoordinate())};Ie.getFormattedAzimutRadius=function(e,t,r,a,n,i){var o=Ie.getFormattedAzimut(e,r,i);o+=", "+Te.getFormattedLength(e,t,a,n);return o};Ie.getFormattedAzimut=function(e,t,r){var a=Ie.getAzimut(e);return r(a,t)+"°"};Ie.getAzimut=function(e){var t=e.getCoordinates();var r=t[1][0]-t[0][0];var a=t[1][1]-t[0][1];var n=Math.acos(a/Math.sqrt(r*r+a*a));var i=r>0?1:-1;return i*n*180/Math.PI%360};var Ne=Ie;var Ge=r(8);var Ue=r(107);var je=r(5);var Ve=r(105);var Be=r(109);var We=r(45);var He=r(116);var qe=r(277);var Ke=r(273);var Ye=r(106);var ze=r(136);var Qe=r(171);var Xe=function e(t,r){this.$filter_=r;this.decimals_=undefined;if(t.has("ngeoMeasureDecimals")){this.decimals_=t.get("ngeoMeasureDecimals")}this.precision_=undefined;if(t.has("ngeoMeasurePrecision")){this.precision_=t.get("ngeoMeasurePrecision")}this.numberFormat_=r("number");this.unitPrefixFormat_=r("ngeoUnitPrefix");this.ngeoNumberCoordinates_=r("ngeoNumberCoordinates");this.pointFilterFn_=null;this.pointFilterArgs_=[];if(t.has("ngeoPointfilter")){var a=t.get("ngeoPointfilter").split(":");var n=a.shift();var i=this.$filter_(n);h["a"].assertFunction(i);this.pointFilterFn_=i;this.pointFilterArgs_=a}else{this.pointFilterFn_=null}this.projection_;this.download_=t.get("ngeoDownload")};Xe.$inject=["$injector","$filter"];Xe.$inject=["$injector","$filter"];Xe.prototype.setProjection=function(e){this.projection_=e};Xe.prototype.setStyle=function(e,t){var r=this.getStyle(e);if(t){if(this.supportsVertex_(e)){r.push(this.getVertexStyle())}r.unshift(this.getHaloStyle_(e))}e.setStyle(r)};Xe.prototype.getStyle=function(e){var t=this.getType(e);var r=void 0;switch(t){case he.LINE_STRING:r=this.getLineStringStyle_(e);break;case he.POINT:r=this.getPointStyle_(e);break;case he.CIRCLE:case he.POLYGON:case he.RECTANGLE:r=this.getPolygonStyle_(e);break;case he.TEXT:r=this.getTextStyle_(e);break;default:break}h["a"].assert(r,"Style should be thruthy");var a=void 0;if(r.constructor===Array){a=r}else{a=[r]}return a};Xe.prototype.getLineStringStyle_=function(e){var t=this.getStrokeProperty(e);var r=this.getShowLabelProperty(e);var a=this.getShowMeasureProperty(e);var n=this.getRGBAColorProperty(e);var i=[new we["c"]({stroke:new be["a"]({color:n,width:t})})];var o=[];if(a){o.push(this.getMeasure(e))}if(r){o.push(this.getNameProperty(e))}if(r||a){var s=o.join("\n");i.push(new we["c"]({text:this.createTextStyle_({text:s})}))}return i};Xe.prototype.getPointStyle_=function(e){var t=this.getSizeProperty(e);var r=this.getRGBAColorProperty(e);var a=this.getShowLabelProperty(e);var n=this.getShowMeasureProperty(e);var i=[new we["c"]({image:new Ye["a"]({radius:t,fill:new Se["a"]({color:r})})})];var o=[];if(n){o.push(this.getMeasure(e))}if(a){o.push(this.getNameProperty(e))}if(a||n){var s=o.join("\n");var l=10;var u=1.3;i.push(new we["c"]({text:this.createTextStyle_({text:s,size:l,offsetY:-(t+l/2*o.length*u+4)})}))}return i};Xe.prototype.optNumber=function(e,t){var r=e.get(t);if(r!==undefined){if(typeof r=="string"){return+r}else{return h["a"].assertNumber(r)}}else{return undefined}};Xe.prototype.getNumber=function(e,t){var r=e.get(t);if(typeof r=="string"){return+r}else{return h["a"].assertNumber(r)}};Xe.prototype.getPolygonStyle_=function(e){var t=this.getStrokeProperty(e);var r=this.getOpacityProperty(e);var a=this.getRGBAColorProperty(e);var n=this.getShowLabelProperty(e);var i=this.getShowMeasureProperty(e);var o=a.slice();o[3]=r;var s=this.optNumber(e,ce["a"].AZIMUT);var l=[new we["c"]({fill:new Se["a"]({color:o}),stroke:new be["a"]({color:a,width:t})})];if(i||n){if(i&&s!==undefined){var u=this.getRadiusLine(e,s);var c=Te.getFormattedLength(u,this.projection_,this.precision_,this.unitPrefixFormat_);l.push(new we["c"]({geometry:u,fill:new Se["a"]({color:o}),stroke:new be["a"]({color:a,width:t}),text:this.createTextStyle_({text:c,angle:(s%180+180)%180-90})}));l.push(new we["c"]({geometry:new ke["a"](u.getLastCoordinate()),text:this.createTextStyle_({text:this.numberFormat_(s,this.decimals_)+"°",size:10,offsetX:Math.cos((s-90)*Math.PI/180)*20,offsetY:Math.sin((s-90)*Math.PI/180)*20})}));if(n){l.push(new we["c"]({text:this.createTextStyle_({text:this.getNameProperty(e),offsetY:-8,exceedLength:true})}))}}else{var f=[];if(i){f.push(this.getMeasure(e))}if(n){f.push(this.getNameProperty(e))}if(n||i){var h=f.join("\n");l.push(new we["c"]({text:this.createTextStyle_({text:h,exceedLength:true})}))}}}return l};Xe.prototype.getTextStyle_=function(e){return new we["c"]({text:this.createTextStyle_({text:this.getNameProperty(e),size:this.getSizeProperty(e),angle:this.getAngleProperty(e),color:this.getRGBAColorProperty(e),width:this.getStrokeProperty(e)})})};Xe.prototype.createEditingStyles=function(e){var t=[255,255,255,1];var r=[0,153,255,1];var a=3;var n=[];var i=e.getGeometry();console.assert(i);var o=i.getType();if(o==="Point"){n.push(new we["c"]({image:new Ye["a"]({radius:a*2,fill:new Se["a"]({color:r}),stroke:new be["a"]({color:t,width:a/2})}),zIndex:Infinity}))}else{if(o==="LineString"){n.push(new we["c"]({stroke:new be["a"]({color:t,width:a+2})}));n.push(new we["c"]({stroke:new be["a"]({color:r,width:a})}))}else{n.push(new we["c"]({stroke:new be["a"]({color:r,width:a/2}),fill:new Se["a"]({color:[255,255,255,.5]})}))}n.push(this.getVertexStyle(true))}return n};Xe.prototype.getVertexStyle=function(e){var t=e!==undefined?e:true;var r={image:new ze["a"]({radius:6,points:4,angle:Math.PI/4,fill:new Se["a"]({color:[255,255,255,.5]}),stroke:new be["a"]({color:[0,0,0,1]})})};if(t){r.geometry=function(e){var t=e.getGeometry();if(t.getType()=="Point"){return}var r=void 0;var a=[];var n=[];var i=void 0,o=void 0;if(t instanceof Re["a"]){n=t.getCoordinates()}else if(t instanceof Ve["a"]){a=t.getCoordinates()}else if(t instanceof We["b"]){n=t.getCoordinates()[0]}else if(t instanceof He["a"]){r=t.getCoordinates()}if(r){for(i=0,o=r.length;i<o;i++){a=a.concat(r[i])}}for(i=0,o=a.length;i<o;i++){n=n.concat(a[i])}if(n.length){return new Be["a"](n)}else{return t}}}return new we["c"](r)};Xe.prototype.supportsVertex_=function(e){var t=[he.LINE_STRING,he.POLYGON,he.RECTANGLE];var r=this.getType(e);return Ge["f"](t,r)};Xe.prototype.getHaloStyle_=function(e){var t=this.getType(e);var r=void 0;var a=3;switch(t){case he.POINT:var n=this.getSizeProperty(e);r=new we["c"]({image:new Ye["a"]({radius:n+a,fill:new Se["a"]({color:[255,255,255,1]})})});break;case he.LINE_STRING:case he.CIRCLE:case he.POLYGON:case he.RECTANGLE:var i=this.getStrokeProperty(e);r=new we["c"]({stroke:new be["a"]({color:[255,255,255,1],width:i+a*2})});break;case he.TEXT:r=new we["c"]({text:this.createTextStyle_({text:this.getNameProperty(e),size:this.getSizeProperty(e),angle:this.getAngleProperty(e),width:a*3})});break;default:break}h["a"].assert(r,"Style should be thruthy");return r};Xe.getFilteredFeatureValues=function(e){var t=e.getProperties();delete t["boundedBy"];delete t[e.getGeometryName()];delete t["ngeo_feature_type_"];return t};Xe.prototype.getAngleProperty=function(e){var t=+e.get(ce["a"].ANGLE);h["a"].assertNumber(t);return t};Xe.prototype.getColorProperty=function(e){var t=h["a"].assertString(e.get(ce["a"].COLOR));h["a"].assertString(t);return t};Xe.prototype.getRGBAColorProperty=function(e){return Ue["c"](this.getColorProperty(e))};Xe.prototype.getNameProperty=function(e){var t=h["a"].assertString(e.get(ce["a"].NAME));h["a"].assertString(t);return t};Xe.prototype.getOpacityProperty=function(e){return this.getNumber(e,ce["a"].OPACITY)};Xe.prototype.getShowMeasureProperty=function(e){var t=e.get(ce["a"].SHOW_MEASURE);if(t===undefined){t=false}else if(typeof t==="string"){t=t==="true"?true:false}return h["a"].assertBoolean(t)};Xe.prototype.getShowLabelProperty=function(e){var t=e.get(ce["a"].SHOW_LABEL);if(t===undefined){t=false}else if(typeof t==="string"){t=t==="true"?true:false}return h["a"].assertBoolean(t)};Xe.prototype.getSizeProperty=function(e){return this.getNumber(e,ce["a"].SIZE)};Xe.prototype.getStrokeProperty=function(e){return this.getNumber(e,ce["a"].STROKE)};Xe.prototype.export=function(e,t){switch(t){case Xe.FormatType.GPX:this.exportGPX(e);break;case Xe.FormatType.KML:this.exportKML(e);break;default:break}};Xe.prototype.exportGPX=function(e){var t=new qe["a"];var r="application/gpx+xml";var a="export.gpx";this.export_(e,t,a,r)};Xe.prototype.exportKML=function(e){var t=new Ke["a"];var r="application/vnd.google-earth.kml+xml";var a="export.kml";this.export_(e,t,a,r)};Xe.prototype.export_=function(e,t,r,a){var n=this;var i=a!==undefined?a:"text/plain";var o=[];var s=void 0;e.forEach(function(e){s=new Le["a"](e.getProperties());n.setStyle(s,false);o.push(s)});var l=this.projection_?{dataProjection:"EPSG:4326",featureProjection:this.projection_}:{};var u=t.writeFeatures(o,l);this.download_(u,r,i+";charset=utf-8")};Xe.prototype.createTextStyle_=function(e){if(e.angle){var t=e.angle!==undefined?e.angle:0;var r=t*Math.PI/180;e.rotation=r;delete e.angle}e.font=["normal",(e.size||10)+"pt","Arial"].join(" ");if(e.color){e.fill=new Se["a"]({color:e.color||[0,0,0,1]});delete e.color}e.stroke=new be["a"]({color:[255,255,255,1],width:e.width||3});delete e.width;return new Qe["a"](e)};Xe.prototype.getMeasure=function(e){var t=e.getGeometry();h["a"].assert(t,"Geometry should be truthy");var r="";if(t instanceof We["b"]){if(this.getType(e)===he.CIRCLE){var a=this.optNumber(e,ce["a"].AZIMUT);h["a"].assertNumber(a);var n=this.getRadiusLine(e,a);r=Ne.getFormattedAzimutRadius(n,this.projection_,this.decimals_,this.precision_,this.unitPrefixFormat_,this.numberFormat_)}else{r=Te.getFormattedArea(t,this.projection_,this.precision_,this.unitPrefixFormat_)}}else if(t instanceof Re["a"]){r=Te.getFormattedLength(t,this.projection_,this.precision_,this.unitPrefixFormat_)}else if(t instanceof ke["a"]){if(this.pointFilterFn_===null){r=Te.getFormattedPoint(t,this.decimals_,this.ngeoNumberCoordinates_)}else{var i=t.getCoordinates();var o=this.pointFilterArgs_.slice(0);o.unshift(i);r=this.pointFilterFn_.apply(this,o)}}return r};Xe.prototype.getType=function(e){var t=e.getGeometry();h["a"].assert(t,"Geometry should be thruthy");var r=void 0;if(t instanceof ke["a"]){if(e.get(ce["a"].IS_TEXT)){r=he.TEXT}else{r=he.POINT}}else if(t instanceof Be["a"]){r=he.MULTI_POINT}else if(t instanceof We["b"]){if(e.get(ce["a"].IS_CIRCLE)){r=he.CIRCLE}else if(e.get(ce["a"].IS_RECTANGLE)){r=he.RECTANGLE}else{r=he.POLYGON}}else if(t instanceof He["a"]){r=he.MULTI_POLYGON}else if(t instanceof Re["a"]){r=he.LINE_STRING}else if(t instanceof Ve["a"]){r=he.MULTI_LINE_STRING}h["a"].assert(r,"Type should be thruthy");return r};Xe.prototype.panMapToFeature=function(e,t,r){var a=r!==undefined?r:250;var n=t.getSize();h["a"].assertArray(n);var i=t.getView();var o=i.calculateExtent(n);var s=e.getGeometry();if(!s.intersectsExtent(o)){var l=i.getCenter();h["a"].assertArray(l);var u=void 0;if(s instanceof Re["a"]){u=s.getCoordinateAt(.5)}else if(s instanceof We["b"]){u=s.getInteriorPoint().getCoordinates()}else if(s instanceof ke["a"]){u=s.getCoordinates()}else{u=je["x"](s.getExtent())}i.animate({center:l,duration:a},{center:u,duration:a})}};Xe.prototype.getRadiusLine=function(e,t){var r=e.getGeometry();var a=r.getExtent();var n=(a[3]-a[1])/2;var i=je["x"](r.getExtent());var o=Math.cos((t-90)*Math.PI/180)*n;var s=-Math.sin((t-90)*Math.PI/180)*n;var l=[o+i[0],s+i[1]];return new Re["a"]([i,l])};Xe.prototype.getNonSpatialProperties=function(e){var t=e.getGeometryName();var r={};var a=e.getProperties();for(var n in a){if(n!==t){r[n]=a[n]}}return r};Xe.prototype.clearNonSpatialProperties=function(e){var t=e.getGeometryName();var r=e.getProperties();for(var a in r){if(a!==t){e.set(a,undefined)}}};Xe.FormatType={GPX:"GPX",KML:"KML"};Xe.module=angular.module("ngeoFeatureHelper",[ue.name,ie.name]);Xe.module.service("ngeoFeatureHelper",Xe);var Ze=Xe;var Je=r(89);var et=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function tt(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var rt=function(){function e(t){tt(this,e);this.active_=t.active===true;this.expression=t.expression!==undefined?t.expression:null;this.lowerBoundary_=t.lowerBoundary!==undefined?t.lowerBoundary:null;this.operator_=t.operator||null;this.upperBoundary_=t.upperBoundary!==undefined?t.upperBoundary:null;this.isCustom_=t.isCustom!==false;this.name_=t.name;this.operators_=t.operators||null;this.propertyName_=t.propertyName;this.type_=h["a"].assert(t.type);this.listenerKeys=[]}e.prototype.getExpression=function e(){return this.expression};e.prototype.setExpression=function e(t){this.expression=t};e.prototype.reset=function e(){if(this.getExpression()!==null){this.setExpression(null)}if(this.lowerBoundary!==null){this.lowerBoundary=null}if(this.upperBoundary!==null){this.upperBoundary=null}};e.prototype.destroy=function e(){this.listenerKeys.forEach(D["e"]);this.listenerKeys.length=0};et(e,[{key:"active",get:function e(){return this.active_},set:function e(t){this.active_=t}},{key:"lowerBoundary",get:function e(){return this.lowerBoundary_},set:function e(t){this.lowerBoundary_=t}},{key:"operator",get:function e(){return this.operator_},set:function e(t){this.operator_=t}},{key:"upperBoundary",get:function e(){return this.upperBoundary_},set:function e(t){this.upperBoundary_=t}},{key:"isCustom",get:function e(){return this.isCustom_}},{key:"name",get:function e(){return this.name_}},{key:"operators",get:function e(){return this.operators_}},{key:"propertyName",get:function e(){return this.propertyName_}},{key:"type",get:function e(){return this.type_}},{key:"value",get:function t(){var r=null;var a=this.getExpression();var n=this.lowerBoundary;var i=this.operator;var o=this.propertyName;var s=this.upperBoundary;if(i){if(i===e.OperatorType.BETWEEN||i===e.TemporalOperatorType.DURING){if(n!==null&&s!==null){r={operator:i,lowerBoundary:n,propertyName:o,upperBoundary:s}}}else{if(a!==null){r={expression:a,operator:i,propertyName:o}}}}return r}}]);return e}();rt.OperatorType={BETWEEN:"..",EQUAL_TO:"=",GREATER_THAN:">",GREATER_THAN_OR_EQUAL_TO:">=",LESSER_THAN:"<",LESSER_THAN_OR_EQUAL_TO:"<=",LIKE:"~",NOT_EQUAL_TO:"!="};rt.SpatialOperatorType={CONTAINS:"contains",INTERSECTS:"intersects",WITHIN:"within"};rt.TemporalOperatorType={BEGINS:"time_start",DURING:"time_during",ENDS:"time_end",EQUALS:"time_equal"};var at=rt;function nt(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function it(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function ot(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var st=function(e){ot(t,e);function t(r){nt(this,t);r.type=r.type||H["a"].DATE;return it(this,e.call(this,r))}return t}(at);var lt=st;var ut=r(231);var ct=r(83);var ft=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function ht(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function pt(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function dt(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var gt=function(e){dt(t,e);function t(r){ht(this,t);r.type=H["a"].GEOMETRY;var a=pt(this,e.call(this,r));var n=r.featureProperties||{};a.feature_=new Le["a"](n);a.format_=new ut["a"];a.updatingExpression_=false;a.updatingGeometry_=false;a.geometryChangeListenerKey_=null;a.listenerKeys.push(D["a"](a.feature_,"change:"+a.feature.getGeometryName(),a.handleFeatureGeometryChange_,a));a.setGeometryFromExpression_();return a}t.prototype.setExpression=function t(r){this.updatingExpression_=true;e.prototype.setExpression.call(this,r);if(!this.updatingGeometry_){this.setGeometryFromExpression_()}this.registerGeometryChange_();this.updatingExpression_=false};t.prototype.handleFeatureGeometryChange_=function e(){if(this.updatingExpression_){return}this.updatingGeometry_=true;var t=this.feature_.getGeometry();if(t){this.expression=this.format_.writeGeometry(t)}else{this.expression=null}this.registerGeometryChange_();this.updatingGeometry_=false};t.prototype.handleGeometryChange_=function e(t){var r=h["a"].assertInstanceof(t.target,ct["a"]);this.updatingGeometry_=true;this.expression=this.format_.writeGeometry(r);this.updatingGeometry_=false};t.prototype.setGeometryFromExpression_=function e(){var t=null;if(this.expression){var r=h["a"].assertString(this.expression);t=this.format_.readGeometry(r)}this.geometry=t};t.prototype.registerGeometryChange_=function e(){if(this.geometryChangeListenerKey_!==null){D["e"](this.geometryChangeListenerKey_);this.geometryChangeListenerKey_=null}var t=this.feature_.getGeometry();if(t){this.geometryChangeListenerKey_=D["a"](t,"change",this.handleGeometryChange_,this)}};ft(t,[{key:"feature",get:function e(){return this.feature_}},{key:"geometry",get:function e(){return this.feature_.getGeometry()||null},set:function e(t){this.feature_.setGeometry(t)}}]);return t}(at);var mt=gt;var vt=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function yt(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _t(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function St(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var bt=function(e){St(t,e);function t(r){yt(this,t);r.operator=at.OperatorType.EQUAL_TO;r.type=H["a"].SELECT;var a=_t(this,e.call(this,r));a.choices_=r.choices;return a}vt(t,[{key:"choices",get:function e(){return this.choices_}},{key:"selectedChoices",get:function e(){var t=void 0;if(this.expression){var r=String(this.expression);t=r.split(",")}else{t=[]}return t}}]);return t}(at);var wt=bt;function Ct(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function Tt(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function Et(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var Mt=function(e){Et(t,e);function t(r){Ct(this,t);r.operator=r.operator||at.OperatorType.LIKE;r.type=H["a"].TEXT;return Tt(this,e.call(this,r))}return t}(at);var Lt=Mt;var At=r(172);var Ft=r(52);var Pt=r(103);function Rt(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var kt=function(){e.$inject=["gettextCatalog","ngeoFeatureHelper","ngeoWMSTime"];function e(t,r,a){Rt(this,e);this.gettextCatalog_=t;this.ngeoFeatureHelper_=r;this.ngeoWMSTime_=a}e.prototype.createRulesFromAttributes=function e(t,r){var a=[];for(var n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;a.push(this.createRuleFromAttribute(l,r))}return a};e.prototype.createRuleFromAttribute=function e(t,r){var a=void 0;var n=r===true;var i=this.gettextCatalog_.getString(t.name);switch(t.type){case H["a"].DATE:case H["a"].DATETIME:if(n){a=new lt({name:i,operator:at.TemporalOperatorType.EQUALS,operators:[at.TemporalOperatorType.EQUALS,at.TemporalOperatorType.BEGINS,at.TemporalOperatorType.ENDS],propertyName:t.name,type:t.type})}else{a=new lt({name:i,operator:at.TemporalOperatorType.DURING,propertyName:t.name,type:t.type})}break;case H["a"].GEOMETRY:a=new mt({name:i,operator:at.SpatialOperatorType.WITHIN,operators:[at.SpatialOperatorType.CONTAINS,at.SpatialOperatorType.INTERSECTS,at.SpatialOperatorType.WITHIN],propertyName:t.name,type:t.type});break;case H["a"].NUMBER:if(n){a=new at({name:i,operator:at.OperatorType.EQUAL_TO,operators:[at.OperatorType.EQUAL_TO,at.OperatorType.GREATER_THAN,at.OperatorType.GREATER_THAN_OR_EQUAL_TO,at.OperatorType.LESSER_THAN,at.OperatorType.LESSER_THAN_OR_EQUAL_TO,at.OperatorType.NOT_EQUAL_TO],propertyName:t.name,type:H["a"].NUMBER})}else{a=new at({name:i,operator:at.OperatorType.BETWEEN,propertyName:t.name,type:H["a"].NUMBER})}break;case H["a"].SELECT:a=new wt({choices:h["a"].assert(t.choices),name:i,propertyName:t.name});break;default:if(n){a=new Lt({name:i,operator:at.OperatorType.LIKE,operators:[at.OperatorType.LIKE,at.OperatorType.EQUAL_TO,at.OperatorType.NOT_EQUAL_TO],propertyName:t.name})}else{a=new Lt({name:i,operator:at.OperatorType.LIKE,propertyName:t.name})}break}return a};e.prototype.createRules=function e(t){var r=[];for(var a=t,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;r.push(this.createRule(s))}return r};e.prototype.createRule=function e(t){var r=void 0;switch(t.type){case H["a"].DATE:case H["a"].DATETIME:r=new lt(t);break;case H["a"].GEOMETRY:r=new mt(t);break;case H["a"].SELECT:var a=t;h["a"].assert(a.choices);r=new wt(a);break;default:r=new Lt(t);break}return r};e.prototype.cloneRule=function e(t){var r=void 0;var a=t.getExpression();if(a===null){a=undefined}var n=t.isCustom;var i=t.lowerBoundary!==null?t.lowerBoundary:undefined;var o=t.name;var s=t.operator!==null?t.operator:undefined;var l=t.operators?t.operators.slice(0):undefined;var u=t.propertyName;var c=t.type!==null?t.type:undefined;var f=t.upperBoundary!==null?t.upperBoundary:undefined;var h={expression:a,isCustom:n,lowerBoundary:i,name:o,operator:s,operators:l,propertyName:u,type:c,upperBoundary:f};if(t instanceof lt){r=new lt(h)}else if(t instanceof mt){r=new mt(h);r.feature.setProperties(this.ngeoFeatureHelper_.getNonSpatialProperties(t.feature))}else if(t instanceof wt){h.choices=t.choices.slice(0);r=new wt(h)}else if(t instanceof Lt){r=new Lt(h)}else{r=new at(h)}return r};e.prototype.extendRule=function e(t,r){if(r.getExpression()!==t.getExpression()){r.setExpression(t.getExpression())}if(r.lowerBoundary!==t.lowerBoundary){r.lowerBoundary=t.lowerBoundary}if(r.operator!==t.operator){r.operator=t.operator}if(r.upperBoundary!==t.upperBoundary){r.upperBoundary=t.upperBoundary}if(t instanceof mt&&r instanceof mt){this.ngeoFeatureHelper_.clearNonSpatialProperties(r.feature);r.feature.setProperties(this.ngeoFeatureHelper_.getNonSpatialProperties(t.feature))}};e.prototype.serializeRules=function e(t){var r=this;return t.map(function(e){var t=r.serializeRule(e);return t})};e.prototype.serializeRule=function e(t){var r={name:t.name,propertyName:t.propertyName,type:t.type};if(t.expression!==null){r.expression=t.expression}if(t.lowerBoundary!==null){r.lowerBoundary=t.lowerBoundary}if(t.operator!==null){r.operator=t.operator}if(t.operators!==null){r.operators=t.operators.slice(0)}if(t.upperBoundary!==null){r.upperBoundary=t.upperBoundary}if(t instanceof mt){r.featureProperties=this.ngeoFeatureHelper_.getNonSpatialProperties(t.feature)}if(t instanceof wt){r.choices=t.choices}return r};e.prototype.createFilter=function e(t){var r=t.dataSource;var a=null;if(t.filter){a=t.filter}else{var n=t.filterRules||r.filterRules;var i=[];if(n&&n.length){for(var o=n,s=Array.isArray(o),l=0,o=s?o:o[Symbol.iterator]();;){var u;if(s){if(l>=o.length)break;u=o[l++]}else{l=o.next();if(l.done)break;u=l.value}var c=u;var f=this.createFilterFromRule_(c,r,t.srsName);if(f){i.push(f)}}}var h=r.filterCondition;if(i.length===1){a=i[0]}else if(i.length>=2){if(h===te["a"].AND){a=Ft["and"].apply(null,i)}else if(h===te["a"].OR||h===te["a"].NOT){a=Ft["or"].apply(null,i)}}if(a&&h===te["a"].NOT){a=Ft["not"](a)}}if(t.incTime){var p=this.createTimeFilterFromDataSource_(r);if(p){if(a){a=Ft["and"].apply(null,[a,p])}else{a=p}}}if(t.incDimensions){var d=this.createDimensionsFilterFromDataSource_(r);if(d){if(a){a=Ft["and"].apply(null,[a,d])}else{a=d}}}return a};e.prototype.createFilterString=function e(t){var r=null;var a=this.createFilter(t);if(a){var n=Object(At["b"])(a);var i=new XMLSerializer;r=i.serializeToString(n)}return r};e.prototype.createFilterFromRule_=function e(t,r,a){var n=null;var i=t.value;if(!i){return null}var o=i.expression;var s=i.lowerBoundary;var l=i.operator;var u=i.propertyName;var c=i.upperBoundary;var f=at.OperatorType;var p=at.SpatialOperatorType;var d=at.TemporalOperatorType;var g=[p.CONTAINS,p.INTERSECTS,p.WITHIN];var m=[f.GREATER_THAN,f.GREATER_THAN_OR_EQUAL_TO,f.LESSER_THAN,f.LESSER_THAN_OR_EQUAL_TO];if(t instanceof lt){var v=void 0;var y=void 0;if(l===d.DURING){v=Object(Pt["a"])(s).format("YYYY-MM-DD");y=Object(Pt["a"])(c).format("YYYY-MM-DD")}else if(l===d.EQUALS){v=Object(Pt["a"])(o).format("YYYY-MM-DD HH:mm:ss");y=Object(Pt["a"])(o).add(1,"days").subtract(1,"seconds").format("YYYY-MM-DD HH:mm:ss")}else if(l===d.BEGINS){v=Object(Pt["a"])(o).format("YYYY-MM-DD");y=Object(Pt["a"])(o).add(30,"years").format("YYYY-MM-DD")}else if(l===d.ENDS){v="1970-01-01";y=Object(Pt["a"])(o).format("YYYY-MM-DD")}if(v&&y){n=Ft["during"](u,v,y)}}else if(t instanceof wt){var _=t.selectedChoices;if(_.length===1){n=Ft["equalTo"](u,_[0])}else if(_.length>=2){var S=[];for(var b=_,w=Array.isArray(b),C=0,b=w?b:b[Symbol.iterator]();;){var T;if(w){if(C>=b.length)break;T=b[C++]}else{C=b.next();if(C.done)break;T=C.value}var E=T;S.push(Ft["equalTo"](u,E))}n=Ft["or"].apply(null,S)}}else if(Ge["f"](g,l)){var M=r.geometryName;h["a"].assertInstanceof(t,mt);var L=h["a"].assert(t.geometry);if(l===p.CONTAINS){n=Ft["contains"](M,L,a)}else if(l===p.INTERSECTS){n=Ft["intersects"](M,L,a)}else if(l===p.WITHIN){n=Ft["within"](M,L,a)}}else if(Ge["f"](m,l)){var A=h["a"].assertNumber(o);if(l===f.GREATER_THAN){n=Ft["greaterThan"](u,A)}else if(l===f.GREATER_THAN_OR_EQUAL_TO){n=Ft["greaterThanOrEqualTo"](u,A)}else if(l===f.LESSER_THAN){n=Ft["lessThan"](u,A)}else if(l===f.LESSER_THAN_OR_EQUAL_TO){n=Ft["lessThanOrEqualTo"](u,A)}}else if(l===f.BETWEEN){n=Ft["between"](u,s,c)}else if(l===f.EQUAL_TO){n=Ft["equalTo"](u,o)}else if(l===f.LIKE){var F=String(o).replace(/!/g,"!!").replace(/\./g,"!.").replace(/\*/g,"!*");n=Ft["like"](u,"*"+F+"*","*",".","!",false)}else if(l===f.NOT_EQUAL_TO){n=Ft["notEqualTo"](u,o)}return n};e.prototype.createDimensionsFilterFromDataSource_=function e(t){var r=t.dimensionsFiltersConfig;var a=t.dimensions;var n=[];for(var i in r){var o=r[i].value;if(o===null){if(a[i]!==undefined&&a[i]!==null){o=a[i]}}if(o!==null){n.push(Ft["equalTo"](r[i].field,o,true))}}if(n.length===1){return n[0]}else if(n.length>=2){return Ft["and"].apply(null,n)}return null};e.prototype.createTimeFilterFromDataSource_=function e(t){var r=null;var a=t.timeRangeValue;var n=t.timeProperty;var i=t.timeAttributeName;if(a&&n&&i){if(a.end!==undefined){var o=this.ngeoWMSTime_.formatWMSTimeParam(n,a).split("/");r=Ft["during"](i,o[0],o[1])}else{var s=n.resolution||"seconds";var l=this.ngeoWMSTime_.formatWMSTimeParam(n,a);var u=void 0;switch(s){case"year":u=Object(Pt["a"])(l).add(1,"years").subtract(1,"seconds");break;case"month":u=Object(Pt["a"])(l).add(1,"months").subtract(1,"seconds");break;case"day":u=Object(Pt["a"])(l).add(1,"days").subtract(1,"seconds");break;default:}if(u){var c=Object(Pt["a"])(l).format("YYYY-MM-DD HH:mm:ss");var f=u.format("YYYY-MM-DD HH:mm:ss");r=Ft["during"](i,c,f)}}}return r};return e}();kt.module=angular.module("ngeoRuleHelper",[Ze.module.name,Je["a"].module.name]);kt.module.service("ngeoRuleHelper",kt);var xt=kt;var Dt=r(0);var Ot=function e(){Y["a"].call(this)};T["d"](Ot,Y["a"]);Ot.prototype.read;Ot.prototype.readFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling){if(t.nodeType==Node.ELEMENT_NODE){return this.readFromNode(t)}}return null};Ot.prototype.readFromNode=function(e){var t={};t=Dt["u"](t,Ot.PARSERS_,e,[]);return t};Ot.readElement_=function(e,t){var r={};for(var a=0,n=e.attributes.length;a<n;a++){var i=e.attributes.item(a);r[i.name]=i.value}if(t.length===1){r["type"]=r["type"].split(":").pop()}return r};Ot.readComplexType_=function(e,t){var r=e.getAttribute("name");var a=Dt["u"]({name:r},Ot.COMPLEX_TYPE_PARSERS_,e,t);a["complexContent"]=a["complexContent"]["extension"]["sequence"]["element"];return a};Ot.readComplexContent_=function(e,t){return Dt["u"]({},Ot.COMPLEX_CONTENT_PARSERS_,e,t)};Ot.readExtension_=function(e,t){return Dt["u"]({},Ot.EXTENSION_PARSERS_,e,t)};Ot.readSequence_=function(e,t){return Dt["u"]({},Ot.SEQUENCE_PARSERS_,e,t)};Ot.NAMESPACE_URIS_=[null,"http://www.w3.org/2001/XMLSchema"];Ot.PARSERS_=h["a"].assert(Dt["r"](Ot.NAMESPACE_URIS_,{element:Dt["m"](Ot.readElement_),complexType:Dt["m"](Ot.readComplexType_)}));Ot.COMPLEX_TYPE_PARSERS_=h["a"].assert(Dt["r"](Ot.NAMESPACE_URIS_,{complexContent:Dt["n"](Ot.readComplexContent_)}));Ot.COMPLEX_CONTENT_PARSERS_=h["a"].assert(Dt["r"](Ot.NAMESPACE_URIS_,{extension:Dt["n"](Ot.readExtension_)}));Ot.EXTENSION_PARSERS_=h["a"].assert(Dt["r"](Ot.NAMESPACE_URIS_,{sequence:Dt["n"](Ot.readSequence_)}));Ot.SEQUENCE_PARSERS_=h["a"].assert(Dt["r"](Ot.NAMESPACE_URIS_,{element:Dt["m"](Ot.readElement_)}));var $t=Ot;var It=r(360);var Nt=r(272);var Gt=r(11);var Ut=r(142);function jt(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Vt=function(){e.$inject=["$http","$q","ngeoRuleHelper","ngeoWMSTime"];function e(t,r,a,n){jt(this,e);this.http_=t;this.q_=r;this.ngeoRuleHelper_=a;this.ngeoWMSTime_=n;this.requestCancelers_=[];this.wmsGetCapabilitiesPromises_={};this.wmtsGetCapabilitiesPromises_={}}e.prototype.issue=function e(t){var r=[];var a=t.map;this.cancelStillRunningRequests_();var n=void 0;if(t.queryableDataSources){n=t.queryableDataSources}else{var i=t.dataSources;h["a"].assert(i,"DataSources should be set");n=this.getQueryableDataSources(i,a)}var o=this.getCombinableWFSDataSources_(n.wfs);r.push(this.issueCombinedWFS_(o,t));var s=t.coordinate;if(s){var l=this.getCombinableWMSDataSources_(n.wms);r.push(this.issueCombinedWMS_(l,t))}return this.q_.all(r).then(this.handleCombinedQueryResult_.bind(this))};e.prototype.getQueryableDataSources=function e(t,r){var a={wfs:[],wms:[]};var n=h["a"].assertNumber(r.getView().getResolution());for(var i=t,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;if(!this.isDataSourceQueryable_(u,n)){continue}if(u instanceof ee["a"]){if(u.supportsWFS){a.wfs.push(u)}else{a.wms.push(u)}}}return a};e.prototype.wfsDescribeFeatureType=function e(t){h["a"].assert(t.supportsAttributes,"The data source must support WFS, have a single OGCLayer that\n      is queryable in order to issue WFS DescribeFeatureType requests");var r=t.getOGCLayerNames();var a=Ut["a"](h["a"].assertString(t.wfsUrl),{REQUEST:"DescribeFeatureType",SERVICE:"WFS",VERSION:"2.0.0",TYPENAME:r});return this.http_.get(a).then(function(e){var t=new $t;return t.read(e.data)})};e.prototype.wmsFindLayerCapability=function e(t,r){var a=null;for(var n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(l["Name"]===r){a=l;break}else if(l["Layer"]){a=this.wmsFindLayerCapability(l["Layer"],r);if(a){break}}}return a};e.prototype.wmsGetCapabilities=function e(t,r){var a=r!==false;var n={REQUEST:"GetCapabilities",SERVICE:"WMS",VERSION:"1.3.0"};var i=Ut["a"](t,n);var o=void 0;if(!a||!this.wmsGetCapabilitiesPromises_[t]){o=this.http_.get(i).then(function(e){var t=new It["a"];return t.read(e.data)})}else if(a&&this.wmsGetCapabilitiesPromises_[t]){o=this.wmsGetCapabilitiesPromises_[t]}h["a"].assert(o);if(a&&!this.wmsGetCapabilitiesPromises_[t]){this.wmsGetCapabilitiesPromises_[t]=o}return o};e.prototype.wmtsFindLayerCapability=function e(t,r){var a=null;for(var n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(l["Identifier"]===r){a=l;break}}return a};e.prototype.wmtsGetCapabilities=function e(t,r){var a=r!==false;var n=void 0;if(!a||!this.wmtsGetCapabilitiesPromises_[t]){n=this.http_.get(t).then(function(e){var t=new Nt["a"];return t.read(e.data)})}else if(a&&this.wmtsGetCapabilitiesPromises_[t]){n=this.wmtsGetCapabilitiesPromises_[t]}h["a"].assert(n);if(a&&!this.wmtsGetCapabilitiesPromises_[t]){this.wmtsGetCapabilitiesPromises_[t]=n}return n};e.prototype.handleCombinedQueryResult_=function e(t){var r={};for(var a=t,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;for(var l in s){var u=Number(l);r[u]=s[u]}}return r};e.prototype.handleQueryResult_=function e(t,r,a,n){var i={};for(var o=t,s=Array.isArray(o),l=0,o=s?o:o[Symbol.iterator]();;){var u;if(s){if(l>=o.length)break;u=o[l++]}else{l=o.next();if(l.done)break;u=l.value}var c=u;var f=void 0;var h=void 0;var p=void 0;if(typeof n==="number"){f=[];h=true;p=n}else{if(c instanceof ee["a"]){f=this.readAndTypeFeatures_(c,n.data,a)}else{f=[]}}var d=c.id;this.setUniqueIds_(f,c.id);i[d]={features:f,limit:r,tooManyFeatures:h,totalFeatureCount:p}}return i};e.prototype.readAndTypeFeatures_=function e(t,r,a){var n=this;var i=[];var o=void 0;var s=this.getSetOlFormatTypes_(t,a).slice();s.forEach(function(e){n.getSetOlFormatTypes_(t,a,[e]);if(a){o=t.wfsFormat.readFeatures(r)}else{o=t.wmsFormat.readFeatures(r)}if(o.length>0){o.forEach(function(t){t.set("ngeo_feature_type_",e);i.push(t)})}});this.getSetOlFormatTypes_(t,a,s);return i};e.prototype.getSetOlFormatTypes_=function e(t,r,a){var n=void 0;if(r){if(a){t.wfsFormat.setFeatureType(a)}n=t.wfsFormat.getFeatureType()}else{if(a){t.wmsFormat.setLayers(a)}n=t.wmsFormat.getLayers()}if(!n){return[]}return Array.isArray(n)?n:[n]};e.prototype.issueCombinedWFS_=function e(t,r){var a=this;var n=[];var i=h["a"].assertNumber(r.limit);var o=r.map;var s=o.getView();var l=h["a"].assertNumber(s.getResolution());var u=s.getProjection();var c=u.getCode();var f=r.wfsCount===true;var p=void 0;var d=r.coordinate;if(d){var g=r.tolerancePx;h["a"].assert(g);var m=g*l;p=je["c"](je["m"](d),m)}else{p=r.extent}var v=new At["a"];var y=new XMLSerializer;var _=function e(t){var o=void 0;var s=void 0;var u=[];var d=void 0;var g={};for(var m=t,_=Array.isArray(m),S=0,m=_?m:m[Symbol.iterator]();;){var b;if(_){if(S>=m.length)break;b=m[S++]}else{S=m.next();if(S.done)break;b=S.value}var w=b;if(!o){s=w.wfsFeatureNS;var C=w.wfsFeaturePrefix;var T=w.geometryName;var E=w.wfsOutputFormat;o={bbox:p,featureNS:s,featurePrefix:C,geometryName:T,outputFormat:E,srsName:c};d=w.wfsUrl;Gt["a"](g,w.activeDimensions)}u=u.concat(w.getInRangeOGCLayerNames(l,true));var M=void 0;if(r.filter){M=a.ngeoRuleHelper_.createFilter({dataSource:w,filter:r.filter,incDimensions:true,incTime:true})}else if(w.filterRules&&w.filterRules.length||w.timeRangeValue||w.dimensionsFiltersConfig&&Object.keys(w.dimensionsFiltersConfig).length>0){h["a"].assert(t.length===1,"A data source having filterRules or timeRangeValue should issue\n            a single query, alone.");M=a.ngeoRuleHelper_.createFilter({dataSource:w,incDimensions:true,incTime:true,srsName:c})}if(M){o["filter"]=M}}h["a"].assert(o);o.featureTypes=u;h["a"].assert(d);var L=a.q_.defer();n.push(L.promise.then(a.handleQueryResult_.bind(a,t,i,true)));var A=void 0;if(f){var F=Gt["a"]({resultType:"hits"},o);var P=v.writeGetFeature(F);var R=y.serializeToString(P);var k=a.registerCanceler_();A=a.http_.post(d,R,{params:g,headers:{"Content-Type":"text/xml; charset=UTF-8"},timeout:k.promise}).then(function(e){var r=t[0].wfsFormat.readFeatureCollectionMetadata(e.data);return r["numberOfFeatures"]}.bind(a))}else{A=a.q_.resolve()}A.then(function(e){if(e===undefined||e<i){var t=Gt["a"]({maxFeatures:i},o);var r=v.writeGetFeature(t);var n=y.serializeToString(r);h["a"].assertString(d);var s=a.registerCanceler_();a.http_.post(d,n,{params:g,headers:{"Content-Type":"text/xml; charset=UTF-8"},timeout:s.promise}).then(function(e){L.resolve(e)})}else{L.resolve(e)}})};for(var S=t,b=Array.isArray(S),w=0,S=b?S:S[Symbol.iterator]();;){var C;if(b){if(w>=S.length)break;C=S[w++]}else{w=S.next();if(w.done)break;C=w.value}var T=C;_(T)}return this.q_.all(n).then(this.handleCombinedQueryResult_.bind(this))};e.prototype.issueCombinedWMS_=function e(t,r){var a=[];var n=h["a"].assertNumber(r.limit);var i=r.map;var o=i.getView();var s=h["a"].assertNumber(o.getResolution());var l=o.getProjection();var u=l.getCode();var c=r.coordinate;h["a"].assert(c);for(var f=t,p=Array.isArray(f),d=0,f=p?f:f[Symbol.iterator]();;){var g;if(p){if(d>=f.length)break;g=f[d++]}else{d=f.next();if(d.done)break;g=d.value}var m=g;var v=void 0;var y=[];var _=void 0;var S=false;var b={};var w=null;var C=null;for(var T=m,E=Array.isArray(T),M=0,T=E?T:T[Symbol.iterator]();;){var L;if(E){if(M>=T.length)break;L=T[M++]}else{M=T.next();if(M.done)break;L=M.value}var F=L;if(!_){_=F.wmsInfoFormat;v=F.wmsUrl}y=y.concat(F.getInRangeOGCLayerNames(s,true));if(!S){Gt["a"](b,F.activeDimensions);S=true}if(F.filterRules&&F.filterRules.length){h["a"].assert(m.length===1);C=F.getFiltrableOGCLayerName();w=this.ngeoRuleHelper_.createFilterString({dataSource:F,srsName:u})}if(F.timeRangeValue!==null&&F.timeProperty){h["a"].assert(m.length===1);b["TIME"]=this.ngeoWMSTime_.formatWMSTimeParam(F.timeProperty,F.timeRangeValue)}}b["LAYERS"]=y;b["QUERY_LAYERS"]=y;if(w&&C){var P=null;if(y.length===1){P=w}else{var R=[];for(var k=0,x=y.length;k<x;k++){if(y[k]===C){R.push("("+w+")")}else{R.push("()")}}P=R.join("")}b["FILTER"]=P}h["a"].assert(v);var D=new A["a"]({params:b,url:v});var O=h["a"].assertString(D.getGetFeatureInfoUrl(c,s,u,{FEATURE_COUNT:n,INFO_FORMAT:_}));var $=this.registerCanceler_();a.push(this.http_.get(O,{timeout:$.promise}).then(this.handleQueryResult_.bind(this,m,n,false)))}return this.q_.all(a).then(this.handleCombinedQueryResult_.bind(this))};e.prototype.getCombinableWFSDataSources_=function e(t){var r=[];var a=[];for(var n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(l.combinableForWFS){var u=false;for(var c=r,f=Array.isArray(c),h=0,c=f?c:c[Symbol.iterator]();;){var p;if(f){if(h>=c.length)break;p=c[h++]}else{h=c.next();if(h.done)break;p=h.value}var d=p;if(l.combinableWithDataSourceForWFS(d[0])){d.push(l);u=true}}if(!u){r.push([l])}}else{a.push([l])}}return r.concat(a)};e.prototype.getCombinableWMSDataSources_=function e(t){var r=[];var a=[];for(var n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(l.combinableForWMS){var u=false;for(var c=r,f=Array.isArray(c),h=0,c=f?c:c[Symbol.iterator]();;){var p;if(f){if(h>=c.length)break;p=c[h++]}else{h=c.next();if(h.done)break;p=h.value}var d=p;if(l.combinableWithDataSourceForWMS(d[0])){d.push(l);u=true}}if(!u){r.push([l])}}else{a.push([l])}}return r.concat(a)};e.prototype.isDataSourceQueryable_=function e(t,r){var a=t.visible&&t.inRange&&t.queryable;if(a&&t instanceof ee["a"]){var n=t;a=n.isAnyOGCLayerInRange(r,true)}return a};e.prototype.setUniqueIds_=function e(t,r){t.forEach(function(e){if(e.getId()!==undefined){var t=r+"_"+e.getId();e.setId(t)}})};e.prototype.registerCanceler_=function e(){var t=this.q_.defer();this.requestCancelers_.push(t);return t};e.prototype.cancelStillRunningRequests_=function e(){for(var t=this.requestCancelers_,r=Array.isArray(t),a=0,t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{a=t.next();if(a.done)break;n=a.value}var i=n;i.resolve()}this.requestCancelers_.length=0};return e}();Vt.CombinedDataSources;Vt.module=angular.module("ngeoQuerent",[xt.module.name,Je["a"].module.name]);Vt.module.service("ngeoQuerent",Vt);var Bt=Vt;var Wt=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function Ht(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var qt=function(){e.$inject=["$q","ngeoDataSources","ngeoQuerent"];function e(t,r,a){Ht(this,e);this.q_=t;this.collection_=r.collection;this.ngeoQuerent_=a;this.cache_={};D["a"](this.collection_,"add",this.handleDataSourcesAdd_,this);D["a"](this.collection_,"remove",this.handleDataSourcesRemove_,this)}e.prototype.getDataSource=function e(t){return this.cache_[t]||null};e.prototype.getDataSourceAttributes=function e(t){var r=this.q_.defer();if(t.attributes){r.resolve(t.attributes)}else{this.ngeoQuerent_.wfsDescribeFeatureType(t).then(function(e){var a=t.getOGCLayerNames()[0];h["a"].assertString(a,"The data source should have only one ogcLayer.");for(var n=e.element,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(l.name===a){for(var u=e.complexType,c=Array.isArray(u),f=0,u=c?u:u[Symbol.iterator]();;){var p;if(c){if(f>=u.length)break;p=u[f++]}else{f=u.next();if(f.done)break;p=f.value}var d=p;if(d.name==l.type){var g=d.complexContent;var m=(new J).read(g);t.setAttributes(m);r.resolve(m);break}}}}})}return r.promise};e.prototype.handleDataSourcesAdd_=function e(t){var r=h["a"].assertInstanceof(t.element,B["a"]);this.cache_[r.id]=r};e.prototype.handleDataSourcesRemove_=function e(t){var r=h["a"].assertInstanceof(t.element,B["a"]);delete this.cache_[r.id]};Wt(e,[{key:"collection",get:function e(){return this.collection_}}]);return e}();qt.module=angular.module("ngeoDataSourcesHelper",[W["a"].module.name,Bt.module.name]);qt.module.service("ngeoDataSourcesHelper",qt);var Kt=qt;var Yt=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function zt(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Qt=function(){e.$inject=["$q","gmfEnumerateAttribute","ngeoDataSourcesHelper"];function e(t,r,a){zt(this,e);this.q_=t;this.gmfEnumerateAttribute_=r;this.ngeoDataSourcesHelper_=a;this.collection_;this.cache_}e.prototype.getDataSource=function e(t){return this.ngeoDataSourcesHelper_.getDataSource(t)};e.prototype.prepareFiltrableDataSource=function e(t){var r=this;var a=this.q_.defer();this.ngeoDataSourcesHelper_.getDataSourceAttributes(t).then(function(e){var n=t.gmfLayer.metadata||{};var i=n.enumeratedAttributes;if(i&&i.length){var o=[];var s=function e(a){if(Ge["f"](i,a.name)&&a.type!==H["a"].SELECT&&(!a.choices||!a.choices.length)){o.push(r.gmfEnumerateAttribute_.getAttributeValues(t,a.name).then(function(e){var t=e.map(function(e){return e.value});a.type=H["a"].SELECT;a.choices=t}))}};for(var l=e,u=Array.isArray(l),c=0,l=u?l:l[Symbol.iterator]();;){var f;if(u){if(c>=l.length)break;f=l[c++]}else{c=l.next();if(c.done)break;f=c.value}var h=f;s(h)}return r.q_.all(o).then(a.resolve(t))}else{a.resolve(t)}});return a.promise};Yt(e,[{key:"collection",get:function e(){return this.ngeoDataSourcesHelper_.collection}}]);return e}();Qt.module=angular.module("gmfDataSourcesHelper",[Kt.module.name,V.module.name]);Qt.module.service("gmfDataSourcesHelper",Qt);var Xt=Qt;var Zt=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function Jt(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function er(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function tr(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var rr=function(e){tr(t,e);function t(r){Jt(this,t);var a=er(this,e.call(this,r));a.gmfLayer_=r.gmfLayer;return a}Zt(t,[{key:"gmfLayer",get:function e(){return this.gmfLayer_}}]);return t}(ee["a"]);var ar=rr;function nr(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var ir=function(){e.$inject=["ngeoDataSourcesHelper"];function e(t){nr(this,e);this.ngeoDataSourcesHelper_=t}e.prototype.describe=function e(t){if(t.ogcServerType==="qgisserver"&&t.wfsUrl_&&t.getOGCLayerNames().length==1&&!t.attributes){this.ngeoDataSourcesHelper_.getDataSourceAttributes(t)}};return e}();ir.module=angular.module("gmfDatasourceWFSAliases",[Kt.module.name]);ir.module.service("gmfWFSAliases",ir);var or=ir;var sr=r(132);var lr=r(98);var ur=r(168);var cr=r(175);function fr(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var hr=function(){e.$inject=["$q","$rootScope","$timeout","gmfThemes","gmfTreeManager","ngeoBackgroundLayerMgr","ngeoDataSources","ngeoLayerHelper","ngeoRuleHelper","ngeoWMSTime","gmfWFSAliases"];function e(t,r,a,n,i,o,s,l,u,c,f){fr(this,e);this.q_=t;this.rootScope_=r;this.timeout_=a;this.gmfThemes_=n;this.gmfTreeManager_=i;this.ngeoBackgroundLayerMgr_=o;this.ngeoDataSources_=s;this.dataSources_=s.collection;this.ngeoLayerHelper_=l;this.ngeoRuleHelper_=u;this.ngeoWMSTime_=c;this.gmfWFSAliases_=f;this.dataSourcesCache_={};this.dimensions_;this.dimensionsWatcherUnregister=null;this.treeCtrlCache_={};this.treeCtrlsUnregister_=null;D["a"](this.ngeoBackgroundLayerMgr_,"change",this.handleNgeoBackgroundLayerChange_,this);D["a"](this.gmfThemes_,"change",this.handleThemesChange_,this)}e.prototype.setDatasourceMap=function e(t){this.ngeoDataSources_.map=t};e.prototype.setDimensions=function e(t){var r=this;if(this.dimensionsWatcherUnregister){this.dimensionsWatcherUnregister()}this.dimensions_=t;this.dimensionsWatcherUnregister=this.rootScope_.$watch(function(){return r.dimensions_},this.handleDimensionsChange_.bind(this),true);this.handleDimensionsChange_()};e.prototype.handleDimensionsChange_=function e(){var t=[];var r=[];var a=this.dataSources_.getArray();for(var n=a,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(l.dimensionsFiltersConfig){for(var u in l.dimensionsFiltersConfig){if(l.dimensionsFiltersConfig[u].value===null){var c=this.getDataSourceLayer_(l);if(c==undefined){return}var f=T["c"](c);if(r.indexOf(f)==-1){t.push(c);r.push(f)}}}}}t.forEach(this.updateLayerFilter_.bind(this))};e.prototype.handleThemesChange_=function e(){var t=this;this.clearDataSources_();if(this.treeCtrlsUnregister_){this.treeCtrlsUnregister_()}this.clearTreeCtrlCache_();this.gmfThemes_.getOgcServersObject().then(function(e){var r=t.gmfThemes_.getThemesObject().then(function(r){for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;for(var l=s.children,u=Array.isArray(l),c=0,l=u?l:l[Symbol.iterator]();;){var f;if(u){if(c>=l.length)break;f=l[c++]}else{c=l.next();if(c.done)break;f=c.value}var p=f;h["a"].assert(p);t.createDataSource_(p,p,e)}}});var a=t.gmfThemes_.getBackgroundLayersObject().then(function(r){for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;t.createDataSource_(null,s,e)}});t.q_.all([r,a]).then(function(){t.treeCtrlsUnregister_=t.rootScope_.$watchCollection(function(){if(t.gmfTreeManager_.rootCtrl){return t.gmfTreeManager_.rootCtrl.children}},t.handleTreeManagerRootChildrenChange_.bind(t))})})};e.prototype.handleTreeManagerRootChildrenChange_=function e(t){var r=this;this.timeout_(function(){if(!t){return}var e=[];var a=function e(t,r){var a=r.node;var n=a.children;if(!n){t.push(r)}};for(var n=0,i=t.length;n<i;n++){t[n].traverseDepthFirst(a.bind(r,e))}for(var o=0,s=e.length;o<s;o++){var l=e[o];var u=r.getTreeCtrlCacheItem_(l);if(!u){r.addTreeCtrlToCache_(l)}}var c=r.treeCtrlCache_;for(var f in r.treeCtrlCache_){var h=c[f];if(!e.includes(h.treeCtrl)){r.removeTreeCtrlCacheItem_(h)}}})};e.prototype.clearDataSources_=function e(){var t=this.dataSources_.getArray();for(var r=t.length-1,a=0;r>=a;r--){if(this.dataSourcesCache_[t[r].id]){this.dataSources_.remove(t[r])}}Gt["b"](this.dataSourcesCache_)};e.prototype.createDataSource_=function e(t,r,a){var n=r.children;if(n){for(var i=n,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;h["a"].assert(u);this.createDataSource_(t,u,a)}return}var c=r;var f=T["c"](c);if(this.dataSourcesCache_[f]){return}var p=c.metadata;var d=c.type;var g=void 0;var m=void 0;var v=void 0;var y=void 0;var _=void 0;var S=void 0;var b=void 0;var C=void 0;if(d===w["a"].NodeType.WMTS){var E=c;_=E.layer;S=E.url;g=p.maxResolution;m=p.minResolution;var M=p.queryLayers||p.wmsLayers;if(M){v=M.split(",").map(function(e){return{maxResolution:g,minResolution:m,name:e,queryable:true}})}if(p.ogcServer&&a[p.ogcServer]){y=a[p.ogcServer]}b=E.imageType}else if(d===w["a"].NodeType.WMS){var L=c;g=L.maxResolutionHint;m=L.minResolutionHint;v=L.childLayers.map(function(e){return{maxResolution:e.maxResolutionHint,minResolution:e.minResolutionHint,name:e.name,queryable:e.queryable}});var A=!t||t.mixed?L.ogcServer:t.ogcServer;h["a"].assert(A);y=a[A];b=y.imageType;if(L.time){C=L.time}else if(t&&t.time){C=t.time}}var F=y?y.type:undefined;var P=y?y.isSingleTile:undefined;var R=y&&y.wfsSupport?y.urlWfs:undefined;var k=y?y.url:undefined;var x=ee["a"].WFSOutputFormat.GML3;if(F===ee["a"].ServerType.QGISSERVER){x=ee["a"].WFSOutputFormat.GML2}var D=!!p.snappingConfig;var O=p.snappingConfig?p.snappingConfig.tolerance:undefined;var $=p.snappingConfig?p.snappingConfig.edge:undefined;var I=p.snappingConfig?p.snappingConfig.vertex:undefined;var N=this.dimensions_;var G=r.dimensions||t.dimensions;var U=r.dimensionsFilters;var j=void 0;var V=void 0;if(C){var B=this.ngeoWMSTime_.getOptions(C)["values"];if(Array.isArray(B)){j=B[0];V=B[1]}else{j=B}}var W=p.copyable;var H=p.identifierAttributeField;var q=c.name;var K=p.timeAttribute;var Y=p.isChecked===true;this.dataSourcesCache_[f]=new ar({copyable:W,dimensions:N,dimensionsConfig:G,dimensionsFiltersConfig:U,gmfLayer:c,id:f,identifierAttribute:H,maxResolution:g,minResolution:m,name:q,ogcImageType:b,ogcLayers:v,ogcServerType:F,ogcType:d,snappable:D,snappingTolerance:O,snappingToEdges:$,snappingToVertice:I,timeAttributeName:K,timeLowerValue:j,timeProperty:C,timeUpperValue:V,visible:Y,wfsOutputFormat:x,wfsUrl:R,wmsIsSingleTile:P,wmsUrl:k,wmtsLayer:_,wmtsUrl:S})};e.prototype.addTreeCtrlToCache_=function e(t){var r=T["c"](t.node);var a=this.dataSourcesCache_[r];h["a"].assert(a,"DataSource should be set");t.setDataSource(a);var n=this.rootScope_.$watch(function(){return t.getState()},this.handleTreeCtrlStateChange_.bind(this,t));var i=this.rootScope_.$watch(function(){var e=a.filterRules!==null;var t=a.visible;return e&&t},this.handleDataSourceFilterRulesChange_.bind(this,a));var o=void 0;var s=void 0;var l=void 0;if(a.timeProperty&&a.ogcType===ee["a"].Type.WMS){o=this.rootScope_.$watch(function(){return a.timeLowerValue},this.handleDataSourceTimeValueChange_.bind(this,a));if(a.timeProperty.mode==="range"){s=this.rootScope_.$watch(function(){return a.timeUpperValue},this.handleDataSourceTimeValueChange_.bind(this,a))}l=h["a"].assertInstanceof(sr["a"].getLayer(t),cr["a"])}this.treeCtrlCache_[r]={filterRulesWatcherUnregister:i,stateWatcherUnregister:n,timeLowerValueWatcherUnregister:o,timeUpperValueWatcherUnregister:s,treeCtrl:t,wmsLayer:l};this.dataSources_.push(a);this.gmfWFSAliases_.describe(a)};e.prototype.removeTreeCtrlCacheItem_=function e(t){var r=t.treeCtrl.getDataSource();h["a"].assert(r,"DataSource should be set");this.dataSources_.remove(r);t.treeCtrl.setDataSource(null);t.filterRulesWatcherUnregister();t.stateWatcherUnregister();if(t.timeLowerValueWatcherUnregister){t.timeLowerValueWatcherUnregister()}if(t.timeUpperValueWatcherUnregister){t.timeUpperValueWatcherUnregister()}delete this.treeCtrlCache_[T["c"](t.treeCtrl.node)]};e.prototype.clearTreeCtrlCache_=function e(){for(var t in this.treeCtrlCache_){this.removeTreeCtrlCacheItem_(this.treeCtrlCache_[t])}};e.prototype.handleTreeCtrlStateChange_=function e(t,r){var a=t.getDataSource();h["a"].assert(a,"DataSource should be set");var n=r==="on";a.visible=n;var i=this.getDataSourceLayer_(a);if(i==undefined){return}this.updateLayerFilter_(i)};e.prototype.getTreeCtrlCacheItem_=function e(t){return this.treeCtrlCache_[T["c"](t.node)]||null};e.prototype.getDataSourceLayer_=function e(t){t=t;var r=T["c"](t.gmfLayer);var a=this.treeCtrlCache_[r];if(a==undefined){return}var n=a.treeCtrl;return sr["a"].getLayer(n)};e.prototype.updateLayerFilter_=function e(t){var r;h["a"].assert(t instanceof cr["a"]||t instanceof ur["a"]);var a=t.getSource();if(!(a instanceof A["a"]||a instanceof F["a"])){return}var n=a.getParams();var i=n["LAYERS"];var o=i.split(",");h["a"].assert(o.length>=1);var s="FILTER";var l=[];var u=false;for(var c=o,f=Array.isArray(c),p=0,c=f?c:c[Symbol.iterator]();;){var d;if(f){if(p>=c.length)break;d=c[p++]}else{p=c.next();if(p.done)break;d=p.value}var g=d;var m="()";var v=this.dataSources_.getArray();for(var y=v,_=Array.isArray(y),S=0,y=_?y:y[Symbol.iterator]();;){var b;if(_){if(S>=y.length)break;b=y[S++]}else{S=y.next();if(S.done)break;b=S.value}var w=b;var C=this.getDataSourceLayer_(w);if(C==undefined){continue}if(T["c"](C)==T["c"](t)&&g===w.name){var E=T["c"](w.gmfLayer);var M=this.treeCtrlCache_[E];h["a"].assert(M);var L=M.treeCtrl;var P=L.map.getView().getProjection().getCode();var R=w.visible?this.ngeoRuleHelper_.createFilterString({dataSource:w,projCode:P,incDimensions:true}):null;if(R){m="("+R+")";u=true}}}l.push(m)}a.updateParams((r={},r[s]=u?l.join(""):null,r))};e.prototype.handleDataSourceFilterRulesChange_=function e(t){if(t.filtrable!==true||t.ogcType!==ee["a"].Type.WMS){return}var r=this.getDataSourceLayer_(t);if(r===undefined){return}this.updateLayerFilter_(r)};e.prototype.handleDataSourceTimeValueChange_=function e(t){var r=T["c"](t.gmfLayer);var a=this.treeCtrlCache_[r];h["a"].assert(a);var n=h["a"].assert(a.wmsLayer);var i=h["a"].assertInstanceof(n.getSource(),A["a"]);var o=h["a"].assert(t.timeProperty);var s=void 0;var l=t.timeRangeValue;if(l){s=this.ngeoWMSTime_.formatWMSTimeParam(o,l)}var u=i.getParams();var c=u["TIME"];if(c===s){return}this.ngeoLayerHelper_.updateWMSLayerState(n,i.getParams()["LAYERS"],s)};e.prototype.handleNgeoBackgroundLayerChange_=function e(t){var r=t.detail.previous;var a=t.detail.current;var n=this.dataSourcesCache_;if(r){var i=r.get("querySourceIds");if(Array.isArray(i)){for(var o=i,s=Array.isArray(o),l=0,o=s?o:o[Symbol.iterator]();;){var u;if(s){if(l>=o.length)break;u=o[l++]}else{l=o.next();if(l.done)break;u=l.value}var c=u;var f=n[c];if(f){f.visible=false;this.dataSources_.remove(f)}}}}if(a){var h=a.get("querySourceIds");if(Array.isArray(h)){for(var p=h,d=Array.isArray(p),g=0,p=d?p:p[Symbol.iterator]();;){var m;if(d){if(g>=p.length)break;m=p[g++]}else{g=p.next();if(g.done)break;m=g.value}var v=m;var y=n[v];if(y){y.visible=true;this.dataSources_.push(y)}}}}};return e}();hr.module=angular.module("gmfDataSourcesManager",[or.module.name,sr["a"].module.name,lr["a"].module.name,w["a"].module.name,xt.module.name,W["a"].module.name,x.module.name,R["a"].module.name,Je["a"].module.name]);hr.module.service("gmfDataSourcesManager",hr);var pr=hr;var dr=angular.module("gmfDatasourceModule",[N["a"].module.name,G["a"].module.name,Xt.module.name,pr.module.name,or.module.name]);var gr=dr;var mr=r(153);var vr=r(41);var yr=r(249);var _r=r(227);var Sr=angular.module("ngeoPopup",["ngSanitize"]);Sr.value("ngeoPopupTemplateUrl",function(e,t){var r=t["ngeoPopupTemplateurl"];return r!==undefined?r:"ngeo/message/popupcomponent"});Sr.run(["$templateCache",function(e){e.put("ngeo/message/popupcomponent",r(342))}]);Sr.directive_=function(e){return{restrict:"A",templateUrl:e,link:function e(t,r,a){r.addClass("popover");t.close=function(e){if(e){e.stopPropagation();e.preventDefault()}r.addClass("hidden")};t.$watch("open",function(e,t){r.css("display",e?"block":"none")})}}};Sr.directive_.$inject=["ngeoPopupTemplateUrl"];Sr.directive("ngeoPopup",Sr.directive_);var br=Sr;var wr=function e(t,r,a,n){var i=this;this.scope=r.$new(true);this.scope.$watch(function(){return i.scope["open"]},function(e){if(!e&&i.autoDestroy_){i.timeout_(function(){i.destroy()})}});this.sce_=a;this.timeout_=n;this.element_=angular.element("<div ngeo-popup></div>");this.autoDestroy_=false;t(this.element_)(this.scope);angular.element(document.body).append(this.element_)};wr.prototype.getOpen=function(){return this.scope["open"]};wr.prototype.setOpen=function(e){this.scope["open"]=e};wr.prototype.destroy=function(){this.scope.$destroy();this.element_.remove()};wr.prototype.setTitle=function(e){var t=this.sce_.trustAsHtml(e);this.scope["title"]=t};wr.prototype.setContent=function(e,t){this.scope["content"]=t?this.sce_.trustAsHtml(e):e};wr.prototype.setUrl=function(e){var t=this.sce_.trustAsHtml('<iframe src="'+e+'" width="100%" height="100%"></iframe>');this.setContent(t)};wr.prototype.setWidth=function(e){this.element_.width(e)};wr.prototype.setHeight=function(e){this.element_.height(e)};wr.prototype.setSize=function(e,t){this.setWidth(e);this.setHeight(t)};wr.prototype.setAutoDestroy=function(e){this.autoDestroy_=e};wr.prototype.addClass=function(e){this.element_.addClass(e)};wr.prototype.open=function(e){if(e.url){this.setUrl(e.url)}else if(e.content){this.setContent(e.content)}else{h["a"].fail('ngeo.message.Popup options requirest "url" or "content".')}if(e.autoDestroy!==undefined){this.setAutoDestroy(e.autoDestroy)}if(e.cls!==undefined){this.addClass(e.cls)}if(e.height!==undefined){this.setHeight(e.height)}if(e.title!==undefined){this.setTitle(e.title)}if(e.width!==undefined){this.setWidth(e.width)}this.setOpen(true)};wr.Factory=function(e,t,r,a){return function(){return new wr(e,t,r,a)}};wr.Factory.$inject=["$compile","$rootScope","$sce","$timeout"];wr.module=angular.module("ngeoCreatePopup",[br.name]);wr.module.factory("ngeoCreatePopup",wr.Factory);var Cr=wr;var Tr=r(414);var Er=function e(t,r,a){this.sce_=t;this.gettextCatalog_=r;this.createPopup_=a;l["a"].call(this);var n=angular.element('<div class="ngeo-disclaimer"></div>');angular.element(document.body).append(n);this.container_=n;this.messages_={}};Er.$inject=["$sce","gettextCatalog","ngeoCreatePopup"];Er.$inject=["$sce","gettextCatalog","ngeoCreatePopup"];T["d"](Er,l["a"]);Er.prototype.alert=function(e){this.show(e)};Er.prototype.close=function(e){var t=this.getMessageObjects(e);t.forEach(this.closeMessage_,this)};Er.prototype.showMessage=function(e){var t=this;var r=this.gettextCatalog_;var a=e.type;h["a"].assertString(a,"Type should be set.");var n=this.getMessageUid_(e);if(this.messages_[n]!==undefined){return}var i=e.popup===true;if(i){var o=this.createPopup_();var s=this.sce_.trustAsHtml(e.msg);o.open({autoDestroy:true,content:s,title:"&nbsp;"});o.scope.$watch("open",function(r,a){if(!r){t.closeMessage_(e)}});this.messages_[n]=o}else{var u=["alert","fade","alert-dismissible"];switch(a){case l["a"].Type.ERROR:u.push("alert-danger");break;case l["a"].Type.INFORMATION:u.push("alert-info");break;case l["a"].Type.SUCCESS:u.push("alert-success");break;case l["a"].Type.WARNING:u.push("alert-warning");break;default:break}var c=angular.element('<div role="alert" class="'+u.join(" ")+'"></div>');var f=angular.element('<button type="button" class="close" data-dismiss="alert" aria-label="'+r.getString("Close")+'"><span aria-hidden="true" class="fa fa-times"></span></button>');var p=angular.element("<span />").html(e.msg);c.append(f).append(p);var d=void 0;if(e.target){d=angular.element(e.target)}else{d=this.container_}d.append(c);c.addClass("in");c.on("closed.bs.alert",function(){t.closeMessage_(e)});this.messages_[n]=c}};Er.prototype.getMessageUid_=function(e){return e.msg+"-"+e.type};Er.prototype.closeMessage_=function(e){var t=this.getMessageUid_(e);var r=this.messages_[t];if(r===undefined){return}if(r instanceof Cr){if(r.getOpen()){r.setOpen(false)}}else{if(r.hasClass("in")){r.alert("close")}}delete this.messages_[t]};Er.module=angular.module("ngeoDisclaimer",[Cr.module.name]);Er.module.service("ngeoDisclaimer",Er);var Mr=Er;var Lr=r(160);var Ar=angular.module("gmfDisclaimer",["ngSanitize",R["a"].module.name,Mr.module.name,Lr["a"].module.name]);Ar.Controller_=function(e,t,r,a,n,i,o,s,l){this.map;this.external;this.popup;this.visibility=false;this.msg;this.msgs_=[];this.sce_=r;this.timeout_=a;this.gettextCatalog_=n;this.element_=e;this.createPopup_=i;this.disclaimer_=o;this.eventHelper_=s;this.ngeoLayerHelper_=l;this.dataLayerGroup_=null};Ar.Controller_.$inject=["$element","$scope","$sce","$timeout","gettextCatalog","ngeoCreatePopup","ngeoDisclaimer","ngeoEventHelper","ngeoLayerHelper"];Ar.Controller_.prototype.$onInit=function(){this.dataLayerGroup_=this.ngeoLayerHelper_.getGroupFromMap(this.map,vr["a"].DATALAYERGROUP_NAME);this.registerLayer_(this.dataLayerGroup_)};Ar.Controller_.prototype.handleLayersAdd_=function(e){var t=this;this.timeout_(function(){var r=e.element;h["a"].assertInstanceof(r,mr["a"]);t.registerLayer_(r)})};Ar.Controller_.prototype.handleLayersRemove_=function(e){var t=e.element;h["a"].assertInstanceof(t,mr["a"]);this.unregisterLayer_(t)};Ar.Controller_.prototype.registerLayer_=function(e){var t=this;var r=T["c"](e);if(e instanceof M["a"]){this.eventHelper_.addListenerKey(r,D["a"](e.getLayers(),"add",this.handleLayersAdd_,this));this.eventHelper_.addListenerKey(r,D["a"](e.getLayers(),"remove",this.handleLayersRemove_,this));e.getLayers().forEach(function(e){t.registerLayer_(e)})}else{var a=e.get("disclaimers");if(a&&Array.isArray(a)){a.forEach(function(e){t.showDisclaimerMessage_(e)})}}};Ar.Controller_.prototype.unregisterLayer_=function(e){var t=this;var r=T["c"](e);if(e instanceof M["a"]){this.eventHelper_.clearListenerKey(r);e.getLayers().forEach(function(e){return t.unregisterLayer_(e)})}else{var a=e.get("disclaimers");if(a&&Array.isArray(a)){a.forEach(function(e){t.closeDisclaimerMessage_(e)})}}};Ar.Controller_.prototype.$onDestroy=function(){this.unregisterLayer_(this.dataLayerGroup_)};Ar.Controller_.prototype.showDisclaimerMessage_=function(e){e=this.gettextCatalog_.getString(e);if(this.external){if(this.msgs_.indexOf(e)<0){this.msgs_.push(e)}this.msg=""+this.sce_.trustAsHtml(this.msgs_.join("<br />"));this.visibility=true}else{this.disclaimer_.alert({popup:this.popup,msg:e,target:this.element_,type:l["a"].Type.WARNING})}};Ar.Controller_.prototype.closeDisclaimerMessage_=function(e){e=this.gettextCatalog_.getString(e);if(this.external){this.visibility=false;this.msgs_.length=0;this.msg=""}else{this.disclaimer_.close({popup:this.popup,msg:e,target:this.element_,type:l["a"].Type.WARNING})}};Ar.component_={controller:Ar.Controller_,bindings:{popup:"<?gmfDisclaimerPopup",map:"=gmfDisclaimerMap",external:"<?gmfDisclaimerExternal",visibility:"=?gmfDisclaimerExternalVisibility",msg:"=?gmfDisclaimerExternalMsg"}};Ar.component("gmfDisclaimer",Ar.component_);var Fr=Ar;var Pr=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function Rr(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var kr=function(){e.$inject=["$rootScope"];function e(t){var r=this;Rr(this,e);this.rootScope_=t;this.currentDataSourceId_=null;this.currentDataSourceItems_=[];this.localStorageKey_="gmf_savedfilters";this.useLocalStorage_=true;try{if("localStorage"in window){window.localStorage["test"]="";delete window.localStorage["test"]}else{this.useLocalStorage_=false}}catch(e){console.error(e);this.useLocalStorage_=false}this.items_=[];this.rootScope_.$watchCollection(function(){return r.items},function(){r.rePopulateCurrentDataSourceItems_()});if(this.useLocalStorage_){this.loadItemsFromLocalStorage_()}}e.prototype.loadItemsFromLocalStorage_=function e(){if(window.localStorage[this.localStorageKey_]){var t=JSON.parse(window.localStorage[this.localStorageKey_]);h["a"].assertArray(t);this.items_=t}};e.prototype.indexOfItem=function e(t,r){var a=void 0;var n=-1;for(var i=0,o=this.items_.length;i<o;i++){a=this.items[i];if(a.dataSourceId===r&&a.name===t){n=i;break}}return n};e.prototype.save=function e(t){var r=this.indexOfItem(t.name,t.dataSourceId);if(r!==-1){this.items[r]=t}else{this.items.push(t)}if(this.useLocalStorage_){this.saveItemsInLocalStorage_()}};e.prototype.remove=function e(t){var r=Ge["j"](this.items,t);if(r&&this.useLocalStorage_){this.saveItemsInLocalStorage_()}};e.prototype.saveItemsInLocalStorage_=function e(){window.localStorage[this.localStorageKey_]=JSON.stringify(this.items)};e.prototype.rePopulateCurrentDataSourceItems_=function e(){this.currentDataSourceItems_.length=0;if(this.currentDataSourceId_!==null){for(var t=this.items,r=Array.isArray(t),a=0,t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{a=t.next();if(a.done)break;n=a.value}var i=n;if(i.dataSourceId===this.currentDataSourceId_){this.currentDataSourceItems_.push(i)}}}};Pr(e,[{key:"currentDataSourceItems",get:function e(){return this.currentDataSourceItems_}},{key:"currentDataSourceId",set:function e(t){this.currentDataSourceId_=t;this.rePopulateCurrentDataSourceItems_()}},{key:"items",get:function e(){return this.items_}}]);return e}();kr.module=angular.module("gmfSavedFilters",[]);kr.module.service("gmfSavedFilters",kr);kr.Item=function(){};kr.Item.prototype.condition;kr.Item.prototype.customRules;kr.Item.prototype.dataSourceId;kr.Item.prototype.directedRules;kr.Item.prototype.name;var xr=kr;function Dr(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Or=function(){e.$inject=["$injector","ngeoDataSources","ngeoDataSourcesHelper","ngeoQuerent","ngeoQueryResult"];function e(t,r,a,n,i){Dr(this,e);var o=t.has("ngeoQueryOptions")?t.get("ngeoQueryOptions"):{};this.dataSources_=r.collection;this.ngeoDataSourcesHelper_=a;this.ngeoQuerent_=n;this.result_=i;this.limit_=o.limit!==undefined?o.limit:50;this.queryCountFirst_=o.queryCountFirst!==undefined?o.queryCountFirst:false;this.tolerancePx_=o.tolerance!==undefined?o.tolerance:3;this.dataSourceNames_={}}e.prototype.issue=function e(t){this.clear();var r=void 0;if(t.dataSources===undefined&&t.queryableDataSources===undefined){r=this.ngeoQuerent_.getQueryableDataSources(this.dataSources_.getArray(),t.map)}var a=t.limit!==undefined?t.limit:this.limit_;Gt["a"](t,{queryableDataSources:r,limit:a,tolerancePx:this.tolerancePx_,wfsCount:this.queryCountFirst_});this.result_.pending=true;this.ngeoQuerent_.issue(t).then(this.handleResult_.bind(this))};e.prototype.clear=function e(){this.result_.total=0;for(var t=this.result_.sources,r=Array.isArray(t),a=0,t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{a=t.next();if(a.done)break;n=a.value}var i=n;i.features.length=0;i.pending=false;i.queried=false;i.tooManyResults=false;i.totalFeatureCount=undefined}this.result_.sources.length=0;this.result_.pending=false};e.prototype.handleResult_=function e(t){var r=this;var a=0;var n=function e(n){var i=Number(n);var o=r.ngeoDataSourcesHelper_.getDataSource(i);var s=o.name;h["a"].assert(o);var l=t[i];var u=l.features;var c=l.limit;var f=l.tooManyFeatures===true;var p=l.totalFeatureCount;var d={};u.forEach(function(e){var t=h["a"].assertString(e.get("ngeo_feature_type_"));if(!d[t]){d[t]=[]}if(o.attributes&&o.attributes.length){var r=e.getProperties();var a={};o.attributes.forEach(function(t){if(t.alias){a[t.alias]=r[t.name];e.unset(t.name,true)}else{a[t.name]=r[t.name]}});e.setProperties(a,true)}d[t].push(e)});for(var g in d){s=g?g:s;var m=d[g];r.result_.sources.push({features:m,id:i,label:s,limit:c,pending:false,queried:true,tooManyResults:f,totalFeatureCount:p});a+=u.length}};for(var i in t){n(i)}this.result_.total=a;this.result_.pending=false};return e}();Or.module=angular.module("ngeoMapQuerent",[W["a"].module.name,Kt.module.name,Bt.module.name]);Or.module.service("ngeoMapQuerent",Or);Or.module.value("ngeoQueryResult",{sources:[],total:0,pending:false});var $r=Or;var Ir=r(269);var Nr=r(209);var Gr=angular.module("ngeoBtnComponent",[]);Gr.btnGroupComponent_=function(e){return{restrict:"A",controller:"ngeoBtnGroupController",link:function t(r,a,n,i){var o=e(n["ngeoBtnGroupActive"]).assign;if(o){r.$watch(function(){return i.buttons_.some(function(e){return e(r)===true})},function(e){o(r,e)})}}}};Gr.btnGroupComponent_.$inject=["$parse"];Gr.directive("ngeoBtnGroup",Gr.btnGroupComponent_);Gr.BtnGroupController=function(e){this.buttons_=[];this.scope_=e};Gr.BtnGroupController.$inject=["$scope"];Gr.BtnGroupController.prototype.activate=function(e){var t=this;this.buttons_.forEach(function(r,a){if(a!=e){r.assign(t.scope_,false)}})};Gr.BtnGroupController.prototype.addButton=function(e){this.buttons_.push(e);return this.buttons_.length-1};Gr.controller("ngeoBtnGroupController",Gr.BtnGroupController);Gr.btnComponent_=function(e){return{require:["?^ngeoBtnGroup","ngModel"],restrict:"A",link:function t(r,a,n,i){var o=i[0];var s=i[1];var l=-1;var u=e(n["ngModel"]);var c=u.assign;if(u(r)===undefined){c(r,false)}if(o!==null){l=o.addButton(u)}a.on("click",function(){r.$apply(function(){s.$setViewValue(!s.$viewValue);s.$render()})});s.$render=function(){if(s.$viewValue&&o!==null){o.activate(l)}a.toggleClass("active",s.$viewValue)}}}};Gr.btnComponent_.$inject=["$parse"];Gr.directive("ngeoBtn",Gr.btnComponent_);var Ur=Gr;var jr=r(95);var Vr=function e(t,r,a,n,i){var o=this;this.active;if(this.active===undefined){this.active=false}this.features;this.map;this.showMeasure;this.gettextCatalog_=a;a.getString("Point");a.getString("LineString");a.getString("Polygon");a.getString("Circle");a.getString("Rectangle");a.getString("Text");this.featureHelper_=n;this.ngeoFeatures_=i;this.interactions_=[];this.drawPoint;this.measureLength;this.measureArea;this.measureAzimut;this.drawRectangle;this.drawText;t.$watch(function(){return o.active},function(e){if(e===false){o.interactions_.forEach(function(e){e.setActive(false)})}})};Vr.$inject=["$scope","$sce","gettextCatalog","ngeoFeatureHelper","ngeoFeatures"];Vr.$inject=["$scope","$sce","gettextCatalog","ngeoFeatureHelper","ngeoFeatures"];Vr.prototype.registerInteraction=function(e){this.interactions_.push(e);e.setActive(false);jr["a"].interaction(e);this.map.addInteraction(e)};Vr.prototype.handleActiveChange=function(e){this.active=this.interactions_.some(function(e){return e.getActive()},this)};Vr.prototype.handleDrawEnd=function(e,t){var r=void 0;if(t.feature){r=t.feature}else{r=t.detail.feature}h["a"].assert(r);var a=r.get("azimut");var n=this.features||this.ngeoFeatures_;var i=new Le["a"](r.getGeometry());var o=ce["a"];switch(e){case he.CIRCLE:i.set(o.IS_CIRCLE,true);if(a!==undefined){i.set(o.AZIMUT,a)}break;case he.TEXT:i.set(o.IS_TEXT,true);break;case he.RECTANGLE:i.set(o.IS_RECTANGLE,true);break;default:break}var s=this.gettextCatalog_.getString(e);i.set(o.NAME,s+" "+(n.getLength()+1));var l=e!==he.TEXT?"#DB4436":"#000000";i.set(o.COLOR,l);i.set(o.ANGLE,0);i.set(o.OPACITY,.2);i.set(o.SHOW_MEASURE,this.showMeasure?true:false);i.set(o.SHOW_LABEL,false);i.set(o.SIZE,10);i.set(o.STROKE,2);this.featureHelper_.setStyle(i);n.push(i)};Vr.module=angular.module("ngeoDrawfeatureController",[Nr["a"].name,Ur.name,Ze.module.name]);Vr.module.controller("ngeoDrawfeatureController",Vr);var Br=Vr;var Wr=r(166);var Hr=angular.module("ngeoDrawpoint",[]);Hr.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function e(t,r,a,n){var i=new Wr["a"]({type:"Point"});n.registerInteraction(i);n.drawPoint=i;D["a"](i,"drawend",n.handleDrawEnd.bind(n,he.POINT),n);D["a"](i,"change:active",n.handleActiveChange,n)}}};Hr.directive("ngeoDrawpoint",Hr.directive_);var qr=Hr;var Kr=angular.module("ngeoDrawrectangle",[]);Kr.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function e(t,r,a,n){var i=new Wr["a"]({type:"LineString",geometryFunction:function e(t,r){if(!r){r=new We["b"](null)}var a=t[0];var n=t[1];r.setCoordinates([[a,[a[0],n[1]],n,[n[0],a[1]],a]]);return r},maxPoints:2});n.registerInteraction(i);n.drawRectangle=i;D["a"](i,"drawend",n.handleDrawEnd.bind(n,he.RECTANGLE),n);D["a"](i,"change:active",n.handleActiveChange,n)}}};Kr.directive("ngeoDrawrectangle",Kr.directive_);var Yr=Kr;var zr=angular.module("ngeoDrawtext",[]);zr.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function e(t,r,a,n){var i=new Wr["a"]({type:"Point"});n.registerInteraction(i);n.drawText=i;D["a"](i,"drawend",n.handleDrawEnd.bind(n,he.TEXT),n);D["a"](i,"change:active",n.handleActiveChange,n)}}};zr.directive("ngeoDrawtext",zr.directive_);var Qr=zr;var Xr=function e(t,r){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};Te.call(this,a);this.continueMsg;if(a.continueMsg!==undefined){this.continueMsg=a.continueMsg}else{this.continueMsg=document.createElement("span");this.continueMsg.textContent=r.getString("Click to continue drawing the polygon.");var n=document.createElement("br");n.textContent=r.getString("Double-click or click starting point to finish.");this.continueMsg.appendChild(n)}this.format=t};T["d"](Xr,Te);Xr.prototype.createDrawInteraction=function(e,t){return new Wr["a"]({type:"Polygon",source:t,style:e})};Xr.prototype.handleMeasure=function(e){var t=h["a"].assertInstanceof(this.sketchFeature.getGeometry(),We["b"]);var r=this.getMap().getView().getProjection();h["a"].assert(r);var a=Te.getFormattedArea(t,r,this.precision,this.format);var n=t.getCoordinates()[0].length;var i=null;if(n>3){i=t.getInteriorPoint().getCoordinates()}e(a,i)};var Zr=Xr;var Jr=angular.module("ngeoMeasurearea",[Br.module.name]);Jr.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function n(i,o,s,l){var u=t.getString("Click to start drawing polygon");var c=t.getString("Click to continue drawing<br>"+"Double-click or click starting point to finish");var f=new Zr(r("ngeoUnitPrefix"),t,{style:new we["c"],startMsg:e("<div translate>"+u+"</div>")(i)[0],continueMsg:e("<div translate>"+c+"</div>")(i)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):undefined});l.registerInteraction(f);l.measureArea=f;D["a"](f,"measureend",l.handleDrawEnd.bind(l,he.POLYGON),l);D["a"](f,"change:active",l.handleActiveChange,l)}}};Jr.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"];Jr.directive("ngeoMeasurearea",Jr.directive_);var ea=Jr;var ta=angular.module("ngeoMeasureazimut",[Br.module.name,ie.name]);ta.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function n(i,o,s,l){var u=t.getString("Click to start drawing circle");var c=t.getString("Click to finish");var f=new Ne(r("ngeoUnitPrefix"),r("number"),{style:new we["c"],startMsg:e("<div translate>"+u+"</div>")(i)[0],continueMsg:e("<div translate>"+c+"</div>")(i)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):undefined,decimals:a.has("ngeoMeasureDecimals")?a.get("ngeoMeasureDecimals"):undefined});l.registerInteraction(f);l.measureAzimut=f;D["a"](f,"measureend",function(e){var t=e.detail.feature.getGeometry();var r=t.getGeometries()[1];var a=Object(We["c"])(r,64);e.detail.feature=new Le["a"](a);var n=Ne.getAzimut(t.getGeometries()[0]);e.detail.feature.set("azimut",n);l.handleDrawEnd(he.CIRCLE,e)},l);D["a"](f,"change:active",l.handleActiveChange,l)}}};ta.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"];ta.directive("ngeoMeasureazimut",ta.directive_);var ra=ta;var aa=function e(t,r){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};Te.call(this,a);if(a.continueMsg!==undefined){this.continueMsg=a.continueMsg}else{this.continueMsg=document.createElement("span");this.continueMsg.textContent=r.getString("Click to continue drawing the line.");var n=document.createElement("br");n.textContent=r.getString("Double-click or click last point to finish.");this.continueMsg.appendChild(n)}this.format=t};T["d"](aa,Te);aa.prototype.createDrawInteraction=function(e,t){return new Wr["a"]({type:"LineString",source:t,style:e})};aa.prototype.handleMeasure=function(e){var t=h["a"].assertInstanceof(this.sketchFeature.getGeometry(),Re["a"]);var r=this.getMap().getView().getProjection();h["a"].assert(r);var a=Te.getFormattedLength(t,r,this.precision,this.format);var n=t.getLastCoordinate();e(a,n)};var na=aa;var ia=angular.module("ngeoMeasurelength",[Br.module.name,ie.name]);ia.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function n(i,o,s,l){var u=t.getString("Click to start drawing line");var c=t.getString("Click to continue drawing<br>"+"Double-click or click last point to finish");var f=new na(r("ngeoUnitPrefix"),t,{style:new we["c"],startMsg:e("<div translate>"+u+"</div>")(i)[0],continueMsg:e("<div translate>"+c+"</div>")(i)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):undefined});l.registerInteraction(f);l.measureLength=f;D["a"](f,"measureend",l.handleDrawEnd.bind(l,he.LINE_STRING),l);D["a"](f,"change:active",l.handleActiveChange,l)}}};ia.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"];ia.directive("ngeoMeasurelength",ia.directive_);var oa=ia;var sa=angular.module("ngeoDrawfeature",[Br.module.name,qr.name,Yr.name,Qr.name,ea.name,ra.name,oa.name]);sa.directive_=function(){return{controller:"ngeoDrawfeatureController as dfCtrl",scope:true,bindToController:{active:"=ngeoDrawfeatureActive",features:"=?ngeoDrawfeatureFeatures",map:"=ngeoDrawfeatureMap",showMeasure:"=?ngeoDrawfeatureShowmeasure"}}};sa.directive("ngeoDrawfeature",sa.directive_);var la=sa;var ua=r(104);var ca=r(21);var fa=r(191);var ha=function e(t){var r=this;h["a"].assert(t.features);xe["b"].call(this,{handleDownEvent:e.handleDownEvent_,handleDragEvent:e.handleDragEvent_,handleEvent:e.handleEvent,handleUpEvent:e.handleUpEvent_});this.vertexFeature_=null;this.lastPixel_=[0,0];this.modified_=false;this.rBush_=new fa["a"];this.pixelTolerance_=t.pixelTolerance!==undefined?t.pixelTolerance:10;this.snappedToVertex_=false;this.changingFeature_=false;this.dragSegments_=null;this.overlay_=new ye["a"]({source:new _e["b"]({useSpatialIndex:false,wrapX:!!t.wrapX}),style:t.style||Me.getDefaultModifyStyleFunction(),updateWhileAnimating:true,updateWhileInteracting:true});this.features_=t.features;this.features_.forEach(function(e){return r.addFeature_(e)});D["a"](this.features_,"add",this.handleFeatureAdd_,this);D["a"](this.features_,"remove",this.handleFeatureRemove_,this)};T["d"](ha,xe["b"]);ha.prototype.addFeature_=function(e){if(e.getGeometry().getType()==="Polygon"&&!!e.get(ce["a"].IS_CIRCLE)){var t=e.getGeometry();this.writeCircleGeometry_(e,t);var r=this.getMap();if(r){this.handlePointerAtPixel_(this.lastPixel_,r)}}};ha.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=true;var t=new C["a"]("modifystart",{features:this.features_});this.dispatchEvent(t)}};ha.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e);if(this.vertexFeature_&&this.features_.getLength()===0){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}};ha.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_;var r=[];t.forEach(function(t){if(e===t.feature){r.push(t)}});for(var a=r.length-1;a>=0;--a){t.remove(r[a])}};ha.prototype.setMap=function(e){this.overlay_.setMap(e);xe["b"].prototype.setMap.call(this,e)};ha.prototype.handleFeatureAdd_=function(e){var t=e.element;h["a"].assertInstanceof(t,Le["a"],"feature should be an ol.Feature");this.addFeature_(t)};ha.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)};ha.prototype.writeCircleGeometry_=function(e,t){var r=t.getCoordinates();var a=void 0,n=void 0,i=void 0,o=void 0,s=void 0,l=void 0,u=void 0;for(o=0,s=r.length;o<s;++o){a=r[o];for(n=0,i=a.length-1;n<i;++n){l=a.slice(n,n+2);u={feature:e,geometry:t,depth:[o],index:n,segment:l};this.rBush_.insert(je["b"](l),u)}}};ha.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;if(!t){t=new Le["a"](new ke["a"](e));this.vertexFeature_=t;this.overlay_.getSource().addFeature(t)}else{var r=t.getGeometry();r.setCoordinates(e)}return t};ha.compareIndexes_=function(e,t){return e.index-t.index};ha.handleDownEvent_=function(e){this.handlePointerAtPixel_(e.pixel,e.map);this.dragSegments_=[];this.modified_=false;var t=this.vertexFeature_;if(t){var r=t.getGeometry();var a=r.getCoordinates();var n=je["b"]([a]);var i=this.rBush_.getInExtent(n);var o={};i.sort(ha.compareIndexes_);for(var s=0,l=i.length;s<l;++s){var u=i[s];var c=u.segment;var f=T["c"](u.feature);var h=u.depth;if(h){f+="-"+h.join("-")}if(!o[f]){o[f]=new Array(2)}if(ca["e"](c[0],a)&&!o[f][0]){this.dragSegments_.push([u,0]);o[f][0]=u}else if(ca["e"](c[1],a)&&!o[f][1]){this.dragSegments_.push([u,1]);o[f][1]=u}}}return!!this.vertexFeature_};ha.handleDragEvent_=function(e){this.willModifyFeatures_(e);var t=e.coordinate;var r=this.dragSegments_[0][0].geometry;var a=je["x"](r.getExtent());var n=new Re["a"]([a,t]);var i=new Fe["a"](a,n.getLength());var o=Object(We["c"])(i,64).getCoordinates();this.setGeometryCoordinates_(r,o);var s=Ne.getAzimut(n);this.features_.getArray()[0].set(ce["a"].AZIMUT,s);this.createOrUpdateVertexFeature_(t)};ha.handleUpEvent_=function(e){this.rBush_.clear();this.writeCircleGeometry_(this.dragSegments_[0][0].feature,this.dragSegments_[0][0].geometry);if(this.modified_){var t=new C["a"]("modifyend",{features:this.features_});this.dispatchEvent(t);this.modified_=false}return false};ha.handleEvent=function(e){if(!(e instanceof ua["a"])){return true}var t=void 0;if(!e.map.getView().getInteracting()&&e.type=="pointermove"&&!this.handlingDownUpSequence){this.handlePointerMove_(e)}return xe["c"].call(this,e)&&!t};ha.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel;this.handlePointerAtPixel_(e.pixel,e.map)};ha.prototype.handlePointerAtPixel_=function(e,t){var r=t.getCoordinateFromPixel(e);var a=function e(t,a){return ca["i"](r,t.segment)-ca["i"](r,a.segment)};var n=t.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]);var i=t.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]);var o=je["b"]([n,i]);var s=this.rBush_;var l=s.getInExtent(o);if(l.length>0){l.sort(a);var u=l[0];var c=u.segment;var f=ca["c"](r,c);var h=t.getPixelFromCoordinate(f);if(Math.sqrt(ca["h"](e,h))<=this.pixelTolerance_){var p=t.getPixelFromCoordinate(c[0]);var d=t.getPixelFromCoordinate(c[1]);var g=ca["h"](h,p);var m=ca["h"](h,d);var v=Math.sqrt(Math.min(g,m));this.snappedToVertex_=v<=this.pixelTolerance_;if(this.snappedToVertex_){f=g>m?c[1]:c[0];this.createOrUpdateVertexFeature_(f);var y={};y[T["c"](c)]=true;var _=void 0;for(var S=1,b=l.length;S<b;++S){_=l[S].segment;if(ca["e"](c[0],_[0])&&ca["e"](c[1],_[1])||ca["e"](c[0],_[1])&&ca["e"](c[1],_[0])){y[T["c"](_)]=true}else{break}}return}}}if(this.vertexFeature_){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}};ha.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=true;e.setCoordinates(t);this.changingFeature_=false};var pa=ha;var da=function e(t){var r=this;h["a"].assert(t.features);xe["b"].call(this,{handleDownEvent:this.handleDown_,handleDragEvent:this.handleDrag_,handleUpEvent:this.handleUp_});this.modified_=false;this.vectorPoints_=new ye["a"]({source:new _e["b"]({wrapX:!!t.wrapX}),visible:this.getActive(),style:t.style||Me.getDefaultModifyStyleFunction(),updateWhileAnimating:true,updateWhileInteracting:true});this.features_=t.features;this.feature_=null;this.cache_={};this.params_=null;D["a"](this.features_,"add",this.handleFeatureAdd_,this);D["a"](this.features_,"remove",this.handleFeatureRemove_,this);this.features_.forEach(function(e){r.addFeature_(e)})};T["d"](da,xe["b"]);da.prototype.setActive=function(e){xe["b"].prototype.setActive.call(this,e);if(this.vectorPoints_){this.vectorPoints_.setVisible(e)}};da.prototype.addFeature_=function(e){var t=e.getGeometry();if(t instanceof We["b"]){var r=T["c"](e);var a=this.cache_[r];if(a){return}var n=this.vectorPoints_.getSource();var i=t.getCoordinates()[0];while(i.length>4){if(i[0][0]<i[1][0]&&i[0][1]<=i[1][1]){i.pop()}else{i.shift()}}var o=[];var s=void 0;var l=void 0;i.forEach(function(t){s=new ke["a"](t);l=new Le["a"]({corner:true,geometry:s,siblingX:null,siblingY:null,boxFeature:e});o.push(l)},this);a={corners:o};this.cache_[r]=a;var u=void 0;var c=void 0;o.forEach(function(e,t){u=o[t-1];if(!u){u=o[o.length-1]}c=o[t+1];if(!c){c=o[0]}if(t%2===0){e.set("siblingX",c);e.set("siblingY",u)}else{e.set("siblingX",u);e.set("siblingY",c)}},this);n.addFeatures(o)}};da.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=true;var t=new C["a"]("modifystart",{features:this.features_});this.dispatchEvent(t);this.params_=this.initializeParams_()}};da.prototype.initializeParams_=function(){var e=this.feature_;var t=e.get("siblingX");h["a"].assertInstanceof(t,Le["a"]);var r=t.get("siblingY");h["a"].assertInstanceof(r,Le["a"]);var a=r.getGeometry();h["a"].assertInstanceof(a,ke["a"]);var n=a.getCoordinates();var i=this.getMap().getPixelFromCoordinate(n);var o=r.get("siblingX");h["a"].assertInstanceof(o,Le["a"]);var s=o.getGeometry();h["a"].assertInstanceof(s,ke["a"]);var l=s.getCoordinates();var u=this.getMap().getPixelFromCoordinate(l);var c=[u[0]-i[0],u[1]-i[1]];var f=Math.sqrt(c[0]*c[0]+c[1]*c[1]);c[0]/=f;c[1]/=f;var p=t.getGeometry();h["a"].assertInstanceof(p,ke["a"]);var d=p.getCoordinates();var g=this.getMap().getPixelFromCoordinate(d);var m=[g[0]-i[0],g[1]-i[1]];var v=Math.sqrt(m[0]*m[0]+m[1]*m[1]);m[0]/=v;m[1]/=v;if(isNaN(c[0])&&isNaN(m[0])){c=[0,1];m=[1,0]}else if(isNaN(c[0])){c=[m[1],-m[0]]}else if(isNaN(m[0])){m=[c[1],-c[0]]}return{originCoordinate:n,originPixel:i,siblingXPoint:s,siblingYPoint:p,vectorX:c,vectorY:m}};da.prototype.removeFeature_=function(e){var t=T["c"](e);var r=this.cache_[t];var a=r.corners;for(var n=0;n<a.length;n++){this.vectorPoints_.getSource().removeFeature(a[n])}this.feature_=null;a.length=0;delete this.cache_[t]};da.prototype.setMap=function(e){this.vectorPoints_.setMap(e);xe["b"].prototype.setMap.call(this,e)};da.prototype.handleFeatureAdd_=function(e){var t=e.element;h["a"].assertInstanceof(t,Le["a"],"feature should be an ol.Feature");this.addFeature_(t)};da.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)};da.prototype.handleDown_=function(e){var t=e.map;var r=t.forEachFeatureAtPixel(e.pixel,function(e){return e.get("siblingX")&&e.get("siblingY")?e:undefined});if(r){this.feature_=r;return true}return false};da.prototype.handleDrag_=function(e){this.willModifyFeatures_(e);var t=this.feature_;var r=t.getGeometry();if(r instanceof ke["a"]){r.setCoordinates(e.coordinate);var a=e.pixel;var n=this.params_.originPixel;var i=this.params_.siblingXPoint;var o=this.params_.siblingYPoint;var s=this.params_.vectorX;var l=this.params_.vectorY;var u=this.params_.originCoordinate;var c=this.calculateNewPixel_(n,a,s);var f=this.getMap().getCoordinateFromPixel(c);i.setCoordinates(f);var p=this.calculateNewPixel_(n,a,l);var d=this.getMap().getCoordinateFromPixel(p);o.setCoordinates(d);var g=t.get("boxFeature");var m=g.getGeometry();h["a"].assertInstanceof(m,We["b"]);m.setCoordinates([[e.coordinate,f,u,d,e.coordinate]])}};da.prototype.calculateNewPixel_=function(e,t,r){var a=[t[0]-e[0],t[1]-e[1]];var n=a[0]*r[0]+a[1]*r[1];var i=[r[0]*n,r[1]*n];return[i[0]+e[0],i[1]+e[1]]};da.prototype.handleUp_=function(e){if(this.modified_){var t=new C["a"]("modifyend",{features:this.features_});this.dispatchEvent(t);this.params_=null;this.modified_=false}return false};da.CacheItem;da.ModifyParams;var ga=da;var ma=r(36);var va=r(268);var ya=function e(t){h["a"].assert(t.features);this.features_=t.features;this.listenerKeys_=[];this.interactions_=[];this.otherFeatures_=new ma["b"];this.interactions_.push(new va["a"]({deleteCondition:oe["a"].deleteCondition,features:this.otherFeatures_,pixelTolerance:t.pixelTolerance,style:t.style,wrapX:t.wrapX}));this.circleFeatures_=new ma["b"];this.interactions_.push(new pa({features:this.circleFeatures_,pixelTolerance:t.pixelTolerance,style:t.style,wrapX:t.wrapX}));this.rectangleFeatures_=new ma["b"];this.interactions_.push(new ga({features:this.rectangleFeatures_,pixelTolerance:t.pixelTolerance,style:t.style,wrapX:t.wrapX}));ve["a"].call(this,{handleEvent:Ae["b"]})};T["d"](ya,ve["a"]);ya.prototype.setActive=function(e){ve["a"].prototype.setActive.call(this,e);this.setState_()};ya.prototype.setMap=function(e){var t=this.interactions_;var r=this.getMap();if(r){t.forEach(function(e){r.removeInteraction(e)})}ve["a"].prototype.setMap.call(this,e);if(e){t.forEach(function(t){e.addInteraction(t)})}this.setState_()};ya.prototype.setState_=function(){var e=this;var t=this.getMap();var r=this.getActive();var a=this.interactions_;var n=this.listenerKeys_;a.forEach(function(e){e.setActive(r&&!!t)});if(r&&t){this.features_.forEach(function(t){return e.addFeature_(t)});n.push(D["a"](this.features_,"add",this.handleFeaturesAdd_,this),D["a"](this.features_,"remove",this.handleFeaturesRemove_,this))}else{n.forEach(D["e"]);n.length=0;this.features_.forEach(function(t){return e.removeFeature_(t)})}};ya.prototype.handleFeaturesAdd_=function(e){var t=e.element;h["a"].assertInstanceof(t,Le["a"],"feature should be an ol.Feature");this.addFeature_(t)};ya.prototype.handleFeaturesRemove_=function(e){var t=e.element;this.removeFeature_(t)};ya.prototype.addFeature_=function(e){var t=this.getFeatureCollection_(e);t.push(e)};ya.prototype.removeFeature_=function(e){var t=this.getFeatureCollection_(e);t.remove(e)};ya.prototype.getFeatureCollection_=function(e){var t=void 0;var r=e.get(ce["a"].IS_CIRCLE);var a=e.get(ce["a"].IS_RECTANGLE);if(r===true||r==="true"){t=this.circleFeatures_}else if(a===true||a==="true"){t=this.rectangleFeatures_}else{t=this.otherFeatures_}return t};var _a=ya;var Sa=function e(t){h["a"].assert(t.features);this.listenerKeys_=[];this.modified_=false;this.keyPressListenerKey_=null;this.changingFeature_=false;this.pixelTolerance_=t.pixelTolerance!==undefined?t.pixelTolerance:10;this.features_=t.features;this.feature_=null;this.coordinate_=null;this.centerCoordinate_=null;this.overlay_=new ye["a"]({source:new _e["b"]({useSpatialIndex:false,wrapX:!!t.wrapX}),style:t.style||Me.getDefaultModifyStyleFunction(),updateWhileAnimating:true,updateWhileInteracting:true});this.centerFeatures_={};xe["b"].call(this,{handleDownEvent:this.handleDown_,handleDragEvent:this.handleDrag_,handleUpEvent:this.handleUp_})};T["d"](Sa,xe["b"]);Sa.prototype.setActive=function(e){var t=this;if(this.keyPressListenerKey_){D["e"](this.keyPressListenerKey_);this.keyPressListenerKey_=null}xe["b"].prototype.setActive.call(this,e);if(e){this.keyPressListenerKey_=D["a"](document,"keyup",this.handleKeyUp_,this);this.features_.forEach(function(e){return t.addFeature_(e)});this.listenerKeys_.push(D["a"](this.features_,"add",this.handleFeatureAdd_,this),D["a"](this.features_,"remove",this.handleFeatureRemove_,this))}else{this.listenerKeys_.forEach(D["e"]);this.listenerKeys_.length=0;this.features_.forEach(function(e){return t.removeFeature_(e)})}};Sa.prototype.addFeature_=function(e){var t=e.getGeometry();h["a"].assertInstanceof(t,ct["a"]);e.set("angle",0);var r=T["c"](e);var a=new ke["a"](this.getCenterCoordinate_(t));var n=new Le["a"](a);this.centerFeatures_[r]=n;this.overlay_.getSource().addFeature(n)};Sa.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=true;var t=new C["a"]("modifystart",{features:this.features_});this.dispatchEvent(t)}};Sa.prototype.removeFeature_=function(e){this.feature_=null;if(e){var t=T["c"](e);if(this.centerFeatures_[t]){this.overlay_.getSource().removeFeature(this.centerFeatures_[t]);delete this.centerFeatures_[t]}}};Sa.prototype.setMap=function(e){this.overlay_.setMap(e);xe["b"].prototype.setMap.call(this,e)};Sa.prototype.handleFeatureAdd_=function(e){var t=e.element;h["a"].assertInstanceof(t,Le["a"],"feature should be an ol.Feature");this.addFeature_(t)};Sa.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)};Sa.prototype.handleDown_=function(e){var t=e.map;var r=t.forEachFeatureAtPixel(e.pixel,function(e,t){return e},undefined);if(r){var a=false;this.features_.forEach(function(e){if(T["c"](e)==T["c"](r)){a=true}});if(!a){r=null}}if(r){this.coordinate_=e.coordinate;this.feature_=r;var n=this.feature_.getGeometry();if(n!==undefined){this.centerCoordinate_=this.getCenterCoordinate_(n)}return true}return false};Sa.prototype.getCenterCoordinate_=function(e){var t=void 0;if(e instanceof Re["a"]){t=e.getFlatMidpoint()}else if(e instanceof We["b"]){t=e.getFlatInteriorPoint()}else{var r=e.getExtent();t=je["x"](r)}return t};Sa.prototype.handleDrag_=function(e){this.willModifyFeatures_(e);var t=this.feature_.getGeometry();var r=this.coordinate_[0];var a=this.coordinate_[1];var n=this.centerCoordinate_[0];var i=this.centerCoordinate_[1];var o=r-n;var s=a-i;var l=e.coordinate[0]-n;var u=e.coordinate[1]-i;this.coordinate_[0]=e.coordinate[0];this.coordinate_[1]=e.coordinate[1];var c=Math.atan2(u,l);var f=Math.atan2(s,o);var h=f-c;t.rotate(-h,[n,i])};Sa.prototype.handleUp_=function(e){if(this.modified_){var t=new C["a"]("rotateend",{feature:this.feature_});this.dispatchEvent(t);this.modified_=false;this.setActive(false)}return false};Sa.prototype.handleKeyUp_=function(e){if(e.keyCode===27){this.setActive(false)}};var ba=Sa;var wa=r(188);var Ca=function e(t){this.listenerKeys_=[];this.featureListenerKeys_={};this.keyPressListenerKey_=null;this.myFeatures_=t.features!==undefined?t.features:null;this.vectorSource_=new _e["b"]({useSpatialIndex:false});this.vectorLayer_=new ye["a"]({source:this.vectorSource_,style:t.style,updateWhileAnimating:true,updateWhileInteracting:true});this.centerFeatures_={};wa["a"].call(this,t)};T["d"](Ca,wa["a"]);Ca.prototype.setActive=function(e){if(this.keyPressListenerKey_){D["e"](this.keyPressListenerKey_);this.keyPressListenerKey_=null}wa["a"].prototype.setActive.call(this,e);if(e){this.keyPressListenerKey_=D["a"](document,"keyup",this.handleKeyUp_,this)}this.setState_()};Ca.prototype.setMap=function(e){var t=this.getMap();if(t){this.vectorLayer_.setMap(null)}wa["a"].prototype.setMap.call(this,e);if(e){this.vectorLayer_.setMap(e)}this.setState_()};Ca.prototype.setState_=function(){var e=this;var t=this.getMap();var r=this.getActive();var a=this.myFeatures_;var n=this.listenerKeys_;if(t&&r&&a){a.forEach(function(t){return e.addFeature_(t)});n.push(D["a"](a,"add",this.handleFeaturesAdd_,this),D["a"](a,"remove",this.handleFeaturesRemove_,this))}else{if(t){var i=t.getTargetElement();i.style.cursor="default"}n.forEach(D["e"]);n.length=0;a.forEach(function(t){return e.removeFeature_(t)})}};Ca.prototype.handleFeaturesAdd_=function(e){var t=e.element;h["a"].assertInstanceof(t,Le["a"],"feature should be an ol.Feature");this.addFeature_(t)};Ca.prototype.handleFeaturesRemove_=function(e){var t=e.element;this.removeFeature_(t)};Ca.prototype.addFeature_=function(e){var t=T["c"](e);var r=e.getGeometry();h["a"].assertInstanceof(r,ct["a"]);this.featureListenerKeys_[t]=D["a"](r,"change",this.handleGeometryChange_.bind(this,e),this);var a=this.getGeometryCenterPoint_(r);var n=new Le["a"](a);this.centerFeatures_[t]=n;this.vectorSource_.addFeature(n)};Ca.prototype.removeFeature_=function(e){var t=T["c"](e);if(this.featureListenerKeys_[t]){D["e"](this.featureListenerKeys_[t]);delete this.featureListenerKeys_[t];this.vectorSource_.removeFeature(this.centerFeatures_[t]);delete this.centerFeatures_[t]}};Ca.prototype.handleGeometryChange_=function(e,t){var r=t.target;h["a"].assertInstanceof(r,ct["a"]);var a=this.getGeometryCenterPoint_(r);var n=T["c"](e);this.centerFeatures_[n].setGeometry(a)};Ca.prototype.getGeometryCenterPoint_=function(e){var t=void 0;var r=void 0;if(e instanceof We["b"]){r=e.getInteriorPoint()}else if(e instanceof Re["a"]){t=e.getCoordinateAt(.5)}else{var a=e.getExtent();t=je["x"](a)}if(!r&&t){r=new ke["a"](t)}h["a"].assert(r,"Point should be thruthy");return r};Ca.prototype.handleKeyUp_=function(e){if(e.keyCode===27){this.setActive(false)}};var Ta=Ca;var Ea=r(145);var Ma=r(208);var La=function e(t,r){this.getActive=function(){return t[r]};this.setActive=function(e){t[r]=e}};var Aa=La;var Fa=function e(t){this.groups_={};this.scope_=t};Fa.$inject=["$rootScope"];Fa.$inject=["$rootScope"];Fa.prototype.registerTool=function(e,t,r){var a=this;var n=this.groups_[e];if(!n){n=this.groups_[e]=[]}var i=this.scope_.$watch(t.getActive,function(r,n){if(r===n){return}if(r){a.deactivateTools_(e,t)}else{a.activateDefault_(e)}});n.push({tool:t,defaultTool:r||false,unlisten:i});if(h["a"].ENABLE_ASSERTS){var o=0;n.forEach(function(e){if(e.defaultTool){o++}});h["a"].assert(o<=1,"more than one default tool in group "+e)}};Fa.prototype.unregisterTool=function(e,t){var r=this.groups_[e];if(r){for(var a=0;a<r.length;a++){if(r[a].tool==t){r[a].unlisten();r.splice(a,1);break}}}};Fa.prototype.unregisterGroup=function(e){var t=this.groups_[e];if(t){for(var r=0;r<t.length;r++){t[r].unlisten()}delete this.groups_[e]}};Fa.prototype.activateTool=function(e){e.setActive(true)};Fa.prototype.deactivateTool=function(e){e.setActive(false)};Fa.prototype.deactivateTools_=function(e,t){var r=this.groups_[e];for(var a=0;a<r.length;a++){if(t!=r[a].tool){r[a].tool.setActive(false)}}};Fa.prototype.activateDefault_=function(e){var t=this.groups_[e];var r=null;var a=false;for(var n=0;n<t.length;n++){a=a||t[n].tool.getActive();if(t[n].defaultTool){r=t[n].tool}}if(!a&&r!==null){r.setActive(true)}};Fa.module=angular.module("ngeoToolActivateMgr",[]);Fa.module.service("ngeoToolActivateMgr",Fa);var Pa=Fa;function Ra(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var ka=angular.module("ngeoRule",[la.name,xt.module.name,Ea["a"].module.name,Ma["a"].name,Ze.module.name,Pa.module.name]);ka.run(["$templateCache",function(e){e.put("ngeo/filter/rulecomponent",r(335))}]);ka.value("ngeoRuleTemplateUrl",function(e){var t=e["ngeoRuleTemplateUrl"];return t!==undefined?t:"ngeo/filter/rulecomponent"});xa.$inject=["$attrs","ngeoRuleTemplateUrl"];function xa(e,t){return t(e)}ka.RuleController_=function(){e.$inject=["gettextCatalog","$scope","$timeout","ngeoFeatureHelper","ngeoRuleHelper","ngeoToolActivateMgr"];function e(t,r,a,n,i,o){var s,l;Ra(this,e);this.featureOverlay;this.map;this.rule;this.toolGroup;this.gettextCatalog_=t;this.scope_=r;this.timeout_=a;this.ngeoFeatureHelper_=n;this.ngeoRuleHelper_=i;this.ngeoToolActivateMgr_=o;this.clone;var u=at.OperatorType;var c=at.SpatialOperatorType;var f=at.TemporalOperatorType;this.operators=(s={},s[u.EQUAL_TO]=t.getString("Is equal to"),s[u.GREATER_THAN]=t.getString("Is greater than"),s[u.GREATER_THAN_OR_EQUAL_TO]=t.getString("Is greater than or equal to"),s[u.LESSER_THAN]=t.getString("Is lesser than"),s[u.LESSER_THAN_OR_EQUAL_TO]=t.getString("Is lesser than or equal to"),s[u.NOT_EQUAL_TO]=t.getString("Is not equal to"),s[u.LIKE]=t.getString("Contains"),s[c.CONTAINS]=t.getString("Contains"),s[c.INTERSECTS]=t.getString("Intersects"),s[c.WITHIN]=t.getString("Is inside of"),s[f.BEGINS]=t.getString("Begins at"),s[f.DURING]=t.getString("During"),s[f.ENDS]=t.getString("Ends at"),s[f.EQUALS]=t.getString("Is equal to"),s);this.operatorsShortFormat=(l={},l[u.EQUAL_TO]="=",l[u.GREATER_THAN]=">",l[u.GREATER_THAN_OR_EQUAL_TO]=">=",l[u.LESSER_THAN]="<",l[u.LESSER_THAN_OR_EQUAL_TO]="<=",l[u.NOT_EQUAL_TO]="!=",l[u.LIKE]="~",l[f.BEGINS]=">=",l[f.ENDS]="<=",l[f.EQUALS]="=",l);this.timeRangeMode={widget:"datepicker",maxValue:null,minValue:null,maxDefValue:this.createDate_(),minDefValue:this.createWeekAgoDate_(),mode:"range",interval:[0,1,0,0]};this.timeValueMode={widget:"datepicker",maxValue:null,minValue:null,maxDefValue:this.createDate_(),minDefValue:this.createDate_(),mode:"value",interval:[0,1,0,0]};this.toolActivate_;this.unlisteners_=[];this.drawActive=false;this.drawToolActivate=new Aa(this,"drawActive");this.drawnFeatures=new ma["b"];this.menu_=null;this.selectedFeatures=new ma["b"];this.interactions_=new ma["b"];this.modify_=new _a({features:this.selectedFeatures,style:n.getVertexStyle(false)});this.interactions_.push(this.modify_);this.rotate_=new ba({features:this.selectedFeatures,style:new we["c"]({text:new Qe["a"]({text:"",font:"normal 18px FontAwesome",fill:new Se["a"]({color:"#7a7a7a"})})})});this.interactions_.push(this.rotate_);this.translate_=new Ta({features:this.selectedFeatures,style:new we["c"]({text:new Qe["a"]({text:"",font:"normal 18px FontAwesome",fill:new Se["a"]({color:"#7a7a7a"})})})});this.interactions_.push(this.translate_);this.listenerKeys_=[];this.initializeInteractions_();this.modifyToolActivate=new Aa(this.modify_,"active");this.rotateToolActivate=new Aa(this.rotate_,"active");this.translateToolActivate=new Aa(this.translate_,"active");this.geomType=null}e.prototype.$onInit=function e(){var t=this;this.clone=this.ngeoRuleHelper_.cloneRule(this.rule);this.toolActivate_=new Aa(this.rule,"active");this.ngeoToolActivateMgr_.registerTool(this.toolGroup,this.toolActivate_);this.scope_.$watch(function(){return t.rule.active},this.handleActiveChange_.bind(this));if(this.clone.type===H["a"].DATE||this.clone.type===H["a"].DATETIME){this.unlisteners_.push(this.scope_.$watch(function(){return t.clone.getExpression()},function(e){t.timeValueMode.minValue=e}));this.unlisteners_.push(this.scope_.$watch(function(){return t.clone.lowerBoundary},function(e){t.timeRangeMode.minValue=e}));this.unlisteners_.push(this.scope_.$watch(function(){return t.clone.upperBoundary},function(e){t.timeRangeMode.maxValue=e}))}else if(this.clone.type===H["a"].GEOMETRY){this.unlisteners_.push(this.scope_.$watch(function(){return t.clone.operator},function(e){if(e&&e===at.SpatialOperatorType.CONTAINS){var r=h["a"].assertInstanceof(t.clone,mt);var a=r.feature.getGeometry();if(a){var n=t.ngeoFeatureHelper_.getType(r.feature);var i=[he.CIRCLE,he.POLYGON,he.RECTANGLE];if(!Ge["f"](i,n)){t.clone.setExpression(null)}}}}));this.unlisteners_.push(this.scope_.$watch(function(){return t.clone.expression},function(e){if(e){var r=h["a"].assertInstanceof(t.clone,mt);t.geomType=t.ngeoFeatureHelper_.getType(r.feature)}else{t.geomType=null}}));this.unlisteners_.push(this.scope_.$watch(function(){var e=t.clone.getExpression()!==null;var r=t.rule.active===true;var a=t.modify_.getActive()||t.rotate_.getActive()||t.translate_.getActive();return e&&r&&a},function(e){if(e){var r=h["a"].assertInstanceof(t.clone,mt);t.selectedFeatures.push(r.feature)}else{t.selectedFeatures.clear()}}))}};e.prototype.$onDestroy=function e(){if(this.rule.active){this.rule.active=false;this.handleActiveChange_(false,true)}this.ngeoToolActivateMgr_.unregisterTool(this.toolGroup,this.toolActivate_);for(var t=0,r=this.unlisteners_.length;t<r;t++){this.unlisteners_[t]()}this.unlisteners_.length=0;this.clone.destroy()};e.prototype.toggle=function e(){if(this.rule.active){this.cancel()}else{this.rule.active=true}};e.prototype.apply=function e(){this.ngeoRuleHelper_.extendRule(this.clone,this.rule);this.rule.active=false};e.prototype.cancel=function e(){this.ngeoRuleHelper_.extendRule(this.rule,this.clone);this.rule.active=false};e.prototype.reset=function e(){this.clone.reset();this.rule.reset()};e.prototype.toggleChoiceSelection=function e(t){var r=h["a"].assertInstanceof(this.clone,wt);var a=r.getExpression()?r.getExpression().split(","):[];var n=a.indexOf(t);if(n>-1){a.splice(n,1)}else{a.push(t)}r.setExpression(a.length?a.join(","):null)};e.prototype.onDateSelected=function e(t){this.clone.setExpression(t["start"])};e.prototype.onDateRangeSelected=function e(t){this.clone.lowerBoundary=t["start"];this.clone.upperBoundary=t["end"]};e.prototype.createDate_=function e(t){var r=new Date;if(t!==undefined){var a=r.getTime()-t;r.setTime(a)}return r.toISOString()};e.prototype.createWeekAgoDate_=function e(){return this.createDate_(1e3*60*60*24*7)};e.prototype.timeToDate=function e(t){var r=new Date(t);return r.toLocaleDateString()};e.prototype.handleActiveChange_=function e(t,r){if(!(this.rule instanceof mt)||!(this.clone instanceof mt)||t===r){return}var a=this.listenerKeys_;var n=["ngeo-rule-",T["c"](this)].join("-");var i=this.ngeoToolActivateMgr_;var o=this.rule.feature;var s=this.clone.feature;var l=this.map.getViewport();h["a"].assertElement(l);if(t){a.push(D["a"](this.drawnFeatures,"add",this.handleFeaturesAdd_,this));a.push(D["a"](l,"contextmenu",this.handleMapContextMenu_,this));a.push(D["a"](this.translate_,"translateend",this.handleTranslateEnd_,this));a.push(D["a"](this.rotate_,"rotateend",this.handleRotateEnd_,this));this.featureOverlay.removeFeature(o);this.featureOverlay.addFeature(s);this.registerInteractions_();i.registerTool(n,this.drawToolActivate,false);i.registerTool(n,this.modifyToolActivate,true);i.registerTool(n,this.rotateToolActivate,false);i.registerTool(n,this.translateToolActivate,false);this.modify_.setActive(true);if(s.getGeometry()){this.ngeoFeatureHelper_.setStyle(s,true)}}else{s.setStyle(null);a.forEach(D["e"]);a.length=0;this.drawActive=false;i.unregisterTool(n,this.drawToolActivate);i.unregisterTool(n,this.modifyToolActivate);i.unregisterTool(n,this.rotateToolActivate);i.unregisterTool(n,this.translateToolActivate);this.modify_.setActive(false);this.unregisterInteractions_();if(this.selectedFeatures.getLength()){this.featureOverlay.removeFeature(s)}this.featureOverlay.addFeature(o);this.selectedFeatures.clear()}};e.prototype.initializeInteractions_=function e(){this.interactions_.forEach(function(e){e.setActive(false);jr["a"].interaction(e)})};e.prototype.registerInteractions_=function e(){var t=this;this.interactions_.forEach(function(e){t.map.addInteraction(e)})};e.prototype.unregisterInteractions_=function e(){var t=this;this.interactions_.forEach(function(e){t.map.removeInteraction(e)})};e.prototype.handleFeaturesAdd_=function e(t){var r=this;this.timeout_(function(){var e=h["a"].assertInstanceof(r.clone,mt);var a=e.feature;var n=h["a"].assertInstanceof(t.element,Le["a"]);var i=h["a"].assertInstanceof(n.getGeometry(),ct["a"]);e.geometry=i;r.drawActive=false;var o=r.ngeoFeatureHelper_.getNonSpatialProperties(n);r.ngeoFeatureHelper_.clearNonSpatialProperties(a);a.setProperties(o);r.ngeoFeatureHelper_.setStyle(a,true);r.scope_.$apply()})};e.prototype.getRuleGeometryType=function e(){var t=h["a"].assertInstanceof(this.rule,mt);return this.ngeoFeatureHelper_.getType(t.feature)};e.prototype.handleMapContextMenu_=function e(t){var r=this;this.removeMenu_();var a=this.map.getEventPixel(t);var n=this.map.getCoordinateFromPixel(a);var i=this.map.forEachFeatureAtPixel(a,function(e){var t=false;if(Ge["f"](r.selectedFeatures.getArray(),e)){t=e}return t});i=i?i:null;var o=[];if(i){var s=this.ngeoFeatureHelper_.getType(i);var l=this.gettextCatalog_;if(s==he.CIRCLE||s==he.LINE_STRING||s==he.POLYGON||s==he.RECTANGLE){o.push({cls:"fa fa-arrows",label:l.getString("Move"),name:"move"})}if(s==he.LINE_STRING||s==he.POLYGON||s==he.RECTANGLE){o.push({cls:"fa fa-rotate-right",label:l.getString("Rotate"),name:"rotate"})}}if(o.length){this.menu_=new Ir["a"]({actions:o});D["a"](this.menu_,"actionclick",this.handleMenuActionClick_,this);this.map.addOverlay(this.menu_);this.menu_.open(n);t.preventDefault();t.stopPropagation();this.scope_.$apply()}};e.prototype.removeMenu_=function e(){if(this.menu_){D["c"](this.menu_,"actionclick",this.handleMenuActionClick_,this);this.map.removeOverlay(this.menu_);this.menu_=null}};e.prototype.handleMenuActionClick_=function e(t){var r=t.detail.action;switch(r){case"move":this.translate_.setActive(true);this.scope_.$apply();break;case"rotate":this.rotate_.setActive(true);this.scope_.$apply();break;default:console.log("FIXME - support: "+r);break}};e.prototype.handleRotateEnd_=function e(t){this.rotate_.setActive(false);this.scope_.$apply()};e.prototype.handleTranslateEnd_=function e(t){this.translate_.setActive(false);this.scope_.$apply()};return e}();ka.component("ngeoRule",{bindings:{featureOverlay:"<",map:"<",rule:"<",toolGroup:"<"},controller:ka.RuleController_,templateUrl:xa});var Da=ka;function Oa(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var $a=angular.module("ngeoFilter",[xt.module.name,Da.name,Ea["a"].module.name,$r.module.name]);$a.run(["$templateCache",function(e){e.put("ngeo/filter",r(334))}]);$a.value("ngeoFilterTemplateUrl",function(e){var t=e["ngeoFilterTemplateUrl"];return t!==undefined?t:"ngeo/filter"});Ia.$inject=["$attrs","ngeoFilterTemplateUrl"];function Ia(e,t){return t(e)}$a.component("ngeoFilter",{bindings:{aRuleIsActive:"=",customRules:"<",datasource:"<",directedRules:"<",featureOverlay:"<",map:"<",toolGroup:"<"},controller:"ngeoFilterController",templateUrl:Ia});$a.FilterController_=function(){e.$inject=["gettextCatalog","$scope","$timeout","ngeoMapQuerent","ngeoRuleHelper"];function e(t,r,a,n,i){Oa(this,e);this.aRuleIsActive;this.customRules;this.datasource;this.directedRules;this.featureOverlay;this.map;this.toolGroup;this.gettextCatalog_=t;this.scope_=r;this.timeout_=a;this.ngeoMapQuerent_=n;this.ngeoRuleHelper_=i;this.conditions=[{text:t.getString("All"),value:te["a"].AND},{text:t.getString("At least one"),value:te["a"].OR},{text:t.getString("None"),value:te["a"].NOT}];this.geometryAttributes=[];this.otherAttributes=[];this.ruleUnlisteners_={}}e.prototype.$onInit=function e(){var t=this;this.scope_.$watch(function(){return t.aRuleIsActive},this.handleARuleIsActiveChange_.bind(this));var r=h["a"].assert(this.datasource.attributes);for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.type===H["a"].GEOMETRY){this.geometryAttributes.push(s)}else{this.otherAttributes.push(s)}}var l=[].concat(this.customRules,this.directedRules);for(var u=l,c=Array.isArray(u),f=0,u=c?u:u[Symbol.iterator]();;){var p;if(c){if(f>=u.length)break;p=u[f++]}else{f=u.next();if(f.done)break;p=f.value}var d=p;this.registerRule_(d)}this.apply()};e.prototype.$onDestroy=function e(){if(this.datasource.filterRules!==null){this.datasource.filterRules=null}this.featureOverlay.clear()};e.prototype.hasARule=function e(){return[].concat(this.customRules,this.directedRules).length>0};e.prototype.apply=function e(){var t=this;this.datasource.filterRules=null;this.timeout_(function(){var e=t.getRulesWithValue_();if(e.length){t.datasource.filterRules=e;t.ngeoMapQuerent_.clear()}})};e.prototype.getData=function e(){var t=this.getRulesWithValue_();if(!t.length){return}var r=this.datasource;var a=1e3;var n=this.map;var i=n.getView().getProjection().getCode();var o=this.ngeoRuleHelper_.createFilter({dataSource:r,filterRules:t,srsName:i});h["a"].assert(o);this.ngeoMapQuerent_.issue({dataSources:[r],filter:o,limit:a,map:n})};e.prototype.getRulesWithValue_=function e(){var t=[];var r=[].concat(this.customRules,this.directedRules);for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.value){t.push(s)}}return t};e.prototype.createAndAddCustomRule=function e(t){var r=this.ngeoRuleHelper_.createRuleFromAttribute(t,true);this.registerRule_(r);this.customRules.push(r);this.timeout_(function(){r.active=true},1)};e.prototype.setCondition=function e(t){if(this.datasource.filterCondition!==t.value){this.datasource.filterCondition=t.value}};e.prototype.removeCustomRule=function e(t){var r=this;t.active=false;this.timeout_(function(){Ge["j"](r.customRules,t);r.unregisterRule_(t);t.destroy()})};e.prototype.registerRule_=function e(t){var r=T["c"](t);this.ruleUnlisteners_[r]=this.scope_.$watch(function(){return t.active},this.handleRuleActiveChange_.bind(this));if(t instanceof mt){this.featureOverlay.addFeature(t.feature)}};e.prototype.unregisterRule_=function e(t){var r=T["c"](t);var a=this.ruleUnlisteners_[r];h["a"].assert(a);a();delete this.ruleUnlisteners_[r];if(t instanceof mt){this.featureOverlay.removeFeature(t.feature)}};e.prototype.handleRuleActiveChange_=function e(){var t=false;var r=[].concat(this.customRules,this.directedRules);for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.active){t=true;break}}this.aRuleIsActive=t};e.prototype.handleARuleIsActiveChange_=function e(){if(this.aRuleIsActive){return}var t=[].concat(this.customRules,this.directedRules);for(var r=t,a=Array.isArray(r),n=0,r=a?r:r[Symbol.iterator]();;){var i;if(a){if(n>=r.length)break;i=r[n++]}else{n=r.next();if(n.done)break;i=n.value}var o=i;if(o.active){o.active=false;break}}};return e}();$a.controller("ngeoFilterController",$a.FilterController_);var Na=$a;var Ga=r(88);var Ua=r(157);function ja(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Va=angular.module("gmfFilterselector",[s["a"].module.name,N["a"].module.name,Xt.module.name,Ga["a"].module.name,u["a"].module.name,g.name,xt.module.name,Na.name,xr.module.name]);Va.run(["$templateCache",function(e){e.put("gmf/filters/filterselectorcomponent",r(333))}]);Va.value("gmfFilterselectorTemplateUrl",function(e){var t=e["gmfFilterselectorTemplateUrl"];return t!==undefined?t:"gmf/filters/filterselectorcomponent"});Ba.$inject=["$attrs","gmfFilterselectorTemplateUrl"];function Ba(e,t){return t(e)}Va.Controller_=function(){e.$inject=["$scope","$timeout","gettextCatalog","gmfDataSourceBeingFiltered","gmfDataSourcesHelper","gmfSavedFilters","gmfUser","ngeoNotification","ngeoFeatureOverlayMgr","ngeoRuleHelper"];function e(t,r,a,n,i,o,s,l,u,c){var f=this;ja(this,e);this.active;t.$watch(function(){return f.active},this.handleActiveChange_.bind(this));this.map;this.toolGroup;this.timeout_=r;this.gettextCatalog_=a;this.gmfDataSourceBeingFiltered=n;t.$watch(function(){return f.gmfDataSourceBeingFiltered.dataSource},this.handleSelectedDataSourceChange_.bind(this));this.gmfDataSourcesHelper_=i;this.gmfSavedFilters=o;t.$watchCollection(function(){return f.gmfSavedFilters.currentDataSourceItems},function(){if(f.gmfSavedFilters.currentDataSourceItems.length===0&&f.saveFilterManageModalShown){f.saveFilterManageModalShown=false}});this.gmfUser_=s;t.$watch(function(){return f.gmfUser_.functionalities},this.handleGmfUserFunctionalitiesChange_.bind(this));this.ngeoNotification_=l;this.featureOverlay=h["a"].assert(u.getFeatureOverlay());this.ngeoRuleHelper_=c;this.aRuleIsActive=false;this.customRules=null;this.directedRules=null;this.filtrableDataSources=[];this.filtrableLayerNodeNames_=null;this.gmfDataSources_=i.collection;this.listenerKeys_=[];this.readyDataSource=null;this.ruleCache_={};this.saveFilterSaveModalShown=false;t.$watch(function(){return f.saveFilterSaveModalShown},function(){f.saveFilterName=""});this.saveFilterName="";this.saveFilterManageModalShown=false;this.enableDataSourceRegistration_=false;t.$watch(function(){return f.enableDataSourceRegistration_},this.handleEnableDataSourceRegistrationChange_.bind(this));this.defaultFiltrableDataSourceName_;this.toggleDataSourceRegistration_()}e.prototype.handleGmfUserFunctionalitiesChange_=function e(){var t=this.gmfUser_.functionalities;if(t&&t["filterable_layers"]){this.filtrableLayerNodeNames_=t["filterable_layers"]}else{this.filtrableLayerNodeNames_=null}if(t&&t["preset_layer_filter"]&&t["preset_layer_filter"][0]){this.defaultFiltrableDataSourceName_=t["preset_layer_filter"][0]}else{this.defaultFiltrableDataSourceName_=undefined}this.toggleDataSourceRegistration_()};e.prototype.toggleDataSourceRegistration_=function e(){var t=!!this.filtrableLayerNodeNames_;if(this.enableDataSourceRegistration_!==t){this.enableDataSourceRegistration_=t}};e.prototype.handleActiveChange_=function e(t){var r=this;if(!t){this.aRuleIsActive=false;this.timeout_(function(){r.gmfDataSourceBeingFiltered.dataSource=null})}};e.prototype.handleEnableDataSourceRegistrationChange_=function e(t){var r=this.listenerKeys_;if(t){r.push(D["a"](this.gmfDataSources_,"add",this.handleDataSourcesAdd_,this),D["a"](this.gmfDataSources_,"remove",this.handleDataSourcesRemove_,this));this.gmfDataSources_.forEach(this.registerDataSource_,this)}else{r.forEach(D["e"]);r.length=0;this.filtrableDataSources.length=0}};e.prototype.handleDataSourcesAdd_=function e(t){var r=t.element;if(r instanceof ar){this.registerDataSource_(r)}};e.prototype.handleDataSourcesRemove_=function e(t){var r=t.element;if(r instanceof ar){this.unregisterDataSource_(r)}};e.prototype.registerDataSource_=function e(t){if(t.filtrable===null){t.filtrable=this.isDataSourceFiltrable_(t)}if(t.filtrable){this.filtrableDataSources.push(t);if(this.defaultFiltrableDataSourceName_!==undefined&&t.name===this.defaultFiltrableDataSourceName_){this.gmfDataSourceBeingFiltered.dataSource=t}}};e.prototype.unregisterDataSource_=function e(t){if(t.filtrable){Ge["j"](this.filtrableDataSources,t);if(this.gmfDataSourceBeingFiltered.dataSource===t){this.gmfDataSourceBeingFiltered.dataSource=null}}};e.prototype.isDataSourceFiltrable_=function e(t,r){var a=true;var n=this.gettextCatalog_;var i=r!==false;var o=h["a"].assert(this.filtrableLayerNodeNames_);var s=[];if(Ge["f"](o,t.name)){if(!t.supportsWFS){s.push(n.getString("The data source doesn't support WFS, which is required "+"to fetch the attributes to build the filter rules."))}if(!t.ogcLayers||!t.ogcLayers.length){s.push(n.getString("The data source must have only 1 ogcLayer defined."))}else if(!t.ogcLayers[0].queryable){s.push(n.getString("The ogcLayer within the data source must be queryable."))}a=!s.length;if(i&&!a){var u=n.getString("The following data source is marked as being filtrable,\n          but is missing some requirements: ");var c=t.name+" ("+t.id+").";var f=n.getString("Please, contact your administrator about this.\n          Here are the reasons: ");s.unshift(u+" "+c+" "+f);console.warn(s.join(" "));this.ngeoNotification_.notify({msg:s.join(" "),type:l["a"].Type.WARNING})}}else{a=false}return a};e.prototype.handleSelectedDataSourceChange_=function e(t){var r=this;this.aRuleIsActive=false;this.customRules=null;this.directedRules=null;this.readyDataSource=null;this.gmfSavedFilters.currentDataSourceId=null;if(!t){return}if(!this.active){this.active=true}this.gmfDataSourcesHelper_.prepareFiltrableDataSource(t).then(function(e){var t=r.getRuleCacheItem_(e);if(!t){t={customRules:[],directedRules:[]};r.setRuleCacheItem_(e,t);if(e.gmfLayer.metadata&&e.gmfLayer.metadata.directedFilterAttributes&&e.gmfLayer.metadata.directedFilterAttributes.length){var a=e.gmfLayer.metadata.directedFilterAttributes;var n=h["a"].assert(e.attributes);for(var i=n,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;if(Ge["f"](a,u.name)){t.directedRules.push(r.ngeoRuleHelper_.createRuleFromAttribute(u))}}}}r.customRules=t.customRules;r.directedRules=t.directedRules;r.readyDataSource=e;r.gmfSavedFilters.currentDataSourceId=e.id})};e.prototype.getRuleCacheItem_=function e(t){return this.ruleCache_[t.id]||null};e.prototype.setRuleCacheItem_=function e(t,r){this.ruleCache_[t.id]=r};e.prototype.saveFilterShowModal=function e(){this.saveFilterSaveModalShown=true};e.prototype.saveFilterSave=function e(){var t=this.saveFilterName;var r=h["a"].assert(this.readyDataSource);var a=r.id;var n=this.gmfSavedFilters.indexOfItem(t,a)!==-1;var i=r.filterCondition;var o=this.gettextCatalog_.getString("A filter with the same name already exists.\n      Do you want to overwrite it?");if(!n||confirm(o)){var s=this.customRules?this.ngeoRuleHelper_.serializeRules(this.customRules):[];var l=this.directedRules?this.ngeoRuleHelper_.serializeRules(this.directedRules):[];var u={condition:i,customRules:s,dataSourceId:a,directedRules:l,name:t};this.gmfSavedFilters.save(u);this.saveFilterSaveModalShown=false}};e.prototype.saveFilterLoadItem=function e(t){var r=this;var a=h["a"].assert(this.readyDataSource);this.customRules=null;this.directedRules=null;var n=this.ngeoRuleHelper_.createRules(t.customRules);var i=this.ngeoRuleHelper_.createRules(t.directedRules);this.timeout_(function(){r.customRules=n;r.directedRules=i;a.filterCondition=t.condition;var e=h["a"].assert(r.getRuleCacheItem_(a));e.customRules=n;e.directedRules=i})};e.prototype.saveFilterManage=function e(){this.saveFilterManageModalShown=true};e.prototype.saveFilterRemoveItem=function e(t){this.gmfSavedFilters.remove(t)};return e}();Va.Controller_.RuleCache;Va.Controller_.RuleCacheItem;Va.component("gmfFilterselector",{bindings:{active:"=",map:"<",toolGroup:"<"},controller:Va.Controller_,templateUrl:Ba});var Wa=Va;var Ha=angular.module("gmfFiltersModule",[Wa.name,xr.module.name]);var qa=Ha;var Ka=r(267);var Ya=r(205);var za=r(329);var Qa=r(328);var Xa=r(377);var Za=angular.module("gmfLayertreeTimeSliderComponent",[Je["a"].module.name,"ui.slider"]);Za.run(["$templateCache",function(e){e.put("gmf/layertree/timesliderComponent",r(326))}]);Za.directive_=function(e,t){return{scope:{onDateSelected:"&gmfTimeSliderOnDateSelected",time:"=gmfTimeSliderTime"},bindToController:true,controller:"gmfTimeSliderController as sliderCtrl",restrict:"AE",templateUrl:"gmf/layertree/timesliderComponent",link:{pre:function e(t,r,a,n){n.init();n.sliderOptions["stop"]=i;n.sliderOptions["slide"]=o;function i(e,r){n.onDateSelected({time:o(e,r)});t.$apply()}function o(e,r){var a=void 0,i=void 0,o=void 0;if(r.values){a=new Date(n.getClosestValue_(r.values[0]));i=new Date(n.getClosestValue_(r.values[1]));n.dates=[a,i];o={start:a.getTime(),end:i.getTime()}}else{a=new Date(n.getClosestValue_(r.value));n.dates=a;o={start:a.getTime()}}t.$apply();return o}}}}};Za.directive_.$inject=["$timeout","$filter"];Za.directive("gmfTimeSlider",Za.directive_);Za.Controller_=function(e,t){this.ngeoWMSTime_=t;this.onDateSelected;this.time;this.isModeRange;this.minValue;this.maxValue;this.timeValueList;this.sliderOptions;this.dates};Za.Controller_.$inject=["$scope","ngeoWMSTime"];Za.Controller_.prototype.init=function(){this.timeValueList=this.getTimeValueList_();var e=this.ngeoWMSTime_.getOptions(this.time);this.isModeRange=this.time.mode==="range";this.minValue=e.minDate;this.maxValue=e.maxDate;this.dates=this.isModeRange?[e.values[0],e.values[1]]:e.values;this.sliderOptions={range:this.isModeRange,min:this.minValue,max:this.maxValue}};Za.Controller_.prototype.getTimeValueList_=function(){var e=this.time;var t=null;var r=new Date(this.minValue);var a=new Date(this.maxValue);if(e.values){t=[];e.values.forEach(function(e){t.push(new Date(e).getTime())})}else{var n=1024;var i=new Date(r.getTime());i.setFullYear(r.getFullYear()+n*e.interval[0]);i.setMonth(r.getMonth()+n*e.interval[1],r.getDate()+n*e.interval[2]);i.setSeconds(r.getSeconds()+n*e.interval[3]);if(i>a){t=[];for(var o=0;;o++){var s=new Date(r.getTime());s.setFullYear(r.getFullYear()+o*e.interval[0]);s.setMonth(r.getMonth()+o*e.interval[1],r.getDate()+o*e.interval[2]);s.setSeconds(r.getSeconds()+o*e.interval[3]);if(s<=a){t.push(s.getTime())}else{break}}}}return t};Za.Controller_.prototype.getClosestValue_=function(e){if(e<=this.minValue){return this.minValue}if(e>=this.maxValue){return this.maxValue}if(this.timeValueList){var t=void 0;var r=0;var a=this.timeValueList.length-1;while(a-r>1){t=Math.floor((r+a)/2);if(this.timeValueList[t]>=e){a=t}else{r=t}}var n=Math.abs(this.timeValueList[r]-e);var i=Math.abs(this.timeValueList[a]-e);return this.timeValueList[n<i?r:a]}else{var o=new Date(e);var s=new Date(this.minValue);var l=new Date(this.minValue);var u=new Date(this.maxValue);var c=Math.abs(o-l);for(var f=1;;f++){var h=new Date(s.getTime());h.setFullYear(s.getFullYear()+f*this.time.interval[0]);h.setMonth(s.getMonth()+f*this.time.interval[1],s.getDate()+f*this.time.interval[2]);h.setSeconds(s.getSeconds()+f*this.time.interval[3]);if(h>u){break}var p=Math.abs(o-h);if(p<=c){l=h;c=p}else{break}}return l.getTime()}};Za.Controller_.prototype.getLocalizedDate=function(e){return this.ngeoWMSTime_.formatTimeValue(e,this.time.resolution)};Za.controller("gmfTimeSliderController",Za.Controller_);var Ja=Za;var en=r(376);var tn=angular.module("gmfLayertreeModule",[Ka["a"].name,Ya["a"].name,sr["a"].module.name,Ja.name,lr["a"].module.name]);var rn=tn;var an=r(207);var nn=r(165);var on=r(161);function sn(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var ln=angular.module("gmfPermalinkShareComponent",[nn["a"].module.name,on["a"].module.name]);ln.run(["$templateCache",function(e){e.put("gmf/permalink/shareComponent",r(325))}]);ln.value("gmfPermalinkShareTemplateUrl",function(e){var t=e["gmfPermalinkShareTemplateUrl"];return t!==undefined?t:"gmf/permalink/shareComponent"});un.$inject=["$attrs","gmfPermalinkShareTemplateUrl"];function un(e,t){return t(e)}ln.component_={bindings:{enableEmail:"<gmfShareEmail"},controller:"GmfShareController",templateUrl:un};ln.component("gmfShare",ln.component_);var cn=function(){e.$inject=["$scope","ngeoLocation","gmfShareService","$q","$attrs"];function e(t,r,a,n,i){sn(this,e);this.$scope_=t;this.gmfShareService_=a;this.$q_=n;this.ngeoLocation_=r;this.enableEmail;this.shortLink;this.email;this.message;this.permalink_=this.ngeoLocation_.getUriString();this.showLengthWarning=this.permalink_.length>nn["a"].URL_MAX_LEN||r.getPath()>nn["a"].URL_PATH_MAX_LEN;this.successfullySent=false;this.errorOnsend=false;this.errorOnGetShortUrl=false;this.getShortUrl()}e.prototype.getShortUrl=function e(){var t=this;this.$q_.when(this.gmfShareService_.getShortUrl(this.permalink_)).then(function(e){t.shortLink=e.data.short_url;t.errorOnGetShortUrl=false},function(e){t.shortLink=t.permalink;t.errorOnGetShortUrl=true})};e.prototype.sendShortUrl=function e(){var t=this;if(this.$scope_["gmfShareForm"].$valid){this.$q_.when(this.gmfShareService_.sendShortUrl(this.permalink_,this.email,this.message)).then(function(e){t.successfullySent=true},function(e){t.errorOnsend=true})}};return e}();ln.controller("GmfShareController",cn);var fn=ln;var hn=r(375);var pn=angular.module("gmfPermalinkModule",[an["a"].module.name,nn["a"].module.name,fn.name]);var dn=pn;var gn=r(75);var mn=r(262);var vn=function e(t,r,a,n,i,o){this.http_=t;this.q_=r;this.rootScope_=a;this.timeout_=n;this.gmfThemes_=i;this.gmfTreeManager_=o;this.cache_={};this.listenerKeys_=[];this.map_=null;this.mapViewChangePromise_=null;this.ogcServers_=null};vn.$inject=["$http","$q","$rootScope","$timeout","gmfThemes","gmfTreeManager"];vn.$inject=["$http","$q","$rootScope","$timeout","gmfThemes","gmfTreeManager"];vn.prototype.ensureSnapInteractionsOnTop=function(){var e=this.map_;h["a"].assert(e);var t=void 0;for(var r in this.cache_){t=this.cache_[+r];if(t.active){h["a"].assert(t.interaction);e.removeInteraction(t.interaction);e.addInteraction(t.interaction)}}};vn.prototype.setMap=function(e){var t=this;var r=this.listenerKeys_;if(this.map_){this.treeCtrlsUnregister_();this.unregisterAllTreeCtrl_();r.forEach(D["e"]);r.length=0}this.map_=e;if(e){this.treeCtrlsUnregister_=this.rootScope_.$watchCollection(function(){if(t.gmfTreeManager_.rootCtrl){return t.gmfTreeManager_.rootCtrl.children}},function(e){t.timeout_(function(){if(e){t.unregisterAllTreeCtrl_();t.gmfTreeManager_.rootCtrl.traverseDepthFirst(t.registerTreeCtrl_.bind(t))}},0)});r.push(D["a"](this.gmfThemes_,"change",this.handleThemesChange_,this),D["a"](e,"moveend",this.handleMapMoveEnd_,this))}};vn.prototype.handleThemesChange_=function(){var e=this;this.ogcServers_=null;this.gmfThemes_.getOgcServersObject().then(function(t){e.ogcServers_=t})};vn.prototype.registerTreeCtrl_=function(e){var t=e.node;if(t.children){return}t=e.node;var r=w["a"].getSnappingConfig(t);if(r){var a=this.getWFSConfig_(e);if(a){var n=T["c"](e);var i=this.rootScope_.$watch(function(){return e.getState()},this.handleTreeCtrlStateChange_.bind(this,e));this.cache_[n]={active:false,featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",features:new ma["b"],geometryName:"geom",interaction:null,maxFeatures:50,requestDeferred:null,snappingConfig:r,treeCtrl:e,wfsConfig:a,stateWatcherUnregister:i};this.handleTreeCtrlStateChange_(e,e.getState())}}};vn.prototype.unregisterAllTreeCtrl_=function(){for(var e in this.cache_){var t=this.cache_[+e];if(t){t.stateWatcherUnregister();this.deactivateItem_(t);delete this.cache_[+e]}}};vn.prototype.getWFSConfig_=function(e){if(this.ogcServers_===null){return null}var t=e.node;if(t.type!==w["a"].NodeType.WMS){return null}var r=t;var a=[];for(var n=0,i=r.childLayers.length;n<i;n++){if(r.childLayers[n].queryable){a.push(r.childLayers[n].name)}}if(!a.length){return null}var o=void 0;var s=e.parent.node;if(s.mixed){o=r.ogcServer}else{var l=gn["a"].getFirstParentTree(e);var u=l.node;o=u.ogcServer}if(!o){return null}var c=this.ogcServers_[o];if(!c.wfsSupport){return null}var f=c.urlWfs;h["a"].assert(f,"urlWfs should be defined.");return{featureTypes:a.join(","),url:f}};vn.prototype.handleTreeCtrlStateChange_=function(e,t){var r=T["c"](e);var a=this.cache_[r];if(t==="on"){this.activateItem_(a)}else{this.deactivateItem_(a)}};vn.prototype.activateItem_=function(e){if(e.active){return}var t=this.map_;h["a"].assert(t);var r=new mn["a"]({edge:e.snappingConfig.edge,features:e.features,pixelTolerance:e.snappingConfig.tolerance,vertex:e.snappingConfig.vertex});t.addInteraction(r);e.interaction=r;e.active=true;this.loadItemFeatures_(e)};vn.prototype.deactivateItem_=function(e){if(!e.active){return}var t=this.map_;h["a"].assert(t);var r=e.interaction;t.removeInteraction(r);e.interaction=null;e.features.clear();if(e.requestDeferred){e.requestDeferred.resolve();e.requestDeferred=null}e.active=false};vn.prototype.loadAllItems_=function(){this.mapViewChangePromise_=null;var e=void 0;for(var t in this.cache_){e=this.cache_[+t];if(e.active){this.loadItemFeatures_(e)}}};vn.prototype.refresh=function(){this.loadAllItems_()};vn.prototype.loadItemFeatures_=function(e){if(e.requestDeferred){e.requestDeferred.resolve()}var t=this.map_;h["a"].assert(t);var r=t.getView();var a=t.getSize();h["a"].assert(a);var n=r.calculateExtent(a);var i=r.getProjection().getCode();var o=e.wfsConfig.featureTypes.split(",");var s={srsName:i,featureNS:e.featureNS,featurePrefix:e.featurePrefix,featureTypes:o,outputFormat:"GML3",bbox:n,geometryName:e.geometryName,maxFeatures:e.maxFeatures};var l=new At["a"];var u=new XMLSerializer;var c=l.writeGetFeature(s);var f=u.serializeToString(c);var p=e.wfsConfig.url;e.requestDeferred=this.q_.defer();this.http_.post(p,f,{timeout:e.requestDeferred.promise}).then(function(t){e.requestDeferred=null;e.features.clear();var r=(new At["a"]).readFeatures(t.data);if(r){e.features.extend(r)}})};vn.prototype.handleMapMoveEnd_=function(){if(this.mapViewChangePromise_){this.timeout_.cancel(this.mapViewChangePromise_)}this.mapViewChangePromise_=this.timeout_(this.loadAllItems_.bind(this),400)};vn.Cache;vn.CacheItem;vn.WFSConfig;vn.module=angular.module("gmfSnapping",[lr["a"].module.name,w["a"].module.name,gn["a"].module.name]);vn.module.service("gmfSnapping",vn);var yn=vn;var _n=r(123);var Sn=angular.module("ngeoMap",[]);Sn.directive_=function(e){return{restrict:"A",link:function t(r,a,n){var i="ngeoMap";var o=n[i];var s=r.$eval(o);h["a"].assertInstanceof(s,_n["a"]);s.setTarget(a[0]);var l="ngeoMapManageResize";var u=n[l];var c=r.$eval(u);if(c){var f="ngeoMapResizeTransition";var p=n[f];var d=r.$eval(p);D["a"](e,"resize",function(){if(d){var t=Date.now();var r=true;var a=function a(){s.updateSize();s.renderSync();if(r){e.requestAnimationFrame(a)}if(Date.now()-t>d){r=false}};a()}else{s.updateSize()}})}}}};Sn.directive_.$inject=["$window"];Sn.directive("ngeoMap",Sn.directive_);var bn=Sn;var wn=r(260);var Cn=angular.module("ngeoResizemap",[]);Cn.directive_=function(e){var t=1e3;return{restrict:"A",link:function r(a,n,i){var o="ngeoResizemap";var s=i[o];var l=a.$eval(s);h["a"].assertInstanceof(l,_n["a"]);var u=i["ngeoResizemapState"];h["a"].assert(u!==undefined);var c=void 0;var f=void 0;var p=function r(){l.updateSize();l.renderSync();if(Date.now()-c<t){f=e.requestAnimationFrame(r)}};n.on("transitionend",function(){l.updateSize();l.renderSync()});a.$watch(u,function(t,r){if(t!=r){c=Date.now();e.cancelAnimationFrame(f);f=e.requestAnimationFrame(p)}})}}};Cn.directive_.$inject=["$window"];Cn.directive("ngeoResizemap",Cn.directive_);var Tn=Cn;var En=angular.module("ngeoScaleselector",[]);En.value("ngeoScaleselectorTemplateUrl",function(e,t){var r=t["ngeoScaleselectorTemplateurl"];return r!==undefined?r:"ngeo/map/scaleselector"});En.run(["$templateCache",function(e){e.put("ngeo/map/scaleselector",r(316))}]);var Mn=function e(t){return{restrict:"A",scope:true,controller:"NgeoScaleselectorController",templateUrl:t}};Mn.$inject=["ngeoScaleselectorTemplateUrl"];Mn.$inject=["ngeoScaleselectorTemplateUrl"];En.directive("ngeoScaleselector",Mn);var Ln=function e(t,r,a){var n=this;var i=a["ngeoScaleselector"];this.scales=t.$eval(i);h["a"].assert(this.scales!==undefined);this.zoomLevels;t.$watch(function(){return Object.keys(n.scales).length},function(e){n.zoomLevels=Object.keys(n.scales).map(Number);n.zoomLevels.sort(Ge["i"])});var o=a["ngeoScaleselectorMap"];this.map_=t.$eval(o);h["a"].assertInstanceof(this.map_,_n["a"]);var s=a["ngeoScaleselectorOptions"];var l=t.$eval(s);this.options=e.getOptions_(l);this.$scope_=t;this.resolutionChangeKey_=null;this.currentScale=undefined;var u=this.map_.getView();if(u!==null){var c=this.map_.getView().getZoom();if(c!==undefined){this.currentScale=this.getScale(c)}}D["a"](this.map_,"change:view",this.handleViewChange_,this);this.registerResolutionChangeListener_();t["scaleselectorCtrl"]=this};Ln.$inject=["$scope","$element","$attrs"];Ln.$inject=["$scope","$element","$attrs"];Ln.getOptions_=function(e){var t=false;if(e!==undefined){t=e["dropup"]==true}return{dropup:t}};Ln.prototype.getScale=function(e){return this.scales[e]};Ln.prototype.changeZoom=function(e){this.map_.getView().setZoom(e)};Ln.prototype.handleResolutionChange_=function(e){var t=this;var r=this.map_.getView();var a=this.scales[r.getZoom()];if(a!==undefined){this.$scope_.$applyAsync(function(){t.currentScale=a})}};Ln.prototype.handleViewChange_=function(e){this.registerResolutionChangeListener_();this.handleResolutionChange_(null)};Ln.prototype.registerResolutionChangeListener_=function(){if(this.resolutionChangeKey_!==null){D["e"](this.resolutionChangeKey_)}var e=this.map_.getView();this.resolutionChangeKey_=D["a"](e,"change:resolution",this.handleResolutionChange_,this)};En.controller("NgeoScaleselectorController",Ln);var An=En;var Fn=angular.module("ngeoMapModule",[x.module.name,bn.name,Ga["a"].module.name,wn["a"].name,Tn.name,An.name]);var Pn=Fn;var Rn=angular.module("gmfMapComponent",[dn.name,yn.module.name,Pn.name,Ga["a"].module.name]);Rn.run(["$templateCache",function(e){e.put("gmf/map",r(315))}]);Rn.directive_=function(){return{scope:{map:"<gmfMapMap",manageResize:"<gmfMapManageResize",resizeTransition:"<gmfMapResizeTransition"},controller:"GmfMapController as ctrl",bindToController:true,templateUrl:"gmf/map"}};Rn.directive("gmfMap",Rn.directive_);Rn.Controller_=function(e,t,r){this.map;this.manageResize;this.resizeTransition;this.ngeoFeatureOverlayMgr_=e;this.gmfPermalink_=t;this.gmfSnapping_=r};Rn.Controller_.$inject=["ngeoFeatureOverlayMgr","gmfPermalink","gmfSnapping"];Rn.Controller_.prototype.$onInit=function(){this.ngeoFeatureOverlayMgr_.init(this.map);this.gmfPermalink_.setMap(this.map);this.gmfSnapping_.setMap(this.map)};Rn.controller("GmfMapController",Rn.Controller_);var kn=Rn;var xn=r(359);var Dn=angular.module("gmfMapMouseposition",[ie.name]);Dn.run(["$templateCache",function(e){e.put("gmf/map/mousepositionComponent",r(314))}]);Dn.value("gmfMapMousepositionTemplateUrl",function(e){var t=e["gmfMapMousepositionTemplateUrl"];return t!==undefined?t:"gmf/map/mousepositionComponent"});On.$inject=["$attrs","gmfMapMousepositionTemplateUrl"];function On(e,t){return t(e)}Dn.component_={controller:"gmfMousepositionController as ctrl",bindings:{map:"<gmfMousepositionMap",projections:"<gmfMousepositionProjections"},templateUrl:On};Dn.component("gmfMouseposition",Dn.component_);Dn.Controller_=function(e,t,r,a){this.map;this.projections;this.projection;this.$scope_=r;this.gettextCatalog_=a;this.$element_=e;this.$filter_=t;this.control_=null};Dn.Controller_.$inject=["$element","$filter","$scope","gettextCatalog"];Dn.Controller_.prototype.$onInit=function(){var e=this;this.$scope_.$on("gettextLanguageChanged",function(){e.initOlControl_()});this.initOlControl_()};Dn.Controller_.prototype.initOlControl_=function(){if(this.control_!==null){this.map.removeControl(this.control_)}var e=function e(t){var r=this.projection.filter.split(":");var a=this.$filter_(r.shift());h["a"].assertFunction(a);var n=r;n.unshift(t);return a.apply(this,n)};var t=this.gettextCatalog_;this.control_=new xn["a"]({className:"gmf-mouseposition-control",coordinateFormat:e.bind(this),target:angular.element(".gmf-mouseposition-control-target",this.$element_)[0],undefinedHTML:t.getString("Coordinates")});this.setProjection(this.projections[0]);this.map.addControl(this.control_)};Dn.Controller_.prototype.setProjection=function(e){this.control_.setProjection(de["f"](e.code));this.projection=e};Dn.controller("gmfMousepositionController",Dn.Controller_);var $n=Dn;var In=angular.module("gmfMapModule",[kn.name,$n.name]);var Nn=In;var Gn=function e(t,r){this.gettextCatalog_=r;this.encoding_=t.has("ngeoCsvEncoding")?t.get("ngeoCsvEncoding"):"utf-8";this.extension_=t.has("ngeoCsvExtension")?t.get("ngeoCsvExtension"):".csv";this.includeHeader_=t.has("ngeoCsvIncludeHeader")?t.get("ngeoCsvIncludeHeader"):true;this.quote_=t.has("ngeoCsvQuote")?t.get("ngeoCsvQuote"):'"';this.separator_=t.has("ngeoCsvSeparator")?t.get("ngeoCsvSeparator"):",";this.download_=t.get("ngeoDownload")};Gn.$inject=["$injector","gettextCatalog"];Gn.$inject=["$injector","gettextCatalog"];Gn.prototype.generateCsv=function(e,t){var r=this;if(e.length==0||t.length==0){return""}var a=t.map(function(e){return r.gettextCatalog_.getString(e.name)});var n=this.getRow_(a);var i=e.map(function(e){var a=t.map(function(t){return e[t.name]});return r.getRow_(a)});return this.includeHeader_?n+i.join(""):i.join("")};Gn.prototype.getRow_=function(e){var t=this;var r=new RegExp(this.quote_,"g");var a=this.quote_+this.quote_;var n=e.map(function(e){if(e!==undefined&&e!==null){e=""+e;return t.quote_+e.replace(r,a)+t.quote_}else{return""}});return n.join(this.separator_)+"\n"};Gn.prototype.startDownload=function(e,t,r){var a=this.generateCsv(e,t);this.download_(a,r,"text/csv;charset="+this.encoding_)};Gn.module=angular.module("ngeoCsvDownload",[ue.name]);Gn.module.service("ngeoCsvDownload",Gn);var Un=Gn;var jn=function e(t,r){this.data=t;this.columnDefs=r;this.selectedRows={}};jn.getRowUid=function(e){return""+T["c"](e)};jn.prototype.isRowSelected=function(e){return!!this.selectedRows[jn.getRowUid(e)]};jn.prototype.getSelectedCount=function(){return Object.keys(this.selectedRows).length};jn.prototype.getSelectedRows=function(){var e=this;return this.data.filter(function(t){return e.isRowSelected(t)})};jn.prototype.selectRow=function(e){var t=jn.getRowUid(e);this.selectedRows[t]=e};jn.prototype.toggleRow=function(e){var t=jn.getRowUid(e);var r=this.isRowSelected(e);if(r){delete this.selectedRows[t]}else{this.selectedRows[t]=e}};jn.prototype.selectAll=function(){var e=this;this.data.forEach(function(t){e.selectRow(t)})};jn.prototype.unselectAll=function(){for(var e in this.selectedRows){delete this.selectedRows[e]}};jn.prototype.invertSelection=function(){var e=this;this.data.forEach(function(t){e.toggleRow(t)})};jn.module=angular.module("ngeoGridConfig",[]);var Vn=jn;var Bn=r(65);var Wn=r(313);var Hn=r(312);var qn=angular.module("ngeoGrid",[Vn.module.name,ie.name,"floatThead"]);qn.run(["$templateCache",function(e){e.put("ngeo/grid",r(311))}]);qn.value("ngeoGridTemplateUrl",function(e){var t=e["ngeoGridTemplateurl"];return t!==undefined?t:"ngeo/grid"});Kn.$inject=["$attrs","ngeoGridTemplateUrl"];function Kn(e,t){return t(e)}qn.component_={controller:"ngeoGridController as ctrl",bindings:{configuration:"=ngeoGridConfiguration"},templateUrl:Kn};qn.component("ngeoGrid",qn.component_);qn.Controller_=function(e){this.scope_=e;this.configuration;this.selectedRows;this.sortedBy;this.sortAscending=true;this.floatTheadConfig={scrollContainer:function e(t){return t.closest(".ngeo-grid-table-container")}}};qn.Controller_.$inject=["$scope"];qn.Controller_.prototype.$onInit=function(){this.selectedRows=this.configuration.selectedRows};qn.Controller_.prototype.sort=function(e){this.sortAscending=this.sortedBy===e?!this.sortAscending:true;this.sortedBy=e;var t=this.sortAscending?1:-1;this.configuration.data.sort(function(r,a){if(!r[e]){return 1}if(!a[e]){return-1}return r[e]>a[e]?t:-t})};qn.Controller_.prototype.clickRow=function(e,t){var r=this.isShiftKeyOnly_(t);var a=this.isPlatformModifierKeyOnly_(t);this.clickRow_(e,r,a)};qn.Controller_.prototype.clickRow_=function(e,t,r){if(t&&!r){this.selectRange_(e)}else if(!t&&r){this.configuration.toggleRow(e)}else{var a=this.configuration.isRowSelected(e);this.configuration.unselectAll();if(!a){this.configuration.selectRow(e)}}};qn.Controller_.prototype.selectRange_=function(e){var t=Vn.getRowUid(e);var r=this.configuration.data;if(this.configuration.isRowSelected(e)){return}var a=undefined;var n=[];for(var i=0;i<r.length;i++){var o=r[i];var s=Vn.getRowUid(o);if(t===s){a=i}else if(this.configuration.isRowSelected(o)){n.push(i)}}h["a"].assert(a!==undefined);if(n.length==0){this.configuration.selectRow(e)}var l=Infinity;var u=n[0];for(var c=0;c<n.length;c++){var f=n[c];var p=Math.abs(f-a);if(l>p){l=p;u=f}}var d=a<u?a:u;var g=a>u?a:u;for(var m=d;m<=g;m++){this.configuration.selectRow(r[m])}};qn.Controller_.prototype.preventTextSelection=function(e){var t=this.isShiftKeyOnly_(e);var r=this.isPlatformModifierKeyOnly_(e);if(t||r){e.preventDefault()}};qn.Controller_.prototype.isPlatformModifierKeyOnly_=function(e){return!e.altKey&&(Bn["e"]?e.metaKey:e.ctrlKey)&&!e.shiftKey};qn.Controller_.prototype.isShiftKeyOnly_=function(e){return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey};qn.controller("ngeoGridController",qn.Controller_);var Yn=qn;var zn=angular.module("gmfQueryGridComponent",[Un.module.name,ue.name,Yn.name,Vn.module.name,Ga["a"].module.name,$r.module.name]);zn.value("gmfDisplayquerygridTemplateUrl",function(e,t){var r=t["gmfDisplayquerygridTemplateurl"];return r!==undefined?r:"gmf/query/gridComponent"});zn.run(["$templateCache",function(e){e.put("gmf/query/gridComponent",r(310))}]);Qn.$inject=["$element","$attrs","gmfDisplayquerygridTemplateUrl"];function Qn(e,t,r){return r(e,t)}zn.component_={controller:"GmfDisplayquerygridController as ctrl",bindings:{active:"=?gmfDisplayquerygridActive",featuresStyleFn:"&gmfDisplayquerygridFeaturesstyle",selectedFeatureStyleFn:"&gmfDisplayquerygridSelectedfeaturestyle",getMapFn:"&gmfDisplayquerygridMap",removeEmptyColumnsFn:"&?gmfDisplayquerygridRemoveemptycolumns",maxResultsFn:"&?gmfDisplayquerygridMaxresults",maxRecenterZoomFn:"&?gmfDisplayquerygridMaxrecenterzoom",mergeTabs:"<?gmfDisplayquerygridMergetabs"},templateUrl:Qn};zn.component("gmfDisplayquerygrid",zn.component_);zn.Controller_=function(e,t,r,a,n,i,o,s){var l=this;var u=e.has("ngeoQueryOptions")?e.get("ngeoQueryOptions"):{};this.$scope_=t;this.$timeout_=i;this.ngeoQueryResult=r;this.ngeoMapQuerent_=a;this.ngeoCsvDownload_=o;this.$element_=s;this.maxResults=u.limit!==undefined?u.limit:50;this.active=false;this.pending=false;this.gridSources={};this.loadedGridSources=[];this.selectedTab=null;this.removeEmptyColumns_=false;this.maxRecenterZoom;this.mergeTabs={};this.featuresForSources_={};this.features_=new ma["b"];this.ngeoFeatureOverlayMgr_=n;this.highlightFeatures_=new ma["b"];this.filename_=e.has("gmfCsvFilename")?e.get("gmfCsvFilename"):"query-results.csv";this.map_=null;this.$scope_.$watchCollection(function(){return r},function(e,t){if(e!==t){l.updateData_()}});this.unregisterSelectWatcher_=null};zn.Controller_.$inject=["$injector","$scope","ngeoQueryResult","ngeoMapQuerent","ngeoFeatureOverlayMgr","$timeout","ngeoCsvDownload","$element"];zn.Controller_.prototype.$onInit=function(){this.removeEmptyColumns_=this["removeEmptyColumnsFn"]?this["removeEmptyColumnsFn"]()===true:false;this.maxRecenterZoom=this["maxRecenterZoomFn"]?this["maxRecenterZoomFn"]():undefined;var e=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();e.setFeatures(this.features_);var t=this["featuresStyleFn"]();if(t!==undefined){h["a"].assertInstanceof(t,we["c"]);e.setStyle(t)}var r=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();r.setFeatures(this.highlightFeatures_);var a=this["selectedFeatureStyleFn"]();if(a!==undefined){h["a"].assertInstanceof(a,we["c"])}else{var n=new Se["a"]({color:[255,0,0,.6]});var i=new be["a"]({color:[255,0,0,1],width:2});a=new we["c"]({fill:n,image:new Ye["a"]({fill:n,radius:5,stroke:i}),stroke:i,zIndex:10})}r.setStyle(a);var o=this["getMapFn"];if(o){var s=o();h["a"].assertInstanceof(s,_n["a"]);this.map_=s}};zn.Controller_.prototype.getGridSources=function(){var e=this;return this.loadedGridSources.map(function(t){return e.gridSources[t]})};zn.Controller_.prototype.updateData_=function(){var e=this;if(this.ngeoQueryResult.total===0&&!this.hasOneWithTooManyResults_()){var t=this.active;this.clear();if(t){this.active=this.ngeoQueryResult.pending;this.pending=this.ngeoQueryResult.pending}return}this.active=true;this.pending=false;var r=this.ngeoQueryResult.sources;if(Object.keys(this.mergeTabs).length>0){r=this.getMergedSources_(r)}r.forEach(function(t){if(t.tooManyResults){e.makeGrid_(null,t)}else{t.id=e.escapeValue(t.id);var r=t.features;if(r.length>0){e.collectData_(t)}}});if(this.loadedGridSources.length===0){this.active=false;return}if(this.selectedTab===null||!(""+this.selectedTab in this.gridSources)){this.$timeout_(function(){var t=e.loadedGridSources[0];e.selectTab(e.gridSources[t])},0)}};zn.Controller_.prototype.hasOneWithTooManyResults_=function(){return this.ngeoQueryResult.sources.some(function(e){return e.tooManyResults})};zn.Controller_.prototype.escapeValue=function(e){if(Number.isInteger(e)){return e}else{var t=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\ |]/g;if(e.match(t)!==null){return e.replace(t,"_")}else{return e}}};zn.Controller_.prototype.isSelected=function(e){return this.selectedTab===e.source.label};zn.Controller_.prototype.getMergedSources_=function(e){var t=this;var r=[];var a={};e.forEach(function(e){var n=t.getMergedSource_(e,a);if(n===null){r.push(e)}});for(var n in a){r.push(a[n])}return r};zn.Controller_.prototype.getMergedSource_=function(e,t){var r=null;for(var a in this.mergeTabs){var n=this.mergeTabs[a];var i=n.some(function(t){return t==e.label});if(i){r=a;break}}if(r===null){return null}var o=void 0;if(r in t){o=t[r]}else{o={features:[],id:r,label:r,limit:this.maxResults,pending:false,queried:true,tooManyResults:false,totalFeatureCount:undefined};t[r]=o}e.features.forEach(function(e){o.features.push(e)});o.tooManyResults=o.tooManyResults||e.tooManyResults;if(o.tooManyResults){o.totalFeatureCount=o.totalFeatureCount!==undefined?o.totalFeatureCount+o.features.length:o.features.length;o.features=[]}if(e.totalFeatureCount!==undefined){o.totalFeatureCount=o.totalFeatureCount!==undefined?o.totalFeatureCount+e.totalFeatureCount:e.totalFeatureCount}return o};zn.Controller_.prototype.collectData_=function(e){var t=e.features;var r=[];var a=[];var n={};var i=void 0,o=void 0;t.forEach(function(e){i=e.getProperties();if(i!==undefined){o=e.getGeometryName();if(a.indexOf(o)===-1){a.push(o)}r.push(i);n[Vn.getRowUid(i)]=e}});this.cleanProperties_(r,a);if(r.length>0){var s=this.makeGrid_(r,e);if(s){this.featuresForSources_[""+e.label]=n}}};zn.Controller_.prototype.cleanProperties_=function(e,t){e.forEach(function(e){t.forEach(function(t){delete e[t]});delete e["boundedBy"];delete e["ngeo_feature_type_"]});if(this.removeEmptyColumns_===true){this.removeEmptyColumnsFn_(e)}};zn.Controller_.prototype.removeEmptyColumnsFn_=function(e){var t=[];var r=void 0,a=void 0;for(a in e[0]){for(r=0;r<e.length;r++){if(e[r][a]!==undefined){t.push(a);break}}}var n=void 0;e.forEach(function(e){n=[];for(a in e){if(t.indexOf(a)===-1){n.push(a)}}n.forEach(function(t){delete e[t]})})};zn.Controller_.prototype.makeGrid_=function(e,t){var r=""+t.label;var a=null;if(e!==null){a=this.getGridConfiguration_(e);if(a===null){return false}}if(this.loadedGridSources.indexOf(r)==-1){this.loadedGridSources.push(r)}this.gridSources[r]={configuration:a,source:t};return true};zn.Controller_.prototype.getGridConfiguration_=function(e){h["a"].assert(e.length>0);var t={};Object.assign(t,e[0]);delete t.ol_uid;var r=Object.keys(t);var a=[];r.forEach(function(e){a.push({name:e})});if(a.length>0){return new Vn(e,a)}else{return null}};zn.Controller_.prototype.clear=function(){this.active=false;this.pending=false;this.gridSources={};this.loadedGridSources=[];this.selectedTab=null;this.tooManyResults=false;this.features_.clear();this.highlightFeatures_.clear();this.ngeoMapQuerent_.clear();this.featuresForSources_={};if(this.unregisterSelectWatcher_){this.unregisterSelectWatcher_()}};zn.Controller_.prototype.selectTab=function(e){var t=this;var r=e.source;this.selectedTab=r.label;if(this.unregisterSelectWatcher_){this.unregisterSelectWatcher_();this.unregisterSelectWatcher_=null}if(e.configuration!==null){this.unregisterSelectWatcher_=this.$scope_.$watchCollection(function(){return e.configuration.selectedRows},function(e,r){if(Object.keys(e)!==Object.keys(r)){t.onSelectionChanged_()}})}this.updateFeatures_(e);this.reflowGrid_()};zn.Controller_.prototype.reflowGrid_=function(){var e=this.escapeValue(this.selectedTab||"");var t=this.$element_.find("div.tab-pane#"+e);t.removeClass("active").addClass("active");this.$timeout_(function(){t.find("div.ngeo-grid-table-container table")["trigger"]("reflow")})};zn.Controller_.prototype.onSelectionChanged_=function(){if(this.selectedTab===null){return}var e=this.gridSources[""+this.selectedTab];this.updateFeatures_(e)};zn.Controller_.prototype.updateFeatures_=function(e){this.features_.clear();this.highlightFeatures_.clear();if(e.configuration===null){return}var t=""+e.source.label;var r=this.featuresForSources_[t];var a=e.configuration.selectedRows;for(var n in r){var i=r[n];if(n in a){this.highlightFeatures_.push(i)}else{this.features_.push(i)}}};zn.Controller_.prototype.getActiveGridSource=function(){if(this.selectedTab===null){return null}else{return this.gridSources[""+this.selectedTab]}};zn.Controller_.prototype.isOneSelected=function(){var e=this.getActiveGridSource();if(e===null||e.configuration===null){return false}else{return e.configuration.getSelectedCount()>0}};zn.Controller_.prototype.getSelectedRowCount=function(){var e=this.getActiveGridSource();if(e===null||e.configuration===null){return 0}else{return e.configuration.getSelectedCount()}};zn.Controller_.prototype.selectAll=function(){var e=this.getActiveGridSource();if(e!==null){e.configuration.selectAll()}};zn.Controller_.prototype.unselectAll=function(){var e=this.getActiveGridSource();if(e!==null){e.configuration.unselectAll()}};zn.Controller_.prototype.invertSelection=function(){var e=this.getActiveGridSource();if(e!==null){e.configuration.invertSelection()}};zn.Controller_.prototype.zoomToSelection=function(){var e=this.getActiveGridSource();if(e!==null){var t=je["j"]();this.highlightFeatures_.forEach(function(e){je["q"](t,e.getGeometry().getExtent())});var r=this.map_.getSize();h["a"].assert(r!==undefined);var a=this.maxRecenterZoom;this.map_.getView().fit(t,{size:r,maxZoom:a})}};zn.Controller_.prototype.downloadCsv=function(){var e=this.getActiveGridSource();if(e!==null){var t=e.configuration.columnDefs;h["a"].assert(t!==undefined);var r=e.configuration.getSelectedRows();this.ngeoCsvDownload_.startDownload(r,t,this.filename_)}};zn.controller("GmfDisplayquerygridController",zn.Controller_);var Xn=zn;var Zn=angular.module("ngeoMiscSwipe",[]);Zn.factory("$verticalSwipe",[function(){var e=10;var t={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup",cancel:"pointercancel"}};function r(e){var t=e.originalEvent||e;var r=t.touches&&t.touches.length?t.touches:[t];var a=t.changedTouches&&t.changedTouches[0]||r[0];return{x:a.clientX,y:a.clientY}}function a(e,r){var a=[];angular.forEach(e,function(e){var n=t[e][r];if(n){a.push(n)}});return a.join(" ")}return{bind:function t(n,i,o){var s=void 0,l=void 0;var u=void 0;var c=void 0;var f=false;o=o||["mouse","touch","pointer"];n.on(a(o,"start"),function(e){u=r(e);f=true;s=0;l=0;c=u;if(i["start"]){i["start"](u,e)}});var h=a(o,"cancel");if(h){n.on(h,function(e){f=false;if(i["cancel"]){i["cancel"](e)}})}n.on(a(o,"move"),function(t){if(!f){return}if(!u){return}var a=r(t);s+=Math.abs(a.x-c.x);l+=Math.abs(a.y-c.y);c=a;if(s<e&&l<e){return}if(s>l){f=false;if(i["cancel"]){i["cancel"](t)}return}else{t.preventDefault();if(i["move"]){i["move"](a,t)}}});n.on(a(o,"end"),function(e){if(!f){return}f=false;if(i["end"]){i["end"](r(e),e)}})}}}]);Zn.makeSwipeDirective_=function(e,t,r){Zn.directive(e,["$parse","$verticalSwipe",function(a,n){var i=75;var o=.3;var s=30;return function(l,u,c){var f=a(c[e]);var h=void 0,p=void 0;function d(e){if(!h){return false}var r=(e.y-h.y)*t;var a=Math.abs(e.x-h.x);return p&&a<i&&r>0&&r>s&&a/r<o}var g=["touch"];if(!angular.isDefined(c["ngeoSwipeDisableMouse"])){g.push("mouse")}n.bind(u,{start:function e(t,r){h=t;p=true},cancel:function e(t){p=false},end:function e(t,a){if(d(t)){l.$apply(function(){u.triggerHandler(r);f(l,{$event:a})})}}},g)}}])};Zn.makeSwipeDirective_("ngeoSwipeDown",1,"swipedown");Zn.makeSwipeDirective_("ngeoSwipeUp",-1,"swipeup");var Jn=Zn;var ei=r(242);var ti=r(308);var ri=r(306);var ai=r(226);var ni=angular.module("gmfQueryWindowComponent",[Ga["a"].module.name,Ze.module.name,Jn.name,$r.module.name,"ngAnimate","ngTouch"]);ni.config(["$animateProvider",function(e){e.classNameFilter(/gmf-animatable/)}]);ni.value("gmfDisplayquerywindowTemplateUrl",function(e,t){var r=t["gmfDisplayquerywindowTemplateurl"];return r!==undefined?r:"gmf/query/windowComponent"});ni.run(["$templateCache",function(e){e.put("gmf/query/windowComponent",r(304))}]);ii.$inject=["$element","$attrs","gmfDisplayquerywindowTemplateUrl"];function ii(e,t,r){return r(e,t)}ni.component_={controller:"GmfDisplayquerywindowController as ctrl",bindings:{draggableContainment:"<?gmfDisplayquerywindowDraggableContainment",featuresStyleFn:"&gmfDisplayquerywindowFeaturesstyle",selectedFeatureStyleFn:"&gmfDisplayquerywindowSelectedfeaturestyle",defaultCollapsedFn:"&?gmfDisplayquerywindowDefaultcollapsed",desktop:"=gmfDisplayquerywindowDesktop",showUnqueriedLayers:"=gmfDisplayquerywindowShowunqueriedlayers"},templateUrl:ii};ni.component("gmfDisplayquerywindow",ni.component_);ni.Controller_=function(e,t,r,a,n){var i=this;this.draggableContainment;this.desktop=false;this.collapsed=!this.desktop;this.showUnqueriedLayers_=false;this.sourcesFilter={queried:true};this.ngeoQueryResult={sources:[],total:0,pending:false};this.ngeoMapQuerent_=a;this.selectedSource=null;this.features_=new ma["b"];this.ngeoFeatureOverlayMgr_=n;this.highlightFeatures_=new ma["b"];this.source=null;this.feature=null;this.currentResult=-1;this.isNext=true;this.animate=0;this.open=false;this.element_=e;t.$watchCollection(function(){return r},function(e,t){i.updateQueryResult_(e);if(e.total>0){i.show()}else if(t!==e){i.close()}})};ni.Controller_.$inject=["$element","$scope","ngeoQueryResult","ngeoMapQuerent","ngeoFeatureOverlayMgr"];ni.Controller_.prototype.$onInit=function(){this.draggableContainment=this.draggableContainment||"document";this.desktop=this.desktop;this.collapsed=this["defaultCollapsedFn"]?this["defaultCollapsedFn"]()===true:!this.desktop;this.showUnqueriedLayers_=this["showUnqueriedLayers"]?this["showUnqueriedLayers"]===true:false;this.sourcesFilter=this.showUnqueriedLayers_?{}:{queried:true};var e=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();e.setFeatures(this.features_);var t=this["featuresStyleFn"]();if(t!==undefined){h["a"].assertInstanceof(t,we["c"]);e.setStyle(t)}var r=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();r.setFeatures(this.highlightFeatures_);var a=this["selectedFeatureStyleFn"]();if(a!==undefined){h["a"].assertInstanceof(a,we["c"])}else{var n=new Se["a"]({color:[255,0,0,.6]});var i=new be["a"]({color:[255,0,0,1],width:2});a=new we["c"]({fill:n,image:new Ye["a"]({fill:n,radius:5,stroke:i}),stroke:i})}r.setStyle(a);if(this.desktop){this.element_.find(".gmf-displayquerywindow .windowcontainer").draggable({cancel:"input,textarea,button,select,option,tr",containment:this.draggableContainment});this.element_.find(".gmf-displayquerywindow .windowcontainer").resizable({minHeight:240,minWidth:240})}};ni.Controller_.prototype.show=function(){this.clear();this.updateFeatures_()};ni.Controller_.prototype.updateFeatures_=function(){this.setCurrentResult_(0,false);if(this.source!==null){this.collectFeatures_();this.highlightCurrentFeature_();this.open=true}};ni.Controller_.prototype.setCurrentResult_=function(e,t){var r=false;if(e!==this.currentResult){var a=void 0,n=void 0,i=void 0;var o=this.feature;var s=this.ngeoQueryResult.sources;this.currentResult=e;for(a=0;a<s.length;a++){n=s[a];if(this.selectedSource!==null&&this.selectedSource!==n){continue}i=n.features;if(e>=i.length){e-=i.length}else{this.source=n;this.feature=n.features[e];r=true;break}}if(t){this.highlightCurrentFeature_(o)}}return r};ni.Controller_.prototype.previous=function(){var e=this.currentResult-1;if(e<0){e=this.getResultLength()-1}var t=this.setCurrentResult_(e,true);if(t){this.animate_(false)}};ni.Controller_.prototype.next=function(){var e=this.currentResult+1;var t=this.getResultLength()-1;if(e>t){e=0}var r=this.setCurrentResult_(e,true);if(r){this.animate_(true)}};ni.Controller_.prototype.updateQueryResult_=function(e){this.ngeoQueryResult.total=0;this.ngeoQueryResult.sources.length=0;for(var t=0;t<e.sources.length;t++){var r=e.sources[t];r.features=r.features.filter(function(e){h["a"].assert(e);return!Gt["d"](Ze.getFilteredFeatureValues(e))});this.ngeoQueryResult.sources.push(r);this.ngeoQueryResult.total+=r.features.length}};ni.Controller_.prototype.getResultLength=function(){if(this.selectedSource===null){return this.ngeoQueryResult.total}else{return this.selectedSource.features.length}};ni.Controller_.prototype.isFirst=function(){return this.currentResult==0};ni.Controller_.prototype.isLast=function(){return this.currentResult==this.getResultLength()-1};ni.Controller_.prototype.getFeatureValues=function(){if(!this.feature){return null}return Ze.getFilteredFeatureValues(this.feature)};ni.Controller_.prototype.animate_=function(e){this.isNext=e;this.animate++};ni.Controller_.prototype.collectFeatures_=function(){var e=this.ngeoQueryResult.sources;this.features_.clear();for(var t=0;t<e.length;t++){var r=e[t];if(this.selectedSource!==null&&this.selectedSource!==r){continue}var a=r.features;for(var n=0;n<a.length;n++){this.features_.push(a[n])}}};ni.Controller_.prototype.highlightCurrentFeature_=function(e){this.highlightFeatures_.clear();this.features_.remove(this.feature);this.highlightFeatures_.push(this.feature);if(e!==undefined){this.features_.push(e)}};ni.Controller_.prototype.close=function(){this.open=false;this.clear();this.ngeoMapQuerent_.clear()};ni.Controller_.prototype.clear=function(){this.feature=null;this.source=null;this.currentResult=-1;this.features_.clear();this.highlightFeatures_.clear();this.selectedSource=null};ni.Controller_.prototype.setSelectedSource=function(e){if(e!==null&&e.features.length<=0){return}this.clear();this.selectedSource=e;this.updateFeatures_()};ni.controller("GmfDisplayquerywindowController",ni.Controller_);var oi=ni;var si=r(374);var li=r(373);var ui=angular.module("gmfQueryExtraModule",[Xn.name,oi.name]);var ci=ui;var fi=r(259);var hi=r(204);var pi=r(372);var di=angular.module("gmfSearchModule",[fi["a"].name,hi["a"].module.name]);var gi=di;var mi=r(121);var vi=angular.module("gmfThemeSelectorComponent",[mi["a"].module.name,w["a"].module.name]);vi.run(["$templateCache",function(e){e.put("gmf/theme/selectorComponent",r(295))}]);vi.value("gmfThemeSelectorTemplateUrl",function(e){var t=e["gmfThemeSelectorTemplateUrl"];return t!==undefined?t:"gmf/theme/selectorComponent"});yi.$inject=["$attrs","gmfThemeSelectorTemplateUrl"];function yi(e,t){return t(e)}vi.component_={bindings:{filter:"<gmfThemeselectorFilter"},controller:"gmfThemeselectorController",templateUrl:yi};vi.component("gmfThemeselector",vi.component_);vi.Controller_=function(e,t,r){this.gmfThemeManager=t;this.gmfThemes_=r;this.themes;this.filter;this.listenerKeys_=[];this.listenerKeys_.push(D["a"](this.gmfThemes_,"change",this.setThemes_,this));e.$on("$destroy",this.handleDestroy_.bind(this))};vi.Controller_.$inject=["$scope","gmfThemeManager","gmfThemes"];vi.Controller_.prototype.setThemes_=function(){var e=this;this.gmfThemes_.getThemesObject().then(function(t){e.themes=e.filter?t.filter(e.filter):t})};vi.Controller_.prototype.setTheme=function(e,t){if(e){this.gmfThemeManager.addTheme(e,t)}};vi.Controller_.prototype.handleDestroy_=function(){this.listenerKeys_.forEach(D["e"]);this.listenerKeys_.length=0};vi.controller("gmfThemeselectorController",vi.Controller_);var _i=vi;var Si=angular.module("gmfThemeModule",[_i.name,mi["a"].module.name,w["a"].module.name]);var bi=Si;var wi=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function Ci(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Ti=angular.module("ngeoMessageDisplaywindowComponent",["ngSanitize"]);Ti.run(["$templateCache",function(e){e.put("ngeo/message/displaywindowComponent",r(294))}]);Ti.value("ngeoMessageDisplaywindowTemplateUrl",function(e){var t=e["ngeoMessageDisplaywindowTemplateUrl"];return t!==undefined?t:"ngeo/message/displaywindowComponent"});Ei.$inject=["$attrs","ngeoMessageDisplaywindowTemplateUrl"];function Ei(e,t){return t(e)}Ti.Controller_=function(){e.$inject=["$element","$sce","$scope","$compile"];function e(t,r,a,n){Ci(this,e);this.clearOnClose;this.content=null;this.contentTemplate=null;this.contentScope=null;this.draggable;this.draggableContainment;this.desktop;this.height=null;this.open;this.resizable;this.title=null;this.url=null;this.width=null;this.element_=t;this.sce_=r;this.scope_=a;this.compile_=n}e.prototype.$onInit=function e(){this.clearOnClose=this.clearOnClose!==false;this.content=this.content||null;this.contentTemplate=this.contentTemplate||null;this.contentScope=this.contentScope||null;this.desktop=this.desktop!==false;this.draggableContainment=this.draggableContainment||"document";this.open=this.open===true;this.height=this.height||"240px";this.width=this.width||"240px";this.draggable=this.draggable!==undefined?this.draggable:this.desktop;this.resizable=this.resizable!==undefined?this.resizable:this.desktop;if(this.draggable){this.element_.find(".ngeo-displaywindow .windowcontainer").draggable({containment:this.draggableContainment,handle:"div.header"})}if(this.resizable){this.element_.find(".ngeo-displaywindow .windowcontainer").resizable({minHeight:240,minWidth:240})}if(this.contentTemplate){var t=h["a"].assert(this.contentScope||this.scope_);var r=this.compile_(this.contentTemplate)(t);var a=this.element_.find(".ngeo-displaywindow .windowcontainer .animation-container");a.append(r)}};e.prototype.close=function e(){this.open=false;if(this.clearOnClose){this.clear_()}};e.prototype.clear_=function e(){this.content=null;this.title=null;this.url=null};wi(e,[{key:"style",get:function e(){return{height:this.height,width:this.width}}},{key:"urlTrusted",get:function e(){if(this.url){return this.sce_.trustAsResourceUrl(this.url)}}}]);return e}();Ti.component("ngeoDisplaywindow",{bindings:{clearOnClose:"<?",content:"=?",contentTemplate:"<?",contentScope:"<?",desktop:"<?",draggable:"<?",draggableContainment:"<?",height:"=?",open:"=?",resizable:"<?",title:"=?",url:"=?",width:"=?"},controller:Ti.Controller_,templateUrl:Ei});var Mi=Ti;var Li=r(203);var Ai=r(57);var Fi=angular.module("ngeoControl",[]);Fi.component_=function(){return{restrict:"A",link:function e(t,r,a){var n=t.$eval(a["ngeoControl"]);h["a"].assertInstanceof(n,Ai["a"]);var i=t.$eval(a["ngeoControlMap"]);h["a"].assertInstanceof(i,_n["a"]);n.setTarget(r[0]);i.addControl(n)}}};Fi.directive("ngeoControl",Fi.component_);var Pi=Fi;var Ri=r(159);var ki=r(214);var xi=angular.module("ngeoFilereader",[]);xi.component_=function(e){return{restrict:"A",scope:{fileContent:"=ngeoFilereader",supported:"=?ngeoFilereaderSupported"},link:function t(r,a,n){var i="FileReader"in e;r["supported"]=i;if(!i){return}a.on("change",function(t){var a=new e.FileReader;a.onload=function(e){r.$apply(function(){r["fileContent"]=e.target.result})};a.readAsText(t.target.files[0])})}}};xi.component_.$inject=["$window"];xi.directive("ngeoFilereader",xi.component_);var Di=xi;var Oi=angular.module("ngeoGetBrowserLanguage",[]);Oi.factory_=function(e){return function(t){var r=e.navigator;var a=r.languages||r.language||r.browserLanguage||r.systemLanguage||r.userLanguage;if(!Array.isArray(a)){a=[a]}a=a.map(function(e){return e.substring(0,2)});a=a.filter(function(e,t,r){return r.indexOf(e)==t});var n=a.filter(function(e){return t.indexOf(e)!=-1});return n[0]}};Oi.factory_.$inject=["$window"];Oi.factory("ngeoGetBrowserLanguage",Oi.factory_);var $i=Oi;var Ii=r(256);var Ni=r(133);var Gi=angular.module("ngeoMiscExtraModule",[Li["a"].module.name,Ur.name,Pi.name,Ma["a"].name,Ri["a"].name,Lr["a"].module.name,Ze.module.name,ki["a"].module.name,Di.name,ie.name,$i.name,Ii["a"].name,Ni["a"].module.name,Pa.module.name,Je["a"].module.name]);var Ui=Gi;var ji=angular.module("ngeoMapQuery",[$r.module.name]);ji.directive_=function(e,t){return{restrict:"A",scope:false,link:function r(a,n,i){var o=a.$eval(i["ngeoMapQueryMap"]);var s=null;var l=null;var u=function t(r){var a=r.coordinate;e.issue({coordinate:a,map:o})};var c=function e(t){if(!t.dragging){var r=o.getEventPixel(t.originalEvent);var a=function e(t){var r=t.get("visible");var a=t.get("querySourceIds");return r&&!!a};var n=o.forEachLayerAtPixel(r,function(){return true},undefined,a);o.getTargetElement().style.cursor=n?"pointer":""}};var f=function e(){s=D["a"](o,"singleclick",u);var r=t.has("ngeoQueryOptions")?t.get("ngeoQueryOptions"):{};if(r.cursorHover){l=D["a"](o,"pointermove",c)}};var h=function t(){if(s!==null){D["e"](s);s=null}if(l!==null){D["e"](l);l=null}if(a.$eval(i["ngeoMapQueryAutoclear"])!==false){e.clear()}};a.$watch(i["ngeoMapQueryActive"],function(e,t){if(e){f()}else{h()}})}}};ji.directive_.$inject=["ngeoMapQuerent","$injector"];ji.directive("ngeoMapQuery",ji.directive_);var Vi=ji;var Bi=r(206);var Wi=function e(t,r,a){var n=this;var i=a;this.url_=i.url;this.maxFeatures_=i.maxFeatures!==undefined?i.maxFeatures:50;this.wfsTypes_={};h["a"].assertArray(i.wfsTypes,"wfsTypes is not correctly set");i.wfsTypes.forEach(function(e){n.wfsTypes_[e.featureType]=e});this.defaultFeatureNS_=i.defaultFeatureNS;this.defaultFeaturePrefix_=i.defaultFeaturePrefix;this.pointRecenterZoom_=i.pointRecenterZoom;this.$http_=t;this.result_=r};Wi.$inject=["$http","ngeoQueryResult","ngeoWfsPermalinkOptions"];Wi.$inject=["$http","ngeoQueryResult","ngeoWfsPermalinkOptions"];Wi.prototype.clear=function(){this.clearResult_()};Wi.prototype.issue=function(e,t){h["a"].assert(this.url_,"url is not set. to use the wfs permalink service, "+"set the value `ngeoWfsPermalinkOptions`");this.clearResult_();var r=e.wfsType;if(!this.wfsTypes_.hasOwnProperty(r)){return}var a=this.wfsTypes_[r];var n=this.createFilters_(e.filterGroups);if(n===null){return}this.issueRequest_(a,n,t,e.showFeatures)};Wi.prototype.issueRequest_=function(e,t,r,a){var n=this;var i=new At["a"];var o=i.writeGetFeature({srsName:r.getView().getProjection().getCode(),featureNS:e.featureNS!==undefined?e.featureNS:this.defaultFeatureNS_,featurePrefix:e.featurePrefix!==undefined?e.featurePrefix:this.defaultFeaturePrefix_,featureTypes:[e.featureType],outputFormat:"GML3",filter:t,maxFeatures:this.maxFeatures_});var s=(new XMLSerializer).serializeToString(o);var l={headers:{"Content-Type":"text/xml; charset=UTF-8"}};this.$http_.post(this.url_,s,l).then(function(t){var o=i.readFeatures(t.data);if(o.length==0){return}var s=r.getSize();if(s!==undefined){var l=n.pointRecenterZoom_;var u=[10,10,10,10];r.getView().fit(n.getExtent_(o),{size:s,maxZoom:l,padding:u})}if(a){var c={features:o,id:e.featureType,identifierAttributeField:e.label,label:e.featureType,pending:false};n.result_.sources.push(c);n.result_.total=o.length}})};Wi.prototype.getExtent_=function(e){return e.reduce(function(e,t){return je["q"](e,t.getGeometry().getExtent())},je["j"]())};Wi.prototype.createFilters_=function(e){if(e.length==0){return null}var t=Ft;var r=function e(r){var a=r.filters.map(function(e){var r=e.condition;if(Array.isArray(r)){return Wi.or_(r.map(function(r){return t.equalTo(e.property,r)}))}else{return t.equalTo(e.property,e.condition)}});return Wi.and_(a)};return Wi.or_(e.map(r))};Wi.and_=function(e){return Wi.joinFilters_(e,Ft["and"])};Wi.or_=function(e){return Wi.joinFilters_(e,Ft["or"])};Wi.joinFilters_=function(e,t){return e.reduce(function(e,r){if(e===null){return r}else{h["a"].assert(r!==null);return t(e,r)}},null)};Wi.prototype.clearResult_=function(){this.result_.total=0;this.result_.sources.forEach(function(e){e.features.length=0})};Wi.module=angular.module("ngeoWfsPermalink",[]);Wi.module.value("ngeoWfsPermalinkOptions",{url:"",wfsTypes:[],defaultFeatureNS:"",defaultFeaturePrefix:""});Wi.module.service("ngeoWfsPermalink",Wi);var Hi=Wi;var qi=function e(t,r,a){var n=this;this.ngeoLocation=a.get("ngeoLocation");if(this.ngeoLocation.hasParam("debug")){window.injector=a}h["a"].assertInstanceof(this.map,_n["a"]);var i=a.get("ngeoFeatureHelper");i.setProjection(h["a"].assert(this.map.getView().getProjection()));this.gmfThemeManager=a.get("gmfThemeManager");this.gmfTreeManager_=a.get("gmfTreeManager");this.gmfThemes_=a.get("gmfThemes");this.permalink_=a.get("gmfPermalink");var o=a.get("gmfAuthenticationService");this.hasEditableLayers=false;this.updateHasEditableLayers_=function(){var e=this;this.gmfThemes_.hasEditableLayers().then(function(t){e.hasEditableLayers=t})};this.loginRedirectUrl=null;this.loginInfoMessage=null;r.$on("authenticationrequired",function(e,t){var i=a.get("gettextCatalog");n.loginInfoMessage=i.getString("Some layers in this link are not accessible to unauthenticated users. "+"Please log in to see whole data.");n.loginRedirectUrl=t.url;n.loginActive=true;var o=r.$watch(function(){return n.loginActive},function(){if(!n.loginActive){n.loginInfoMessage=null;n.loginRedirectUrl=null;o()}})});var s=function e(t){if(n.loginRedirectUrl){window.location=n.loginRedirectUrl;return}var r=t.detail.user;var a=r.username!==null?r.role_id:undefined;n.gmfThemes_.getThemesObject().then(function(e){var t=n.gmfUser.functionalities;if(t&&t.open_panel&&t.open_panel[0]==="layer_filter"){n.filterSelectorActive=true}});var i=n.gmfThemeManager.getThemeName();n.gmfThemeManager.setThemeName("",true);if(t.type!=="ready"){n.updateCurrentTheme_(i)}n.gmfThemes_.loadThemes(a);n.updateHasEditableLayers_()};D["a"](o,"ready",s);D["a"](o,"login",s);D["a"](o,"logout",s);this.searchDatasources=[{labelKey:"label",groupValues:a.get("gmfSearchGroups"),groupActions:a.get("gmfSearchActions"),projection:"EPSG:"+(t.srid||21781),url:a.get("fulltextsearchUrl")}];this.dimensions={};this.permalink_.setDimensions(this.dimensions);var l=a.get("gmfDataSourcesManager");l.setDatasourceMap(this.map);l.setDimensions(this.dimensions);if(a.has("gmfDefaultDimensions")){var u=a.get("gmfDefaultDimensions");for(var c in u){if(this.dimensions[c]===undefined){this.dimensions[c]=u[c]}}}this.backgroundLayerMgr_=a.get("ngeoBackgroundLayerMgr");r.$watchCollection(function(){return n.dimensions},function(){n.backgroundLayerMgr_.updateDimensions(n.map,n.dimensions)});this.backgroundLayerMgr_.on("change",function(){n.backgroundLayerMgr_.updateDimensions(n.map,n.dimensions)});this.leftNavVisible=false;this.rightNavVisible=false;var f=new Se["a"]({color:[255,170,0,.6]});var p=new be["a"]({color:[255,170,0,1],width:2});this.queryFeatureStyle=new we["c"]({fill:f,image:new Ye["a"]({fill:f,radius:5,stroke:p}),stroke:p});this.filterSelectorActive=false;this.queryActive=true;this.queryAutoClear=true;this.printPanelActive=false;this.printActive=false;this.ngeoMapQuerent_=a.get("ngeoMapQuerent");r.$watch(function(){return n.printPanelActive},function(e){if(!e&&!n.queryActive){n.ngeoMapQuerent_.clear()}n.queryAutoClear=!e;n.printActive=e});this.measurePointActive=false;this.measureLengthActive=false;this.drawFeatureActive=false;this.drawProfilePanelActive=false;this.gmfUser=a.get("gmfUser");this.getBrowserLanguage=a.get("ngeoGetBrowserLanguage");this.stateManager=a.get("ngeoStateManager");this.tmhDynamicLocale=a.get("tmhDynamicLocale");this.$scope=r;this.lang;this.defaultLang=a.get("defaultLang");this.langUrls=a.get("langUrls");this.gettextCatalog=a.get("gettextCatalog");this.initLanguage();var d="mapTools";this.mapToolsGroup=d;var g=a.get("ngeoFeatureOverlayMgr");g.init(this.map);var m=a.get("ngeoToolActivateMgr");var v=new Aa(this,"queryActive");m.registerTool(d,v,true);var y=new Aa(this,"measurePointActive");m.registerTool(d,y,false);var _=new Aa(this,"measureLengthActive");m.registerTool(d,_,false);var S=new Aa(this,"drawFeatureActive");m.registerTool(d,S,false);var b=new Aa(this,"drawProfilePanelActive");m.registerTool(d,b,false);var w=new Aa(this,"printPanelActive");m.registerTool(d,w,false);r.$root.$on(mi["a"].EventType.THEME_NAME_SET,function(e,t){n.gmfThemes_.getThemeObject(t).then(function(e){n.setDefaultBackground_(e)})});this.updateCurrentBackgroundLayer_=function(e){var t=this;this.gmfThemes_.getBgLayers().then(function(r){var a=void 0;if(!e){a=t.permalink_.getBackgroundLayer(r)}if(!a){var n=t.gmfUser.functionalities;if(n){var i=n.default_basemap;if(i.length>0){var o=i[0];a=Ge["d"](r,function(e){return e.get("label")===o})}}}if(!a&&r[1]){a=r[1]}if(a){t.backgroundLayerMgr_.set(t.map,a)}})}.bind(this);this.updateCurrentBackgroundLayer_(false);var C=window.gmfx||{};window.gmfx=C;C.openIframePopup=function(e,t,r,a,i){n.displaywindowUrl=e;C.openPopup_(t,r,a,i)};C.openTextPopup=function(e,t,r,a,i){n.displaywindowContent=e;C.openPopup_(t,r,a,i)};C.openPopup_=function(e,t,r,a){n.displaywindowTitle=e;n.displaywindowOpen=true;if(t){n.displaywindowWidth=t+"px"}if(r){n.displaywindowHeight=r+"px"}if(a!==false){n.$scope.$apply()}};this.manageResize=false;this.resizeTransition;var T=window.cgxp||{};window.cgxp=T;T.tools=window.cgxp.tools||{};T.tools.openInfoWindow=function(e,t,r,a,n){C.openIframePopup(e,t,r,a,n)};this.displaywindowContent=null;this.displaywindowDraggableContainment=".gmf-map";this.displaywindowHeight="50vh";this.displaywindowOpen=false;this.displaywindowTitle=null;this.displaywindowUrl=null;this.displaywindowWidth="50vw"};qi.$inject=["config","$scope","$injector"];qi.$inject=["config","$scope","$injector"];qi.prototype.userMustChangeItsPassword=function(){return this.gmfUser.is_password_changed===false};qi.getLayerByLabels=function(e,t){if(t&&t.length>0){return Ge["d"](e,function(e){return e.get("label")===t[0]})}return null};qi.prototype.switchLanguage=function(e){h["a"].assert(e in this.langUrls);this.gettextCatalog.setCurrentLanguage(e);this.gettextCatalog.loadRemote(this.langUrls[e]);this.tmhDynamicLocale.set(e);this.lang=e};qi.prototype.initLanguage=function(){var e=this;this.$scope.$watch(function(){return e.lang},function(t){e.stateManager.updateState({lang:t})});var t=this.getBrowserLanguage(Object.keys(this.langUrls));var r=this.stateManager.getInitialValue("lang");if(r!==undefined&&r in this.langUrls){this.switchLanguage(r);return}else if(t!==undefined&&t in this.langUrls){this.switchLanguage(t);return}else{this.switchLanguage(this.defaultLang);return}};qi.prototype.setDefaultBackground_=function(e){var t=this;this.gmfThemes_.getBgLayers().then(function(r){var a=void 0;a=t.permalink_.getBackgroundLayer(r);if(!a&&t.gmfUser.functionalities){a=qi.getLayerByLabels(r,t.gmfUser.functionalities.default_basemap)}if(!a&&e){a=qi.getLayerByLabels(r,e.functionalities.default_basemap)}if(!a){a=r[r.length>1?1:0]}h["a"].assert(a);t.backgroundLayerMgr_.set(t.map,a)})};qi.prototype.updateCurrentTheme_=function(e){var t=this;this.gmfThemes_.getThemesObject().then(function(r){var a=t.permalink_.defaultThemeNameFromFunctionalities();if(a){var n=w["a"].findThemeByName(r,a);if(n){t.gmfThemeManager.addTheme(n,true)}}else{t.gmfThemeManager.setThemeName(e)}})};qi.prototype.getLocationIcon=function(){var e=document.createElement("span");e.className="fa fa-location-arrow";e.style.transform="rotate(-0.82rad)";var t=document.createElement("span");t.appendChild(e);return t};qi.module=angular.module("GmfAbstractAppControllerModule",["gettext","tmh.dynamicLocale",b.name,I.name,gr.name,Fr.name,qa.name,rn.name,Nn.name,ci.name,gi.name,bi.name,Mi.name,Ui.name,Ze.module.name,$r.module.name,Vi.name,Bi["a"].name,Hi.module.name]);qi.module.controller("AbstractController",qi);qi.module.value("ngeoExportFeatureFormats",[Ze.FormatType.KML,Ze.FormatType.GPX]);qi.module.config(["tmhDynamicLocaleProvider","angularLocaleScript",function(e,t){e.localeLocationPattern(t)}]);var Ki=qi;var Yi=r(66);var zi=function e(t){ve["a"].call(this,{handleEvent:Ae["b"]});this.changeEventKey_=null;this.type_=t.type;this.minPoints_=t.minPoints?t.minPoints:this.type_==="Polygon"?3:2;this.sketchFeature_=null;this.sketchPoints_=[];this.sketchPoint_=null;this.overlay_=new ye["a"]({source:new _e["b"]({useSpatialIndex:false,wrapX:t.wrapX?t.wrapX:false}),style:t.style||Me.getDefaultDrawStyleFunction(),updateWhileAnimating:true,updateWhileInteracting:true});D["a"](this,"change:active",this.updateState_,this);this.set("dirty",false);this.set("drawing",false);this.set("valid",false)};T["d"](zi,ve["a"]);zi.prototype.setMap=function(e){var t=this.getMap();if(t){if(this.changeEventKey_){D["e"](this.changeEventKey_)}}ve["a"].prototype.setMap.call(this,e);if(e){this.changeEventKey_=D["a"](e.getView(),"change:center",this.handleViewCenterChange_,this)}this.updateState_()};zi.prototype.getDirty=function(){return this.get("dirty")};zi.prototype.getDrawing=function(){return this.get("drawing")};zi.prototype.getValid=function(){return this.get("valid")};zi.prototype.getFeature=function(){return this.sketchFeature_};zi.prototype.addToDrawing=function(){var e=this.getActive();var t=this.getDrawing();if(!e||!t){return}var r=void 0;var a=this.getSketchPointGeometry_();var n=a.getCoordinates();var i=void 0;if(this.type_==="Point"){if(!this.sketchFeature_){this.sketchFeature_=new Le["a"](new ke["a"](n));var o=new C["a"]("drawstart",{feature:this.sketchFeature_});this.dispatchEvent(o)}r=this.sketchFeature_.getGeometry();h["a"].assertInstanceof(r,Yi["a"]);r.setCoordinates(n);return}if(this.type_==="LineString"){this.sketchPoints_.push(this.sketchPoint_);if(!this.sketchFeature_){i=[n.slice(),n.slice()];this.sketchFeature_=new Le["a"](new Re["a"](i));var s=new C["a"]("drawstart",{feature:this.sketchFeature_});this.dispatchEvent(s)}else{r=this.sketchFeature_.getGeometry();h["a"].assertInstanceof(r,Yi["a"]);i=r.getCoordinates();i.push(n.slice());r.setCoordinates(i)}}var l=this.getDirty();if(l){this.set("dirty",false)}var u=this.getValid();if(this.type_==="LineString"){if(i.length>=this.minPoints_){if(!u){this.set("valid",true)}}else{if(u){this.set("valid",false)}}}this.sketchPoint_=null;this.updateSketchFeatures_()};zi.prototype.clearDrawing=function(){this.setActive(false);this.setActive(true)};zi.prototype.finishDrawing=function(){var e=this.getActive();var t=this.getDrawing();if(!e||!t){return}if(this.sketchPoint_){this.addToDrawing()}this.set("drawing",false);var r=new C["a"]("drawend",{feature:this.sketchFeature_});this.dispatchEvent(r)};zi.prototype.startDrawing_=function(){this.set("drawing",true);this.createOrUpdateSketchPoint_();this.updateSketchFeatures_();if(this.type_==="Point"){this.addToDrawing()}};zi.prototype.modifyDrawing_=function(){if(!this.sketchFeature_){return}var e=this.getCenter_();if(this.type_==="LineString"){var t=this.sketchFeature_.getGeometry();h["a"].assertInstanceof(t,Yi["a"]);var r=t.getCoordinates();r.pop();r.push(e);t.setCoordinates(r)}var a=this.getDirty();if(!a){this.set("dirty",true)}};zi.prototype.abortDrawing_=function(){var e=this.sketchFeature_;if(e||this.sketchPoints_.length>0){this.sketchFeature_=null;this.sketchPoint_=null;this.overlay_.getSource().clear(true)}this.sketchPoints_=[];this.set("dirty",false);this.set("drawing",false);this.set("valid",false);return e};zi.prototype.updateState_=function(){var e=this.getMap();var t=this.getActive();if(!e||!t){this.abortDrawing_()}else{this.startDrawing_()}this.overlay_.setMap(t?e:null)};zi.prototype.handleViewCenterChange_=function(e){var t=this.getActive();var r=this.getDrawing();if(!t||!r){return}this.createOrUpdateSketchPoint_();if(this.type_==="Point"){this.addToDrawing()}else{this.modifyDrawing_();this.updateSketchFeatures_()}};zi.prototype.createOrUpdateSketchPoint_=function(){var e=this.getCenter_();if(this.sketchPoint_){var t=this.getSketchPointGeometry_();t.setCoordinates(e)}else{this.sketchPoint_=new Le["a"](new ke["a"](e))}};zi.prototype.updateSketchFeatures_=function(){var e=[];if(this.sketchFeature_){e.push(this.sketchFeature_)}if(this.sketchPoint_){e.push(this.sketchPoint_)}var t=this.overlay_.getSource();t.clear(true);t.addFeatures(e);t.addFeatures(this.sketchPoints_)};zi.prototype.getSketchPointGeometry_=function(){h["a"].assert(this.sketchPoint_,"sketch point should be thruty");var e=this.sketchPoint_.getGeometry();h["a"].assertInstanceof(e,ke["a"]);return e};zi.prototype.getCenter_=function(){var e=this.getMap().getView().getCenter();h["a"].assertArray(e);return e};var Qi=zi;var Xi=function e(t,r,a){var n=a!==undefined?a:{};Gt["a"](n,{displayHelpTooltip:false});na.call(this,t,r,n)};T["d"](Xi,na);Xi.prototype.createDrawInteraction=function(e,t){return new Qi({type:"LineString",style:e,source:t})};var Zi=Xi;var Ji=angular.module("gmfMobileMeasureLength",[ie.name]);Ji.value("gmfMobileMeasureLengthTemplateUrl",function(e,t){var r=t["gmfMobileMeasureLengthTemplateurl"];return r!==undefined?r:"gmf/measure/lengthComponent"});Ji.run(["$templateCache",function(e){e.put("gmf/measure/lengthComponent",r(292))}]);Ji.component_=function(e){return{restrict:"A",scope:{active:"=gmfMobileMeasurelengthActive",precision:"<?gmfMobileMeasurelengthPrecision",map:"=gmfMobileMeasurelengthMap",sketchStyle:"=?gmfMobileMeasurelengthSketchstyle"},controller:"GmfMobileMeasureLengthController as ctrl",bindToController:true,templateUrl:e,link:function e(t,r,a,n){n.init()}}};Ji.component_.$inject=["gmfMobileMeasureLengthTemplateUrl"];Ji.directive("gmfMobileMeasurelength",Ji.component_);Ji.Controller_=function(e,t,r){var a=this;this.scope_=e;this.filter_=t;this.gettextCatalog_=r;this.map;this.active;this.scope_.$watch(function(){return a.active},function(e){a.measure.setActive(e)});this.precision;this.sketchStyle=new we["c"]({fill:new Se["a"]({color:"rgba(255, 255, 255, 0.2)"}),stroke:new be["a"]({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ze["a"]({stroke:new be["a"]({color:"rgba(0, 0, 0, 0.7)",width:2}),points:4,radius:8,radius2:0,angle:0})});this.measure;this.drawInteraction;this.dirty=false;this.drawing=false;this.valid=false};Ji.Controller_.$inject=["$scope","$filter","gettextCatalog"];Ji.Controller_.prototype.init=function(){this.measure=new Zi(this.filter_("ngeoUnitPrefix"),this.gettextCatalog_,{precision:this.precision,sketchStyle:this.sketchStyle});this.measure.setActive(this.active);jr["a"].interaction(this.measure);this.drawInteraction=this.measure.getDrawInteraction();var e=this.drawInteraction;jr["a"].interaction(e);Object.defineProperty(this,"hasPoints",{get:function e(){return this.drawInteraction.getFeature()!==null}});D["a"](e,"change:dirty",function(){this.dirty=e.getDirty();if(this.dirty){this.scope_.$apply()}},this);D["a"](e,"change:drawing",function(){this.drawing=e.getDrawing()},this);D["a"](e,"change:valid",function(){this.valid=e.getValid()},this);this.map.addInteraction(this.measure)};Ji.Controller_.prototype.addPoint=function(){this.drawInteraction.addToDrawing()};Ji.Controller_.prototype.clear=function(){this.drawInteraction.clearDrawing()};Ji.Controller_.prototype.finish=function(){this.drawInteraction.finishDrawing()};Ji.Controller_.prototype.deactivate=function(){this.active=false};Ji.controller("GmfMobileMeasureLengthController",Ji.Controller_);var eo=Ji;var to=function e(t,r){this.$http_=t;this.url_=r};to.$inject=["$http","gmfRasterUrl"];to.$inject=["$http","gmfRasterUrl"];to.prototype.getRaster=function(e,t){var r=t||{};r[to.Param.X]=e[0];r[to.Param.Y]=e[1];return this.$http_.get(this.url_,{params:r}).then(this.handleGetRaster_.bind(this))};to.prototype.handleGetRaster_=function(e){return e.data};to.Param={X:"lon",Y:"lat"};to.module=angular.module("gmfRaster",[]);to.module.service("gmfRaster",to);var ro=to;var ao=function e(t,r){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};Gt["a"](a,{displayHelpTooltip:false});Te.call(this,a);this.format_=t;this.coordFormat_=r};T["d"](ao,Te);ao.prototype.createDrawInteraction=function(e,t){return new Qi({type:"Point",style:e,source:t})};ao.prototype.handleMeasure=function(e){var t=h["a"].assertInstanceof(this.sketchFeature.getGeometry(),ke["a"]);var r=this.decimals;var a=Te.getFormattedPoint(t,r,this.format_,this.coordFormat_);var n=t.getLastCoordinate();e(a,n)};var no=ao;var io=angular.module("gmfMobileMeasurePoint",[ro.module.name,Ri["a"].name]);io.value("gmfMobileMeasurePointTemplateUrl",function(e,t){var r=t["gmfMobileMeasurePointTemplateurl"];return r!==undefined?r:"gmf/measure/pointComponent"});io.run(["$templateCache",function(e){e.put("gmf/measure/pointComponent",r(291))}]);io.component_=function(e){return{restrict:"A",scope:{active:"=gmfMobileMeasurepointActive",getCoordinateDecimalsFn:"&?gmfMobileMeasurepointCoordinatedecimals",getLayersConfigFn:"&gmfMobileMeasurepointLayersconfig",map:"=gmfMobileMeasurepointMap",sketchStyle:"=?gmfMobileMeasurepointSketchstyle",format:"<gmfMobileMeasurepointFormat"},controller:"GmfMobileMeasurePointController as ctrl",bindToController:true,templateUrl:e,link:function e(t,r,a,n){n.init()}}};io.component_.$inject=["gmfMobileMeasurePointTemplateUrl"];io.directive("gmfMobileMeasurepoint",io.component_);io.Controller_=function(e,t,r,a,n){var i=this;this.gmfRaster_=a;this.ngeoDebounce_=n;this.gettextCatalog_=e;this.$filter_=r;this.map;this.active;t.$watch(function(){return i.active},function(e){i.measure.setActive(e);i.handleMeasureActiveChange_()});var o=this["getCoordinateDecimalsFn"];this.coordinateDecimals=o?o():0;this.layersConfig;this.sketchStyle;if(this.sketchStyle===undefined){this.sketchStyle=new we["c"]({fill:new Se["a"]({color:"rgba(255, 255, 255, 0.2)"}),stroke:new be["a"]({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ze["a"]({stroke:new be["a"]({color:"rgba(0, 0, 0, 0.7)",width:2}),points:4,radius:8,radius2:0,angle:0})})}this.format;this.measure;this.drawInteraction;this.mapViewPropertyChangeEventKey_=null};io.Controller_.$inject=["gettextCatalog","$scope","$filter","gmfRaster","ngeoDebounce"];io.Controller_.prototype.init=function(){this.measure=new no(this.$filter_("ngeoNumberCoordinates"),this.format||"{x}, {y}",{decimals:this.coordinateDecimals,sketchStyle:this.sketchStyle});this.measure.setActive(this.active);jr["a"].interaction(this.measure);this.drawInteraction=this.measure.getDrawInteraction();jr["a"].interaction(this.drawInteraction);var e=this["getLayersConfigFn"]();h["a"].assert(Array.isArray(e));this.layersConfig=e;this.map.addInteraction(this.measure)};io.Controller_.prototype.deactivate=function(){this.active=false};io.Controller_.prototype.translate=function(e){return this.gettextCatalog_.getString(e)};io.Controller_.prototype.handleMeasureActiveChange_=function(){if(this.measure.getActive()){var e=this.map.getView();this.mapViewPropertyChangeEventKey_=D["a"](e,"propertychange",this.ngeoDebounce_(this.getMeasure_.bind(this),300,true),this);this.getMeasure_()}else if(this.mapViewPropertyChangeEventKey_){D["e"](this.mapViewPropertyChangeEventKey_);this.mapViewPropertyChangeEventKey_=null}};io.Controller_.prototype.getMeasure_=function(){var e=this;var t=this.map.getView().getCenter();h["a"].assertArray(t);var r={layers:this.layersConfig.map(function(e){return e.name}).join(",")};this.gmfRaster_.getRaster(t,r).then(function(t){var r=e.measure.getTooltipElement();var a=document.createElement("div");var n="gmf-mobile-measure-point";a.className=n;for(var i=e.layersConfig,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;var c=u.name;if(c in t){var f=t[c];var h=document.createElement("div");h.className="gmf-mobile-measure-point-"+c;var p=u.unit||"";var d=u.decimals&&u.decimals>0||0;f=e.$filter_("number")(f,d);h.innerHTML=[e.translate(c),": ",f," ",p].join("");a.appendChild(h)}}var g=r.getElementsByClassName(n);if(g[0]){g[0].remove()}r.appendChild(a)})};io.controller("GmfMobileMeasurePointController",io.Controller_);io.LayerConfig;var oo=io;var so=angular.module("gmfMobileMeasureModule",[eo.name,oo.name]);var lo=so;var uo=r(255);var co=angular.module("gmfMobileNavigationModule",[uo["a"].name]);var fo=co;var ho=r(87);var po=r(358);var go=angular.module("ngeoMobileGeolocation",[Ga["a"].module.name,u["a"].module.name]);go.GeolocationEventType={ERROR:"mobile-geolocation-error"};go.directive_=function(){return{restrict:"A",scope:{getMobileMapFn:"&ngeoMobileGeolocationMap",getMobileGeolocationOptionsFn:"&ngeoMobileGeolocationOptions"},controller:"ngeoGeolocationMobileController"}};go.directive("ngeoMobileGeolocation",go.directive_);go.Controller_=function(e,t,r,a,n){var i=this;t.on("click",this.toggleTracking.bind(this));var o=e["getMobileMapFn"]();h["a"].assertInstanceof(o,_n["a"]);this.$scope_=e;this.map_=o;var s=e["getMobileGeolocationOptionsFn"]()||{};h["a"].assertObject(s);this.notification_=n;this.featureOverlay_=a.getFeatureOverlay();this.geolocation_=new po["a"]({projection:o.getView().getProjection(),trackingOptions:{enableHighAccuracy:true}});if(s.autorotate){this.autorotateListener()}this.geolocation_.on("error",function(t){i.untrack_();var a=void 0;switch(t.code){case 1:a=r.getString("User denied the request for Geolocation.");break;case 2:a=r.getString("Location information is unavailable.");break;case 3:a=r.getString("The request to get user location timed out.");break;default:a=r.getString("Geolocation: An unknown error occurred.");break}i.notification_.error(a);e.$emit(go.GeolocationEventType.ERROR,t)});this.positionFeature_=new Le["a"];if(s.positionFeatureStyle){this.positionFeature_.setStyle(s.positionFeatureStyle)}this.accuracyFeature_=new Le["a"];if(s.accuracyFeatureStyle){this.accuracyFeature_.setStyle(s.accuracyFeatureStyle)}this.zoom_=s.zoom;this.follow_=false;this.viewChangedByMe_=false;D["a"](this.geolocation_,"change:accuracyGeometry",function(){i.accuracyFeature_.setGeometry(i.geolocation_.getAccuracyGeometry());i.setPosition_()});D["a"](this.geolocation_,"change:position",function(){i.setPosition_()});var l=o.getView();D["a"](l,"change:center",this.handleViewChange_,this);D["a"](l,"change:resolution",this.handleViewChange_,this)};go.Controller_.$inject=["$scope","$element","gettextCatalog","ngeoFeatureOverlayMgr","ngeoNotification"];go.Controller_.prototype.toggleTracking=function(){if(this.geolocation_.getTracking()){var e=this.geolocation_.getPosition();if(e===undefined){this.untrack_();this.$scope_.$emit(go.GeolocationEventType.ERROR,null);return}h["a"].assert(e!==undefined);var t=this.map_.getView().getCenter();var r=Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1]);if(r<2){this.untrack_()}else{this.untrack_();this.track_()}}else{this.track_()}};go.Controller_.prototype.track_=function(){this.featureOverlay_.addFeature(this.positionFeature_);this.featureOverlay_.addFeature(this.accuracyFeature_);this.follow_=true;this.geolocation_.setTracking(true)};go.Controller_.prototype.untrack_=function(){this.featureOverlay_.clear();this.follow_=false;this.geolocation_.setTracking(false);this.notification_.clear()};go.Controller_.prototype.setPosition_=function(){var e=this.geolocation_.getPosition();var t=new ke["a"](e);this.positionFeature_.setGeometry(t);var r=this.accuracyFeature_.getGeometry();if(this.follow_){this.viewChangedByMe_=true;if(this.zoom_!==undefined){this.map_.getView().setCenter(e);this.map_.getView().setZoom(this.zoom_)}else if(r){var a=this.map_.getSize();this.map_.getView().fit(r,a)}this.viewChangedByMe_=false}};go.Controller_.prototype.handleViewChange_=function(e){if(this.follow_&&!this.viewChangedByMe_){this.follow_=false}};go.Controller_.prototype.autorotateListener=function(){var e=this;var t=0;if(window.hasOwnProperty("ondeviceorientationabsolute")){window.addEventListener("deviceorientationabsolute",function(r){t=e.handleRotate_(r.alpha,t)},true)}else if(window.hasOwnProperty("ondeviceorientation")){window.addEventListener("deviceorientation",function(r){if(r.webkitCompassHeading){t=e.handleRotate_(-r.webkitCompassHeading,t)}else{t=e.handleRotate_(r.alpha-270,t)}},true)}else{console.error("Orientation is not supported on this device")}};go.Controller_.prototype.handleRotate_=function(e,t){if(this.geolocation_.getTracking()&&Math.abs(e-t)>.2){t=e;var r=t*Math.PI/180;this.map_.getView().animate({rotation:r,duration:350,easing:ho["d"]})}return t};go.controller("ngeoGeolocationMobileController",go.Controller_);var mo=go;var vo=r(232);var yo=r(261);var _o=r(228);var So=r(229);var bo=r(274);var wo=function e(t,r,a){var n=this;this.leftNavVisible=false;this.rightNavVisible=false;this.searchOverlayVisible=false;this.searchListeners={open:function(){this.searchOverlayVisible=true}.bind(this),close:function(){this.searchOverlayVisible=false}.bind(this)};var i=t.positionFeatureStyle||new we["c"]({image:new Ye["a"]({radius:6,fill:new Se["a"]({color:"rgba(230, 100, 100, 1)"}),stroke:new be["a"]({color:"rgba(230, 40, 40, 1)",width:2})})});var o=t.accuracyFeatureStyle||new we["c"]({fill:new Se["a"]({color:"rgba(100, 100, 230, 0.3)"}),stroke:new be["a"]({color:"rgba(40, 40, 230, 1)",width:2})});this.mobileGeolocationOptions={positionFeatureStyle:i,accuracyFeatureStyle:o,zoom:t.geolocationZoom,autorotate:t.autorotate};var s={projection:de["f"]("EPSG:"+(t.srid||21781))};Gt["a"](s,t.mapViewConfig||{});var l=Ki.prototype.getLocationIcon();this.map=new _n["a"]({pixelRatio:t.mapPixelRatio,layers:[],view:new vo["a"](s),controls:t.mapControls||[new yo["a"],new _o["a"]({zoomInTipLabel:"",zoomOutTipLabel:""}),new So["a"]({label:l,tipLabel:""})],interactions:t.mapInteractions||bo["a"]({pinchRotate:true})});Ki.call(this,t,r,a);this.manageResize=true;this.resizeTransition=500;r.$watch(function(){return n.gmfUser.username},function(e){if(e!==null&&n.navIsVisible()){n.rightNavVisible=false}});this.redirectUrl=a.get("redirectUrl")};wo.$inject=["config","$scope","$injector"];wo.$inject=["config","$scope","$injector"];T["d"](wo,Ki);wo.prototype.toggleLeftNavVisibility=function(){this.leftNavVisible=!this.leftNavVisible};wo.prototype.toggleRightNavVisibility=function(){this.rightNavVisible=!this.rightNavVisible};wo.prototype.hideNav=function(){this.leftNavVisible=this.rightNavVisible=false};wo.prototype.navIsVisible=function(){return this.leftNavVisible||this.rightNavVisible};wo.prototype.hideSearchOverlay=function(){this.searchOverlayVisible=false};wo.prototype.leftNavIsVisible=function(){return this.leftNavVisible};wo.prototype.rightNavIsVisible=function(){return this.rightNavVisible};wo.prototype.openNavMenu=function(e){var t=document.getElementsByClassName("gmf-mobile-nav-button");for(var r=0;r<t.length;r++){var a=t[r];if(a.dataset&&a.dataset.target===e){a.click()}}};wo.module=angular.module("GmfAbstractMobileControllerModule",[Ki.module.name,lo.name,fo.name,oi.name,mo.name]);wo.module.controller("AbstractMobileController",wo);wo.module.value("isMobile",true);wo.module.value("ngeoQueryOptions",{tolerance:10});var Co=wo;var To=r(371);var Eo={};Eo.module=angular.module("app",[]);Eo.module.config(["$compileProvider",function(e){if(!("debug"in oe["a"].decodeQueryString(window.location.search))){e.debugInfoEnabled(false)}}]);var Mo=Eo;var Lo=r(275);var Ao=r(201);var Fo=r(131);var Po=["+proj="+Ao["a"],"+lat_0=46.95240555555556","+lon_0=7.439583333333333","+k_0=1","+x_0=2600000","+y_0=1200000","+ellps=bessel","+towgs84=674.374,15.056,405.346,0,0,0,0","+units=m","+no_defs"].join(" ");var Ro=[242e4,103e4,29e5,135e4];Fo["a"].defs("EPSG:2056",Po);Lo["a"](Fo["a"]);de["f"]("EPSG:2056").setExtent(Ro);var ko="EPSG:2056";var xo=ko;var Do=r(202);var Oo=r(254);var $o=r.n(Oo);var Io=r(253);var No=r.n(Io);if(!window.requestAnimationFrame){alert("Your browser is not supported, please update it or use another one. You will be redirected.\n\n"+"Votre navigateur n'est pas supporté, veuillez le mettre à jour ou en utiliser un autre. Vous allez être redirigé.\n\n"+"Ihr Browser wird nicht unterstützt, bitte aktualisieren Sie ihn oder verwenden Sie einen anderen. Sie werden weitergeleitet.");window.location="http://geomapfish.org/"}var Go=function e(t,r){Co.call(this,{autorotate:false,srid:21781,mapViewConfig:{center:[632464,185457],zoom:3,resolutions:[250,100,50,20,10,5,2,1,.5,.25,.1,.05]}},t,r);this.elevationLayersConfig=[{name:"aster",unit:"m"},{name:"srtm",unit:"m"}];this.searchCoordinatesProjections=[Do["a"],xo,"EPSG:4326"];if(r.has("sentryUrl")){var a=r.has("sentryOptions")?r.get("sentryOptions"):undefined;var n=new $o.a;n.config(r.get("sentryUrl"),a).addPlugin(No.a).install()}};Go.$inject=["$scope","$injector"];Go.$inject=["$scope","$injector"];T["d"](Go,Co);Go.module=angular.module("Appmobile",[Mo.module.name,Co.module.name]);Go.module.controller("MobileController",Go);var Uo=t["default"]=Go},,,,,function(e,t){e.exports='<a class="btn btn-default" ng-if=ctrl.active ng-click=ctrl.deactivate()> <span class="fa fa-times"></span> {{\'Close\' | translate}} </a> '},function(e,t){e.exports='<a class="btn btn-default" ng-if="ctrl.drawing && (!ctrl.valid)" ng-click=ctrl.addPoint()> <span class="fa fa-check"></span> {{\'Set as starting point\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.dirty ng-click=ctrl.addPoint()> <span class="fa fa-plus"></span> {{\'Add new point\' | translate}} </a> <a class="btn btn-default" ng-if="ctrl.drawing && ctrl.valid && !ctrl.dirty" ng-click=ctrl.finish()> <span class="fa fa-check"></span> {{\'Terminate\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.valid ng-click=ctrl.clear()> <span class="fa fa-repeat"></span> {{\'Clear\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.active ng-click=ctrl.deactivate()> <span class="fa fa-times"></span> {{\'Close\' | translate}} </a> '},,function(e,t){e.exports='<div class=ngeo-displaywindow ng-show=$ctrl.open ng-style=$ctrl.style> <div class=windowcontainer> <button type=button class="btn fa-close close" ng-click=$ctrl.close()> </button> <div class=animation-container> <div class=slide-animation> <div class="header ui-draggable-handle" ng-if="$ctrl.title !== null"> <p class=title>{{$ctrl.title | translate}}</p> </div> <div class="details content" ng-if=$ctrl.content ng-bind-html=$ctrl.content> </div> <div class="details iframe" ng-if="$ctrl.url !== null"> <iframe frameborder=0 type=text/html height=100% width=100% ng-src="{{ $ctrl.urlTrusted }}"></iframe> </div> </div> </div> </div> </div> '},function(e,t){e.exports='<ul class=gmf-theme-selector> <li ng-repeat="theme in $ctrl.themes" ng-click=$ctrl.setTheme(theme) ng-class="{\'gmf-theme-selector-active\': $ctrl.gmfThemeManager.getThemeName() == theme.name}"> <img class=gmf-thumb ng-src={{::theme.icon}} /> <span class=gmf-text>{{theme.name | translate}}</span> </li> </ul> '},function(e,t){e.exports='<div class=gmf-search> <input type=text ng-attr-placeholder={{$ctrl.placeholder|translate}} class=form-control ng-model=$ctrl.inputValue ngeo-search=$ctrl.options ngeo-search-datasets=$ctrl.datasets ngeo-search-listeners=$ctrl.listeners> <span class="gmf-clear-button ng-hide" ng-hide="!$ctrl.clearButton || $ctrl.inputValue == \'\'" ng-click=$ctrl.onClearButton()> </span> </div> <span ng-if=$ctrl.colorChooser> <span ng-show=$ctrl.displayColorPicker ngeo-popover ngeo-popover-placement=bottom> <button class="gmf-color-button fa fa-tint" ngeo-popover-anchor data-original-title="{{\'Change the color of the search result\'|translate}}"></button> <div ngeo-popover-content> <div ngeo-colorpicker ngeo-colorpicker-color=$ctrl.color></div> </div> </span> </span> '},,,,,,,function(e,t){e.exports='<table class=ngeo-colorpicker-palette> <tr ng-repeat="colors in ::ctrl.colors"> <td ng-repeat="color in ::colors" ng-click=ctrl.setColor(color) ng-class="{\'ngeo-colorpicker-selected\': color == ctrl.color}"> <div ng-style="::{\'background-color\': color}"></div> </td> </tr> </table> '},function(e,t){e.exports='<div class=gmf-displayquerywindow ng-class="{\'desktop\': ctrl.desktop, \'mobile\': !ctrl.desktop}" ng-show=ctrl.open ngeo-swipe-up="ctrl.collapsed = false" ngeo-swipe-down="ctrl.collapsed = true" ngeo-swipe-disable-mouse ng-swipe-disable-mouse ng-swipe-left=ctrl.next() ng-swipe-right=ctrl.previous()> <button class=collapse-button type=button ng-show=::!ctrl.desktop ng-click="ctrl.collapsed = !ctrl.collapsed" ng-class="[ctrl.collapsed ? \'collapse-button-up\' : \'collapse-button-down\']"> </button> <div class=windowcontainer> <button type=button class="btn fa-close close" ng-click=ctrl.close()> </button> <div class=animation-container ng-class="[ctrl.collapsed ? \'\' : \'animation-container-detailed\', ctrl.isNext ? \'next\' : \'previous\']"> <div ng-animate-swap=ctrl.animate class="slide-animation gmf-animatable"> <div class=header> <p class=title>{{ctrl.source.label | translate}}</p> <p class=subtitle>{{ctrl.getFeatureValues()[ctrl.source.identifierAttributeField]}}</p> </div> <div class=details> <table> <tr ng-repeat="(key, value) in ctrl.getFeatureValues()" ng-if="value !== undefined"> <td class=details-key ng-bind-html="key | translate | ngeoTrustHtml"></td> <td class=details-value ng-bind-html="value | ngeoTrustHtml"></td> </tr> </table> </div> </div> </div> <div class=navigate> <div class=placeholder> <button type=button class="previous btn" ng-disabled=ctrl.isFirst() ng-show="ctrl.getResultLength() > 1" ng-click=ctrl.previous()> <span ng-show=::ctrl.desktop>{{\'Prev.\' | translate}}</span> </button> </div> <div class=results> <span ng-show=::!ctrl.desktop>{{\'Result\' | translate}}</span> <span>{{ctrl.currentResult + 1}}</span> <span>/</span> <span>{{ctrl.getResultLength()}}</span> <div ng-show=::ctrl.desktop class=dropup> <button type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span class="fa fa-filter"></span> <span class="fa fa-caret-up"></span> </button> <ul class="dropdown-menu dropdown-menu-right" role=menu> <li> <a href=# ng-click=ctrl.setSelectedSource(null)> <i class="fa fa-fw" ng-class="{\'fa-check\': ctrl.selectedSource === null}"> </i> <span>{{\'All layers\' | translate}} ({{ctrl.ngeoQueryResult.total}})</span> </a> </li> <li role=separator class=divider> </li> <li ng-repeat-start="source in ctrl.ngeoQueryResult.sources | filter: ctrl.sourcesFilter" ng-repeat-end ng-class="{\'disabled\': source.features.length <= 0}"> <a href=# ng-click=ctrl.setSelectedSource(source)> <i class="fa fa-fw" ng-class="{\'fa-check\': ctrl.selectedSource === source}"> </i> <span>{{source.label | translate}} ({{source.features.length}})</span> </a> </li> </ul> </div> </div> <div class=placeholder> <button type=button class="next btn" ng-disabled=ctrl.isLast() ng-show="ctrl.getResultLength() > 1" ng-click=ctrl.next()> <span ng-show=::ctrl.desktop>{{\'Next\' | translate}}</span> </button> </div> </div> </div> </div> '},,,,,,function(e,t){e.exports='<div class="gmf-displayquerygrid panel" ng-show=ctrl.active> <div class=close ng-click=ctrl.clear()> &times; </div> <ul class="nav nav-pills" role=tablist> <li ng-repeat="gridSource in ctrl.getGridSources() track by gridSource.source.label" role=presentation ng-class="{\'active\' : ctrl.isSelected(gridSource)}" ng-click=ctrl.selectTab(gridSource)> <a href=#{{ctrl.escapeValue(gridSource.source.label)}} data-target=#{{ctrl.escapeValue(gridSource.source.label)}} aria-controls={{ctrl.escapeValue(gridSource.source.label)}} role=tab data-toggle=tab> <span ng-if="gridSource.source.tooManyResults !== true"> {{gridSource.source.label | translate}} ({{gridSource.source.features.length}}) </span> <span ng-if="gridSource.source.tooManyResults === true"> {{gridSource.source.label | translate}} ({{gridSource.source.totalFeatureCount}}*) </span> </a> </li> </ul> <div class=tab-content> <div ng-repeat="gridSource in ctrl.getGridSources() track by gridSource.source.label" role=tabpanel class=tab-pane ng-class="{\'active\' : ctrl.isSelected(gridSource)}" id={{ctrl.escapeValue(gridSource.source.label)}}> <ngeo-grid ngeo-grid-configuration=gridSource.configuration ng-if="gridSource.source.tooManyResults !== true"> </ngeo-grid> <div ng-if="gridSource.source.tooManyResults === true"> <div class="gmf-displayquerygrid-message alert alert-warning"> <p><span translate>The results can not be displayed because the maximum number has been reached</span> ({{gridSource.source.limit}}).</p> <p translate>Please refine your query.</p> </div> </div> </div> </div> <div class=navbar ng-show="!ctrl.pending && ctrl.getActiveGridSource() && ctrl.getActiveGridSource().configuration !== null"> <ul class="nav navbar-nav navbar-right"> <li class=ng-hide ng-show=ctrl.isOneSelected()> <p class="navbar-text ng-binding"> {{ctrl.getSelectedRowCount()}} <span translate>selected element(s)</span> </p> </li> <li ng-show=ctrl.isOneSelected() class=ng-hide> <button class="btn btn-link btn-xs" title="{{\'Zoom to selection\' | translate}}" ng-click=ctrl.zoomToSelection()> <i class="fa fa-search-plus"></i> <span translate>Zoom to</span> </button> </li> <li ng-show=ctrl.isOneSelected() class=ng-hide> <button class="btn btn-link btn-xs" title="{{\'Export selection as CSV\' | translate}}" ng-click=ctrl.downloadCsv()> <i class="fa fa-download"></i> <span translate>Export as CSV</span> </button> </li> <li class="dropdown navbar-link dropup"> <button type=button class="dropup btn btn-default btn-xs" data-toggle=dropdown aria-haspopup=true aria-expanded=false> <span translate>Select</span> <span class=caret></span> </button> <ul class=dropdown-menu aria-labelledby=dLabel> <li> <a href="" ng-click=ctrl.selectAll() translate>All</a> </li> <li> <a href="" ng-click=ctrl.unselectAll() translate>None</a> </li> <li> <a href="" ng-click=ctrl.invertSelection() translate>Reverse selection</a> </li> </ul> </li> </ul> </div> <div ng-show=ctrl.pending class=gmf-displayquerygrid-pending> <span class="fa fa-spinner fa-spin"></span> </div> </div> '},function(e,t){e.exports='<div class=ngeo-grid-table-container> <table float-thead=ctrl.floatTheadConfig ng-model=ctrl.configuration.data class="table table-bordered table-striped table-hover"> <thead class=table-header> <tr> <th ng-repeat="columnDefs in ctrl.configuration.columnDefs" ng-click=ctrl.sort(columnDefs.name) ng-bind-html="columnDefs.name | ngeoTrustHtml | translate"> <i ng-show="ctrl.sortedBy !== columnDefs.name" class="fa fa-fw"></i> <i ng-show="ctrl.sortedBy === columnDefs.name && ctrl.sortAscending === true" class="fa fa-caret-up"></i> <i ng-show="ctrl.sortedBy === columnDefs.name && ctrl.sortAscending === false" class="fa fa-caret-down"></i> </th> </tr> </thead> <tbody> <tr ng-repeat="attributes in ctrl.configuration.data" ng-class="[\'row-\' + ctrl.configuration.getRowUid(attributes), ctrl.configuration.isRowSelected(attributes) ? \'ngeo-grid-active\': \'\']" ng-click="ctrl.clickRow(attributes, $event)" ng-mousedown=ctrl.preventTextSelection($event)> <td ng-repeat="columnDefs in ctrl.configuration.columnDefs" ng-bind-html="attributes[columnDefs.name] | ngeoTrustHtml"></td> </tr> </tbody> </table> </div> '},,,function(e,t){e.exports='<div class="btn-group dropup"> <a type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span class=gmf-mouseposition-control-target></span> <span class=caret></span> </a> <ul class="dropdown-menu dropdown-menu-right" role=menu> <li class=dropdown-header translate>Coordinate systems</li> <li ng-repeat="projitem in ::ctrl.projections"> <a href ng-click=ctrl.setProjection(projitem)> <span class="fa fa-fw" ng-class="{\'fa-check\': ctrl.projection == projitem}"></span> {{::projitem.label}} </a> </li> </ul> </div> '},function(e,t){e.exports="<div ngeo-map=ctrl.map ngeo-map-manage-resize=ctrl.manageResize ngeo-map-resize-transition=ctrl.resizeTransition> </div> "},function(e,t){e.exports='<div class="btn-group btn-block" ng-class="::{\'dropup\': scaleselectorCtrl.options.dropup}"> <button type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span ng-bind-html="scaleselectorCtrl.currentScale | ngeoScalify | ngeoTrustHtml"></span>&nbsp;<i class=caret></i> </button> <ul class="dropdown-menu btn-block" role=menu> <li ng-repeat="zoomLevel in ::scaleselectorCtrl.zoomLevels"> <a href ng-click=scaleselectorCtrl.changeZoom(zoomLevel) ng-bind-html="scaleselectorCtrl.getScale(zoomLevel) | ngeoScalify | ngeoTrustHtml"> </a> </li> </ul> </div> '},,,,,,,,,function(e,t){e.exports='<div class=modal-header> <button type=button class=close data-dismiss=modal aria-label=Close><span aria-hidden=true>&times;</span></button> <h4 class=modal-title translate>Share this map</h4> </div> <div class=modal-body> <form role=form name=gmfShareForm novalidate> <div class=form-group> <label for=gmfShareInputShortLink translate>Permalink</label> <input type=text class=form-control id=gmfShareInputShortLink onclick=this.select() ng-model=$ctrl.shortLink readonly=True> <p class=help-block translate>Copy this link to share it.</p> <p class=text-danger ng-if=$ctrl.showLengthWarning> <span class="fa fa-exclamation-triangle"></span> {{\'You have a lot of drawn elements in this map. The above link may not be correctly supported by some browsers.\' | translate}} </p> <p class=text-danger ng-if=$ctrl.errorOnGetShortUrl> <span class="fa fa-exclamation"></span> {{\'Error, cannot get the shortened URL.\' | translate}} </p> </div> <hr> <div class=gmf-share-email ng-if=::$ctrl.enableEmail> <div class=form-group> <label for=gmfShareInputEmail translate>Send this link to</label> <input type=email class=form-control name=inputEmail id=gmfShareInputEmail placeholder=E-mail ng-model=$ctrl.email required> <span ng-show="gmfShareForm.$submitted || gmfShareForm.inputEmail.$touched"> <span class=text-danger ng-show="gmfShareForm.inputEmail.$error.email || gmfShareForm.inputEmail.$error.required"> <i class="fa fa-exclamation-triangle" aria-hidden=true></i> {{\'Invalid email.\' | translate}}</span> </span> </div> <div class=form-group> <textarea class=form-control ng-attr-placeholder="{{\'Message (optional)\' | translate }}" ng-model=$ctrl.message></textarea> </div> <span class=text-success ng-if=$ctrl.successfullySent> <i class="fa fa-check" aria-hidden=true></i> {{ \'Link successfully sent.\' | translate }} </span> <span class=text-danger ng-if=$ctrl.errorOnsend> <i class="fa fa-exclamation" aria-hidden=true></i> {{ \'Error, the link has not been sent.\' | translate }} </span> </div> <div class=text-right> <button type=button class="btn btn-default" data-dismiss=modal translate>Close</button> <button ng-if=::$ctrl.enableEmail type=submit class="btn btn-default btn-primary" ng-click=$ctrl.sendShortUrl() ng-disabled=!gmfShareForm.$valid translate>Send </button> </div> </form> </div> '},function(e,t){e.exports='<div class=gmf-time-slider> <div ui-slider=sliderCtrl.sliderOptions ng-model=sliderCtrl.dates> <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex=0 data-toggle=tooltip title=""> </span> </div> <div class=gmf-time-slider-displayed-dates> <div class=gmf-time-slider-start-date ng-if="::sliderCtrl.time.mode === \'range\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates[0])}}</span> </div> <div class=gmf-time-slider-start-date ng-if="::sliderCtrl.time.mode === \'value\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates)}}</span> </div> <div class=gmf-time-slider-end-date ng-if="::sliderCtrl.time.mode === \'range\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates[1])}}</span> </div> </div> </div> '},,,,function(e,t){e.exports='<div class=gmf-layertree-root-tools ng-if=layertreeCtrl.isRoot> <a href ng-if="gmfLayertreeCtrl.nodesCount() > 0" ng-click=gmfLayertreeCtrl.removeAllNodes()> <span class="fa fa-trash"></span> {{\'Clear all\' | translate}} </a> </div> <div ng-if=::!layertreeCtrl.isRoot id=gmf-layertree-node-{{::layertreeCtrl.uid}} ng-class="[layertreeCtrl.node.children ? \'gmf-layertree-group\' : \'gmf-layertree-leaf\', \'gmf-layertree-depth-\' + layertreeCtrl.depth, gmfLayertreeCtrl.getResolutionStyle(layertreeCtrl.node), gmfLayertreeCtrl.getNodeState(layertreeCtrl)]"> <div class=ngeo-sortable-handle ng-show="layertreeCtrl.depth === 1 && layertreeCtrl.parent.children.length > 1"> <i class="gmf-layertree-sortable-handle-icon fa fa-ellipsis-v"></i> </div> <a ng-if=::layertreeCtrl.node.children data-toggle=collapse href=#gmf-layertree-layer-group-{{::layertreeCtrl.uid}} aria-expanded={{::layertreeCtrl.node.metadata.isExpanded}} class="fa gmf-layertree-expand-node fa-fw"> </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) ng-if=::!layertreeCtrl.node.children ng-class="::{\'gmf-layertree-no-layer-icon\' : !gmfLayertreeCtrl.getLegendIconURL(layertreeCtrl)}" class=gmf-layertree-layer-icon> <img ng-if="::(legendIconUrl=gmfLayertreeCtrl.getLegendIconURL(layertreeCtrl))" ng-src={{::legendIconUrl}}>  </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) ng-if=::layertreeCtrl.node.children> <span ng-switch="layertreeCtrl.node.children && !layertreeCtrl.layer.loading"> <i ng-switch-when=true class="fa fa-fw gmf-layertree-state"></i> <i ng-switch-when=false class="fa fa-fw fa-refresh fa-spin"></i> </span> </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) class=gmf-layertree-name data-toggle=tooltip data-placement=top title="{{layertreeCtrl.node.name | translate}}"> {{layertreeCtrl.node.name | translate}} <i class="gmf-icon gmf-icon-search-go gmf-layertree-zoom" data-toggle=tooltip data-placement=bottom data-title="{{\'Not visible at current scale. Click to zoom.\'|translate}}" ng-click="::gmfLayertreeCtrl.zoomToResolution(layertreeCtrl); $event.preventDefault(); $event.stopPropagation();" ng-if="gmfLayertreeCtrl.getNodeState(layertreeCtrl) == \'on\'"> </i> <span ngeo-popover ngeo-popover-dismiss=.content ng-if="gmfLayertreeCtrl.getNodeState(layertreeCtrl) !== \'off\' && layertreeCtrl.node.time && layertreeCtrl.node.time.mode !== \'disabled\'"> <span ngeo-popover-anchor class="fa fa-clock-o" ng-click="$event.preventDefault(); $event.stopPropagation()"> </span> <div ngeo-popover-content> <ngeo-date-picker ng-if="::layertreeCtrl.node.time.widget === \'datepicker\'" time=layertreeCtrl.node.time on-date-selected="gmfLayertreeCtrl.updateWMSTimeLayerState(layertreeCtrl, time)"> </ngeo-date-picker> <gmf-time-slider ng-if="::layertreeCtrl.node.time.widget === \'slider\'" gmf-time-slider-time=layertreeCtrl.node.time gmf-time-slider-on-date-selected="gmfLayertreeCtrl.updateWMSTimeLayerState(layertreeCtrl, time)"> </gmf-time-slider> </div> </span> <span class="fa fa-pencil" data-toggle=tooltip data-placement=right title="{{\'Currently editing this layer\'|translate}}" ng-if=layertreeCtrl.properties.editing> </span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-if="::layertreeCtrl.depth == 1" ng-click=gmfLayertreeCtrl.removeNode(layertreeCtrl.node)> <span class="fa fa-trash"></span> </a> <a class=gmf-layertree-node-menu-btn href="" ng-if=::gmfLayertreeCtrl.supportsCustomization(layertreeCtrl) ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-menu-\' + layertreeCtrl.uid)"> <span class="fa fa-cog"></span> </a> <span ngeo-popover ng-if="::(layertreeCtrl.depth === 1 && !layertreeCtrl.node.mixed) || (layertreeCtrl.depth > 1 && layertreeCtrl.parent.node.mixed && !layertreeCtrl.node.children) || (gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend) || layertreeCtrl.getDataSource().filtrable" ngeo-popover-dismiss=.content> <span ngeo-popover-anchor class="extra-actions fa fa-cog"> </span> <div ngeo-popover-content> <ul> <li ng-if="::(layertreeCtrl.depth === 1 && !layertreeCtrl.node.mixed) || (layertreeCtrl.depth > 1 && layertreeCtrl.parent.node.mixed)"> <i class="fa fa-tint fa-fw"></i> <span for=layer-opactity>{{\'Opacity\'|translate}}</span> <input class=input-action name=layer-opactity type=range min=0 max=1 step=0.01 ng-model=layertreeCtrl.layer.opacity /> </li> <li ng-if="::gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend"> <i class="fa fa-th-list fa-fw"></i> <a ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\'); popoverCtrl.dismissPopover()" data-toggle=collapse href=""> {{\'Show/hide legend\'|translate}} </a> </li> <li ng-if="layertreeCtrl.getDataSource() && layertreeCtrl.getDataSource().filtrable"> <i class="fa fa-filter fa-fw"></i> <a ng-click=gmfLayertreeCtrl.toggleFiltrableDataSource(layertreeCtrl.getDataSource()) href=""> {{\'Filter\'|translate}} </a> </li> </ul> </div> </span> <span class=gmf-layertree-metadata ng-if=::layertreeCtrl.node.metadata.metadataUrl> <span ng-if="::gmfLayertreeCtrl.openLinksInNewWindow === true"> <a title="{{\'More informations\'|translate}}" href={{::layertreeCtrl.node.metadata.metadataUrl}} target=blank_> </a> </span> <span ng-if="::gmfLayertreeCtrl.openLinksInNewWindow !== true"> <a title="{{\'More informations\'|translate}}" href="" ng-click=gmfLayertreeCtrl.displayMetadata(layertreeCtrl)> </a> </span> </span> </span> </div> <div class=gmf-layertree-node-menu id=gmf-layertree-node-menu-{{::layertreeCtrl.uid}} style=display:none ng-if=::gmfLayertreeCtrl.supportsCustomization(layertreeCtrl)> <div ng-if=::gmfLayertreeCtrl.supportsOpacityChange(layertreeCtrl)> <i class="fa fa-tint fa-fw"></i> <span for=layer-opactity>{{\'Opacity\'|translate}}</span> <input class=input-action name=layer-opactity type=range min=0 max=1 step=0.01 ng-model=layertreeCtrl.layer.opacity /> </div> <a class=gmf-layertree-node-menu-togglelegend ng-if=::gmfLayertreeCtrl.supportsLegend(layertreeCtrl) data-toggle=collapse ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')" href=""> <span class="fa fa-th-list"> </span> {{\'Show/hide legend\'|translate}} </a> </div> <div ng-if="::!layertreeCtrl.isRoot && gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend" id=gmf-layertree-node-{{::layertreeCtrl.uid}}-legend class="collapse gmf-layertree-legend" ng-class="::[layertreeCtrl.node.metadata.isLegendExpanded ? \'in\' : \'\']"> <a title="{{\'Hide legend\'|translate}}" data-toggle=collapse ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')" href=""> {{\'Hide legend\'|translate}} </a> <div ng-if="gmfLayertreeCtrl.isNodeLegendVisible(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')"> <div ng-repeat="(title, url) in gmfLayertreeCtrl.getLegendsObject(layertreeCtrl)"> <p ng-if="gmfLayertreeCtrl.getNumberOfLegendsObject(layertreeCtrl) > 1">{{title|translate}}</p> <img ng-src={{url}}> </div> </div> </div> <ul class=gmf-layertree-root-external-datasources ng-if="layertreeCtrl.isRoot && (gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmsGroups.length || gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmtsGroups.length || gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup.dataSources.length)"> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-repeat="wmtsGroup in gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmtsGroups" group=wmtsGroup> </gmf-datasourcegrouptree> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-repeat="wmsGroup in gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmsGroups" group=wmsGroup> </gmf-datasourcegrouptree> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-if=gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup.dataSources.length group=gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup> </gmf-datasourcegrouptree> </ul> <ul id=gmf-layertree-layer-group-{{::layertreeCtrl.uid}} ng-if=::layertreeCtrl.node.children ng-class="{collapse: !layertreeCtrl.isRoot, in : layertreeCtrl.node.metadata.isExpanded}" ngeo-sortable="::layertreeCtrl.isRoot && layertreeCtrl.node.children" ngeo-sortable-options="{handleClassName: \'ngeo-sortable-handle\', draggerClassName: \'gmf-layertree-dragger\', placeholderClassName : \'gmf-layertree-curr-drag-item\'}" ngeo-sortable-callback=::gmfLayertreeCtrl.afterReorder ngeo-sortable-callback-ctx=::gmfLayertreeCtrl> <li class=gmf-layertree-node ng-repeat="node in layertreeCtrl.node.children" ng-class="\'gmf-layertree-depth-\' + layertreeCtrl.depth" ngeo-layertree=node ngeo-layertree-notroot ngeo-layertree-map=layertreeCtrl.map ngeo-layertree-nodelayerexpr=layertreeCtrl.nodelayerExpr ngeo-layertree-listenersexpr=layertreeCtrl.listenersExpr> </li> </ul> '},function(e,t){e.exports='<span ng-if=::!layertreeCtrl.isRoot>{{::layertreeCtrl.node.name}}</span> <input type=checkbox ng-if="::layertreeCtrl.node && !layertreeCtrl.node.children" ng-model=layertreeCtrl.getSetActive ng-model-options="{getterSetter: true}"/> <ul ng-if=::layertreeCtrl.node.children> <li ng-repeat="node in ::layertreeCtrl.node.children" ngeo-layertree=::node ngeo-layertree-notroot ngeo-layertree-map=layertreeCtrl.map ngeo-layertree-nodelayerexpr=layertreeCtrl.nodelayerExpr ngeo-layertree-listenersexpr=layertreeCtrl.listenersExpr> </li> </ul> '},function(e,t){e.exports='<div class="gmf-layertree-group gmf-layertree-depth-1 {{$ctrl.group.visibilityState}}"> <a data-toggle=collapse href=#gmf-layertree-layer-group-{{::$ctrl.getGroupUid()}} aria-expanded=true class="fa gmf-layertree-expand-node fa-fw"> </a> <a class="fa fa-fw gmf-layertree-state" href ng-click=$ctrl.toggle()> </a> <a class=gmf-layertree-name href ng-click=$ctrl.toggle()> <span>{{$ctrl.group.title | translate}}</span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-click=$ctrl.remove()> <span class="fa fa-trash"></span> </a> </span> </div> <ul id=gmf-layertree-layer-group-{{::$ctrl.getGroupUid()}} class="collapse in"> <li class="gmf-layertree-node gmf-layertree-depth-2" ng-class="[dataSource.visible ? \'on\' : \'off\']" ng-repeat="dataSource in $ctrl.group.dataSources"> <div class=gmf-layertree-leaf> <a href ng-click=$ctrl.toggleDataSource(dataSource) class="gmf-layertree-layer-icon gmf-layertree-no-layer-icon"> </a> <a class=gmf-layertree-name href ng-click=$ctrl.toggleDataSource(dataSource)> <span>{{dataSource.name | translate}}</span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-click=$ctrl.removeDataSource(dataSource)> <span class="fa fa-trash"></span> </a> </span> </div> </li> </ul> '},function(e,t){e.exports='<div class=form-group ng-switch=$ctrl.filtrableDataSources.length> <span ng-switch-when=0 translate>No filtrable layer available!</span> <select class=form-control ng-disabled=$ctrl.aRuleIsActive ng-switch-default ng-model=$ctrl.gmfDataSourceBeingFiltered.dataSource ng-options="dataSource.name | translate for dataSource in $ctrl.filtrableDataSources"> <option value="" translate>-- Layer to filter --</option> </select> <div ng-if="$ctrl.customRules && $ctrl.directedRules && $ctrl.readyDataSource"> <hr class=gmf-filterselector-separator /> <div class="dropdown gmf-filterselector-savedfilters"> <a class="btn btn-link dropdown-toggle ngeo-filter-condition-button" ng-class="{disabled: $ctrl.aRuleIsActive || $ctrl.gmfSavedFilters.currentDataSourceItems.length === 0}" type=button data-toggle=dropdown ng-disabled="$ctrl.aRuleIsActive || $ctrl.gmfSavedFilters.currentDataSourceItems.length === 0"> <span translate>Saved</span> <span class=caret></span> </a> <ul class=dropdown-menu> <li ng-repeat="item in $ctrl.gmfSavedFilters.currentDataSourceItems"> <a href ng-click=$ctrl.saveFilterLoadItem(item)> <span>{{::item.name}}</span> </a> </li> <li role=separator class=divider></li> <li> <a href ng-click=$ctrl.saveFilterManage()> <span translate>Manage saved filters</span> </a> </li> </ul> </div> <ngeo-filter a-rule-is-active=$ctrl.aRuleIsActive custom-rules=$ctrl.customRules datasource=$ctrl.readyDataSource directed-rules=$ctrl.directedRules feature-overlay=$ctrl.featureOverlay map=$ctrl.map tool-group=$ctrl.toolGroup> </ngeo-filter> <div> <a class="btn btn-link gmf-filterselector-savebtn" type=button data-toggle=dropdown ng-click="!$ctrl.aRuleIsActive && $ctrl.saveFilterShowModal()" ng-disabled=$ctrl.aRuleIsActive> <span class="fa fa-save"></span> <span translate>Save</span> </a> </div> </div> <ngeo-modal ng-model=$ctrl.saveFilterSaveModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title>{{\'Save filter\' | translate}}</h4> </div> <div class=modal-body> <p class=gmf-filterselector-savefilter-desc translate> You can save the filter that you created to re-load it later. </p> <input type=text class=form-control name=name ng-model=$ctrl.saveFilterName placeholder="{{\'Filter name\' | translate}}"/> </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'Cancel\' | translate}}</button> <button type=button ng-click=$ctrl.saveFilterSave() ng-disabled="$ctrl.saveFilterName === \'\'" class="btn btn-primary">{{\'Save\' | translate}}</button> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.saveFilterManageModalShown> <div class=gmf-filterselector-managefilter-modal> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title>{{\'Manage filters\' | translate}}</h4> </div> <div class=modal-body> <ul> <li ng-repeat="item in $ctrl.gmfSavedFilters.currentDataSourceItems"> <span>{{::item.name}}</span> <a href ng-click=$ctrl.saveFilterRemoveItem(item)> {{ \'Delete\' | translate }} </a> <div class=gmf-eol></div> </li> </ul> </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'Close\' | translate}}</button> </div> </div> </ngeo-modal> </div> '},function(e,t){e.exports='<div class=dropdown> <a class="btn btn-link dropdown-toggle ngeo-filter-condition-button" ng-class="{disabled: $ctrl.aRuleIsActive}" type=button data-toggle=dropdown ng-disabled=$ctrl.aRuleIsActive> <span class="fa fa-cog"></span> <span class=caret></span> </a> <ul class=dropdown-menu> <li class=ngeo-filter-condition-criteria-header translate>Criteria taken into account</li> <li ng-repeat="condition in ::$ctrl.conditions"> <a href ng-click=$ctrl.setCondition(condition)> <span ng-class="{\'ngeo-filter-condition-criteria-active\': condition.value == $ctrl.datasource.filterCondition}" class="fa fa-check ngeo-filter-condition-criteria"> </span> <span>{{::condition.text | translate}}</span> </a> </li> </ul> </div> <ngeo-rule ng-repeat="rule in $ctrl.directedRules" feature-overlay=::$ctrl.featureOverlay class=ngeo-filter-rule-directed map=$ctrl.map rule=rule tool-group=$ctrl.toolGroup> </ngeo-rule> <hr class=ngeo-filter-separator-rules /> <div ng-repeat="rule in $ctrl.customRules"> <a class="btn btn-xs btn-link ngeo-filter-rule-custom-rm-btn" ng-click="!$ctrl.aRuleIsActive && $ctrl.removeCustomRule(rule)" ng-disabled=$ctrl.aRuleIsActive href> <span class="fa fa-remove"></span> </a> <ngeo-rule feature-overlay=::$ctrl.featureOverlay class=ngeo-filter-rule-custom map=$ctrl.map rule=rule tool-group=$ctrl.toolGroup> </ngeo-rule> </div> <div class=dropdown> <a class="btn btn-link dropdown-toggle" ng-class="{disabled: $ctrl.aRuleIsActive}" type=button data-toggle=dropdown ng-disabled=$ctrl.aRuleIsActive> <span translate>+ Add a new criteria</span> <span class=caret></span> </a> <ul class=dropdown-menu> <li ng-repeat="attribute in ::$ctrl.geometryAttributes"> <a href ng-click=$ctrl.createAndAddCustomRule(attribute)> <span translate>Spatial filter</span> </a> </li> <li role=presentation class=divider></li> <li ng-repeat="attribute in ::$ctrl.otherAttributes"> <a href ng-click=$ctrl.createAndAddCustomRule(attribute)> <span>{{::attribute.name | translate}}</span> </a> </li> </ul> </div> <hr class=ngeo-filter-separator-criteria /> <a class="btn btn-link" type=button ng-click=$ctrl.apply() ng-disabled="$ctrl.hasARule() === false || $ctrl.datasource.visible === false"> <span class="fa fa-check"></span> <span translate>Apply filter</span> </a> <a class="btn btn-link" type=button ng-click=$ctrl.getData() ng-disabled="$ctrl.hasARule() === false || $ctrl.datasource.visible === false"> <span class="fa fa-chevron-right"></span> <span translate>Get data</span> </a> '},function(e,t){e.exports='<div class=dropdown ng-class="{open: $ctrl.rule.active}"> <a class="btn btn-default btn-sm dropdown-toggle" type=button ng-click=$ctrl.toggle()> <span>{{ ::$ctrl.clone.name | translate }}</span> <span class=caret></span> </a> <div class="dropdown-menu form-group"> <select class="form-control input-sm ngeo-rule-operators-list" ng-disabled=$ctrl.drawActive ng-if=::$ctrl.clone.operators ng-model=$ctrl.clone.operator ng-options="$ctrl.operators[operator] | translate for operator in ::$ctrl.clone.operators track by operator"> </select> <div ng-switch=::$ctrl.clone.type> <div class="ngeo-rule-type-date form-group" ng-if=$ctrl.rule.active ng-switch-when=date|datetime ng-switch-when-separator=|> <div ng-switch=$ctrl.clone.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <ngeo-date-picker time=$ctrl.timeRangeMode on-date-selected=$ctrl.onDateRangeSelected(time)> </ngeo-date-picker> </div> <div ng-switch-default> <ngeo-date-picker time=$ctrl.timeValueMode on-date-selected=$ctrl.onDateSelected(time)> </ngeo-date-picker> </div> </div> </div> <div class="ngeo-rule-type-geometry form-group" ng-switch-when=geometry> <div ng-switch=$ctrl.geomType> <span class="gmf-icon gmf-icon-point" ng-switch-when=Point> </span> <span class="gmf-icon gmf-icon-line" ng-switch-when=LineString> </span> <span class="gmf-icon gmf-icon-polygon" ng-switch-when=Polygon> </span> <span class="gmf-icon gmf-icon-circle" ng-switch-when=Circle> </span> <span class="gmf-icon gmf-icon-rectangle" ng-switch-when=Rectangle> </span> </div> <ngeo-drawfeature ngeo-drawfeature-active=$ctrl.drawActive ngeo-drawfeature-features=$ctrl.drawnFeatures ngeo-drawfeature-map=$ctrl.map> <div ngeo-btn-group class=btn-group> <a data-toggle=tooltip title="{{\'Draw a point on the map\' | translate}}" href ngeo-btn ngeo-drawpoint class="btn btn-sm btn-default ngeo-drawfeature-point" ng-show="[\'intersects\', \'within\'].indexOf($ctrl.clone.operator) !== -1" ng-class="{active: dfCtrl.drawPoint.active}" ng-model=dfCtrl.drawPoint.active> <span class="gmf-icon gmf-icon-point"></span> </a> <a data-toggle=tooltip title="{{\'Draw a line on the map\' | translate}}" href ngeo-btn ngeo-measurelength class="btn btn-sm btn-default ngeo-drawfeature-linestring" ng-show="[\'intersects\', \'within\'].indexOf($ctrl.clone.operator) !== -1" ng-class="{active: dfCtrl.measureLength.active}" ng-model=dfCtrl.measureLength.active> <span class="gmf-icon gmf-icon-line"></span> </a> <a data-toggle=tooltip title="{{\'Draw a polygon on the map\' | translate}}" href ngeo-btn ngeo-measurearea class="btn btn-sm btn-default ngeo-drawfeature-polygon" ng-class="{active: dfCtrl.measureArea.active}" ng-model=dfCtrl.measureArea.active> <span class="gmf-icon gmf-icon-polygon"></span> </a> <a data-toggle=tooltip title="{{\'Draw a circle on the map\' | translate}}" href ngeo-btn ngeo-measureazimut class="btn btn-sm btn-default ngeo-drawfeature-circle" ng-class="{active: dfCtrl.measureAzimut.active}" ng-model=dfCtrl.measureAzimut.active> <span class="gmf-icon gmf-icon-circle"></span> </a> <a data-toggle=tooltip title="{{\'Draw a rectangle on the map\' | translate}}" href ngeo-btn ngeo-drawrectangle class="btn btn-sm btn-default ngeo-drawfeature-rectangle" ng-class="{active: dfCtrl.drawRectangle.active}" ng-model=dfCtrl.drawRectangle.active> <span class="gmf-icon gmf-icon-rectangle"></span> </a> </div> <div class=ngeo-rule-type-geometry-instructions ng-if=$ctrl.drawActive> <span ng-if=dfCtrl.drawPoint.active> {{ \'Draw a point on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureLength.active> {{ \'Draw a line string on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureArea.active> {{ \'Draw a polygon on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureAzimut.active> {{ \'Draw a circle on the map.\' | translate }} </span> <span ng-if=dfCtrl.drawRectangle.active> {{ \'Draw a rectangle on the map.\' | translate }} </span> </div> </ngeo-drawfeature> </div> <div class="checkbox ngeo-rule-type-select" ng-switch-when=select> <a ng-click=$ctrl.selectAllChoices() href>{{ All | translate}} </a> <label class="form-group ol-unselectable" ng-repeat="choice in ::$ctrl.clone.choices"> <input ng-checked="$ctrl.clone.getExpression() && $ctrl.clone.getExpression().split(\',\').indexOf(choice) > -1" ng-click=$ctrl.toggleChoiceSelection(choice) type=checkbox value=choice /> <span>{{ choice | translate }}</span> </label> </div> <div class="form-group ngeo-rule-type-text" ng-switch-default> <div ng-switch=$ctrl.clone.operator> <div ng-switch-when=..> <input type=number class="form-control input-sm" ng-model=$ctrl.clone.lowerBoundary /> <input type=number class="form-control input-sm" ng-model=$ctrl.clone.upperBoundary /> </div> <div ng-switch-default> <input type=number class="form-control input-sm" ng-if="$ctrl.clone.type === \'number\'" ng-model=$ctrl.clone.expression /> <input type=text class="form-control input-sm" ng-if="$ctrl.clone.type !== \'number\'" ng-model=$ctrl.clone.expression /> </div> </div> </div> <div class=ngeo-rule-btns> <button class="btn btn-xs btn-default" ng-click=$ctrl.apply() type=button>{{\'Apply\' | translate}}</button> <button class="btn btn-xs btn-default" ng-click=$ctrl.cancel() type=button>{{\'Cancel\' | translate}}</button> </div> </div> </div> </div> <div class=ngeo-rule-value ng-if="$ctrl.rule.value !== null"> <a class="btn btn-xs btn-link" ng-click="!$ctrl.rule.active && $ctrl.reset()" ng-disabled=$ctrl.rule.active href> <span class="fa fa-remove"></span> </a> <div ng-switch=::$ctrl.rule.type> <div ng-switch-when=date|datetime ng-switch-when-separator=|> <div ng-switch=$ctrl.rule.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <span translate>From </span> <span>{{ $ctrl.timeToDate($ctrl.rule.lowerBoundary) }}</span> <span translate> to </span> <span>{{ $ctrl.timeToDate($ctrl.rule.upperBoundary) }}</span> </div> <div ng-switch-default> <span>{{ $ctrl.operatorsShortFormat[$ctrl.rule.operator] }}</span> <span>{{ $ctrl.timeToDate($ctrl.rule.getExpression()) }}</span> </div> </div> </div> <div ng-switch-when=geometry> <span>{{ $ctrl.operators[$ctrl.rule.operator] }}</span> <span ng-switch=$ctrl.getRuleGeometryType()> <span class="gmf-icon gmf-icon-point" ng-switch-when=Point> </span> <span class="gmf-icon gmf-icon-line" ng-switch-when=LineString> </span> <span class="gmf-icon gmf-icon-polygon" ng-switch-when=Polygon> </span> <span class="gmf-icon gmf-icon-circle" ng-switch-when=Circle> </span> <span class="gmf-icon gmf-icon-rectangle" ng-switch-when=Rectangle> </span> </span> </div> <div ng-switch-when=select> <span ng-repeat="choice in $ctrl.rule.getExpression().split(\',\')"> {{ choice | translate }}{{ $last ? \'\' : \', \' }} </span> </div> <div ng-switch-default> <div ng-switch=$ctrl.rule.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <span translate>Between </span> <span>{{ $ctrl.rule.lowerBoundary }}</span> <span translate> and </span> <span>{{ $ctrl.rule.upperBoundary }}</span> </div> <div ng-switch-default> <span>{{ $ctrl.operatorsShortFormat[$ctrl.rule.operator] }}</span> <span>{{ $ctrl.rule.getExpression() }}</span> </div> </div> </div> </div> </div> '},function(e,t){e.exports='<div class=ngeo-datepicker> <form name=dateForm class=ngeo-datepicker-form novalidate> <div ng-if="::datepickerCtrl.time.widget === \'datepicker\'"> <div class=ngeo-datepicker-start-date> <span ng-if="::datepickerCtrl.time.mode === \'range\'" translate>From:</span> <span ng-if="::datepickerCtrl.time.mode !== \'range\'" translate>Date:</span> <input name=sdate ui-date=datepickerCtrl.sdateOptions ng-model=datepickerCtrl.sdate required=""/> </div> <div class=ngeo-datepicker-end-date ng-if="::datepickerCtrl.time.mode === \'range\'"> <span translate>To:</span> <input name=edate ui-date=datepickerCtrl.edateOptions ng-model=datepickerCtrl.edate required=""/> </div> </div> </form> </div> '},,,,,,function(e,t){e.exports='<h4 class="popover-title ngeo-popup-title"> <span ng-bind-html=title></span> <button type=button class=close ng-click="open = false"> &times;</button> </h4> <div class=popover-content ng-bind-html=content></div> '},,,,,,function(e,t){e.exports='<ul class=gmf-backgroundlayerselector> <li ng-repeat="layer in ctrl.bgLayers" ng-click=ctrl.setLayer(layer) ng-class="{\'gmf-backgroundlayerselector-active\': ctrl.bgLayer == layer, \'gmf-backgroundlayerselector-disabled\': ctrl.opacityLayer == layer}"> <img class=gmf-thumb ng-src="{{::layer.get(\'metadata\')[\'thumbnail\']}}"/> <span class=gmf-text>{{layer.get("label") | translate}}</span> <span ng-class="{\'gmf-backgroundlayerselector-opacity-check\': ctrl.opacityLayer == layer}"></span> </li> <input ng-if=ctrl.opacityLayer class="input-action gmf-backgroundlayerselector-opacity-slider" name=bg-layer-opacity type=range min=0 max=1 step=0.01 ng-model=ctrl.getSetBgLayerOpacity ng-model-options="{getterSetter: true}"> </ul> '},function(e,t){e.exports='<div ng-if=$ctrl.gmfUser.username> <div class=form-group> <span>{{\'Logged in as\' | translate}}</span> <strong>{{ ::$ctrl.gmfUser.username }}</strong>. </div> <form name=logoutForm role=form ng-submit=$ctrl.logout() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}" ng-if=!$ctrl.changingPassword> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Logout\' | translate}}"/> </div> <div class=form-group> <input ng-show=$ctrl.allowPasswordChange type=button class="form-control btn btn-default" value="{{\'Change password\' | translate}}" ng-click="$ctrl.changingPassword = true"/> </div> </form> <form name=changePasswordForm role=form ng-submit=$ctrl.changePassword() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}" ng-if=$ctrl.changingPassword> <div class=form-group> <input type=password class=form-control name=oldpassword ng-model=$ctrl.oldPwdVal ng-attr-placeholder="{{\'Old password\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=newpassword ng-model=$ctrl.newPwdVal ng-attr-placeholder="{{\'New password\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=newpasswordconfirm ng-model=$ctrl.newPwdConfVal ng-attr-placeholder="{{\'Confirm new password\' | translate}}"/> </div> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Change password\' | translate}}"/> </div> <div class=form-group> <input type=button class="form-control btn btn-default" value="{{\'Cancel\' | translate}}" ng-if=!$ctrl.userMustChangeItsPassword() ng-click=$ctrl.changePasswordReset() /> <input type=button class="form-control btn btn-default" value="{{\'Logout\' | translate}}" ng-if=$ctrl.userMustChangeItsPassword() ng-click=$ctrl.logout() /> </div> </form> <div ng-show=$ctrl.error class="gmf-authentication-error help-block"></div> <ngeo-modal ng-model=$ctrl.changePasswordModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title> {{\'Password Changed\' | translate}} </h4> </div> <div class=modal-body> {{\'Your password has successfully been changed.\' | translate}} </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'OK\' | translate}}</button> </div> </ngeo-modal> </div> <div ng-if=!$ctrl.gmfUser.username> <div class="alert alert-warning" ng-show=$ctrl.infoMessage> <span>{{ $ctrl.infoMessage }}</span> </div> <form name=loginForm role=form ng-submit=$ctrl.login() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}"> <div class=form-group> <input type=text class=form-control name=login ng-model=$ctrl.loginVal ng-attr-placeholder="{{\'Username\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=password ng-model=$ctrl.pwdVal ng-attr-placeholder="{{\'Password\' | translate}}"/> </div> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Connect\' | translate}}"/> </div> <div ng-show=$ctrl.allowPasswordReset class=form-group> <a ng-click=$ctrl.resetPassword() href="">{{\'Password forgotten?\' | translate}}</a> </div> </form> <div ng-show=$ctrl.error class="gmf-authentication-error help-block"></div> <ngeo-modal ng-model=$ctrl.resetPasswordModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title> {{\'Password forgotten?\' | translate}} </h4> </div> <div class=modal-body translate> A new password has just been sent to you by e-mail. </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'OK\' | translate}}</button> </div> </ngeo-modal> </div> '},,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){}]);
//# sourceMappingURL=mobile.e3f006.js.map