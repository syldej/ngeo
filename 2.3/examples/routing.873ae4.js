(function(e){function t(t){var o=t[0];var a=t[1];var s=t[2];var l,u,g=0,h=[];for(;g<o.length;g++){u=o[g];if(n[u]){h.push(n[u][0])}n[u]=0}for(l in a){if(Object.prototype.hasOwnProperty.call(a,l)){e[l]=a[l]}}if(c)c(t);while(h.length){h.shift()()}i.push.apply(i,s||[]);return r()}function r(){var e;for(var t=0;t<i.length;t++){var r=i[t];var o=true;for(var s=1;s<r.length;s++){var l=r[s];if(n[l]!==0)o=false}if(o){i.splice(t--,1);e=a(a.s=r[0])}}return e}var o={};var n={6:0};var i=[];function a(t){if(o[t]){return o[t].exports}var r=o[t]={i:t,l:false,exports:{}};e[t].call(r.exports,r,r.exports,a);r.l=true;return r.exports}a.m=e;a.c=o;a.d=function(e,t,r){if(!a.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:r})}};a.r=function(e){Object.defineProperty(e,"__esModule",{value:true})};a.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};a.d(t,"a",t);return t};a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};a.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[];var l=s.push.bind(s);s.push=t;s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var c=l;i.push([345,0]);return r()})({331:function(e,t,r){"use strict";r.r(t);var o=r(477);var n=r(557);var i=r(476);var a=r(17);var s=r(121);var l=r(90);var u=function e(t,r,o){this.$http_=t;this.ngeoDebounce_=o;this.nominatimUrl_="https://nominatim.openstreetmap.org/";if(r.has("ngeoNominatimUrl")){this.nominatimUrl_=r.get("ngeoNominatimUrl");if(this.nominatimUrl_.substr(-1)!=="/"){this.nominatimUrl_+="/"}}this.searchDefaultParams_={};if(r.has("ngeoNominatimSearchDefaultParams")){this.searchDefaultParams_=r.get("ngeoNominatimSearchDefaultParams")}this.typeaheadDebounceDelay_=500;this.typeaheadSourceDebounced=this.ngeoDebounce_(this.typeaheadSource_.bind(this),this.typeaheadDebounceDelay_,true)};u.$inject=["$http","$injector","ngeoDebounce"];u.$inject=["$http","$injector","ngeoDebounce"];u.prototype.search=function(e,t){var r=this.nominatimUrl_+"search?q="+e;t=t||{};t=Object.assign({},this.searchDefaultParams_,t);t["format"]="json";if(t){r+="&";var o=[];for(var n=Object.keys(t),i=Array.isArray(n),a=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(a>=n.length)break;s=n[a++]}else{a=n.next();if(a.done)break;s=a.value}var l=s;o.push(l+"="+t[l])}r+=o.join("&")}return this.$http_.get(r)};u.prototype.reverse=function(e,t){var r=this.nominatimUrl_+"reverse";t=Object.assign({},t);t["lon"]=e[0];t["lat"]=e[1];t["format"]="json";if(t){r+="?";var o=[];for(var n=Object.keys(t),i=Array.isArray(n),a=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(a>=n.length)break;s=n[a++]}else{a=n.next();if(a.done)break;s=a.value}var l=s;o.push(l+"="+t[l])}r+=o.join("&")}return this.$http_.get(r)};u.prototype.typeaheadSource_=function(e,t,r){var o=function e(t){var o=function e(t){return{coordinate:[t.lon,t.lat],name:t.display_name}};r(t.data.map(o))};var n=function e(t){r([])};this.search(e,{}).then(o,n)};u.module=angular.module("ngeoNominatimService",[s["a"].name]);u.module.service("ngeoNominatimService",u);var c=u;var g=function e(t,r){this.$http_=t;this.routingOptions_=r.has("ngeoRoutingOptions")?r.get("ngeoRoutingOptions"):{};this.ngeoOsrmBackendUrl_=this.routingOptions_.backendUrl||"https://router.project-osrm.org/";if(this.ngeoOsrmBackendUrl_.substr(-1)!=="/"){this.ngeoOsrmBackendUrl_+="/"}this.protocolVersion_="v1"};g.$inject=["$http","$injector"];g.$inject=["$http","$injector"];g.prototype.getRoute=function(e,t){t=t||{};if(!t["service"]){t["service"]="route"}if(!t["profile"]){t["profile"]="car"}var r=this.ngeoOsrmBackendUrl_;if(t["instance"]){r+=t["instance"]+"/"}r+=t["service"]+"/"+this.protocolVersion_+"/"+t["profile"]+"/";var o=e.map(function(e){return e.join(",")}).join(";");r+=o;if(t.options){r+="?";var n=[];for(var i=Object.keys(t.options),a=Array.isArray(i),s=0,i=a?i:i[Symbol.iterator]();;){var l;if(a){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;n.push(u+"="+t.options[u])}r+=n.join("&")}return this.$http_.get(r)};g.prototype.getNearest=function(e,t){t=t||{};t["service"]="nearest";if(!t["profile"]){t["profile"]="car"}var r=this.ngeoOsrmBackendUrl_;if(t["instance"]){r+=t["instance"]+"/"}r+=t["service"]+"/"+this.protocolVersion_+"/"+t["profile"]+"/";var o=e.join(",");r+=o;if(t.options){r+="?";var n=[];for(var i=Object.keys(t.options),a=Array.isArray(i),s=0,i=a?i:i[Symbol.iterator]();;){var l;if(a){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;n.push(u+"="+t.options[u])}r+=n.join("&")}return this.$http_.get(r)};g.module=angular.module("ngeoRoutingService",[]);g.module.service("ngeoRoutingService",g);var h=g;var p=r(240);var f={};f.module=angular.module("ngeoRoutingNominatimInputComponent",[p["a"].module.name,c.module.name]);f.module.run(["$templateCache",function(e){e.put("ngeo/routing/nominatiminput",r(344))}]);f.module.value("ngeoRoutingNominatimInputComponentTemplateUrl",function(e){var t=e["ngeoRoutingNominatimInputComponentTemplateUrl"];return t!==undefined?t:"ngeo/routing/nominatiminput"});m.$inject=["$attrs","ngeoRoutingNominatimInputComponentTemplateUrl"];function m(e,t){return t(e)}f.Controller=function(e,t,r,o){this.element_=e;this.$scope_=r;this.ngeoNominatimService=o;this.onSelect;this.inputValue;this.options={};this.datasets=[{name:"nominatim",display:"name",source:this.ngeoNominatimService.typeaheadSourceDebounced}];this.listeners={select:this.select_.bind(this)};this.placeholder=""};f.Controller.$inject=["$element","$injector","$scope","ngeoNominatimService"];f.Controller.prototype.select_=function(e,t,r){if(this.onSelect){this.onSelect(t)}};var v={controller:f.Controller,bindings:{onSelect:"=?ngeoNominatimInputOnSelect",inputValue:"=?ngeoNominatimInputValue",placeholder:"@?ngeoNominatimInputPlaceholder"},templateUrl:m};f.module.component("ngeoNominatimInput",v);var d=f;var _=r(8);var y=r(24);var b=r(42);var $=r(52);var C=r(64);var w=r(19);var F=r(148);var S=r(47);var R=r(46);var j=r(44);var k=r(280);var P=r(102);var D=r(520);var x={};x.module=angular.module("ngeoRoutingFeatureComponent",[c.module.name,d.module.name]);x.module.run(["$templateCache",function(e){e.put("ngeo/routing/routingfeature",r(343))}]);x.module.value("ngeoRoutingFeatureTemplateUrl",function(e){var t=e["ngeoRoutingFeatureTemplateUrl"];return t!==undefined?t:"ngeo/routing/routingfeature"});A.$inject=["$attrs","ngeoRoutingFeatureTemplateUrl"];function A(e,t){return t(e)}x.Controller=function(e,t,r,o){this.scope_=e;this.timeout_=t;this.$q_=r;this.ngeoNominatimService_=o;this.map;this.feature;this.featureLabel="";this.fillColor;this.strokeColor;this.onChange;this.vectorFeatures_=new b["a"];this.vectorSource_=new $["a"]({features:this.vectorFeatures_});this.vectorLayer_=new C["a"]({source:this.vectorSource_,style:function(e,t){return[new w["c"]({text:new F["a"]({fill:new S["a"]({color:this.fillColor||"#000000"}),font:"normal 30px FontAwesome",offsetY:-15,stroke:new R["a"]({width:3,color:this.strokeColor||"#000000"}),text:"ÔÅÅ"})})]}.bind(this)});this.modifyFeature_=new k["a"]({features:this.vectorFeatures_});this.draw_=null;this.onSelect=this.onSelect_.bind(this);this.errorMessage=""};x.Controller.$inject=["$scope","$timeout","$q","ngeoNominatimService"];x.Controller.prototype.$onInit=function(){var e=this;this.map.addLayer(this.vectorLayer_);this.modifyFeature_.setActive(true);this.map.addInteraction(this.modifyFeature_);this.modifyFeature_.on("modifyend",function(t){var r=t.features.getArray()[0];e.vectorSource_.clear();e.snapFeature_(r)});this.scope_.$watch(function(){return e.feature},function(t,r){if(t){e.onFeatureChange_()}if(t===null){e.vectorSource_.clear();e.featureLabel=""}})};x.Controller.prototype.$onDestroy=function(){this.map.removeLayer(this.vectorLayer_);this.modifyFeature_.setActive(false);this.map.removeInteraction(this.modifyFeature_)};x.Controller.prototype.set=function(){var e=this;if(this.draw_){this.map.removeInteraction(this.draw_)}this.draw_=new P["a"]({features:this.vectorFeatures_,type:"Point"});this.draw_.on("drawstart",function(){if(e.feature){e.vectorSource_.removeFeature(e.feature)}});this.draw_.on("drawend",function(t){if(e.draw_){e.map.removeInteraction(e.draw_)}e.snapFeature_(t.feature);e.modifyFeature_.setActive(true)});this.modifyFeature_.setActive(false);this.map.addInteraction(this.draw_)};x.Controller.prototype.setFeature_=function(e,t){var r=_["f"](e,this.map.getView().getProjection());if(t===""){t=r.join("/")}this.feature=new y["a"]({geometry:new j["a"](r),name:t})};x.Controller.prototype.onFeatureChange_=function(){var e=this;this.featureLabel=this.feature.get("name")||"";this.vectorSource_.clear();this.vectorSource_.addFeature(this.feature);if(this.onChange){this.timeout_(function(){e.onChange(e.feature)})}};x.Controller.prototype.onSelect_=function(e){var t=e.coordinate.map(parseFloat);var r=e.label;this.setFeature_(t,r);var o=this.feature.getGeometry().getCoordinates();this.map.getView().setCenter(o)};x.Controller.prototype.snapFeature_=function(e){var t=this.getLonLatFromPoint_(e);var r={};var o=function(e){var t=parseFloat(e["data"]["lon"]);var r=parseFloat(e["data"]["lat"]);var o=[t,r];var n=e["data"]["display_name"];this.setFeature_(o,n)}.bind(this);var n=function(e){this.errorMessage="Error: nominatim server not responding.";console.log(e)}.bind(this);this.$q_.when(this.ngeoNominatimService_.reverse(t,r)).then(o.bind(this),n.bind(this))};x.Controller.prototype.getLonLatFromPoint_=function(e){var t=e.getGeometry();var r=t.getCoordinates();var o=this.map.getView().getProjection();return _["l"](r,o)};x.component_={controller:x.Controller,bindings:{map:"<ngeoRoutingFeatureMap",feature:"=ngeoRoutingFeatureFeature",fillColor:"<?ngeoRoutingFeatureFillColor",strokeColor:"<?ngeoRoutingFeatureStrokeColor",onChange:"=?ngeoRoutingFeatureOnChange"},templateUrl:A};x.module.component("ngeoRoutingFeature",x.component_);var O=x;var U=r(217);var L=r(58);var N={};N.module=angular.module("ngeoRoutingComponent",[s["a"].name,l["a"].name,c.module.name,h.module.name,O.module.name]);N.module.run(["$templateCache",function(e){e.put("ngeo/routing/routing",r(342))}]);N.module.value("ngeoRoutingTemplateUrl",function(e){var t=e["ngeoRoutingTemplateUrl"];return t!==undefined?t:"ngeo/routing/routing"});I.$inject=["$attrs","ngeoRoutingTemplateUrl"];function I(e,t){return t(e)}N.Controller=function(e,t,r,o,n,i){var a=this;this.$scope_=t;this.ngeoRoutingService_=r;this.ngeoNominatimService_=o;this.routingOptions_=e.has("ngeoRoutingOptions")?e.get("ngeoRoutingOptions"):{};this.routingProfiles=this.routingOptions_.profiles||[];this.selectedRoutingProfile=this.routingProfiles.length>0?this.routingProfiles[0]:null;t.$watch(function(){return a.selectedRoutingProfile},this.calculateRoute.bind(this));this.$q_=n;this.map;this.errorMessage="";this.startFeature_=null;this.targetFeature_=null;this.viaArray=[];this.colors={"start.fill":"#6BE62E","start.stroke":"#4CB01E","destination.fill":"#FF3E13","destination.stroke":"#CD3412","via.fill":"#767676","via.stroke":"#000000"};this.routeSource_=new $["a"]({features:[]});this.routeLayer_=new C["a"]({source:this.routeSource_,style:new w["c"]({fill:new S["a"]({color:"rgba(16, 112, 29, 0.6)"}),stroke:new R["a"]({color:"rgba(16, 112, 29, 0.6)",width:5})})});this.routeDistance=0;this.routeDuration=null;this.regexIsFormattedCoord=/\d+\.\d+\/\d+\.\d+/;this.draw_=null;var s=200;this.handleChange=i(this.calculateRoute.bind(this),s,true)};N.Controller.$inject=["$injector","$scope","ngeoRoutingService","ngeoNominatimService","$q","ngeoDebounce"];N.Controller.prototype.$onInit=function(){this.map.addLayer(this.routeLayer_)};N.Controller.prototype.clearRoute=function(){this.startFeature_=null;this.targetFeature_=null;this.viaArray=[];this.routeDistance=0;this.routeDuration=null;this.routeSource_.clear();this.errorMessage=""};N.Controller.prototype.getLonLatFromPoint_=function(e){var t=e.getGeometry();var r=t.getCoordinates();var o=this.map.getView().getProjection();return _["l"](r,o)};N.Controller.prototype.reverseRoute=function(){var e=this.startFeature_;this.startFeature_=this.targetFeature_;this.targetFeature_=e;this.viaArray=this.viaArray.reverse()};N.Controller.prototype.parseRoute_=function(e){var t=[];var r=new U["a"];var o={dataProjection:"EPSG:4326",featureProjection:this.map.getView().getProjection()};if(e.legs){var n;t=e.legs.map(function(e){return e.steps.map(function(e){return new y["a"]({geometry:r.readGeometry(e.geometry,o)})})});t=(n=[]).concat.apply(n,t)}else if(e.geometry){t.push(new y["a"]({geometry:r.readGeometry(e.geometry,o)}))}return t};N.Controller.prototype.calculateRoute=function(){var e=this;if(this.startFeature_&&this.targetFeature_){this.routeSource_.clear();var t=this.getLonLatFromPoint_(this.startFeature_);var r=this.getLonLatFromPoint_(this.targetFeature_);var o=this.viaArray.filter(function(e){return e.feature!==null}).map(function(t){return e.getLonLatFromPoint_(t.feature)});var n=[t].concat(o,[r]);var i=function(e){var t=this.parseRoute_(e.data.routes[0]);if(t.length===0){console.log("No route or not supported format.");return}this.routeSource_.addFeatures(t);this.map.getView().fit(this.routeSource_.getExtent());this.routeDistance=parseInt(e.data.routes[0].distance,10);this.routeDuration=e.data.routes[0].duration;var r=t[0].getGeometry().getCoordinateAt(0);var o=t[t.length-1].getGeometry().getCoordinateAt(1);var n=[this.startFeature_.getGeometry().getCoordinates(),r];var i=[o,this.targetFeature_.getGeometry().getCoordinates()];var a=[new y["a"](new L["a"](n)),new y["a"](new L["a"](i))];this.routeSource_.addFeatures(a)}.bind(this);var a=function(e){this.errorMessage="Error: routing server not responding.";console.log(e)}.bind(this);var s={};s["steps"]=true;s["overview"]=false;s["geometries"]="geojson";var l={};l["options"]=s;if(this.selectedRoutingProfile){l["instance"]=this.selectedRoutingProfile["profile"]}this.$q_.when(this.ngeoRoutingService_.getRoute(n,l)).then(i.bind(this),a.bind(this))}};N.Controller.prototype.addVia=function(){this.viaArray.push({feature:null,onSelect:null})};N.Controller.prototype.deleteVia=function(e){if(this.viaArray.length>e){this.viaArray.splice(e,1);this.calculateRoute()}};N.module.component("ngeoRouting",{controller:N.Controller,bindings:{map:"<ngeoRoutingMap"},templateUrl:I});var V=N;var M=r(475);var G=angular.module("ngeoRoutingModule",[V.module.name]);var T=G;var E=r(43);var q=r(53);var B=r(36);var z=r(57);var J={};J.module=angular.module("app",["gettext",a["a"].name,T.name]);J.MainController=function(){this.map=new E["a"]({layers:[new B["a"]({source:new z["b"]})],view:new q["a"]({center:[931010.1535989442,5961705.842297254],zoom:9})});this.routingfeatureActive=true};J.module.controller("MainController",J.MainController);var Y=t["default"]=J},342:function(e,t){e.exports='<div class=ngeo-routing> <div class="ngeo-routing-start form-group"> <ngeo-routing-feature ngeo-routing-feature-map=$ctrl.map ngeo-routing-feature-feature=$ctrl.startFeature_ ngeo-routing-feature-fill-color="$ctrl.colors[\'start.fill\']" ngeo-routing-feature-stroke-color="$ctrl.colors[\'start.stroke\']" ngeo-routing-feature-on-change=$ctrl.handleChange> </ngeo-routing-feature> </div> <div class="ngeo-routing-vias form-group" ng-repeat="(index, via) in $ctrl.viaArray"> <div class=form-inline> <div class=form-group> <ngeo-routing-feature ngeo-routing-feature-map=$ctrl.map ngeo-routing-feature-feature=via.feature ngeo-routing-feature-fill-color="$ctrl.colors[\'via.fill\']" ngeo-routing-feature-stroke-color="$ctrl.colors[\'via.stroke\']" ngeo-routing-feature-on-change=$ctrl.handleChange> </ngeo-routing-feature> </div> <button type=button class="btn btn-primary delete-via" ng-click=$ctrl.deleteVia(index)> <span class="fa fa-trash-o"></span> </button> </div> </div> <div class="ngeo-routing-destination form-group"> <ngeo-routing-feature ngeo-routing-feature-map=$ctrl.map ngeo-routing-feature-feature=$ctrl.targetFeature_ ngeo-routing-feature-fill-color="$ctrl.colors[\'destination.fill\']" ngeo-routing-feature-stroke-color="$ctrl.colors[\'destination.stroke\']" ngeo-routing-feature-on-change=$ctrl.handleChange> </ngeo-routing-feature> </div> <div class="form-group pull-right"> <button type=button class="btn btn-primary" ng-click=$ctrl.clearRoute()> <span class="fa fa-trash-o"></span> <span translate>Clear</span> </button> <button type=button class="btn btn-primary" ng-click=$ctrl.reverseRoute()> <span class="fa fa-exchange"></span> <span translate>Reverse</span> </button> <button type=button class="btn btn-primary" ng-click=$ctrl.addVia()> <span class="fa fa-plus"></span> <span translate>Add via</span> </button> </div> <div class=clearfix></div> <div class=form-horizontal ng-if="$ctrl.routingProfiles.length > 1"> <div class=form-group> <label class="control-label col-md-4" translate>Profile</label> <div class=col-md-8> <select class=form-control ng-model=$ctrl.selectedRoutingProfile> <option ng-repeat="profile in $ctrl.routingProfiles" ng-value=profile>{{profile.label}}</option> </select> </div> </div> </div> <div class="ngeo-routing-error form-group clearfix" ng-hide="$ctrl.errorMessage === \'\'"> {{$ctrl.errorMessage}} </div> <div class=clearfix></div> <div class=form-horizontal ng-hide="$ctrl.routeDuration === null && $ctrl.routeDistance <= 0"> <div class=row> <div class=col-md-12> <strong translate>Route statistics</strong> </div> </div> <div class=row ng-hide="$ctrl.routeDuration === null"> <div class="col-md-4 text-right" translate> Duration </div> <div class=col-md-8> {{$ctrl.routeDuration | ngeoDuration}} </div> </div> <div class=row ng-hide="$ctrl.routeDistance <= 0"> <div class="col-md-4 text-right" translate> Distance </div> <div class=col-md-8> {{$ctrl.routeDistance | ngeoUnitPrefix:\'m\'}} </div> </div> </div> </div> '},343:function(e,t){e.exports='<div class=ngeo-routing-feature> <div class=input-group> <ngeo-nominatim-input ngeo-nominatim-input-value=$ctrl.featureLabel ngeo-nominatim-input-placeholder="{{\'Search...\' | translate}}" ngeo-nominatim-input-on-select=$ctrl.onSelect> </ngeo-nominatim-input> <div class="input-group-addon btn" ng-click=$ctrl.set()> <span class="fa fa-map-marker"></span> </div> </div> </div> '},344:function(e,t){e.exports="<div class=ngeo-nominatim-input> <input type=text class=form-control placeholder={{$ctrl.placeholder}} ng-model=$ctrl.inputValue ngeo-search=$ctrl.options ngeo-search-datasets=$ctrl.datasets ngeo-search-listeners=$ctrl.listeners> </div> "},345:function(e,t,r){r(40);r(39);e.exports=r(331)},475:function(e,t){},477:function(e,t){}});
//# sourceMappingURL=routing.873ae4.js.map