(function(l){function e(e){var t=e[0];var r=e[1];var a=e[2];var n,i,o=0,s=[];for(;o<t.length;o++){i=t[o];if(f[i]){s.push(f[i][0])}f[i]=0}for(n in r){if(Object.prototype.hasOwnProperty.call(r,n)){l[n]=r[n]}}if(d)d(e);while(s.length){s.shift()()}h.push.apply(h,a||[]);return u()}function u(){var e;for(var t=0;t<h.length;t++){var r=h[t];var a=true;for(var n=1;n<r.length;n++){var i=r[n];if(f[i]!==0)a=false}if(a){h.splice(t--,1);e=o(o.s=r[0])}}return e}var r={};var f={20:0};var h=[];function o(e){if(r[e]){return r[e].exports}var t=r[e]={i:e,l:false,exports:{}};l[e].call(t.exports,t,t.exports,o);t.l=true;return t.exports}o.m=l;o.c=r;o.d=function(e,t,r){if(!o.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};o.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};o.t=function(t,e){if(e&1)t=o(t);if(e&8)return t;if(e&4&&typeof t==="object"&&t&&t.__esModule)return t;var r=Object.create(null);o.r(r);Object.defineProperty(r,"default",{enumerable:true,value:t});if(e&2&&typeof t!="string")for(var a in t)o.d(r,a,function(e){return t[e]}.bind(null,a));return r};o.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};o.d(e,"a",e);return e};o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};o.p="";var t=window["webpackJsonp"]=window["webpackJsonp"]||[];var a=t.push.bind(t);t.push=e;t=t.slice();for(var n=0;n<t.length;n++)e(t[n]);var d=a;h.push([585,0]);return u()})({585:function(e,t,r){r(72);r(73);e.exports=r(586)},586:function(e,t,r){"use strict";r.r(t);var a=r(32);var n=r(587);var i=r.n(n);var h=r(1);var o=r(213);var s=r(175);var l=r(22);var u=r(151);var f=r(171);var d={};d.module=angular.module("gmfapp",["gettext",o["a"].module.name,s["a"].module.name,l["a"].module.name]);d.module.value("gmfTreeUrl",a["a"].GMF_THEMES);d.module.value("gmfLayersUrl",a["a"].GMF_LAYERS);d.module.constant("defaultTheme","Demo");d.module.constant("angularLocaleScript","../build/angular-locale_{{locale}}.js");d.MainController=function(e,t,r,a,n){var s=this;this.http_=e;this.q_=t;this.gmfThemes_=a;this.gmfXSDAttributes_=n;this.urls=[{name:"oeedit app. (hosted)",url:"apps/oeedit/"},{name:"oeedit app. (dev)",url:"../apps/oeedit/"},{name:"example",url:"objectediting.html"}];this.viewerUrlDev_="../apps/oeview/";this.viewerUrlHosted_="apps/oeview/";this.selectedUrl=this.urls[0];this.gmfServers_;this.gmfServer_;this.gmfLayerNodes=[];this.selectedGmfLayerNode=null;this.featuresCache_={};this.features=null;this.selectedFeature=null;this.geomTypeCache_={};this.selectedGeomType=undefined;r.$watch(function(){return s.selectedGmfLayerNode},function(e,t){s.selectedFeature=null;if(e){s.getFeatures_(e).then(s.handleGetFeatures_.bind(s,e));s.getGeometryType_(e).then(s.handleGetGeometryType_.bind(s,e))}});this.themeName="ObjectEditing";this.gmfThemes_.loadThemes();this.gmfThemes_.getOgcServersObject().then(function(e){s.gmfServers_=e;s.gmfThemes_.getThemesObject().then(function(e){if(!e){return}var t,r;var a;for(t=0,r=e.length;t<r;t++){if(e[t].name===s.themeName){a=e[t];break}}if(!a){return}var n=a.children[0];h["a"].assert(n.ogcServer);var i=s.gmfServers_[n.ogcServer];if(i&&i.wfsSupport===true&&i.urlWfs){s.gmfServer_=i}else{return}var o=[];for(t=0,r=n.children.length;t<r;t++){if(n.children[t].metadata.identifierAttributeField){o.push(n.children[t])}}s.gmfLayerNodes=o;s.selectedGmfLayerNode=s.gmfLayerNodes[1]})})};d.MainController.$inject=["$http","$q","$scope","gmfThemes","gmfXSDAttributes"];d.MainController.prototype.runEditor=function(){var e=this.selectedGeomType;var t=this.selectedFeature;var r=this.selectedGmfLayerNode.id;var a=this.selectedGmfLayerNode.metadata.identifierAttributeField;h["a"].assert(a!==undefined);var n=t.get(a);var i={};i[s["a"].Param.GEOM_TYPE]=e;i[s["a"].Param.ID]=n;i[s["a"].Param.LAYER]=r;i[s["a"].Param.THEME]=this.themeName;i[s["a"].Param.PROPERTY]=a;var o=d.MainController.appendParams(this.selectedUrl["url"],i);window.open(o)};d.MainController.prototype.runViewerDev=function(){this.runViewer_(this.viewerUrlDev_)};d.MainController.prototype.runViewerHosted=function(){this.runViewer_(this.viewerUrlHosted_)};d.MainController.prototype.runViewer_=function(e){var t=this.selectedGmfLayerNode;var r=t.id;var a=t.name;var n=t.metadata.identifierAttributeField;h["a"].assert(n!==undefined);var i=[];var o=this.featuresCache_[r];for(var s=0,l=o.length;s<l;s++){i.push(o[s].get(n))}var u={};u["wfs_layer"]=a;u["wfs_"+n]=i.join(",");var f=d.MainController.appendParams(e,u);window.open(f)};d.MainController.prototype.getFeatures_=function(e){this.getFeaturesDeferred_=this.q_.defer();var t=this.getFeaturesFromCache_(e);if(t){this.getFeaturesDeferred_.resolve()}else{this.issueGetFeatures_(e)}return this.getFeaturesDeferred_.promise};d.MainController.prototype.issueGetFeatures_=function(e){var r=this;var a=e.id;var t=d.MainController.appendParams(this.gmfServer_.urlWfs,{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:"1.1.0",TYPENAME:e.layers});this.http_.get(t).then(function(e){var t=(new u["a"]).readFeatures(e.data);r.featuresCache_[a]=t;r.getFeaturesDeferred_.resolve()})};d.MainController.prototype.handleGetFeatures_=function(e){var t=this.getFeaturesFromCache_(e);this.features=t;this.selectedFeature=this.features[0]};d.MainController.prototype.getFeaturesFromCache_=function(e){var t=e.id;var r=this.featuresCache_[t]||null;return r};d.MainController.prototype.getGeometryType_=function(e){this.getGeometryTypeDeferred_=this.q_.defer();var t=this.getGeometryTypeFromCache_(e);if(t){this.getGeometryTypeDeferred_.resolve()}else{this.issueGetAttributesRequest_(e)}return this.getGeometryTypeDeferred_.promise};d.MainController.prototype.issueGetAttributesRequest_=function(e){this.gmfXSDAttributes_.getAttributes(e.id).then(function(e,t){var r=f["a"].getGeometryAttribute(t);if(r&&r.geomType){this.geomTypeCache_[e.id]=r.geomType;this.getGeometryTypeDeferred_.resolve()}}.bind(this,e))};d.MainController.prototype.handleGetGeometryType_=function(e){var t=this.getGeometryTypeFromCache_(e);this.selectedGeomType=t};d.MainController.prototype.getGeometryTypeFromCache_=function(e){var t=e.id;var r=this.geomTypeCache_[t];return r};d.MainController.appendParams=function(e,t){var r=[];Object.keys(t).forEach(function(e){if(t[e]!==null&&t[e]!==undefined){r.push(e+"="+encodeURIComponent(t[e]))}});var a=r.join("&");e=e.replace(/[?&]$/,"");e=e.indexOf("?")===-1?e+"?":e+"&";return e+a};d.module.controller("MainController",d.MainController);t["default"]=d},587:function(e,t){}});
//# sourceMappingURL=objecteditinghub.9e6aa3.js.map