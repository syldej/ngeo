(function(s){function e(e){var t=e[0];var o=e[1];var r=e[2];var a,i,n=0,l=[];for(;n<t.length;n++){i=t[n];if(u[i]){l.push(u[i][0])}u[i]=0}for(a in o){if(Object.prototype.hasOwnProperty.call(o,a)){s[a]=o[a]}}if(f)f(e);while(l.length){l.shift()()}h.push.apply(h,r||[]);return c()}function c(){var e;for(var t=0;t<h.length;t++){var o=h[t];var r=true;for(var a=1;a<o.length;a++){var i=o[a];if(u[i]!==0)r=false}if(r){h.splice(t--,1);e=n(n.s=o[0])}}return e}var o={};var u={27:0};var h=[];function n(e){if(o[e]){return o[e].exports}var t=o[e]={i:e,l:false,exports:{}};s[e].call(t.exports,t,t.exports,n);t.l=true;return t.exports}n.m=s;n.c=o;n.d=function(e,t,o){if(!n.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:o})}};n.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};n.t=function(t,e){if(e&1)t=n(t);if(e&8)return t;if(e&4&&typeof t==="object"&&t&&t.__esModule)return t;var o=Object.create(null);n.r(o);Object.defineProperty(o,"default",{enumerable:true,value:t});if(e&2&&typeof t!="string")for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o};n.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};n.d(e,"a",e);return e};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";var t=window["webpackJsonp"]=window["webpackJsonp"]||[];var r=t.push.bind(t);t.push=e;t=t.slice();for(var a=0;a<t.length;a++)e(t[a]);var f=r;h.push([486,0]);return c()})({486:function(e,t,o){o(51);o(52);e.exports=o(543)},487:function(e,t){},543:function(e,t,o){"use strict";o.r(t);var r=o(487);var c=o(19);var a=o(25);var i=o(18);var n=o(30);var l=o(73);var s=o(16);var u=o(33);var h=o(34);var f=o(23);var g=o(1);var p=o(182);var v=o(226);var _=o(72);var d=o(2);var y=o(15);var w=o(293);var b=o(27);var m=angular.module("ngeoMobileGeolocation",[p["a"].module.name,v["a"].module.name]);m.GeolocationEventType={ERROR:"mobile-geolocation-error"};m.directive_=function(){return{restrict:"A",scope:{getMobileMapFn:"&ngeoMobileGeolocationMap",getMobileGeolocationOptionsFn:"&ngeoMobileGeolocationOptions"},controller:"ngeoGeolocationMobileController"}};m.directive("ngeoMobileGeolocation",m.directive_);m.Controller_=function(o,e,r,t,a){var i=this;e.on("click",this.toggleTracking.bind(this));var n=o["getMobileMapFn"]();g["a"].assertInstanceof(n,c["a"]);this.$scope_=o;this.map_=n;var l=o["getMobileGeolocationOptionsFn"]()||{};g["a"].assertObject(l);this.notification_=a;this.featureOverlay_=t.getFeatureOverlay();this.geolocation_=new w["a"]({projection:n.getView().getProjection(),trackingOptions:{enableHighAccuracy:true}});if(l.autorotate){this.autorotateListener()}this.geolocation_.on("error",function(e){i.untrack_();var t;switch(e.code){case 1:t=r.getString("User denied the request for Geolocation.");break;case 2:t=r.getString("Location information is unavailable.");break;case 3:t=r.getString("The request to get user location timed out.");break;default:t=r.getString("Geolocation: An unknown error occurred.");break}i.notification_.error(t);o.$emit(m.GeolocationEventType.ERROR,e)});this.positionFeature_=new y["a"];if(l.positionFeatureStyle){this.positionFeature_.setStyle(l.positionFeatureStyle)}this.accuracyFeature_=new y["a"];if(l.accuracyFeatureStyle){this.accuracyFeature_.setStyle(l.accuracyFeatureStyle)}this.zoom_=l.zoom;this.follow_=false;this.viewChangedByMe_=false;d["a"](this.geolocation_,"change:accuracyGeometry",function(){i.accuracyFeature_.setGeometry(i.geolocation_.getAccuracyGeometry());i.setPosition_()});d["a"](this.geolocation_,"change:position",function(){i.setPosition_()});var s=n.getView();d["a"](s,"change:center",this.handleViewChange_,this);d["a"](s,"change:resolution",this.handleViewChange_,this)};m.Controller_.$inject=["$scope","$element","gettextCatalog","ngeoFeatureOverlayMgr","ngeoNotification"];m.Controller_.prototype.toggleTracking=function(){if(this.geolocation_.getTracking()){var e=this.geolocation_.getPosition();if(e===undefined){this.untrack_();this.$scope_.$emit(m.GeolocationEventType.ERROR,null);return}g["a"].assert(e!==undefined);var t=this.map_.getView().getCenter();var o=Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1]);if(o<2){this.untrack_()}else{this.untrack_();this.track_()}}else{this.track_()}};m.Controller_.prototype.track_=function(){this.featureOverlay_.addFeature(this.positionFeature_);this.featureOverlay_.addFeature(this.accuracyFeature_);this.follow_=true;this.geolocation_.setTracking(true)};m.Controller_.prototype.untrack_=function(){this.featureOverlay_.clear();this.follow_=false;this.geolocation_.setTracking(false);this.notification_.clear()};m.Controller_.prototype.setPosition_=function(){var e=this.geolocation_.getPosition();var t=new b["a"](e);this.positionFeature_.setGeometry(t);var o=this.accuracyFeature_.getGeometry();if(this.follow_){this.viewChangedByMe_=true;if(this.zoom_!==undefined){this.map_.getView().setCenter(e);this.map_.getView().setZoom(this.zoom_)}else if(o){var r=this.map_.getSize();this.map_.getView().fit(o,r)}this.viewChangedByMe_=false}};m.Controller_.prototype.handleViewChange_=function(e){if(this.follow_&&!this.viewChangedByMe_){this.follow_=false}};m.Controller_.prototype.autorotateListener=function(){var t=this;var o=0;if(window.hasOwnProperty("ondeviceorientationabsolute")){window.addEventListener("deviceorientationabsolute",function(e){o=t.handleRotate_(e.alpha,o)},true)}else if(window.hasOwnProperty("ondeviceorientation")){window.addEventListener("deviceorientation",function(e){if(e.webkitCompassHeading){o=t.handleRotate_(-e.webkitCompassHeading,o)}else{o=t.handleRotate_(e.alpha-270,o)}},true)}else{console.error("Orientation is not supported on this device")}};m.Controller_.prototype.handleRotate_=function(e,t){if(this.geolocation_.getTracking()&&Math.abs(e-t)>.2){t=e;var o=t*Math.PI/180;this.map_.getView().animate({rotation:o,duration:350,easing:_["d"]})}return t};m.controller("ngeoGeolocationMobileController",m.Controller_);var M=m;var C={};var O=angular.module("app",["gettext",M.name,f["a"].name]);C.MainController=function(e,t){var o=new s["c"]({image:new l["a"]({radius:6,fill:new u["a"]({color:"rgba(230, 100, 100, 1)"}),stroke:new h["a"]({color:"rgba(230, 40, 40, 1)",width:2})})});var r=new s["c"]({fill:new u["a"]({color:"rgba(100, 100, 230, 0.3)"}),stroke:new h["a"]({color:"rgba(40, 40, 230, 1)",width:2})});this.mobileGeolocationOptions={positionFeatureStyle:o,accuracyFeatureStyle:r,zoom:17,autorotate:true};this.map=new c["a"]({layers:[new i["a"]({source:new n["b"]})],view:new a["a"]({center:[0,0],zoom:4})});t.init(this.map)};C.MainController.$inject=["$scope","ngeoFeatureOverlayMgr"];O.controller("MainController",C.MainController);var k=t["default"]=C}});
//# sourceMappingURL=mobilegeolocation.5a65d3.js.map