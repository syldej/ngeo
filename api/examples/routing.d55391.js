!function(u){function t(t){for(var e,n,o=t[0],r=t[1],i=t[2],a=0,s=[];a<o.length;a++)n=o[a],c[n]&&s.push(c[n][0]),c[n]=0;for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(u[e]=r[e]);for(h&&h(t);s.length;)s.shift()();return g.push.apply(g,i||[]),l()}function l(){for(var t,e=0;e<g.length;e++){for(var n=g[e],o=!0,r=1;r<n.length;r++){var i=n[r];0!==c[i]&&(o=!1)}o&&(g.splice(e--,1),t=a(a.s=n[0]))}return t}var n={},c={37:0},g=[];function a(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return u[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=u,a.c=n,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var e=window.webpackJsonp=window.webpackJsonp||[],o=e.push.bind(e);e.push=t,e=e.slice();for(var r=0;r<e.length;r++)t(e[r]);var h=o;g.push([513,0]),l()}({513:function(t,e,n){n(52),n(53),t.exports=n(535)},514:function(t,e){},516:function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="ngeo-nominatim-input">\n  <input type="text"\n         class="form-control"\n         placeholder="{{$ctrl.placeholder}}"\n         ng-model="$ctrl.inputValue"\n         ngeo-search="$ctrl.options"\n         ngeo-search-datasets="$ctrl.datasets"\n         ngeo-search-listeners="$ctrl.listeners">\n</div>\n';return __p}},517:function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="ngeo-routing-feature">\n    <div class="input-group">\n      <ngeo-nominatim-input\n        ngeo-nominatim-input-value="$ctrl.featureLabel"\n        ngeo-nominatim-input-placeholder="{{\'Search...\' | translate}}"\n        ngeo-nominatim-input-on-select="$ctrl.onSelect">\n      </ngeo-nominatim-input>\n      <div class="input-group-addon btn" ng-click="$ctrl.set()">\n        <span class="fa fa-map-marker"></span>\n      </div>\n    </div>\n</div>\n';return __p}},518:function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="ngeo-routing">\n  <div class="ngeo-routing-start form-group">\n    <ngeo-routing-feature\n      ngeo-routing-feature-map="$ctrl.map"\n      ngeo-routing-feature-feature="$ctrl.startFeature_"\n      ngeo-routing-feature-fill-color="$ctrl.colors[\'start.fill\']"\n      ngeo-routing-feature-stroke-color="$ctrl.colors[\'start.stroke\']"\n      ngeo-routing-feature-on-change="$ctrl.handleChange">\n    </ngeo-routing-feature>\n  </div>\n\n    <div class="ngeo-routing-vias form-group" ng-repeat="(index, via) in $ctrl.viaArray">\n      <div class="form-inline">\n        <div class="form-group">\n          <ngeo-routing-feature\n            ngeo-routing-feature-map="$ctrl.map"\n            ngeo-routing-feature-feature="via.feature"\n            ngeo-routing-feature-fill-color="$ctrl.colors[\'via.fill\']"\n            ngeo-routing-feature-stroke-color="$ctrl.colors[\'via.stroke\']"\n            ngeo-routing-feature-on-change="$ctrl.handleChange">\n          </ngeo-routing-feature>\n        </div>\n        <button type="button" class="btn btn-default delete-via" ng-click="$ctrl.deleteVia(index)">\n          <span class="fa fa-trash"></span>\n        </button>\n      </div>\n    </div>\n\n  <div class="ngeo-routing-destination form-group">\n    <ngeo-routing-feature\n      ngeo-routing-feature-map="$ctrl.map"\n      ngeo-routing-feature-feature="$ctrl.targetFeature_"\n      ngeo-routing-feature-fill-color="$ctrl.colors[\'destination.fill\']"\n      ngeo-routing-feature-stroke-color="$ctrl.colors[\'destination.stroke\']"\n      ngeo-routing-feature-on-change="$ctrl.handleChange">\n    </ngeo-routing-feature>\n  </div>\n\n  <div class="form-group fill">\n    <button type="button" class="btn btn-default" ng-click="$ctrl.clearRoute()">\n      <span class="fa fa-trash"></span> <span translate>Clear</span>\n    </button>\n    <button type="button" class="btn btn-default" ng-click="$ctrl.reverseRoute()">\n      <span class="fa fa-exchange-alt"></span> <span translate>Reverse</span>\n    </button>\n    <button type="button" class="btn btn-default" ng-click="$ctrl.addVia()">\n      <span class="fa fa-plus"></span> <span translate>Add via</span>\n    </button>\n  </div>\n\n  <div class="clearfix"></div>\n\n  <div ng-if="$ctrl.routingProfiles.length > 1">\n    <div class="form-group">\n      <label class="col-form-label col-md-4" translate>Profile</label>\n      <div class="col-md-8">\n        <select class="form-control" ng-model="$ctrl.selectedRoutingProfile">\n          <option ng-repeat="profile in $ctrl.routingProfiles" ng-value="profile">{{profile.label}}</option>\n        </select>\n      </div>\n    </div>\n  </div>\n\n  <div class="ngeo-routing-error form-group clearfix"\n       ng-hide="$ctrl.errorMessage === \'\'">\n    {{$ctrl.errorMessage}}\n  </div>\n\n  <div class="clearfix"></div>\n\n  <div ng-hide="$ctrl.routeDuration === null && $ctrl.routeDistance <= 0">\n    <div class="row">\n      <div class="col-md-12">\n        <strong translate>Route statistics</strong>\n      </div>\n    </div>\n    <div class="row" ng-hide="$ctrl.routeDuration === null">\n      <div class="col-md-4 text-right" translate>\n        Duration\n      </div>\n      <div class="col-md-8">\n        {{$ctrl.routeDuration | ngeoDuration}}\n      </div>\n    </div>\n\n    <div class="row" ng-hide="$ctrl.routeDistance <= 0">\n      <div class="col-md-4 text-right" translate>\n        Distance\n      </div>\n      <div class="col-md-8">\n        {{$ctrl.routeDistance | ngeoUnitPrefix:\'m\'}}\n      </div>\n    </div>\n  </div>\n</div>\n';return __p}},519:function(t,e){},535:function(t,e,n){"use strict";n.r(e);n(514),n(308),n(309),n(515);var o=n(19),r=n(141),i=n(105),a=function(t,e,n){this.$http_=t,this.ngeoDebounce_=n,this.nominatimUrl_="https://nominatim.openstreetmap.org/",e.has("ngeoNominatimUrl")&&(this.nominatimUrl_=e.get("ngeoNominatimUrl"),"/"!==this.nominatimUrl_.substr(-1)&&(this.nominatimUrl_+="/")),this.searchDefaultParams_={},e.has("ngeoNominatimSearchDefaultParams")&&(this.searchDefaultParams_=e.get("ngeoNominatimSearchDefaultParams")),this.typeaheadDebounceDelay_=500,this.typeaheadSourceDebounced=this.ngeoDebounce_(this.typeaheadSource_.bind(this),this.typeaheadDebounceDelay_,!0)};a.$inject=["$http","$injector","ngeoDebounce"],a.$inject=["$http","$injector","ngeoDebounce"],a.prototype.search=function(t,e){var n=this.nominatimUrl_+"search?q="+t;if(e=e||{},(e=Object.assign({},this.searchDefaultParams_,e)).format="json",e){n+="&";for(var o=[],r=Object.keys(e),i=0;i<r.length;i++){var a=r[i];o.push(a+"="+e[a])}n+=o.join("&")}return this.$http_.get(n)},a.prototype.reverse=function(t,e){var n=this.nominatimUrl_+"reverse";if((e=Object.assign({},e)).lon=t[0],e.lat=t[1],e.format="json",e){n+="?";for(var o=[],r=Object.keys(e),i=0;i<r.length;i++){var a=r[i];o.push(a+"="+e[a])}n+=o.join("&")}return this.$http_.get(n)},a.prototype.typeaheadSource_=function(t,e,n){this.search(t,{}).then(function(t){n(t.data.map(function(t){return{coordinate:[t.lon,t.lat],name:t.display_name}}))},function(t){n([])})},(a.module=angular.module("ngeoNominatimService",[r.a.name])).service("ngeoNominatimService",a);var s=a,u=function(t,e){this.$http_=t,this.routingOptions_=e.has("ngeoRoutingOptions")?e.get("ngeoRoutingOptions"):{},this.ngeoOsrmBackendUrl_=this.routingOptions_.backendUrl||"https://router.project-osrm.org/","/"!==this.ngeoOsrmBackendUrl_.substr(-1)&&(this.ngeoOsrmBackendUrl_+="/"),this.protocolVersion_="v1"};u.$inject=["$http","$injector"],u.$inject=["$http","$injector"],u.prototype.getRoute=function(t,e){(e=e||{}).service||(e.service="route"),e.profile||(e.profile="car");var n=this.ngeoOsrmBackendUrl_;if(e.instance&&(n+=e.instance+"/"),n+=e.service+"/"+this.protocolVersion_+"/"+e.profile+"/",n+=t.map(function(t){return t.join(",")}).join(";"),e.options){n+="?";for(var o=[],r=Object.keys(e.options),i=0;i<r.length;i++){var a=r[i];o.push(a+"="+e.options[a])}n+=o.join("&")}return this.$http_.get(n)},u.prototype.getNearest=function(t,e){(e=e||{}).service="nearest",e.profile||(e.profile="car");var n=this.ngeoOsrmBackendUrl_;if(e.instance&&(n+=e.instance+"/"),n+=e.service+"/"+this.protocolVersion_+"/"+e.profile+"/",n+=t.join(","),e.options){n+="?";for(var o=[],r=Object.keys(e.options),i=0;i<r.length;i++){var a=r[i];o.push(a+"="+e.options[a])}n+=o.join("&")}return this.$http_.get(n)},(u.module=angular.module("ngeoRoutingService",[])).service("ngeoRoutingService",u);var l=u,c=n(283),g={};function h(t,e){return e(t)}g.module=angular.module("ngeoRoutingNominatimInputComponent",[c.a.module.name,s.module.name]),g.module.run(["$templateCache",function(t){t.put("ngeo/routing/nominatiminput",n(516))}]),g.module.value("ngeoRoutingNominatimInputComponentTemplateUrl",function(t){var e=t.ngeoRoutingNominatimInputComponentTemplateUrl;return void 0!==e?e:"ngeo/routing/nominatiminput"}),h.$inject=["$attrs","ngeoRoutingNominatimInputComponentTemplateUrl"],g.Controller=function(t,e,n,o){this.element_=t,this.$scope_=n,this.ngeoNominatimService=o,this.onSelect,this.inputValue,this.options={},this.datasets=[{name:"nominatim",display:"name",source:this.ngeoNominatimService.typeaheadSourceDebounced}],this.listeners={select:this.select_.bind(this)},this.placeholder=""},g.Controller.$inject=["$element","$injector","$scope","ngeoNominatimService"],g.Controller.prototype.select_=function(t,e,n){this.onSelect&&this.onSelect(e)};var p={controller:g.Controller,bindings:{onSelect:"=?ngeoNominatimInputOnSelect",inputValue:"=?ngeoNominatimInputValue",placeholder:"@?ngeoNominatimInputPlaceholder"},templateUrl:h};g.module.component("ngeoNominatimInput",p);var m=g,d=n(6),f=n(15),v=n(32),_=n(37),y=n(42),b=n(14),$=n(119),C=n(35),w=n(36),F=n(28),j=n(209),S=n(70),R=(n(193),{});function P(t,e){return e(t)}R.module=angular.module("ngeoRoutingFeatureComponent",[s.module.name,m.module.name]),R.module.run(["$templateCache",function(t){t.put("ngeo/routing/routingfeature",n(517))}]),R.module.value("ngeoRoutingFeatureTemplateUrl",function(t){var e=t.ngeoRoutingFeatureTemplateUrl;return void 0!==e?e:"ngeo/routing/routingfeature"}),P.$inject=["$attrs","ngeoRoutingFeatureTemplateUrl"],R.Controller=function(t,e,n,o){this.scope_=t,this.timeout_=e,this.$q_=n,this.ngeoNominatimService_=o,this.map,this.feature,this.featureLabel="",this.fillColor,this.strokeColor,this.onChange,this.vectorFeatures_=new v.a,this.vectorSource_=new _.a({features:this.vectorFeatures_}),this.vectorLayer_=new y.a({source:this.vectorSource_,style:function(t,e){return[new b.c({text:new $.a({fill:new C.a({color:this.fillColor||"#000000"}),font:"normal 30px FontAwesome",offsetY:-15,stroke:new w.a({width:3,color:this.strokeColor||"#000000"}),text:"ï"})})]}.bind(this)}),this.modifyFeature_=new j.a({features:this.vectorFeatures_}),this.draw_=null,this.onSelect=this.onSelect_.bind(this),this.errorMessage=""},R.Controller.$inject=["$scope","$timeout","$q","ngeoNominatimService"],R.Controller.prototype.$onInit=function(){var n=this;this.map.addLayer(this.vectorLayer_),this.modifyFeature_.setActive(!0),this.map.addInteraction(this.modifyFeature_),this.modifyFeature_.on("modifyend",function(t){var e=t.features.getArray()[0];n.vectorSource_.clear(),n.snapFeature_(e)}),this.scope_.$watch(function(){return n.feature},function(t,e){t&&n.onFeatureChange_(),null===t&&(n.vectorSource_.clear(),n.featureLabel="")})},R.Controller.prototype.$onDestroy=function(){this.map.removeLayer(this.vectorLayer_),this.modifyFeature_.setActive(!1),this.map.removeInteraction(this.modifyFeature_)},R.Controller.prototype.set=function(){var e=this;this.draw_&&this.map.removeInteraction(this.draw_),this.draw_=new S.a({features:this.vectorFeatures_,type:"Point"}),this.draw_.on("drawstart",function(){e.feature&&e.vectorSource_.removeFeature(e.feature)}),this.draw_.on("drawend",function(t){e.draw_&&e.map.removeInteraction(e.draw_),e.snapFeature_(t.feature),e.modifyFeature_.setActive(!0)}),this.modifyFeature_.setActive(!1),this.map.addInteraction(this.draw_)},R.Controller.prototype.setFeature_=function(t,e){var n=d.f(t,this.map.getView().getProjection());""===e&&(e=n.join("/")),this.feature=new f.a({geometry:new F.a(n),name:e})},R.Controller.prototype.onFeatureChange_=function(){var t=this;this.featureLabel=this.feature.get("name")||"",this.vectorSource_.clear(),this.vectorSource_.addFeature(this.feature),this.onChange&&this.timeout_(function(){t.onChange(t.feature)})},R.Controller.prototype.onSelect_=function(t){var e=t.coordinate.map(parseFloat),n=t.label;this.setFeature_(e,n);var o=this.feature.getGeometry().getCoordinates();this.map.getView().setCenter(o)},R.Controller.prototype.snapFeature_=function(t){var e=this.getLonLatFromPoint_(t),n=function(t){var e=[parseFloat(t.data.lon),parseFloat(t.data.lat)],n=t.data.display_name;this.setFeature_(e,n)}.bind(this),o=function(t){this.errorMessage="Error: nominatim server not responding.",console.log(t)}.bind(this);this.$q_.when(this.ngeoNominatimService_.reverse(e,{})).then(n.bind(this),o.bind(this))},R.Controller.prototype.getLonLatFromPoint_=function(t){var e=t.getGeometry().getCoordinates(),n=this.map.getView().getProjection();return d.l(e,n)},R.component_={controller:R.Controller,bindings:{map:"<ngeoRoutingFeatureMap",feature:"=ngeoRoutingFeatureFeature",fillColor:"<?ngeoRoutingFeatureFillColor",strokeColor:"<?ngeoRoutingFeatureStrokeColor",onChange:"=?ngeoRoutingFeatureOnChange"},templateUrl:P},R.module.component("ngeoRoutingFeature",R.component_);var k=R,D=n(158),O=n(40),x={};function U(t,e){return e(t)}x.module=angular.module("ngeoRoutingComponent",[r.a.name,i.a.name,s.module.name,l.module.name,k.module.name]),x.module.run(["$templateCache",function(t){t.put("ngeo/routing/routing",n(518))}]),x.module.value("ngeoRoutingTemplateUrl",function(t){var e=t.ngeoRoutingTemplateUrl;return void 0!==e?e:"ngeo/routing/routing"}),U.$inject=["$attrs","ngeoRoutingTemplateUrl"],x.Controller=function(t,e,n,o,r,i){var a=this;this.$scope_=e,this.ngeoRoutingService_=n,this.ngeoNominatimService_=o,this.routingOptions_=t.has("ngeoRoutingOptions")?t.get("ngeoRoutingOptions"):{},this.routingProfiles=this.routingOptions_.profiles||[],this.selectedRoutingProfile=0<this.routingProfiles.length?this.routingProfiles[0]:null,e.$watch(function(){return a.selectedRoutingProfile},this.calculateRoute.bind(this)),this.$q_=r,this.map,this.errorMessage="",this.startFeature_=null,this.targetFeature_=null,this.viaArray=[],this.colors={"start.fill":"#6BE62E","start.stroke":"#4CB01E","destination.fill":"#FF3E13","destination.stroke":"#CD3412","via.fill":"#767676","via.stroke":"#000000"},this.routeSource_=new _.a({features:[]}),this.routeLayer_=new y.a({source:this.routeSource_,style:new b.c({fill:new C.a({color:"rgba(16, 112, 29, 0.6)"}),stroke:new w.a({color:"rgba(16, 112, 29, 0.6)",width:5})})}),this.routeDistance=0,this.routeDuration=null,this.regexIsFormattedCoord=/\d+\.\d+\/\d+\.\d+/,this.draw_=null;this.handleChange=i(this.calculateRoute.bind(this),200,!0)},x.Controller.$inject=["$injector","$scope","ngeoRoutingService","ngeoNominatimService","$q","ngeoDebounce"],x.Controller.prototype.$onInit=function(){this.map.addLayer(this.routeLayer_)},x.Controller.prototype.clearRoute=function(){this.startFeature_=null,this.targetFeature_=null,this.viaArray=[],this.routeDistance=0,this.routeDuration=null,this.routeSource_.clear(),this.errorMessage=""},x.Controller.prototype.getLonLatFromPoint_=function(t){var e=t.getGeometry().getCoordinates(),n=this.map.getView().getProjection();return d.l(e,n)},x.Controller.prototype.reverseRoute=function(){var t=this.startFeature_;this.startFeature_=this.targetFeature_,this.targetFeature_=t,this.viaArray=this.viaArray.reverse()},x.Controller.prototype.parseRoute_=function(t){var e,n=[],o=new D.a,r={dataProjection:"EPSG:4326",featureProjection:this.map.getView().getProjection()};t.legs?(n=t.legs.map(function(t){return t.steps.map(function(t){return new f.a({geometry:o.readGeometry(t.geometry,r)})})}),n=(e=[]).concat.apply(e,n)):t.geometry&&n.push(new f.a({geometry:o.readGeometry(t.geometry,r)}));return n},x.Controller.prototype.calculateRoute=function(){var e=this;if(this.startFeature_&&this.targetFeature_){this.routeSource_.clear();var t=this.getLonLatFromPoint_(this.startFeature_),n=this.getLonLatFromPoint_(this.targetFeature_),o=this.viaArray.filter(function(t){return null!==t.feature}).map(function(t){return e.getLonLatFromPoint_(t.feature)}),r=[t].concat(o,[n]),i=function(t){var e=this.parseRoute_(t.data.routes[0]);if(0!==e.length){this.routeSource_.addFeatures(e),this.map.getView().fit(this.routeSource_.getExtent()),this.routeDistance=parseInt(t.data.routes[0].distance,10),this.routeDuration=t.data.routes[0].duration;var n=e[0].getGeometry().getCoordinateAt(0),o=e[e.length-1].getGeometry().getCoordinateAt(1),r=[this.startFeature_.getGeometry().getCoordinates(),n],i=[o,this.targetFeature_.getGeometry().getCoordinates()],a=[new f.a(new O.a(r)),new f.a(new O.a(i))];this.routeSource_.addFeatures(a)}else console.log("No route or not supported format.")}.bind(this),a=function(t){this.errorMessage="Error: routing server not responding.",console.log(t)}.bind(this),s={steps:!0,overview:!1,geometries:"geojson"},u={};u.options=s,this.selectedRoutingProfile&&(u.instance=this.selectedRoutingProfile.profile),this.$q_.when(this.ngeoRoutingService_.getRoute(r,u)).then(i.bind(this),a.bind(this))}},x.Controller.prototype.addVia=function(){this.viaArray.push({feature:null,onSelect:null})},x.Controller.prototype.deleteVia=function(t){this.viaArray.length>t&&(this.viaArray.splice(t,1),this.calculateRoute())},x.module.component("ngeoRouting",{controller:x.Controller,bindings:{map:"<ngeoRoutingMap"},templateUrl:U});var L=x,N=(n(519),angular.module("ngeoRoutingModule",[L.module.name])),A=n(18),I=n(26),M=n(17),V=n(31),T={};T.module=angular.module("app",["gettext",o.a.name,N.name]),T.MainController=function(){this.map=new A.a({layers:[new M.a({source:new V.b})],view:new I.a({center:[931010.1535989442,5961705.842297254],zoom:9})}),this.routingfeatureActive=!0},T.module.controller("MainController",T.MainController);e.default=T}});
//# sourceMappingURL=routing.d55391.js.map