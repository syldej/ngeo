!function(l){function e(e){for(var t,r,o=e[0],n=e[1],a=e[2],i=0,s=[];i<o.length;i++)r=o[i],h[r]&&s.push(h[r][0]),h[r]=0;for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(l[t]=n[t]);for(f&&f(e);s.length;)s.shift()();return d.push.apply(d,a||[]),u()}function u(){for(var e,t=0;t<d.length;t++){for(var r=d[t],o=!0,n=1;n<r.length;n++){var a=r[n];0!==h[a]&&(o=!1)}o&&(d.splice(t--,1),e=i(i.s=r[0]))}return e}var r={},h={20:0},d=[];function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return l[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=l,i.c=r,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(r,o,function(e){return t[e]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var t=window.webpackJsonp=window.webpackJsonp||[],o=t.push.bind(t);t.push=e,t=t.slice();for(var n=0;n<t.length;n++)e(t[n]);var f=o;d.push([583,0]),u()}({583:function(e,t,r){r(71),r(72),e.exports=r(584)},584:function(e,t,r){"use strict";r.r(t);r(585);var d=r(1),o=r(212),s=r(175),n=r(24),a=r(151),i=r(171),f={};f.module=angular.module("gmfapp",["gettext",o.a.module.name,s.a.module.name,n.a.module.name]),f.module.value("gmfTreeUrl","https://geomapfish-demo-dc.camptocamp.com/2.4/themes?version=2&background=background"),f.module.value("gmfLayersUrl","https://geomapfish-demo-dc.camptocamp.com/2.4/layers/"),f.module.constant("defaultTheme","Demo"),f.module.constant("angularLocaleScript","../build/angular-locale_{{locale}}.js"),f.MainController=function(e,t,r,o,n){var s=this;this.http_=e,this.q_=t,this.gmfThemes_=o,this.gmfXSDAttributes_=n,this.urls=[{name:"oeedit app. (hosted)",url:"apps/oeedit/"},{name:"oeedit app. (dev)",url:"../apps/oeedit/"},{name:"example",url:"objectediting.html"}],this.viewerUrlDev_="../apps/oeview/",this.viewerUrlHosted_="apps/oeview/",this.selectedUrl=this.urls[0],this.gmfServers_,this.gmfServer_,this.gmfLayerNodes=[],this.selectedGmfLayerNode=null,this.featuresCache_={},this.features=null,this.selectedFeature=null,this.geomTypeCache_={},this.selectedGeomType=void 0,r.$watch(function(){return s.selectedGmfLayerNode},function(e,t){s.selectedFeature=null,e&&(s.getFeatures_(e).then(s.handleGetFeatures_.bind(s,e)),s.getGeometryType_(e).then(s.handleGetGeometryType_.bind(s,e)))}),this.themeName="ObjectEditing",this.gmfThemes_.loadThemes(),this.gmfThemes_.getOgcServersObject().then(function(e){s.gmfServers_=e,s.gmfThemes_.getThemesObject().then(function(e){if(e){var t,r,o;for(t=0,r=e.length;t<r;t++)if(e[t].name===s.themeName){o=e[t];break}if(o){var n=o.children[0];d.a.assert(n.ogcServer);var a=s.gmfServers_[n.ogcServer];if(a&&!0===a.wfsSupport&&a.urlWfs){s.gmfServer_=a;var i=[];for(t=0,r=n.children.length;t<r;t++)n.children[t].metadata.identifierAttributeField&&i.push(n.children[t]);s.gmfLayerNodes=i,s.selectedGmfLayerNode=s.gmfLayerNodes[1]}}}})})},f.MainController.$inject=["$http","$q","$scope","gmfThemes","gmfXSDAttributes"],f.MainController.prototype.runEditor=function(){var e=this.selectedGeomType,t=this.selectedFeature,r=this.selectedGmfLayerNode.id,o=this.selectedGmfLayerNode.metadata.identifierAttributeField;d.a.assert(void 0!==o);var n=t.get(o),a={};a[s.a.Param.GEOM_TYPE]=e,a[s.a.Param.ID]=n,a[s.a.Param.LAYER]=r,a[s.a.Param.THEME]=this.themeName,a[s.a.Param.PROPERTY]=o;var i=f.MainController.appendParams(this.selectedUrl.url,a);window.open(i)},f.MainController.prototype.runViewerDev=function(){this.runViewer_(this.viewerUrlDev_)},f.MainController.prototype.runViewerHosted=function(){this.runViewer_(this.viewerUrlHosted_)},f.MainController.prototype.runViewer_=function(e){var t=this.selectedGmfLayerNode,r=t.id,o=t.name,n=t.metadata.identifierAttributeField;d.a.assert(void 0!==n);for(var a=[],i=this.featuresCache_[r],s=0,l=i.length;s<l;s++)a.push(i[s].get(n));var u={};u.wfs_layer=o,u["wfs_"+n]=a.join(",");var h=f.MainController.appendParams(e,u);window.open(h)},f.MainController.prototype.getFeatures_=function(e){return this.getFeaturesDeferred_=this.q_.defer(),this.getFeaturesFromCache_(e)?this.getFeaturesDeferred_.resolve():this.issueGetFeatures_(e),this.getFeaturesDeferred_.promise},f.MainController.prototype.issueGetFeatures_=function(e){var r=this,o=e.id,t=f.MainController.appendParams(this.gmfServer_.urlWfs,{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:"1.1.0",TYPENAME:e.layers});this.http_.get(t).then(function(e){var t=(new a.a).readFeatures(e.data);r.featuresCache_[o]=t,r.getFeaturesDeferred_.resolve()})},f.MainController.prototype.handleGetFeatures_=function(e){var t=this.getFeaturesFromCache_(e);this.features=t,this.selectedFeature=this.features[0]},f.MainController.prototype.getFeaturesFromCache_=function(e){var t=e.id;return this.featuresCache_[t]||null},f.MainController.prototype.getGeometryType_=function(e){return this.getGeometryTypeDeferred_=this.q_.defer(),this.getGeometryTypeFromCache_(e)?this.getGeometryTypeDeferred_.resolve():this.issueGetAttributesRequest_(e),this.getGeometryTypeDeferred_.promise},f.MainController.prototype.issueGetAttributesRequest_=function(e){this.gmfXSDAttributes_.getAttributes(e.id).then(function(e,t){var r=i.a.getGeometryAttribute(t);r&&r.geomType&&(this.geomTypeCache_[e.id]=r.geomType,this.getGeometryTypeDeferred_.resolve())}.bind(this,e))},f.MainController.prototype.handleGetGeometryType_=function(e){var t=this.getGeometryTypeFromCache_(e);this.selectedGeomType=t},f.MainController.prototype.getGeometryTypeFromCache_=function(e){var t=e.id;return this.geomTypeCache_[t]},f.MainController.appendParams=function(e,t){var r=[];Object.keys(t).forEach(function(e){null!==t[e]&&void 0!==t[e]&&r.push(e+"="+encodeURIComponent(t[e]))});var o=r.join("&");return(e=-1===(e=e.replace(/[?&]$/,"")).indexOf("?")?e+"?":e+"&")+o},f.module.controller("MainController",f.MainController),t.default=f},585:function(e,t){}});
//# sourceMappingURL=objecteditinghub.d1948c.js.map